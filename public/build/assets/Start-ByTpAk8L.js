import{r as b,E as w,q as D,g as G,G as U,j,o,w as q,d as t,b as v,t as m,f as d,c as r,k as $,n as K,F as R,m as J,a as E}from"./vendor-D9AtPSqO.js";import{A as Q}from"./AppLayout-DFKJl1WW.js";import W from"./MenuNavigation-B7E3ZTxP.js";import X from"./PointRenderer-DpwUU6q0.js";import Y from"./AddDamageModal-kuUBoBPD.js";import Z from"./SummaryModal-DTeXntKn.js";import"./app-lVSMz3ZX.js";const ee={class:"space-y-6"},te={class:"bg-white rounded-xl shadow p-6"},ne={class:"flex justify-between items-start"},se={class:"text-2xl font-bold text-gray-900"},oe={class:"text-gray-600 mt-1"},ae={class:"font-medium"},ie={class:"flex items-center mt-3 space-x-4"},re={class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"},le={class:"text-sm text-gray-500"},de={class:"flex space-x-3"},ue=["disabled"],ce={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},me={key:1,class:"-ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ge={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},fe={class:"lg:col-span-1"},ve={class:"lg:col-span-3"},pe={class:"bg-white rounded-xl shadow overflow-hidden"},xe={class:"px-6 py-4 border-b bg-gray-50"},he={class:"flex justify-between items-center"},ye={class:"text-lg font-semibold text-gray-900"},be={class:"text-sm text-gray-600 mt-1"},we={class:"flex items-center space-x-3"},ke={key:0,class:"flex items-center text-sm text-gray-500"},Me={class:"p-6"},Ce={key:0,class:"flex justify-center py-12"},De={key:1},je={key:0,class:"text-center py-12"},Ae={class:"mt-6"},Be={key:1,class:"space-y-6"},Te={__name:"Start",props:{inspection:Object,currentMenu:Object,points:Array,allMenus:Array,uiConfig:Object,initialData:Object},setup(i){const u=i,k=b(!1),p=b(!1),x=b(!1),h=b(!1),a=w({...u.currentMenu,points:[...u.points]}),g=w({prevId:null,nextId:null,currentIndex:u.initialData.currentMenuIndex,totalMenus:u.initialData.totalMenus}),c=w({}),f=w({}),A=D(()=>g.currentIndex),O=D(()=>g.totalMenus),B=D(()=>Object.keys(c).length>0),y=async n=>{if(B.value){if(!confirm("Ada perubahan yang belum disimpan. Pindah menu?"))return;await _()}k.value=!0;try{const e=await E.get(`/api/form-inspection/${u.inspection.id}/menu/${n}`,{params:{current_values:c}});e.data.success&&(Object.assign(a,e.data.menu),a.points=e.data.points,Object.assign(g,e.data.navigation),Object.keys(c).forEach(s=>{delete c[s]}),Object.keys(f).forEach(s=>{delete f[s]}))}catch(e){console.error("Error changing menu:",e),alert("Gagal memuat menu")}finally{k.value=!1}},I=({pointId:n,value:e})=>{c[n]=e,u.uiConfig.autoSave&&P(n)},M=async n=>{var s,S;const e=c[n];if(e!==void 0)try{const l=await E.post(`/api/form-inspection/${u.inspection.id}/save`,{point_id:n,value:e});if(l.data.success){delete c[n],delete f[n],l.data.triggers&&l.data.triggers.length>0&&z(l.data.triggers);const C=a.points.findIndex(F=>F.id===n);C!==-1&&(a.points[C].currentValue=e,a.points[C].existingDataId=l.data.data.id)}}catch(l){console.error("Error saving point:",l),(S=(s=l.response)==null?void 0:s.data)!=null&&S.errors&&(f[n]=l.response.data.errors)}},_=async()=>{const n=Object.keys(c).map(e=>M(e));await Promise.all(n)},T=async()=>{p.value=!0;try{await _(),alert("Semua data berhasil disimpan!")}catch(n){console.error("Error saving all:",n),alert("Gagal menyimpan semua data")}finally{p.value=!1}},L=({pointId:n,errors:e})=>{e&&e.length>0?f[n]=e:delete f[n]},z=n=>{n.forEach(e=>{switch(e.action){case"show_damage":break;case"show_alert":alert(e.message);break}})},H=n=>{y(a.id),x.value=!1},N=n=>new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"long",year:"numeric"}).format(n);let V=null;const P=(n,e)=>{clearTimeout(V),V=setTimeout(()=>{M(n)},u.uiConfig.debounceDelay||1e3)};return G(()=>{window.addEventListener("beforeunload",n=>{B.value&&(n.preventDefault(),n.returnValue="")})}),U(()=>{window.removeEventListener("beforeunload")}),(n,e)=>(o(),j(Q,null,{default:q(()=>[t("div",ee,[t("div",te,[t("div",ne,[t("div",null,[t("h1",se,m(i.inspection.name),1),t("p",oe,[e[6]||(e[6]=d(" Kategori: ")),t("span",ae,m(i.inspection.category.name),1)]),t("div",ie,[t("span",re,[e[7]||(e[7]=t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),d(" ID: "+m(i.inspection.id),1)]),t("span",le," Dibuat: "+m(N(new Date)),1)])]),t("div",de,[t("button",{onClick:T,disabled:p.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"},[p.value?(o(),r("svg",ce,e[8]||(e[8]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(o(),r("svg",me,e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),e[10]||(e[10]=d(" Simpan Semua "))],8,ue),t("button",{onClick:e[0]||(e[0]=s=>h.value=!h.value),class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},e[11]||(e[11]=[t("svg",{class:"-ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),d(" Ringkasan ")]))])])]),t("div",ge,[t("div",fe,[$(W,{menus:i.allMenus,"current-menu-id":a.id,"current-index":A.value,onMenuChange:y,onDamageAdd:n.showAddDamage},null,8,["menus","current-menu-id","current-index","onDamageAdd"])]),t("div",ve,[t("div",pe,[t("div",xe,[t("div",he,[t("div",null,[t("h2",ye,[d(m(a.name)+" ",1),t("span",{class:K(["ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",a.type==="menu"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},m(a.type==="menu"?"Menu":"Damage"),3)]),t("p",be," Menu "+m(A.value+1)+" dari "+m(O.value),1)]),t("div",we,[i.uiConfig.autoSave?(o(),r("div",ke,e[12]||(e[12]=[t("svg",{class:"w-4 h-4 mr-1 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),d(" Auto-save aktif ")]))):v("",!0),g.prevId?(o(),r("button",{key:1,onClick:e[1]||(e[1]=s=>y(g.prevId)),class:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},e[13]||(e[13]=[t("svg",{class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),d(" Sebelumnya ")]))):v("",!0),g.nextId?(o(),r("button",{key:2,onClick:e[2]||(e[2]=s=>y(g.nextId)),class:"inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},e[14]||(e[14]=[d(" Selanjutnya "),t("svg",{class:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):v("",!0)])])]),t("div",Me,[k.value?(o(),r("div",Ce,e[15]||(e[15]=[t("div",{class:"text-center"},[t("svg",{class:"animate-spin h-8 w-8 text-blue-600 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("p",{class:"text-gray-600"},"Memuat data menu...")],-1)]))):(o(),r("div",De,[i.currentMenu.type==="damage"&&a.points.length===0?(o(),r("div",je,[e[17]||(e[17]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e[18]||(e[18]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Belum ada damage",-1)),e[19]||(e[19]=t("p",{class:"mt-1 text-sm text-gray-500"}," Tambahkan damage terlebih dahulu untuk menampilkan form ini. ",-1)),t("div",Ae,[t("button",{onClick:e[3]||(e[3]=s=>x.value=!0),type:"button",class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},e[16]||(e[16]=[t("svg",{class:"-ml-1 mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),d(" Tambah Damage ")]))])])):(o(),r("div",Be,[(o(!0),r(R,null,J(a.points,s=>(o(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[$(X,{point:s,"inspection-id":i.inspection.id,onValueChanged:I,onSave:M,onValidation:L},null,8,["point","inspection-id"])]))),128))]))]))])])])])]),x.value?(o(),j(Y,{key:0,"inspection-id":i.inspection.id,"current-menu-id":a.id,onClose:e[4]||(e[4]=s=>x.value=!1),onDamageAdded:H},null,8,["inspection-id","current-menu-id"])):v("",!0),h.value?(o(),j(Z,{key:1,inspection:i.inspection,"all-menus":i.allMenus,onClose:e[5]||(e[5]=s=>h.value=!1)},null,8,["inspection","all-menus"])):v("",!0)]),_:1}))}};export{Te as default};
