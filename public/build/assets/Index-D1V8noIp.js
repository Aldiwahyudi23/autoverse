import{r as v,q as R,E as O,c as i,o as n,d as e,b as T,z as A,A as Z,n as me,t as x,u as _,F as D,m as U,f as le,g as ge,G,H as ye,x as he,p as ke,I as ue,J as xe,j as de,w as _e,k as pe,v as we,C as Ce,y as ce}from"./vendor-BJzInWMf.js";import{A as $e}from"./AppLayout-BugnxmCo.js";import{l as Te}from"./lodash-0gsBDgrd.js";import{F as Be}from"./fuse-Ch1WBRTM.js";import{_ as Me}from"./app-BeoLapnA.js";const Se={class:"mb-2"},Ae={class:"flex items-center space-x-2"},Ie=["disabled"],Pe=["disabled"],De={key:1,class:"mt-2 text-sm text-red-600"},je={key:2,class:"mt-2 text-sm text-green-600"},Ve={key:3,class:"mt-2 text-sm text-yellow-600"},Ue={__name:"PlateNumberInput",props:{plateNumber:String,inspections:Array},emits:["update:plateNumber","plateValidityUpdate","carDataUpdate"],setup(J,{emit:I}){const o=J,B=I,b=v(""),y=v(""),g=v(""),$=v(""),w=v(""),h=v(""),m=v(!0),C={BL:"Aceh",BB:"Tapanuli (Sumatera Utara)",BK:"Medan, Deli Serdang, Binjai (Sumatera Utara)",BA:"Sumatera Barat",BM:"Riau",BH:"Jambi",BD:"Bengkulu",BG:"Sumatera Selatan",BN:"Bangka Belitung",BE:"Lampung",A:"Banten (Serang, Pandeglang, Cilegon, Lebak)",B:"Jakarta, Depok, Tangerang, Bekasi (Jadetabek)",D:"Bandung, Cimahi",E:"Cirebon, Indramayu, Majalengka, Kuningan",F:"Bogor, Sukabumi, Cianjur",T:"Karawang, Purwakarta, Subang, Bekasi Kabupaten, sebagian Cikampek",Z:"Garut, Tasikmalaya, Ciamis, Banjar, Sumedang",G:"Pekalongan, Tegal, Brebes, Pemalang, Batang",H:"Semarang, Kendal, Salatiga, Demak",K:"Pati, Kudus, Rembang, Blora, Jepara",R:"Banyumas, Cilacap, Purbalingga, Banjarnegara",AA:"Magelang, Temanggung, Purworejo, Wonosobo",AB:"DI Yogyakarta (Sleman, Bantul, Gunungkidul, Kulonprogo, Kota Jogja)",AD:"Surakarta (Solo), Sragen, Boyolali, Klaten, Wonogiri, Sukoharjo, Karanganyar",L:"Surabaya",M:"Madura (Bangkalan, Sampang, Pamekasan, Sumenep)",N:"Malang, Pasuruan, Probolinggo, Lumajang, Batu",P:"Jember, Banyuwangi, Bondowoso, Situbondo",S:"Bojonegoro, Lamongan, Tuban, Mojokerto, Jombang",W:"Sidoarjo, Gresik",AE:"Madiun, Magetan, Ngawi, Ponorogo, Pacitan",AG:"Kediri, Blitar, Tulungagung, Trenggalek",DK:"Bali",DR:"Lombok (NTB)",EA:"Sumbawa, Dompu, Bima (NTB)",DH:"Nusa Tenggara Timur (Kupang, Timor)",EB:"Flores, Lembata",ED:"Sumba",DA:"Kalimantan Selatan (Banjarmasin, Banjarbaru, dll.)",KB:"Kalimantan Barat (Pontianak, Singkawang, dll.)",KH:"Kalimantan Tengah (Palangkaraya, Sampit, dll.)",KT:"Kalimantan Timur (Balikpapan, Samarinda, Bontang, dll.)",KU:"Kalimantan Utara (Tarakan, Nunukan, Malinau, Tana Tidung, Bulungan)",DB:"Sulawesi Utara (Manado, Bitung, Minahasa, dll.)",DL:"Sangihe, Talaud (Sulut)",DM:"Gorontalo",DN:"Sulawesi Tengah (Palu, Poso, Banggai, dll.)",DT:"Sulawesi Tenggara (Kendari, Bau-bau, Kolaka, dll.)",DD:"Sulawesi Selatan (Makassar, Gowa, Bone, dll.)",DC:"Polewali Mandar, Majene, Mamasa (Sulbar)",DW:"Mamuju, Pasangkayu, Mamuju Tengah (Sulbar)",DE:"Maluku (Ambon, Maluku Tengah, dll.)",DG:"Maluku Utara (Ternate, Halmahera, dll.)",PA:"Papua (Jayapura, Merauke, dll.)",PB:"Papua Barat (Manokwari, Sorong, Fakfak, dll.)"},S=()=>{const r=`${b.value}${y.value}${g.value}`.toUpperCase();B("update:plateNumber",r)},P=r=>{r==="area"?b.value=b.value.toUpperCase().replace(/[^A-Z]/g,""):r==="number"?y.value=y.value.replace(/[^0-9]/g,""):r==="suffix"&&(g.value=g.value.toUpperCase().replace(/[^A-Z]/g,"")),S(),E()},E=()=>{b.value&&C[b.value]?(w.value=`âœ… ${b.value} = ${C[b.value]}`,m.value=!1):b.value?(w.value=`ðŸš« Kode wilayah "${b.value}" tidak valid`,m.value=!0):(w.value="âš  Masukkan kode wilayah (contoh: D, B, DK)",m.value=!0)},N=R(()=>b.value.trim().length>=1&&y.value.trim().length>=1&&!m.value);O(N,r=>{B("plateValidityUpdate",r)}),O([b,y,g],()=>{$.value="",h.value=""}),O(()=>o.plateNumber,r=>{r.length>=3&&d(r)});const d=r=>{const c=o.inspections.filter(k=>k.plate_number===r);if(c.length>0){const k=["draft","in_progress","pending","pending_review","revision"],p=c.find(L=>k.includes(L.status));if(p){$.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${p.status.replace(/_/g," ").toUpperCase()}. Selesaikan inspeksi tersebut terlebih dahulu.`,B("plateValidityUpdate",!1);return}const F=c.filter(L=>["approved","rejected","completed","cancelled"].includes(L.status));if(F.length>0){F.sort((q,j)=>new Date(j.created_at)-new Date(q.created_at));const L=F[0];B("carDataUpdate",{id:L.car_id,name:L.car_name}),h.value=`Nomor plat ini sudah pernah diperiksa ${F.length} kali sebelumnya.`}}};return(r,c)=>(n(),i("div",Se,[c[6]||(c[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nomor Plat Kendaraan ",-1)),e("div",Ae,[A(e("input",{"onUpdate:modelValue":c[0]||(c[0]=k=>b.value=k),type:"text",placeholder:"D",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[1]||(c[1]=k=>P("area")),maxlength:"2"},null,544),[[Z,b.value]]),A(e("input",{"onUpdate:modelValue":c[2]||(c[2]=k=>y.value=k),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:"w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[3]||(c[3]=k=>P("number")),disabled:m.value,maxlength:"4"},null,40,Ie),[[Z,y.value]]),A(e("input",{"onUpdate:modelValue":c[4]||(c[4]=k=>g.value=k),type:"text",placeholder:"ABC",class:"w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition",onInput:c[5]||(c[5]=k=>P("suffix")),disabled:m.value,maxlength:"3"},null,40,Pe),[[Z,g.value]])]),w.value?(n(),i("div",{key:0,class:me(["mt-2 text-sm",m.value?"text-red-600":"text-green-600"])},x(w.value),3)):T("",!0),$.value?(n(),i("div",De,x($.value),1)):T("",!0),h.value?(n(),i("div",je,x(h.value),1)):T("",!0),N.value?T("",!0):(n(),i("div",Ve," âš  Kolom kode wilayah dan nomor plat harus diisi "))]))}},Ke={class:"mb-2"},Ne={class:"relative"},Le={key:0,class:"absolute right-3 top-3"},Ee={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ge={key:0},Fe=["onMousedown"],ze={class:"font-medium text-gray-900"},He={key:1,class:"p-4 text-sm text-gray-500 text-center"},Je={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200"},We={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Re=["onClick"],qe=["src","alt"],Ye={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Oe={class:"text-white text-xs text-center"},Ze={__name:"CarSearchInput",props:{carId:[Number,String],carName:String,carDetail:Array},emits:["update:carId","update:carName","carSelected","carImagesLoaded"],setup(J,{emit:I}){const o=J,B=I,b=v(""),y=v(!1),g=v(!1),$=v([]),w=v(null),h=v([]),m=d=>{var c,k,p;if(!d)return"";const r=[];return(c=d.brand)!=null&&c.name&&r.push(d.brand.name),(k=d.model)!=null&&k.name&&r.push(d.model.name),(p=d.type)!=null&&p.name&&r.push(d.type.name),d.cc&&r.push((d.cc/1e3).toFixed(1)),d.transmission&&r.push(d.transmission),d.year&&r.push(d.year.toString()),d.fuel_type&&r.push(d.fuel_type),d.production_period&&r.push(`(${d.production_period})`),r.join(" ")},C=Te.debounce(()=>{if(!b.value.trim()){$.value=[],y.value=!1;return}g.value=!0;const d=b.value.trim(),r=o.carDetail.map(p=>({...p,formattedName:m(p)})),k=new Be(r,{keys:["formattedName"],threshold:.6,findAllMatches:!0,includeScore:!0}).search(d).slice(0,10);$.value=k.map(p=>p.item),y.value=!0,g.value=!1},300),S=()=>{setTimeout(()=>{y.value=!1},200)},P=async d=>{w.value=d,b.value=m(d),B("update:carId",d.id),B("update:carName",m(d)),B("carSelected",d),y.value=!1;const r=await E(d.id);B("carImagesLoaded",r)},E=async d=>{try{const r=await fetch(`/api/cars/${d}/images`);if(r.ok){const c=await r.json(),k=Array.isArray(c)?c:[];return h.value=k,k}else return h.value=[],[]}catch(r){return console.error("Error loading car images:",r),h.value=[],[]}},N=d=>!d||!d.file_path?"":`/storage/${d.file_path}`;return O(()=>o.carId,d=>{d||(w.value=null,b.value="",h.value=[])}),O(b,d=>{(!w.value||m(w.value)!==d)&&(B("update:carId",null),w.value=null,h.value=[])}),(d,r)=>(n(),i(D,null,[e("div",Ke,[r[5]||(r[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nama Mobil ",-1)),e("div",Ne,[A(e("input",{"onUpdate:modelValue":r[0]||(r[0]=c=>b.value=c),type:"text",placeholder:"Cari atau ketik nama mobil...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",onInput:r[1]||(r[1]=(...c)=>_(C)&&_(C)(...c)),onFocus:r[2]||(r[2]=c=>y.value=!0),onBlur:S},null,544),[[Z,b.value]]),g.value?(n(),i("div",Le,r[3]||(r[3]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):T("",!0),y.value?(n(),i("div",Ee,[$.value.length>0?(n(),i("div",Ge,[(n(!0),i(D,null,U($.value,c=>(n(),i("div",{key:c.id,class:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:k=>P(c)},[e("div",ze,x(m(c)),1)],40,Fe))),128))])):(n(),i("div",He,r[4]||(r[4]=[le(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),le(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):T("",!0)])]),w.value&&h.value.length>0?(n(),i("div",Je,[r[6]||(r[6]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",We,[(n(!0),i(D,null,U(h.value,(c,k)=>(n(),i("div",{key:c.id||k,class:"relative group cursor-pointer",onClick:p=>d.openLightbox(k)},[e("img",{src:N(c),alt:c.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,qe),c.note?(n(),i("div",Ye,[e("p",Oe,x(c.note),1)])):T("",!0)],8,Re))),128))])])):T("",!0)],64))}},Qe={class:"mb-2"},Xe={class:"mb-4"},ea=["disabled"],aa=["value"],ta={class:"mb-4"},oa=["disabled"],la=["value"],sa={class:"mb-4"},na=["disabled"],ra=["value"],ia={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ua=["disabled"],da=["value"],ca=["disabled"],ma=["value"],pa={class:"mb-4"},ga={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},va=["value","disabled"],fa={class:"mb-4"},ba=["disabled"],ya=["value"],ha={class:"mb-4"},ka=["disabled"],xa=["value"],_a={key:0,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},wa={class:"text-green-700"},Ca={key:1,class:"mt-2 text-sm text-gray-500 flex items-center"},$a={__name:"CarSelectionWizard",props:{carDetail:Array},emits:["car-selected","car-images-loaded"],setup(J,{emit:I}){const o=I,B=v(""),b=v(""),y=v(""),g=v(""),$=v(""),w=v(""),h=v(""),m=v(""),C=v(null),S=v([]),P=v([]),E=v([]),N=v([]),d=v([]),r=v([]),c=v([]),k=v([]),p=v({brand:!1,model:!1,type:!1,capacity:!1,year:!1,transmission:!1,fuel:!1,period:!1}),F=R(()=>Object.values(p.value).some(u=>u)),L=u=>(u/1e3).toFixed(1)+"L",q=u=>{const t={AT:{category:"AT",label:"Automatic"},MT:{category:"MT",label:"Manual"},CVT:{category:"AT",label:"CVT"},"e-CVT":{category:"AT",label:"e-CVT"},DCT:{category:"AT",label:"DCT"},IVT:{category:"AT",label:"IVT"},SSG:{category:"AT",label:"SSG"},AGS:{category:"AT",label:"AGS"},DHT:{category:"AT",label:"DHT"},AMT:{category:"MT",label:"AMT"}}[u];return t?t.label==="Automatic"||t.label==="Manual"?t.category:`${t.category} (${t.label})`:u},j=async(u,a={})=>{const t=new AbortController,M=setTimeout(()=>t.abort(),5e3);try{const V=await fetch(u,{...a,signal:t.signal});return clearTimeout(M),V}catch(V){throw clearTimeout(M),V}},se=async()=>{p.value.brand=!0;try{const u=await j("/api/car-brands");S.value=await u.json()}catch(u){console.error("Error fetching brands:",u)}finally{p.value.brand=!1}},X=async u=>{if(u){p.value.model=!0;try{const a=await j(`/api/car-models/${u}`);P.value=await a.json()}catch(a){console.error("Error fetching models:",a)}finally{p.value.model=!1}}},ee=async u=>{if(u){p.value.type=!0;try{const a=await j(`/api/car-types/${u}`);E.value=await a.json()}catch(a){console.error("Error fetching types:",a)}finally{p.value.type=!1}}},ne=async u=>{if(u){p.value.capacity=!0;try{const a=await j(`/api/car-capacities/${u}`);N.value=await a.json()}catch(a){console.error("Error fetching capacities:",a)}finally{p.value.capacity=!1}}},Q=async(u,a)=>{if(!(!u||!a)){p.value.year=!0;try{const t=await j(`/api/car-years/${u}/${a}`);d.value=await t.json()}catch(t){console.error("Error fetching years:",t)}finally{p.value.year=!1}}},ae=async(u,a,t)=>{if(!(!u||!a||!t)){p.value.transmission=!0;try{const M=await j(`/api/car-transmissions/${u}/${a}/${t}`);r.value=await M.json()}catch(M){console.error("Error fetching transmissions:",M)}finally{p.value.transmission=!1}}},te=async(u,a,t,M)=>{if(!(!u||!a||!t||!M)){p.value.fuel=!0;try{const V=await j(`/api/car-fuels/${u}/${a}/${t}/${M}`);c.value=await V.json()}catch(V){console.error("Error fetching fuels:",V)}finally{p.value.fuel=!1}}},oe=async(u,a,t,M,V)=>{if(!(!u||!a||!t||!M||!V)){p.value.period=!0;try{const Y=await j(`/api/car-periods/${u}/${a}/${t}/${M}/${V}`);k.value=await Y.json()}catch(Y){console.error("Error fetching periods:",Y)}finally{p.value.period=!1}}},re=async u=>{try{const a=await fetch(`/api/cars/${u}/images`);if(a.ok){const t=await a.json(),M=Array.isArray(t)?t:[];return o("car-images-loaded",M),M}return[]}catch(a){return console.error("Error loading car images:",a),[]}},s=async(u,a,t,M,V,Y)=>{if(!(!u||!a||!t||!M||!V||!Y))try{const ie=await j(`/api/car-details/${u}/${a}/${t}/${M}/${V}/${Y}`);C.value=await ie.json(),C.value&&(o("car-selected",C.value),await re(C.value.id))}catch(ie){console.error("Error fetching car detail:",ie)}},l=()=>{W(["model","type","capacity","year","transmission","fuel","period"]),B.value&&X(B.value)},K=()=>{W(["type","capacity","year","transmission","fuel","period"]),b.value&&ee(b.value)},f=()=>{W(["capacity","year","transmission","fuel","period"]),y.value&&ne(y.value)},z=()=>{W(["year","transmission","fuel","period"]),y.value&&g.value&&Q(y.value,g.value)},H=()=>{W(["transmission","fuel","period"]),y.value&&g.value&&$.value&&ae(y.value,g.value,$.value)},ve=()=>{W(["fuel","period"]),y.value&&g.value&&$.value&&w.value&&te(y.value,g.value,$.value,w.value)},fe=()=>{W(["period"]),y.value&&g.value&&$.value&&w.value&&h.value&&oe(y.value,g.value,$.value,w.value,h.value)},be=()=>{C.value=null,y.value&&g.value&&$.value&&w.value&&h.value&&m.value&&s(y.value,g.value,$.value,w.value,h.value,m.value)},W=u=>{u.forEach(a=>{a==="model"&&(b.value=""),a==="type"&&(y.value=""),a==="capacity"&&(g.value=""),a==="year"&&($.value=""),a==="transmission"&&(w.value=""),a==="fuel"&&(h.value=""),a==="period"&&(m.value="")}),C.value=null,u.includes("model")&&(P.value=[]),u.includes("type")&&(E.value=[]),u.includes("capacity")&&(N.value=[]),u.includes("year")&&(d.value=[]),u.includes("transmission")&&(r.value=[]),u.includes("fuel")&&(c.value=[]),u.includes("period")&&(k.value=[])};return ge(()=>{se()}),(u,a)=>(n(),i("div",Qe,[e("div",Xe,[a[9]||(a[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Brand",-1)),A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>B.value=t),onChange:l,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:p.value.brand},[a[8]||(a[8]=e("option",{value:""},"Pilih Brand",-1)),(n(!0),i(D,null,U(S.value,t=>(n(),i("option",{key:t.id,value:t.id},x(t.name),9,aa))),128))],40,ea),[[G,B.value]])]),e("div",ta,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Model",-1)),A(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>b.value=t),onChange:K,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!B.value||p.value.model},[a[10]||(a[10]=e("option",{disabled:"",value:""},"Pilih Model",-1)),(n(!0),i(D,null,U(P.value,t=>(n(),i("option",{key:t.id,value:t.id},x(t.name),9,la))),128))],40,oa),[[G,b.value]])]),e("div",sa,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type/Varian",-1)),A(e("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>y.value=t),onChange:f,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!b.value||p.value.type},[a[12]||(a[12]=e("option",{disabled:"",value:""},"Pilih Type",-1)),(n(!0),i(D,null,U(E.value,t=>(n(),i("option",{key:t.id,value:t.id},x(t.name),9,ra))),128))],40,na),[[G,y.value]])]),e("div",ia,[e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Kapasitas Mesin",-1)),A(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>g.value=t),onChange:z,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!y.value||p.value.capacity},[a[14]||(a[14]=e("option",{disabled:"",value:""},"Pilih Kapasitas",-1)),(n(!0),i(D,null,U(N.value,t=>(n(),i("option",{key:t.cc,value:t.cc},x(t.display),9,da))),128))],40,ua),[[G,g.value]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun",-1)),A(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>$.value=t),onChange:H,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!g.value||p.value.year},[a[16]||(a[16]=e("option",{disabled:"",value:""},"Pilih Tahun",-1)),(n(!0),i(D,null,U(d.value,t=>(n(),i("option",{key:t.year,value:t.year},x(t.year),9,ma))),128))],40,ca),[[G,$.value]])])]),e("div",pa,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Transmisi",-1)),e("div",ga,[(n(!0),i(D,null,U(r.value,t=>(n(),i("label",{key:t.transmission,class:me(["flex items-center justify-center cursor-pointer rounded-xl border p-3 text-sm font-medium transition-all duration-200",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":w.value===t.transmission,"border-gray-300 text-gray-700 hover:border-indigo-300":w.value!==t.transmission}])},[A(e("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=M=>w.value=M),value:t.transmission,onChange:ve,class:"sr-only",disabled:!$.value||p.value.transmission},null,40,va),[[ye,w.value]]),le(" "+x(q(t.transmission)),1)],2))),128))])]),e("div",fa,[a[20]||(a[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bahan Bakar",-1)),A(e("select",{"onUpdate:modelValue":a[6]||(a[6]=t=>h.value=t),onChange:fe,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!w.value||p.value.fuel},[a[19]||(a[19]=e("option",{disabled:"",value:""},"Pilih Bahan Bakar",-1)),(n(!0),i(D,null,U(c.value,t=>(n(),i("option",{key:t.fuel_type,value:t.fuel_type},x(t.fuel_type),9,ya))),128))],40,ba),[[G,h.value]])]),e("div",ha,[a[22]||(a[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Periode Produksi",-1)),A(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>m.value=t),onChange:be,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",disabled:!h.value||p.value.period},[a[21]||(a[21]=e("option",{disbaled:"",value:""},"Pilih Periode Produksi",-1)),(n(!0),i(D,null,U(k.value,t=>(n(),i("option",{key:t.production_period,value:t.production_period},x(t.production_period),9,xa))),128))],40,ka),[[G,m.value]])]),C.value?(n(),i("div",_a,[a[23]||(a[23]=e("h4",{class:"font-medium text-green-800 mb-2"},"Mobil Terpilih:",-1)),e("p",wa,x(C.value.brand.name)+" "+x(C.value.model.name)+" "+x(C.value.type.name)+" "+x(L(C.value.cc))+" "+x(q(C.value.transmission))+" "+x(C.value.fuel_type)+" "+x(C.value.year)+" ("+x(C.value.production_period)+")",1)])):T("",!0),F.value?(n(),i("div",Ca,a[24]||(a[24]=[e("svg",{class:"animate-spin h-4 w-4 mr-2 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),le(" Memuat data... ")]))):T("",!0)]))}},Ta={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Ba={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},Ma={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Sa={class:"mb-2 flex justify-end"},Aa={class:"mb-4"},Ia=["value"],Pa={class:"mb-4 flex items-center justify-between"},Da={class:"relative inline-flex items-center cursor-pointer"},ja=["disabled"],Va={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ua=["min"],Ka={key:0,class:"mb-6"},Na=["value"],La={class:"mt-6 flex justify-end"},Ea=["disabled"],Ga={key:4,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Fa={key:0,class:"mb-4"},za=["innerHTML"],Ha={key:1},Ja={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Wa=["onClick"],Ra=["src","alt"],qa={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Ya={class:"text-white text-xs text-center"},Oa={key:2,class:"text-center py-4 text-gray-500 text-sm"},Za={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Qa=["src","alt"],Xa={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},et={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},at={__name:"Index",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(J){const I=J,o=he({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),B=ke(),b=B.props.global.user,y=B.props.global.region,g=B.props.global.has_roles,$=v(!1),w=v(new Date().toISOString().split("T")[0]),h=v(null),m=v([]),C=v(!1),S=v(0),P=v("search"),E=()=>{P.value=P.value==="search"?"wizard":"search",o.car_id=null,o.car_name="",h.value=null,m.value=[]},N=R(()=>g.includes("admin_plann"));ue(()=>{N.value&&(o.is_scheduled=!0)});const d=s=>{var l,K,f;s.car_id&&s.car_name?(o.car_id=s.car_id,o.car_name=s.car_name,h.value=I.CarDetail.find(z=>z.id===s.car_id)||null):s.id&&(o.car_id=s.id,o.car_name=`${(l=s.brand)==null?void 0:l.name} ${(K=s.model)==null?void 0:K.name} ${(f=s.type)==null?void 0:f.name} ${F(s.cc)} ${L(s.transmission)} ${s.fuel_type} ${s.year} (${s.production_period})`,h.value=s)},r=R(()=>I.activeInspections),c=R(()=>!(!o.plate_number.trim()||!o.category_id||!o.car_id&&!o.car_name.trim()||o.is_scheduled&&(!o.scheduled_at_date||!o.scheduled_at_time)||(g.includes("Admin")||g.includes("coordinator"))&&!o.inspector_id)),k=R(()=>o.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),p=R(()=>{const s=I.team.filter(H=>H.status==="active"),l=g.includes("Admin"),K=g.includes("admin_plann"),f=g.includes("coordinator"),z=g.includes("admin_region");return l||K?s:f?s.filter(H=>H.region_id===y.id):z?s.filter(H=>H.region_id===y.id):[]}),F=s=>(s/1e3).toFixed(1)+"L",L=s=>({AT:"Automatic",MT:"Manual",CVT:"CVT",AMT:"AMT"})[s]||s,q=s=>{$.value=!s},j=s=>{console.log("Car data received from plate validation:",s),s?(o.car_id=s.id,o.car_name=s.name,s.id&&(h.value=I.CarDetail.find(l=>l.id===s.id)||null,h.value&&se(h.value.id)),s.inspectionData&&console.log("Inspection data available:",s.inspectionData)):(o.car_id=null,o.car_name="",h.value=null,m.value=[])},se=async s=>{try{const l=await fetch(`/api/cars/${s}/images`);if(l.ok){const K=await l.json();m.value=Array.isArray(K)?K:[]}else m.value=[]}catch(l){console.error("Error loading car images:",l),m.value=[]}},X=s=>{m.value=s},ee=s=>s!=null&&s.file_path?`/storage/${s.file_path}`:"",ne=s=>{S.value=s,C.value=!0,document.body.style.overflow="hidden"},Q=()=>{C.value=!1,document.body.style.overflow=""},ae=()=>{S.value=(S.value+1)%m.value.length},te=()=>{S.value=(S.value-1+m.value.length)%m.value.length},oe=s=>{if(C.value)switch(s.key){case"Escape":Q();break;case"ArrowRight":ae();break;case"ArrowLeft":te();break}};ue(()=>{const s=g.includes("Admin")||g.includes("coordinator");o.inspector_id=(b==null?void 0:b.id)||null}),ue(()=>{r.value&&(o.is_scheduled=!0)}),O(()=>o.car_id,s=>{s?h.value=I.CarDetail.find(l=>l.id===s)||null:(h.value=null,m.value=[])}),ge(()=>{window.addEventListener("keydown",oe)}),xe(()=>{window.removeEventListener("keydown",oe)});const re=()=>{o.plate_number,o.car_id,o.car_name,o.category_id,o.is_scheduled,o.inspector_id,o.is_scheduled&&`${o.scheduled_at_date}${o.scheduled_at_time}`,o.post(route("inspections.store"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>{}})};return(s,l)=>(n(),de($e,{title:"Buat Inspeksi Baru"},{default:_e(()=>{var K;return[pe(_(we),{title:"Inspek Baru"}),e("div",Ta,[e("div",Ba,[l[22]||(l[22]=e("div",{class:"mb-4"},[e("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),e("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),_(o).errors.form_error?(n(),i("div",Ma,x(_(o).errors.form_error),1)):T("",!0),pe(Ue,{"plate-number":_(o).plate_number,"onUpdate:plateNumber":l[0]||(l[0]=f=>_(o).plate_number=f),inspections:I.inspection,"car-detail":I.CarDetail,onPlateValidityUpdate:q,onCarDataUpdate:j},null,8,["plate-number","inspections","car-detail"]),e("div",Sa,[e("button",{onClick:E,class:"text-sm text-indigo-600 hover:text-indigo-800 underline"},x(P.value==="search"?"Ganti ke Pilihan Dropdown":"Ganti ke Pencarian Teks"),1)]),P.value==="search"?(n(),de(Ze,{key:1,"car-id":_(o).car_id,"onUpdate:carId":l[1]||(l[1]=f=>_(o).car_id=f),"car-name":_(o).car_name,"onUpdate:carName":l[2]||(l[2]=f=>_(o).car_name=f),"car-detail":I.CarDetail,onCarSelected:d,onCarImagesLoaded:X},null,8,["car-id","car-name","car-detail"])):(n(),de($a,{key:2,"car-detail":I.CarDetail,onCarSelected:d,onCarImagesLoaded:X},null,8,["car-detail"])),e("div",Aa,[l[10]||(l[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),A(e("select",{id:"category","onUpdate:modelValue":l[3]||(l[3]=f=>_(o).category_id=f),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[l[9]||(l[9]=e("option",{value:"",disabled:""},"Pilih Kategori",-1)),(n(!0),i(D,null,U(J.Category,f=>(n(),i("option",{key:f.id,value:f.id},x(f.name),9,Ia))),128))],512),[[G,_(o).category_id]])]),e("div",Pa,[l[12]||(l[12]=e("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),e("label",Da,[A(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=f=>_(o).is_scheduled=f),id:"schedule-toggle",class:"sr-only peer",disabled:r.value||N.value},null,8,ja),[[Ce,_(o).is_scheduled]]),l[11]||(l[11]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),_(o).is_scheduled?(n(),i("div",Va,[e("div",null,[l[13]||(l[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),A(e("input",{type:"date",id:"schedule-date","onUpdate:modelValue":l[5]||(l[5]=f=>_(o).scheduled_at_date=f),min:w.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,8,Ua),[[Z,_(o).scheduled_at_date]])]),e("div",null,[l[14]||(l[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),A(e("input",{type:"time",id:"schedule-time","onUpdate:modelValue":l[6]||(l[6]=f=>_(o).scheduled_at_time=f),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[Z,_(o).scheduled_at_time]])]),_(g).includes("Admin")||_(g).includes("coordinator")||_(g).includes("admin_plann")?(n(),i("div",Ka,[l[16]||(l[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),A(e("select",{id:"inspector","onUpdate:modelValue":l[7]||(l[7]=f=>_(o).inspector_id=f),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[l[15]||(l[15]=e("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(n(!0),i(D,null,U(p.value,f=>(n(),i("option",{key:f.id,value:f.user.id},x(f.user.name),9,Na))),128))],512),[[G,_(o).inspector_id]])])):T("",!0)])):T("",!0),e("div",La,[e("button",{onClick:re,disabled:!c.value||_(o).processing||$.value,class:me({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600 border border-transparent text-white hover:bg-blue-700":!_(o).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600 border-transparent text-white hover:bg-green-700":_(o).is_scheduled})},x(k.value),11,Ea)]),_(o).car_id&&h.value?(n(),i("div",Ga,[h.value.description?(n(),i("div",Fa,[l[17]||(l[17]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:h.value.description},null,8,za)])):T("",!0),m.value.length>0?(n(),i("div",Ha,[l[18]||(l[18]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",Ja,[(n(!0),i(D,null,U(m.value,(f,z)=>(n(),i("div",{key:f.id||z,class:"relative group cursor-pointer",onClick:H=>ne(z)},[e("img",{src:ee(f),alt:f.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ra),f.note?(n(),i("div",qa,[e("p",Ya,x(f.note),1)])):T("",!0)],8,Wa))),128))])])):(n(),i("div",Oa," Tidak ada gambar tersedia untuk mobil ini "))])):T("",!0),C.value?(n(),i("div",{key:5,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Q},[e("div",Za,[e("button",{onClick:Q,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},l[19]||(l[19]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),m.value.length>1?(n(),i("button",{key:0,onClick:ce(te,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},l[20]||(l[20]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):T("",!0),m.value.length>1?(n(),i("button",{key:1,onClick:ce(ae,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},l[21]||(l[21]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):T("",!0),e("img",{src:ee(m.value[S.value]),alt:"Car Image "+(S.value+1),class:"max-w-full max-h-full object-contain",onClick:l[8]||(l[8]=ce(()=>{},["stop"]))},null,8,Qa),m.value.length>1?(n(),i("div",Xa,x(S.value+1)+" / "+x(m.value.length),1)):T("",!0),(K=m.value[S.value])!=null&&K.note?(n(),i("div",et,x(m.value[S.value].note),1)):T("",!0)])])):T("",!0)])])]}),_:1}))}},rt=Me(at,[["__scopeId","data-v-360e3cf5"]]);export{rt as default};
