import{x as oa,r as y,g as st,q as se,H as wt,G as ve,c as i,o as n,d as e,b as d,k as Ae,z as Le,A as dt,n as oe,t as F,F as Ne,m as Pe,f as Ee,u as X,e as ia,y as ct,w as Fe,L as qe,D as Pt,M as Lt,j as De,a as jt,l as aa,T as gt,N as Dt,p as xa,O as sa,J as at,B as wa,S as ka,I as Bt,W as Et}from"./vendor-CUNG9NG6.js";import{l as la}from"./lodash-CeUj5J-L.js";import{_ as Ia}from"./PrimaryButton-h2qnLbgr.js";import{_ as _a}from"./ActionMessage-C19FCsLq.js";import{F as Sa}from"./fuse-Ch1WBRTM.js";import{_ as He}from"./app-d-p9LS84.js";import{_ as ra}from"./InputNumber-BM446ncS.js";const Ca={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},$a={key:0,class:"p-4 space-y-2"},Aa={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Va={class:"flex items-center space-x-2"},Ta={key:0,class:"text-xs text-red-500 font-normal ml-2"},Ma={key:1,class:"text-xs text-red-500 font-normal ml-2"},Ua={key:2,class:"text-xs text-green-500 font-normal ml-2"},Na={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Ea={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Da={class:"col-span-2 flex space-x-3"},Pa={class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},La={class:"flex items-start"},Ra={class:"text-sm text-blue-700"},ja={class:"mt-1"},Ba={key:0,class:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-medium mr-2"},Fa={key:1,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium mr-2"},Oa={key:2,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium"},za={key:3,class:"text-blue-600"},Ka={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},qa={class:"relative"},Ha={key:0,class:"absolute right-3 top-3"},Ga={key:1,class:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Wa={key:0},Ja=["onMousedown"],Ya={class:"font-medium text-gray-900"},Za={class:"text-sm text-gray-500"},Qa={key:1,class:"p-4 text-sm text-gray-500 text-center"},Xa={key:0,class:"text-xs text-red-500 font-normal ml-2"},es={key:0,class:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ts={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},as={key:0,class:"mb-4"},ss=["innerHTML"],ns={key:1},os={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},is=["onClick"],ls=["src","alt"],rs={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},us={class:"text-white text-xs text-center"},ds={key:2,class:"text-center py-4 text-gray-500 text-sm"},cs={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},gs=["src","alt"],ps={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},ms={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},vs={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fs={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges","update:vehicle-type"],setup(a,{emit:ee}){var u,v,S,J,ie,de;const t=a,$=ee,g=oa({plate_number:((u=t.inspection)==null?void 0:u.plate_number)||"",car_id:((v=t.inspection)==null?void 0:v.car_id)||null,car_name:((S=t.inspection)==null?void 0:S.car_name)||""}),A=y(((J=t.inspection)==null?void 0:J.plate_number)||""),x=y(((ie=t.inspection)==null?void 0:ie.car_id)||null),V=y(((de=t.inspection)==null?void 0:de.car_name)||""),_=y(""),L=y(""),w=y(""),E=y(null),U=y({rear_door:!1}),Z=y(!1),f=y(""),m=y(""),T=y(g.car_name),q=y(!1),N=y(!1),z=y([]),G=y(null),B=y([]),I=y(!1),P=y(0);st(()=>{var b,c,te,C,ae;if(O((b=t.inspection)==null?void 0:b.plate_number),(c=t.inspection)!=null&&c.car_id&&((te=t.CarDetail)==null?void 0:te.length)>0){const ye=t.CarDetail.find($e=>$e.id===t.inspection.car_id);ye&&ce(ye)}else!((C=t.inspection)!=null&&C.car_id)&&((ae=t.inspection)!=null&&ae.car_name)&&(T.value=t.inspection.car_name,g.car_id=null);window.addEventListener("keydown",Me),W(),$("update:hasUnsavedChanges",D.value),$("update:validation",R.value)}),wt(()=>{window.removeEventListener("keydown",Me)});const W=()=>{try{const b=localStorage.getItem("vehicle_features");if(b){const c=JSON.parse(b);U.value.rear_door=c.rear_door||!1,c.pick_up?E.value="pick_up":c.box?E.value="box":E.value=null}else U.value.rear_door=!1,E.value=null;k()}catch(b){console.error("Error loading vehicle type from localStorage:",b),U.value.rear_door=!1,E.value=null,k()}},p=()=>{U.value.rear_door=!U.value.rear_door,s()},h=b=>{E.value===b?E.value=null:E.value=b,s()},s=()=>{try{const b={rear_door:U.value.rear_door,pick_up:E.value==="pick_up",box:E.value==="box"};localStorage.setItem("vehicle_features",JSON.stringify(b)),k(),console.log("Vehicle features saved to localStorage:",b)}catch(b){console.error("Error saving vehicle type to localStorage:",b)}},k=()=>{const b={rear_door:U.value.rear_door,pick_up:E.value==="pick_up",box:E.value==="box"};$("update:vehicle-type",b)},O=b=>{if(!b){_.value="",L.value="",w.value="";return}const c=b.toUpperCase().trim(),te=c.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(te)_.value=te[1]||"",L.value=te[2]||"",w.value=te[3]||"";else{let C="area",ae="",ye="",$e="";for(const xe of c)C==="area"&&/[A-Z]/.test(xe)?ae+=xe:C==="area"&&/[0-9]/.test(xe)?(C="number",ye+=xe):C==="number"&&/[0-9]/.test(xe)?ye+=xe:C==="number"&&/[A-Z]/.test(xe)?(C="suffix",$e+=xe):C==="suffix"&&/[A-Z]/.test(xe)&&($e+=xe);_.value=ae,L.value=ye,w.value=$e}re()},re=()=>{const b=`${_.value}${L.value}${w.value}`;g.plate_number=b,Ue()},_e=b=>{b==="area"?_.value=_.value.toUpperCase().replace(/[^A-Z]/g,""):b==="number"?L.value=L.value.replace(/[^0-9]/g,""):b==="suffix"&&(w.value=w.value.toUpperCase().replace(/[^A-Z]/g,"")),re()},he=se(()=>{const b=g.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(b)}),Se=se(()=>!T.value||T.value.trim()===""),Ve=se(()=>g.plate_number.length>0&&!he.value?"Format plat nomor tidak valid.":null),R=se(()=>{const b=!g.plate_number||g.plate_number.trim()==="",c=!T.value||T.value.trim()==="";return b||c||!he.value||Z.value}),D=se(()=>{const b=g.plate_number!==A.value,c=g.car_id!==x.value||T.value!==V.value;return b||c}),K=se(()=>D.value&&!R.value),H=b=>{var te,C,ae;if(!b)return"";const c=[];return(te=b.brand)!=null&&te.name&&c.push(b.brand.name),(C=b.model)!=null&&C.name&&c.push(b.model.name),(ae=b.type)!=null&&ae.name&&c.push(b.type.name),b.cc&&c.push((b.cc/1e3).toFixed(1)),b.transmission&&c.push(b.transmission),b.year&&c.push(b.year.toString()),b.fuel_type&&c.push(b.fuel_type),b.production_period&&c.push(`(${b.production_period})`),c.join(" ")},Q=la.debounce(()=>{if(!T.value.trim()){z.value=[],q.value=!1;return}N.value=!0;try{const b=T.value.trim();if(t.CarDetail&&t.CarDetail.length>0){const c=t.CarDetail.map(ae=>({...ae,formattedName:H(ae)})),C=new Sa(c,{keys:["formattedName","brand.name","model.name","type.name"],threshold:.6,findAllMatches:!0,includeScore:!0,shouldSort:!0}).search(b).slice(0,10);z.value=C.map(ae=>ae.item)}else z.value=[];q.value=!0}finally{N.value=!1}},300),ue=()=>{if(g.car_id&&(g.car_id=null,G.value=null,B.value=[]),!T.value.trim()){z.value=[],q.value=!1;return}Q()},me=()=>{setTimeout(()=>{q.value=!1,!g.car_id&&T.value&&(g.car_name=T.value,Ue())},200)},ce=async b=>{G.value=b,T.value=H(b),g.car_id=b.id,g.car_name=H(b),q.value=!1,Q.cancel(),await we(b.id),Ue(),$("update:hasUnsavedChanges",D.value),$("update:validation",R.value)},Te=b=>!b||!b.file_path?"":`/storage/${b.file_path}`,we=async b=>{try{const c=await fetch(`/api/cars/${b}/images`);if(c.ok){const te=await c.json();B.value=Array.isArray(te)?te:[]}else B.value=[]}catch(c){console.error("Error loading car images:",c),B.value=[]}},ge=b=>{P.value=b,I.value=!0,document.body.style.overflow="hidden"},Ie=()=>{I.value=!1,document.body.style.overflow=""},Ce=()=>{P.value=(P.value+1)%B.value.length},be=()=>{P.value=(P.value-1+B.value.length)%B.value.length},Me=b=>{if(I.value)switch(b.key){case"Escape":Ie();break;case"ArrowRight":Ce();break;case"ArrowLeft":be();break}},Ue=()=>{const b={plate_number:g.plate_number,car_id:g.car_id,car_name:g.car_name};$("update-vehicle",b)},r=()=>{t.inspection&&g.post(route("inspections.updateVehicleDetails",{inspection:t.inspection.id}),{preserveScroll:!0,onSuccess:()=>{A.value=g.plate_number,x.value=g.car_id,V.value=g.car_name,$("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:b=>{console.error("Gagal menyimpan data:",b)}})};return ve([()=>g.plate_number,()=>g.car_name],b=>{f.value="",Z.value=!1,m.value="";const c=b[0];if(c&&c.length>=6){const te=t.allInspections.filter(C=>{var ae;return C.plate_number===c&&C.id!==((ae=t.inspection)==null?void 0:ae.id)});if(te.length>0){const C=["draft","in_progress","pending","pending_review","revision"],ae=te.find(ye=>C.includes(ye.status));if(ae)Z.value=!0,f.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${ae.status.replace(/_/g," ").toUpperCase()}.`;else{const ye=te.filter($e=>["approved","rejected","completed","cancelled"].includes($e.status));if(ye.length>0){ye.sort((xe,Oe)=>new Date(Oe.created_at)-new Date(xe.created_at));const $e=ye[0];if($e.car_id){const xe=t.CarDetail.find(Oe=>Oe.id===$e.car_id);xe&&ce(xe)}else $e.car_name&&(T.value=$e.car_name,g.car_name=$e.car_name,g.car_id=null);m.value=`Nomor plat ini sudah pernah diperiksa ${ye.length} kali sebelumnya.`}}}}$("update:hasUnsavedChanges",D.value),$("update:validation",R.value)},{deep:!0}),ve([()=>U.value.rear_door,()=>E.value],()=>{s()}),ve(()=>{var b;return(b=t.inspection)==null?void 0:b.car_id},b=>{var c,te;if(b!==g.car_id)if(g.car_id=b,b&&((c=t.CarDetail)==null?void 0:c.length)>0){const C=t.CarDetail.find(ae=>ae.id===b);C&&ce(C)}else!b&&((te=t.inspection)!=null&&te.car_name)&&(T.value=t.inspection.car_name,g.car_name=t.inspection.car_name,g.car_id=null)}),ve(()=>{var b;return(b=t.inspection)==null?void 0:b.car_name},b=>{b&&b!==T.value&&(T.value=b)}),(b,c)=>{var te;return n(),i("div",Ca,[c[27]||(c[27]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),a.inspection?(n(),i("div",$a,[e("div",Aa,[c[11]||(c[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",Va,[Le(e("input",{"onUpdate:modelValue":c[0]||(c[0]=C=>_.value=C),type:"text",placeholder:"Contoh: B",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!he.value||Z.value}]),onInput:c[1]||(c[1]=C=>_e("area")),maxlength:"2"},null,34),[[dt,_.value]]),Le(e("input",{"onUpdate:modelValue":c[2]||(c[2]=C=>L.value=C),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:oe(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!he.value||Z.value}]),onInput:c[3]||(c[3]=C=>_e("number")),maxlength:"4"},null,34),[[dt,L.value]]),Le(e("input",{"onUpdate:modelValue":c[4]||(c[4]=C=>w.value=C),type:"text",placeholder:"ABC",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!he.value||Z.value}]),onInput:c[5]||(c[5]=C=>_e("suffix")),maxlength:"3"},null,34),[[dt,w.value]])]),Ve.value?(n(),i("span",Ta,F(Ve.value),1)):d("",!0),f.value?(n(),i("span",Ma,F(f.value),1)):d("",!0),m.value?(n(),i("span",Ua,F(m.value),1)):d("",!0)]),e("div",Na,[c[15]||(c[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Jenis Kendaraan ",-1)),e("div",Ea,[e("div",{class:oe(["w-full px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":U.value.rear_door,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":!U.value.rear_door}]),onClick:p},c[12]||(c[12]=[e("span",null,"Pintu Belakang",-1)]),2),e("div",Da,[e("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":E.value==="pick_up","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":E.value!=="pick_up"}]),onClick:c[6]||(c[6]=C=>h("pick_up"))}," Pick Up ",2),e("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":E.value==="box","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":E.value!=="box"}]),onClick:c[7]||(c[7]=C=>h("box"))}," Box ",2)])]),e("div",Pa,[e("div",La,[c[14]||(c[14]=e("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",Ra,[c[13]||(c[13]=e("p",{class:"font-medium"},"Status Kendaraan:",-1)),e("p",ja,[U.value.rear_door?(n(),i("span",Ba," ✓ Mobil Pada Umum nya yang memiliki Pintu Belakang ")):d("",!0),E.value==="pick_up"?(n(),i("span",Fa," ✓ Pick Up ")):d("",!0),E.value==="box"?(n(),i("span",Oa," ✓ Box ")):d("",!0),!U.value.rear_door&&!E.value?(n(),i("span",za," Pilih jenis kendaraan agar point bisa menyesuaikan dengan tipe kendaraan anda ")):d("",!0)])])])])]),e("div",Ka,[c[18]||(c[18]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",qa,[Le(e("input",{"onUpdate:modelValue":c[8]||(c[8]=C=>T.value=C),type:"text",placeholder:"Cari atau ketik nama mobil...",class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":Se.value}]),onInput:ue,onFocus:c[9]||(c[9]=C=>q.value=!0),onBlur:me},null,34),[[dt,T.value]]),N.value?(n(),i("div",Ha,c[16]||(c[16]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):d("",!0),q.value?(n(),i("div",Ga,[z.value.length>0?(n(),i("div",Wa,[(n(!0),i(Ne,null,Pe(z.value,C=>(n(),i("div",{key:C.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:ae=>ce(C)},[e("div",Ya,F(H(C)),1),e("div",Za,F(C.year)+" • "+F(C.cc)+"cc • "+F(C.transmission)+" • "+F(C.fuel_type),1)],40,Ja))),128))])):(n(),i("div",Qa,c[17]||(c[17]=[Ee(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),Ee(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):d("",!0)]),Se.value?(n(),i("span",Xa,"Nama mobil tidak boleh kosong.")):d("",!0)]),!X(g).car_id&&T.value&&!q.value?(n(),i("div",es,c[19]||(c[19]=[ia('<div class="flex items-start" data-v-f5fe3b58><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-f5fe3b58><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-f5fe3b58></path></svg><div data-v-f5fe3b58><p class="text-yellow-800 font-medium mb-1" data-v-f5fe3b58>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-f5fe3b58> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-f5fe3b58>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-f5fe3b58> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-f5fe3b58> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-f5fe3b58>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-f5fe3b58>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):d("",!0),X(g).car_id&&G.value?(n(),i("div",ts,[G.value.description?(n(),i("div",as,[c[20]||(c[20]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:G.value.description},null,8,ss)])):d("",!0),B.value.length>0?(n(),i("div",ns,[c[21]||(c[21]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",os,[(n(!0),i(Ne,null,Pe(B.value,(C,ae)=>(n(),i("div",{key:C.id||ae,class:"relative group cursor-pointer",onClick:ye=>ge(ae)},[e("img",{src:Te(C),alt:C.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ls),C.note?(n(),i("div",rs,[e("p",us,F(C.note),1)])):d("",!0)],8,is))),128))])])):(n(),i("div",ds," Tidak ada gambar tersedia untuk mobil ini "))])):d("",!0),I.value?(n(),i("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Ie},[e("div",cs,[e("button",{onClick:Ie,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},c[22]||(c[22]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),B.value.length>1?(n(),i("button",{key:0,onClick:ct(be,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},c[23]||(c[23]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):d("",!0),B.value.length>1?(n(),i("button",{key:1,onClick:ct(Ce,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},c[24]||(c[24]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):d("",!0),e("img",{src:Te(B.value[P.value]),alt:"Car Image "+(P.value+1),class:"max-w-full max-h-full object-contain",onClick:c[10]||(c[10]=ct(()=>{},["stop"]))},null,8,gs),B.value.length>1?(n(),i("div",ps,F(P.value+1)+" / "+F(B.value.length),1)):d("",!0),(te=B.value[P.value])!=null&&te.note?(n(),i("div",ms,F(B.value[P.value].note),1)):d("",!0)])])):d("",!0),Ae(Ia,{type:"button",onClick:r,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!K.value},{default:Fe(()=>[X(g).processing?(n(),i("svg",vs,c[25]||(c[25]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):d("",!0),e("span",null,F(X(g).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),Ae(_a,{on:X(g).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Fe(()=>c[26]||(c[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),Ee(" Tersimpan. ")])),_:1,__:[26]},8,["on"])]),_:1},8,["disabled"])])):d("",!0)])}}},hs=He(fs,[["__scopeId","data-v-f5fe3b58"]]),bs={class:"mt-1"},ys=["value","required","minlength","maxlength","allowSpace","placeholder"],xs={key:0,class:"mt-2 text-sm text-red-600"},ua={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(a,{emit:ee}){const t=a,$=ee,g=se(()=>{if(!t.modelValue)return"";let x=t.modelValue;switch(t.allowSpace||(x=x.replace(/\s+/g,"")),t.textTransform){case"uppercase":return x.toUpperCase();case"lowercase":return x.toLowerCase();case"capitalize":return x.replace(/\b\w/g,V=>V.toUpperCase());default:return x}}),A=x=>{let V=x.target.value;switch(t.allowSpace||(V=V.replace(/\s+/g,"")),t.textTransform){case"uppercase":V=V.toUpperCase();break;case"lowercase":V=V.toLowerCase();break;case"capitalize":V=V.replace(/\b\w/g,_=>_.toUpperCase());break}$("update:modelValue",V),$("save",t.pointId)};return(x,V)=>(n(),i("div",bs,[e("input",{value:g.value,onInput:A,type:"text",required:a.required,minlength:a.minLength,maxlength:a.maxLength,allowSpace:a.allowSpace,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:a.textTransform==="uppercase",lowercase:a.textTransform==="lowercase",capitalize:a.textTransform==="capitalize"}])},null,42,ys),a.error?(n(),i("p",xs,F(a.error),1)):d("",!0)]))}},ws={class:"mt-1"},ks=["value","required","min","max"],Is={key:0,class:"mt-2 text-sm text-red-600"},da={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:ee}){const t=a,$=ee,g=A=>{$("update:modelValue",A.target.value),$("save",t.pointId)};return(A,x)=>(n(),i("div",ws,[e("input",{value:a.modelValue,onChange:g,type:"date",required:a.required,min:a.minDate,max:a.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,ks),a.error?(n(),i("p",Is,F(a.error),1)):d("",!0)]))}},_s={class:"mt-1"},Ss=["value","required","placeholder"],Cs={key:0,class:"mt-2 text-sm text-red-600"},ca={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(a,{emit:ee}){const t=a,$=ee,g=y(""),A=se(()=>{var w,E,U,Z;return{currency_symbol:((w=t.settings)==null?void 0:w.currency_symbol)||"Rp",thousands_separator:((E=t.settings)==null?void 0:E.thousands_separator)||",",min_value:((U=t.settings)==null?void 0:U.min_value)!==void 0?Number(t.settings.min_value):0,max_value:((Z=t.settings)==null?void 0:Z.max_value)!==void 0?Number(t.settings.max_value):1e9}}),x=w=>{if(w==null||w==="")return"";const E=Number(w);if(isNaN(E))return"";let U=E.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return A.value.thousands_separator!==","&&(U=U.replace(/,/g,A.value.thousands_separator)),U},V=w=>w?w.replace(/[^\d]/g,""):"",_=se(()=>g.value?`${A.value.currency_symbol} ${x(g.value)}`:""),L=w=>{let E=V(w.target.value),U=Number(E);A.value.min_value!==void 0&&U<A.value.min_value&&(E=A.value.min_value.toString()),A.value.max_value!==void 0&&U>A.value.max_value&&(E=A.value.max_value.toString()),g.value=E,$("update:modelValue",E),$("save",t.pointId)};return ve(()=>t.modelValue,w=>{w!=null&&(g.value=w.toString())},{immediate:!0}),(w,E)=>(n(),i("div",_s,[e("input",{value:_.value,onInput:L,type:"text",required:a.required,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",a.error?"border-red-300":"border-gray-300"])},null,42,Ss),a.error?(n(),i("p",Cs,F(a.error),1)):d("",!0)]))}},$s={class:"mt-1 space-y-3"},As={key:0,class:"space-y-2"},Vs={class:"flex flex-wrap gap-2"},Ts=["onClick"],Ms=["value","required","minlength","maxlength","placeholder"],Us={class:"flex justify-between items-center mt-1"},Ns={class:"text-xs text-gray-500"},Es={key:0,class:"text-xs text-red-600"},ga={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(a,{emit:ee}){const t=a,$=ee,g=y([]),A=y(""),x=w=>g.value.some(E=>E.value===w),V=w=>{x(w.value)?g.value=g.value.filter(f=>f.value!==w.value):g.value.push(w);const U=[...g.value.map(f=>f.value)];A.value.trim()&&U.push(A.value.trim());const Z=U.join(", ");$("update:modelValue",Z),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,notes:Z})},_=w=>{const E=w.target.value;$("update:modelValue",E),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,notes:E}),L(E)},L=w=>{var f,m,T,q;if(!w){g.value=[],A.value="";return}const E=w.split(",").map(N=>N.trim()).filter(N=>N),U=((m=(f=t.settings)==null?void 0:f.damage_options)==null?void 0:m.map(N=>N.value))||[];g.value=((q=(T=t.settings)==null?void 0:T.damage_options)==null?void 0:q.filter(N=>E.includes(N.value)))||[];const Z=E.filter(N=>!U.includes(N));A.value=Z.join(", ")};return ve(()=>t.modelValue,w=>{w!=null&&L(w)},{immediate:!0}),ve(()=>{var w;return(w=t.settings)==null?void 0:w.damage_options},(w,E)=>{if(w!==E){const U=w?w.map(T=>T.value):[];g.value=g.value.filter(T=>U.includes(T.value));const f=[...g.value.map(T=>T.value)];A.value.trim()&&f.push(A.value.trim());const m=f.filter(T=>T).join(", ");$("update:modelValue",m),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,notes:m})}},{deep:!0,immediate:!1}),(w,E)=>{var U,Z,f;return n(),i("div",$s,[(U=a.settings)!=null&&U.enable_damage&&((Z=a.settings)!=null&&Z.damage_options)?(n(),i("div",As,[E[0]||(E[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Vs,[(n(!0),i(Ne,null,Pe(a.settings.damage_options,(m,T)=>(n(),i("button",{key:T,type:"button",onClick:q=>V(m),class:oe(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":x(m.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!x(m.value)}])},F(m.label),11,Ts))),128))])])):d("",!0),e("div",null,[e("textarea",{value:a.modelValue,onInput:_,required:a.required,minlength:a.minLength,maxlength:a.maxLength,placeholder:a.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ms),e("div",Us,[e("span",Ns,F(((f=a.modelValue)==null?void 0:f.length)||0)+"/"+F(a.maxLength||400),1),a.error?(n(),i("p",Es,F(a.error),1)):d("",!0)])])])}}},Ds={class:"mt-1"},Ps=["value","required"],Ls={key:0,class:"mt-2 text-sm text-red-600"},Rs={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:ee}){const t=a,$=ee,g=A=>{$("update:modelValue",A.target.value),$("save",t.pointId)};return(A,x)=>(n(),i("div",Ds,[e("select",{value:a.modelValue,onChange:g,required:a.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},x[0]||(x[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Ps),a.error?(n(),i("p",Ls,F(a.error),1)):d("",!0)]))}},js=He(Rs,[["__scopeId","data-v-1b6c0201"]]),Bs={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Fs={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Os={class:"text-xs text-gray-500 mt-2 text-center"},zs={class:"flex flex-row space-x-4 mb-6"},Ks={class:"mt-4 text-right"},qs={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(a){return(ee,t)=>a.show?(n(),i("div",Bs,[e("div",Fs,[t[7]||(t[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",Os,[t[3]||(t[3]=Ee("Ambil Foto Maksimal: ")),e("b",null,F(a.settings.max_files),1),t[4]||(t[4]=Ee(" Dengan Rasio & Ukuran: ")),e("b",null,F(a.settings.camera_aspect_ratio),1)]),e("div",zs,[e("button",{onClick:t[0]||(t[0]=$=>ee.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-blue-50 hover:border-blue-400 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-blue-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Ambil Foto",-1)])),e("button",{onClick:t[1]||(t[1]=$=>ee.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",Ks,[e("button",{onClick:t[2]||(t[2]=$=>ee.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):d("",!0)}},Hs={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},Gs={class:"w-full h-full flex flex-col"},Ws={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},Js=["disabled"],Ys={class:"text-lg font-semibold"},Zs={class:"flex items-center gap-2"},Qs=["disabled"],Xs={key:0,class:"px-4 py-2 bg-indigo-900 text-white"},en={class:"flex justify-between items-center text-sm"},tn={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},an={class:"flex-1 flex items-center justify-center overflow-hidden relative"},sn=["src"],nn={key:1,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3"},on=["disabled"],ln=["disabled"],rn={key:2,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},un={key:3,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},dn=["disabled"],cn=["disabled"],gn=["disabled"],pn={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},mn={class:"flex justify-between items-center w-full"},vn=["disabled"],fn={key:1,class:"flex-1"},hn=["disabled"],bn={class:"flex gap-3 w-full"},yn={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},xn={class:"flex items-center gap-2"},wn={key:0,class:"text-center"},kn={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(a,{emit:ee}){const t=a,$=ee,g=y(0),A=y([]),x=se(()=>A.value.length>0?A.value[g.value]:null);ve(()=>t.images,q=>{A.value=q.map(N=>({...N,rotation:N.isNew&&N.rotation||0})),q.length===0&&t.show&&U()},{deep:!0,immediate:!0}),ve(()=>t.show,q=>{q&&t.images.length>0&&(g.value=t.initialIndex)}),ve(()=>t.uploadProgress,q=>{q===100&&console.log("Upload completed")});const V=q=>q.preview||(q.image_path?`/${q.image_path}`:""),_=q=>{if(x.value&&x.value.isNew&&!t.isUploading){const N=x.value.rotation||0;let z;q==="left"?z=N-90:z=N+90,z=(z%360+360)%360,A.value[g.value].rotation=z,$("update:images",A.value)}},L=()=>{t.isUploading||(g.value=g.value<A.value.length-1?g.value+1:0)},w=()=>{t.isUploading||(g.value=g.value>0?g.value-1:A.value.length-1)},E=()=>{t.isUploading||$("saveImages",A.value)},U=()=>{t.isUploading||$("close")},Z=()=>{if(x.value&&!t.isUploading){const q=x.value,N=A.value.findIndex(z=>z.isNew&&q.isNew&&z.preview===q.preview||!z.isNew&&!q.isNew&&z.id===q.id);N!==-1&&($("removePreviewImage",q),A.value.splice(N,1),$("update:images",A.value)),g.value>=A.value.length&&(g.value=Math.max(0,A.value.length-1)),A.value.length===0&&$("close")}},f=()=>{t.isUploading||$("triggerAddMorePhotos")},m=()=>{x.value&&!t.isUploading&&$("retryImage",x.value)},T=q=>{q.key==="Escape"&&!t.isUploading&&U()};return st(()=>{document.addEventListener("keydown",T)}),wt(()=>{document.removeEventListener("keydown",T)}),(q,N)=>{var z;return a.show?(n(),i("div",Hs,[e("div",Gs,[e("div",Ws,[e("button",{onClick:U,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:a.isUploading},N[2]||(N[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Js),e("div",Ys,F(((z=a.point)==null?void 0:z.name)||"Preview")+" ("+F(g.value+1)+"/"+F(A.value.length)+") ",1),e("div",Zs,[x.value&&x.value.isNew?(n(),i("button",{key:0,onClick:Z,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:a.isUploading},N[3]||(N[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Qs)):d("",!0)])]),a.isUploading?(n(),i("div",Xs,[e("div",en,[e("span",null,"Mengupload: "+F(a.currentUpload)+"/"+F(a.totalUpload),1),e("span",null,F(a.uploadProgress)+"%",1)]),e("div",tn,[e("div",{class:"bg-gradient-to-r from-indigo-500 to-sky-400 h-2 rounded-full progress-bar",style:qe({width:a.uploadProgress+"%"})},null,4)])])):d("",!0),e("div",an,[e("div",{class:"relative w-full max-w-full",style:qe({paddingTop:a.aspectRatio?100/a.aspectRatio+"%":"75%"})},[x.value?(n(),i("img",{key:0,src:V(x.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:qe({transform:`rotate(${x.value.rotation}deg)`})},null,12,sn)):d("",!0),x.value&&x.value.isNew&&!x.value.isUploading&&!x.value.isFailed?(n(),i("div",nn,[e("button",{onClick:N[0]||(N[0]=G=>_("left")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kiri"},N[4]||(N[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9",transform:"rotate(180 12 12)"})],-1)]),8,on),e("button",{onClick:N[1]||(N[1]=G=>_("right")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kanan"},N[5]||(N[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9"})],-1)]),8,ln)])):d("",!0),x.value&&x.value.isUploading?(n(),i("div",rn,N[6]||(N[6]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):d("",!0),x.value&&x.value.isFailed?(n(),i("div",un,[N[7]||(N[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),N[8]||(N[8]=e("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),e("button",{onClick:m,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:a.isUploading}," Coba Lagi ",8,dn)])):d("",!0)],4),A.value.length>1&&!a.isUploading?(n(),i("button",{key:0,onClick:w,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},N[9]||(N[9]=[e("svg",{xmlns:"http://www.w3.org2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,cn)):d("",!0),A.value.length>1&&!a.isUploading?(n(),i("button",{key:1,onClick:L,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},N[10]||(N[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,gn)):d("",!0)]),e("div",pn,[e("div",mn,[x.value&&!x.value.isNew?(n(),i("button",{key:0,onClick:Z,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:a.isUploading},N[11]||(N[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ee(" Hapus Foto ")]),8,vn)):(n(),i("div",fn)),a.allowMultiple&&A.value.length<a.maxFiles&&!a.isUploading?(n(),i("button",{key:2,onClick:f,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:a.isUploading},N[12]||(N[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Ee(" Tambah Foto ")]),8,hn)):d("",!0)]),e("div",bn,[a.isUploading?(n(),i("button",yn,[e("div",xn,[N[13]||(N[13]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+F(a.uploadProgress)+"%",1)])])):(n(),i("button",{key:0,onClick:E,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),a.isUploading?(n(),i("div",wn,N[14]||(N[14]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):d("",!0)])])])):d("",!0)}}},In=He(kn,[["__scopeId","data-v-0e4bb6d9"]]),_n={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Sn={class:"webcam-content-box"},Cn={class:"webcam-header"},$n={class:"inspection-point-name"},An={class:"camera-quality-indicator"},Vn={class:"quality-badge"},Tn={key:1,class:"auto-focus-indicator"},Mn={key:2,class:"error-overlay"},Un={class:"error-content"},Nn={class:"error-message"},En={class:"webcam-footer"},Dn={class:"camera-controls"},Pn=["disabled"],Ln={class:"camera-icon-container"},Rn={key:0,class:"camera-spinner"},jn={key:1,class:"camera-shutter"},Bn=["disabled"],Fn={__name:"WebCamRTC",props:{show:Boolean,aspectRatio:{type:Number,default:4/3},settings:{type:Object,default:()=>({enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object,cameraQuality:{type:String}},emits:["close","photoCaptured"],setup(a,{emit:ee}){const t=a,$=ee,g=y(null),A=y(null);let x=null,V=null;const _=y("environment"),L=y(null),w=y([]),E=y(!1),U=y(!1),Z=y(!1),f=y(!1),m=y(!1),T=y(null),q=y(null),N=y(!1),z=y(!0),G=y({}),B=se(()=>({aspectRatio:`${t.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"})),I=async()=>{x&&x.getTracks().forEach(R=>R.stop()),T.value=null,m.value=!0;try{const R=P();console.log("Mencoba inisialisasi kamera dengan:",R),x=await navigator.mediaDevices.getUserMedia({video:R,audio:!1}),V=x.getVideoTracks()[0],g.value.srcObject=x,await new Promise((D,K)=>{g.value.onloadedmetadata=D,g.value.onerror=K,setTimeout(D,1e3)}),await g.value.play(),await s(),W(),setTimeout(async()=>{try{await p()}catch(D){console.warn("Gagal mendapatkan daftar perangkat:",D)}},500),m.value=!1,console.log("Kamera berhasil diinisialisasi")}catch(R){if(console.error("Error mengakses kamera: ",R),!x)try{console.log("Mencoba fallback berdasarkan kualitas kamera...");let D,K,H,Q;switch(t.cameraQuality){case"SD":D=1280,K=720,H=640,Q=480;break;case"HD":D=1920,K=1080,H=1280,Q=720;break;case"4K":D=3840,K=2160,H=1920,Q=1080;break;default:D=1920,K=1080,H=1280,Q=720}const ue={video:{facingMode:_.value,width:{min:H,ideal:D},height:{min:Q,ideal:K}}};x=await navigator.mediaDevices.getUserMedia(ue),V=x.getVideoTracks()[0],g.value.srcObject=x,await g.value.play(),m.value=!1,console.log("Fallback berhasil dengan kualitas:",t.cameraQuality)}catch(D){console.error("Fallback juga gagal:",D),T.value=h(D),m.value=!1}}},P=()=>{let R,D,K,H,Q,ue;switch(t.cameraQuality){case"SD":R=1280,D=720,K=1280,H=720,Q=640,ue=480;break;case"HD":R=1920,D=1080,K=1920,H=1080,Q=1280,ue=720;break;case"4K":R=3840,D=2160,K=3840,H=2160,Q=1920,ue=1080;break;default:R=1920,D=1080,K=1920,H=1080,Q=1280,ue=720}return{facingMode:{ideal:"environment"},width:{ideal:R,max:K,min:Q},height:{ideal:D,max:H,min:ue},focusMode:{ideal:["continuous","single-shot","manual"]},exposureMode:{ideal:["continuous","manual"]},whiteBalanceMode:{ideal:["continuous","manual"]}}},W=async()=>{if(V)try{const R=V.getCapabilities();q.value=R;const D=R.focusMode&&(R.focusMode.includes("continuous")||R.focusMode.includes("single-shot")),K=R.exposureMode&&R.exposureMode.includes("continuous");if(D||K){const H={};D&&(H.focusMode="continuous"),K&&(H.exposureMode="continuous",H.exposureCompensation={ideal:0}),Object.keys(H).length>0&&(await V.applyConstraints({advanced:[H]}),console.log("Auto-focus/exposure diaktifkan"))}U.value=!!R.torch||!!R.fillLightMode}catch(R){console.warn("Tidak bisa mengatur auto-focus/exposure:",R)}},p=async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(K=>K.stop());const D=await navigator.mediaDevices.enumerateDevices();if(w.value=D.filter(K=>K.kind==="videoinput"),E.value=w.value.length>1,!L.value&&w.value.length>0){const K=w.value.find(H=>H.label.toLowerCase().includes("back")||H.label.toLowerCase().includes("rear")||H.label.toLowerCase().includes("environment"));L.value=K?K.deviceId:w.value[0].deviceId}}catch(R){console.warn("Error getting camera devices:",R)}},h=R=>{switch(R.name){case"NotAllowedError":return"Izin akses kamera ditolak. Silakan izinkan akses kamera di pengaturan browser.";case"NotFoundError":return"Tidak ada kamera yang ditemukan.";case"NotSupportedError":return"Browser tidak mendukung akses kamera.";case"NotReadableError":return"Kamera sedang digunakan oleh aplikasi lain.";case"OverconstrainedError":return"Perangkat tidak mendukung pengaturan kamera yang diminta.";default:return`Tidak dapat mengakses kamera: ${R.message}`}},s=()=>{var R,D;if(V)try{const K=V.getCapabilities();q.value=K,U.value=!!K.torch||!!K.fillLightMode,console.log("Kamera mendukung:",{maxRes:`${((R=K.width)==null?void 0:R.max)||"N/A"}x${((D=K.height)==null?void 0:D.max)||"N/A"}`,torch:K.torch,focusModes:K.focusMode,exposureModes:K.exposureMode})}catch(K){console.warn("Tidak bisa mendapatkan kemampuan kamera:",K)}},k=async()=>{if(!(!V||!U.value))try{_.value==="environment"?(await V.applyConstraints({advanced:[{torch:!Z.value}]}),Z.value=!Z.value):(console.log("Flash tidak didukung untuk kamera depan"),Z.value=!1)}catch(R){console.error("Gagal mengontrol flash:",R),Z.value=!1}},O=async()=>{if(!E.value||m.value)return;m.value=!0,x&&x.getTracks().forEach(H=>H.stop());const D=(w.value.findIndex(H=>H.deviceId===L.value)+1)%w.value.length;L.value=w.value[D].deviceId;const K=w.value[D];_.value=K.label.toLowerCase().includes("front")?"user":"environment",await I()},re=async R=>{if(!g.value||!V)return;const D=R.currentTarget.getBoundingClientRect(),K=R.type.includes("mouse")?R.clientX-D.left:R.touches[0].clientX-D.left,H=R.type.includes("mouse")?R.clientY-D.top:R.touches[0].clientY-D.top;N.value=!0,G.value={left:`${K-40}px`,top:`${H-40}px`},setTimeout(()=>{N.value=!1},1e3);try{const Q=V.getCapabilities();if(Q.focusMode&&Q.focusMode.includes("manual")){const ue=K/D.width,me=H/D.height;Q.focusDistance&&Q.pan&&Q.tilt&&await V.applyConstraints({advanced:[{focusMode:"manual",focusDistance:.3,pointsOfInterest:[{x:ue,y:me}]}]})}else Q.focusMode&&Q.focusMode.includes("single-shot")&&await V.applyConstraints({advanced:[{focusMode:"single-shot"}]})}catch(Q){console.warn("Penyesuaian fokus tidak didukung:",Q)}},_e=async()=>{var R,D;if(!(f.value||!g.value||!A.value)){f.value=!0;try{const K=g.value,H=A.value;await new Promise(be=>setTimeout(be,100));const Q=K.videoWidth,ue=K.videoHeight;let me,ce,Te,we;Q/ue>t.aspectRatio?(ce=ue,me=ue*t.aspectRatio,Te=(Q-me)/2,we=0):(me=Q,ce=Q/t.aspectRatio,Te=0,we=(ue-ce)/2),H.width=me,H.height=ce,H.getContext("2d").drawImage(K,Te,we,me,ce,0,0,me,ce);const Ie=Math.min(.95,.7+Q*ue/(3840*2160)*.25),Ce=await new Promise(be=>{H.toBlob(be,"image/jpeg",Ie)});if(Ce)if(Ce.size/1024>t.settings.max_size){const be=await he(Ce,t.settings.max_size),Me=`inspeksi_${((R=t.point)==null?void 0:R.name)||"foto"}_${Date.now()}.jpg`,Ue=new File([be],Me,{type:"image/jpeg",lastModified:Date.now()});$("photoCaptured",Ue)}else{const be=`inspeksi_${((D=t.point)==null?void 0:D.name)||"foto"}_${Date.now()}.jpg`,Me=new File([Ce],be,{type:"image/jpeg",lastModified:Date.now()});$("photoCaptured",Me)}}catch(K){console.error("Error mengambil foto:",K)}finally{f.value=!1}}},he=async(R,D)=>new Promise(K=>{const H=new Image;H.onload=()=>{const Q=document.createElement("canvas");let ue=H.width,me=H.height;const ce=1920;(ue>ce||me>ce)&&(ue>me?(me=me*ce/ue,ue=ce):(ue=ue*ce/me,me=ce)),Q.width=ue,Q.height=me,Q.getContext("2d").drawImage(H,0,0,ue,me);let we=.9;const ge=()=>{Q.toBlob(Ie=>{Ie.size/1024<=D||we<=.3?K(Ie):(we-=.1,ge())},"image/jpeg",we)};ge()},H.src=URL.createObjectURL(R)}),Se=()=>{x&&x.getTracks().forEach(R=>R.stop()),$("close")},Ve=async()=>{T.value=null,await I()};return ve(()=>t.show,async R=>{R?(await Pt(),await I()):x&&x.getTracks().forEach(D=>D.stop())}),wt(()=>{x&&x.getTracks().forEach(R=>R.stop())}),(R,D)=>{var K;return a.show?(n(),i("div",_n,[e("div",Sn,[e("div",Cn,[e("div",$n,F(((K=a.point)==null?void 0:K.name)||"Camera"),1),e("div",An,[e("span",Vn,F(a.cameraQuality),1)]),e("button",{onClick:Se,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},D[0]||(D[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:qe(B.value),onTouchstart:re,onClick:re},[e("video",{ref_key:"webcamVideo",ref:g,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:A,class:"hidden"},null,512),N.value?(n(),i("div",{key:0,class:"focus-indicator",style:qe(G.value)},D[1]||(D[1]=[e("div",{class:"focus-ring"},null,-1)]),4)):d("",!0),z.value&&!N.value?(n(),i("div",Tn,D[2]||(D[2]=[e("div",{class:"auto-focus-ring"},null,-1)]))):d("",!0),T.value?(n(),i("div",Mn,[e("div",Un,[D[3]||(D[3]=e("div",{class:"error-icon"},"⚠️",-1)),D[4]||(D[4]=e("h3",{class:"error-title"},"Gagal Mengakses Kamera",-1)),e("p",Nn,F(T.value),1),e("button",{onClick:Ve,class:"retry-button"}," Coba Lagi ")])])):d("",!0)],36),e("div",En,[e("div",Dn,[a.settings.enable_flash&&U.value?(n(),i("button",{key:0,onClick:k,class:oe(["control-button flash-button",{active:Z.value}])},D[5]||(D[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):d("",!0),e("button",{onClick:_e,class:"capture-button",disabled:f.value||m.value},[e("div",Ln,[f.value?(n(),i("div",Rn)):(n(),i("div",jn))])],8,Pn),a.settings.enable_camera_switch&&E.value?(n(),i("button",{key:1,onClick:O,class:"control-button switch-button",disabled:m.value},D[6]||(D[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]),8,Bn)):d("",!0)])])])])):d("",!0)}}},On=He(Fn,[["__scopeId","data-v-472cc13f"]]),zn={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Kn={class:"webcam-content-box"},qn={class:"webcam-header"},Hn={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},Gn={class:"inspection-point-name"},Wn={key:0,class:"screen-flash-overlay"},Jn={key:2,class:"zoom-controls"},Yn=["max"],Zn={class:"webcam-footer"},Qn={class:"camera-controls"},Xn=["disabled"],eo={class:"camera-icon-container"},to={key:0,class:"camera-spinner"},ao={key:1,class:"camera-body"},so={__name:"WebcamModal",props:{show:Boolean,aspectRatio:{type:Number,default:4/3},settings:{type:Object,default:()=>({enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","photoCaptured"],setup(a,{emit:ee}){const t=a,$=ee,g=y(null),A=y(null);let x=null,V=null;const _=y("environment"),L=y(!1),w=y(!1),E=y(!1),U=y(!1),Z=y(!1),f=y(1),m=y(1),T=y(!1),q=async()=>{P();try{x=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:_.value},width:{ideal:1920},height:{ideal:1440},aspectRatio:{ideal:4/3},frameRate:{ideal:30}},audio:!1}),V=x.getVideoTracks()[0],g.value.srcObject=x,await g.value.play(),await N()}catch{alert("Kamera tidak bisa diakses"),$("close")}},N=async()=>{const W=V.getCapabilities();w.value=!!W.torch,W.zoom&&(Z.value=!0,m.value=W.zoom.max);const p=await navigator.mediaDevices.enumerateDevices();L.value=p.filter(h=>h.kind==="videoinput").length>1},z=async()=>{if(w.value)try{await V.applyConstraints({advanced:[{torch:!E.value}]}),E.value=!E.value}catch{console.warn("Torch not supported")}},G=async W=>{if(!Z.value)return;const p=Math.min(Math.max(W,1),m.value);f.value=p,await V.applyConstraints({advanced:[{zoom:p}]})},B=async()=>{_.value=_.value==="environment"?"user":"environment",await q()},I=async()=>{if(T.value)return;T.value=!0;const W=g.value,p=A.value,h=p.getContext("2d");p.width=W.videoWidth,p.height=W.videoHeight,h.drawImage(W,0,0);const s=await new Promise(k=>p.toBlob(k,"image/jpeg",.95));$("photoCaptured",new File([s],`photo_${Date.now()}.jpg`,{type:"image/jpeg"})),U.value=!0,setTimeout(()=>U.value=!1,120),T.value=!1},P=()=>{x&&(x.getTracks().forEach(W=>W.stop()),x=null)};return ve(()=>t.show,W=>W?q():P()),wt(P),(W,p)=>{var h;return a.show?(n(),i("div",zn,[e("div",Kn,[e("div",qn,[e("p",Hn,F(a.settings.camera_aspect_ratio),1),e("div",Gn,F(((h=W.point)==null?void 0:h.name)||"Camera"),1),e("button",{onClick:p[0]||(p[0]=(...s)=>W.closeModal&&W.closeModal(...s)),class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},p[5]||(p[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:qe(W.videoContainerStyle),onClick:p[3]||(p[3]=(...s)=>W.handleTapToFocus&&W.handleTapToFocus(...s)),onTouchstart:p[4]||(p[4]=(...s)=>W.handleTapToFocus&&W.handleTapToFocus(...s))},[e("video",{ref_key:"webcamVideo",ref:g,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:A,class:"hidden"},null,512),U.value?(n(),i("div",Wn)):d("",!0),e("div",{class:"aspect-ratio-guide",style:qe(W.aspectRatioGuideStyle)},null,4),W.showFocusIndicator?(n(),i("div",{key:1,class:"focus-indicator",style:qe(W.focusIndicatorStyle)},p[6]||(p[6]=[e("div",{class:"focus-ring"},null,-1)]),4)):d("",!0),p[7]||(p[7]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),Z.value?(n(),i("div",Jn,[Le(e("input",{type:"range",min:"1",max:m.value,step:"0.1","onUpdate:modelValue":p[1]||(p[1]=s=>f.value=s),onInput:p[2]||(p[2]=s=>G(parseFloat(s.target.value))),class:"zoom-slider"},null,40,Yn),[[dt,f.value]])])):d("",!0)],36),e("div",Zn,[e("div",Qn,[a.settings.enable_flash&&w.value?(n(),i("button",{key:0,onClick:z,class:oe(["control-button",{active:E.value,disabled:!w.value}])},p[8]||(p[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):d("",!0),e("button",{onClick:I,class:"capture-button",disabled:T.value},[e("div",eo,[T.value?(n(),i("div",to)):(n(),i("div",ao,p[9]||(p[9]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,Xn),a.settings.enable_camera_switch&&L.value?(n(),i("button",{key:1,onClick:B,class:"control-button"},p[10]||(p[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):d("",!0)])])])])):d("",!0)}}},no=He(so,[["__scopeId","data-v-3248d3c9"]]),oo={__name:"NativeCameraInput",emits:["photoCaptured"],setup(a,{expose:ee,emit:t}){const $=t,g=y(null);ee({openCamera:()=>{var V;(V=g.value)==null||V.click()}});const x=async V=>{var L;const _=(L=V.target.files)==null?void 0:L[0];_&&($("directPhotoCaptured",_),V.target.value="")};return(V,_)=>(n(),i("input",{ref_key:"cameraInput",ref:g,type:"file",accept:"image/*",capture:"environment",class:"hidden",onChange:x},null,544))}},io=["accept","multiple","disabled"],lo={class:"text-xs text-gray-500 mb-2"},ro=["disabled"],uo={class:"h-full flex flex-col items-center justify-center p-4 text-center"},co={class:"text-xs text-gray-400 mt-1"},go={key:0,class:"flex items-center gap-4"},po=["src"],mo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},vo=["disabled"],fo={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},ho=["disabled"],bo=["onClick"],yo=["src","onError"],xo={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},wo={key:0},ko={key:1,class:"ml-1"},Io={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},_o={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},So={key:2,class:"mt-1 text-xs text-red-600"},Co={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(a,{emit:ee}){const t=a,$=ee,g=y(null),A=y(null),x=y(null),V=y(!1),_=y(!1),L=y(!1),w=y([]),E=y(0),U=y(!1),Z=y(!1),f=y(0),m=y(0),T=y(0),q=Lt("imageSourceSetting",y("all")),N=Lt("cameraQualitySetting",y("HD_Std")),z=`inspection-${t.inspectionId}-point-${t.pointId}-backup`,G=se(()=>Number(t.settings.max_files)>1),B=se(()=>t.settings.allowed_types.map(r=>`.${r}`).join(", ")),I=se(()=>{const r=t.settings.camera_aspect_ratio.split(":");if(r.length===2){const u=parseFloat(r[0]),v=parseFloat(r[1]);if(!isNaN(u)&&!isNaN(v)&&v!==0)return u/v}return 3/4}),P=se(()=>{console.log("🔄 allImages computed called");const r=[],u=new Set;for(const v of t.modelValue){if(!v||typeof v!="object"||v.id&&u.has(v.id))continue;v.id&&u.add(v.id),console.log("📥 Database image:",v),console.log("📥 Type of preview:",typeof v.preview),console.log("📥 Type of public_url:",typeof v.public_url);const S=W(v);r.push({...S,rotation:S.rotation||0,isNew:!1,isUploaded:!0,isUploading:!1,isFailed:!1})}for(const v of w.value)v.id&&u.add(v.id),r.push({...v,isUploading:v.isUploading||!1,isFailed:v.isFailed||!1});return console.log("✅ Final allImages:",r),r}),W=r=>{if(!r||typeof r!="object")return{};const u={...r};return["preview","public_url","original_url","optimized_url"].forEach(S=>{u[S]&&(u[S]=p(u[S]))}),u.image_path&&(u.image_path=u.image_path.replace(/^storage\//,"")),u},p=r=>{if(!r||typeof r!="string")return r;let u=r.replace(/\/storage\/storage\//g,"/storage/");return u=u.replace(/\/\/storage\/storage\//g,"/storage/"),u.startsWith("storage/")&&(u=`/${u}`),!u.startsWith("/")&&!u.startsWith("http")&&(u=`/storage/${u}`),u},h=r=>{if(!r||typeof r!="object")return console.warn("❌ safeImageSrc: image is not object",r),"";const u=s(r);return typeof u!="string"?(console.error("🚨 CRITICAL: getImageSrc returned non-string:",typeof u,u),""):(u&&console.log("✅ safeImageSrc result:",u),u)},s=r=>{if(!r||typeof r!="object")return"";if(console.log("🔍 getImageSrc called with:",r),console.log("🔍 Available fields:",Object.keys(r)),r.preview&&typeof r.preview=="string"){const u=p(r.preview);return console.log("✅ Using preview URL:",u),u}if(r.public_url&&typeof r.public_url=="string"){const u=p(r.public_url);return console.log("✅ Using public_url:",u),u}if(r.original_url&&typeof r.original_url=="string"){const u=p(r.original_url);return console.log("✅ Using original_url:",u),u}if(r.optimized_url&&typeof r.optimized_url=="string"){const u=p(r.optimized_url);return console.log("✅ Using optimized_url:",u),u}if(r.image_path&&typeof r.image_path=="string"){const v=`/storage/${r.image_path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from image_path:",v),v}if(r.path&&typeof r.path=="string"){const v=`/storage/${r.path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from path:",v),v}return console.warn("⚠️ No valid image source found for:",r),""},k=r=>{console.error("❌ Image load error for:",r),console.error("❌ Attempted URL:",h(r)),Z.value=!0;const u=O(r);if(u&&u!==h(r)){console.log("🔄 Trying fallback URL:",u);const v=event==null?void 0:event.target;v&&(v.src=u)}},O=r=>{if(!r||typeof r!="object")return"";const u=["original_url","optimized_url","public_url","preview"];for(const v of u)if(r[v]&&typeof r[v]=="string")return p(r[v]);return""},re=()=>{L.value&&(L.value=!1),q.value==="camera"?he():q.value==="gallery"?_e():V.value=!0},_e=()=>{V.value=!1,A.value.click()},he=()=>{var r;V.value=!1,N.value==="HP_Native"?(r=g.value)==null||r.openCamera():_.value=!0},Se=()=>{V.value=!1,P.value.length>0&&(L.value=!0)},Ve=()=>{_.value=!1,P.value.length>0&&(L.value=!0)},R=()=>{L.value=!1,U.value||(w.value.forEach(r=>{r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview)}),w.value=[])};ve(()=>t.modelValue,r=>{var u;console.log("🔄 modelValue updated:",r),r&&r.length>0&&(console.log("📊 First image structure:",JSON.stringify(r[0],null,2)),console.log("🔍 Type of preview:",typeof((u=r[0])==null?void 0:u.preview)))},{deep:!0});const D=r=>new Promise(u=>{const v=new FileReader;v.onload=S=>{const J=new Image;J.onload=()=>{u({file:r,preview:URL.createObjectURL(r),rotation:0,width:J.naturalWidth,height:J.naturalHeight,isNew:!0})},J.onerror=()=>{console.error("Failed to load image for dimensions:",r.name),u({file:r,preview:URL.createObjectURL(r),rotation:0,width:0,height:0,isNew:!0})},J.src=S.target.result},v.readAsDataURL(r)}),K=r=>{const u=r.name.split(".").pop().toLowerCase();return t.settings.allowed_types.includes(u)},H=async r=>{const v=(t.settings.max_size||2048)*1024;return new Promise(S=>{const J=new Image,ie=new FileReader;ie.onload=de=>{J.onload=()=>{const b=document.createElement("canvas"),c=b.getContext("2d"),te=Math.max(J.width,J.height);b.width=te,b.height=te,c.fillStyle="white",c.fillRect(0,0,te,te);const C=(te-J.width)/2,ae=(te-J.height)/2;c.drawImage(J,C,ae,J.width,J.height);let ye=.9;const $e=()=>{b.toBlob(xe=>{if(xe.size>v&&ye>.1)ye-=.1,$e();else{const Oe=new File([xe],r.name,{type:"image/jpeg",lastModified:Date.now()});S(Oe)}},"image/jpeg",ye)};$e()},J.src=de.target.result},ie.readAsDataURL(r)})},Q=async r=>{const u=Array.from(r.target.files);if(!u.length){V.value=!1,P.value.length>0&&(L.value=!0);return}try{const v=u.filter(c=>!K(c));if(v.length>0){const c=v.map(te=>te.name.split(".").pop()).join(", ");alert(`File type not allowed: ${c}. Allowed types: ${t.settings.allowed_types.join(", ")}`),r.target.value="";return}const S=P.value.length,J=t.settings.max_files-S,ie=await Promise.all(u.slice(0,J).map(async c=>await H(c))),de=await Promise.all(ie.map(D)),b=G.value?de:de.slice(0,1);G.value?w.value.push(...b):(w.value.forEach(c=>{c.preview&&c.preview.startsWith("blob:")&&URL.revokeObjectURL(c.preview)}),w.value=b),V.value=!1,b.length>0?(E.value=Math.max(0,P.value.length-b.length),L.value=!0):P.value.length>0&&(L.value=!0),r.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),V.value=!1,P.value.length>0&&(L.value=!0)}},ue=async r=>{const u=P.value.length;if(!G.value||u<t.settings.max_files)try{const v=await H(r),S=new Image;S.onload=()=>{const J={file:v,preview:URL.createObjectURL(v),rotation:0,width:S.naturalWidth,height:S.naturalHeight,isNew:!0};G.value?w.value.push(J):(w.value.forEach(ie=>{ie.preview&&ie.preview.startsWith("blob:")&&URL.revokeObjectURL(ie.preview)}),w.value=[J]),_.value=!1,V.value=!1,E.value=P.value.length-1,L.value=!0},S.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${t.settings.max_files} files allowed.`),_.value=!1,V.value=!1,P.value.length>0&&(L.value=!0)},me=async r=>{const u=P.value.length;if(!G.value||u<t.settings.max_files)try{const v=await H(r),S=new Image;S.onload=()=>{const J={file:v,preview:URL.createObjectURL(v),rotation:0,width:S.naturalWidth,height:S.naturalHeight,isNew:!0};G.value?w.value.push(J):(w.value.forEach(ie=>{ie.preview&&ie.preview.startsWith("blob:")&&URL.revokeObjectURL(ie.preview)}),w.value=[J]),V.value=!1,E.value=P.value.length-1,L.value=!0},S.src=URL.createObjectURL(v)}catch(v){console.error("Error processing direct captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${t.settings.max_files} files allowed.`),V.value=!1,P.value.length>0&&(L.value=!0)},ce=(r=0)=>{E.value=r,L.value=!0},Te=r=>new Promise(u=>{if(r.rotation===0||!x.value){if(!r.isNew&&!r.file){u({file:null,width:r.width,height:r.height,isOriginal:!0});return}u({file:r.file,width:r.width,height:r.height});return}const v=new Image;v.onload=async()=>{try{const S=x.value,J=S.getContext("2d"),ie=v.width,de=v.height;let b,c;r.rotation===90||r.rotation===270?(b=de,c=ie):(b=ie,c=de),S.width=b,S.height=c,J.clearRect(0,0,S.width,S.height),J.translate(S.width/2,S.height/2),J.rotate(r.rotation*Math.PI/180),J.drawImage(v,-ie/2,-de/2,ie,de),J.setTransform(1,0,0,1,0,0);const te=await new Promise(ye=>{S.toBlob(ye,"image/jpeg",.9)}),C=new File([te],r.file?r.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),ae=await H(C);u({file:ae,width:b,height:c})}catch(S){console.error("Error processing rotated image:",S),u({file:r.file,width:r.width,height:r.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",r.preview),u({file:r.file,width:r.width,height:r.height})},v.src=r.preview}),we=r=>{try{const u={images:r.map(v=>{var S;return{fileName:((S=v.file)==null?void 0:S.name)||`image-${Date.now()}.jpg`,rotation:v.rotation||0,width:v.width||0,height:v.height||0,timestamp:Date.now()}}),inspectionId:t.inspectionId,pointId:t.pointId};localStorage.setItem(z,JSON.stringify(u))}catch(u){console.error("Error saving backup:",u)}},ge=()=>{localStorage.removeItem(z)},Ie=async r=>{U.value=!0;const u=[],v=[];if(!t.pointId){alert("Error: Point ID is missing. Cannot upload image."),U.value=!1;return}try{we(r);for(const S of r){if(!S.isNew&&S.rotation===0&&S.id&&S.image_path){u.push({id:S.id,image_path:S.image_path,width:S.width,height:S.height,rotation:0,preview:S.preview,isUploaded:!0});continue}const{file:J,width:ie,height:de,isOriginal:b}=await Te(S);if(b&&!S.isNew){u.push({id:S.id,image_path:S.image_path,width:S.width,height:S.height,rotation:S.rotation||0,preview:S.preview,isUploaded:!0});continue}J&&v.push({file:J,width:ie,height:de,rotation:S.rotation||0,originalImage:S})}R(),v.length>0?await Ce(v,u):($("update:modelValue",u),$("save",t.pointId))}catch(S){console.error("Error during image processing:",S),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{U.value=!1}},Ce=async(r,u)=>{T.value=r.length,m.value=0,f.value=0;const v=[...u];let S=0;try{for(let J=0;J<r.length;J++){const ie=r[J],de=new FormData;de.append("inspection_id",t.inspectionId),de.append("point_id",t.pointId),de.append("images[]",ie.file);const b=w.value.findIndex(c=>{var te;return c.preview===((te=ie.originalImage)==null?void 0:te.preview)});b!==-1&&(w.value[b].isUploading=!0,w.value[b].isFailed=!1);try{const te=(await jt.post(route("inspections.upload-image"),de,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:C=>{if(C.total){const ae=Math.round(C.loaded*100/C.total);f.value=Math.round((J+C.loaded/C.total)/r.length*100),m.value=J+1}}})).data.images;if(te&&te.length>0){const C=te[0];if(v.push({id:C.image_id,image_path:C.path,width:C.width||ie.width||0,height:C.height||ie.height||0,rotation:ie.rotation||0,preview:C.public_url,isUploaded:!0}),b!==-1){const ae=w.value.splice(b,1)[0];ae.preview&&ae.preview.startsWith("blob:")&&URL.revokeObjectURL(ae.preview)}S++}}catch(c){console.error(`Error uploading image ${J+1}:`,c),b!==-1&&(w.value[b].isUploading=!1,w.value[b].isFailed=!0)}}S>0&&($("update:modelValue",v),$("save",t.pointId),$("uploaded",{pointId:t.pointId,images:v,newImagesCount:S})),S===r.length&&ge(),console.log(`✅ Successfully uploaded ${S}/${r.length} images`)}catch(J){console.error("Error in upload process:",J),r.forEach(ie=>{const de=w.value.findIndex(b=>{var c;return b.preview===((c=ie.originalImage)==null?void 0:c.preview)});de!==-1&&(w.value[de].isUploading=!1,w.value[de].isFailed=!0)})}finally{f.value=0,m.value=0,T.value=0,U.value=!1}},be=async r=>{if(!r||!r.file){console.error("No file to retry upload");return}U.value=!0;const u=[...t.modelValue];try{const v=new FormData;v.append("inspection_id",t.inspectionId),v.append("point_id",t.pointId),v.append("images[]",r.file);const S=w.value.findIndex(de=>de.preview===r.preview);S!==-1&&(w.value[S].isUploading=!0,w.value[S].isFailed=!1);const ie=(await jt.post(route("inspections.upload-image"),v,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(ie&&ie.length>0){const de=ie[0];if(u.push({id:de.image_id,image_path:de.path,width:de.width||r.width||0,height:de.height||r.height||0,rotation:r.rotation||0,preview:de.public_url,isUploaded:!0}),S!==-1){const c=w.value.splice(S,1)[0];c.preview&&c.preview.startsWith("blob:")&&URL.revokeObjectURL(c.preview)}$("update:modelValue",u),$("save",t.pointId),$("uploaded",{pointId:t.pointId,images:u,newImagesCount:1}),w.value.some(c=>c.isFailed)||ge(),console.log("✅ Successfully retried upload for 1 image")}}catch(v){console.error("Error retrying upload:",v),previewIndex!==-1&&(w.value[previewIndex].isUploading=!1,w.value[previewIndex].isFailed=!0)}finally{U.value=!1}},Me=r=>{if(r){if(r.id&&!r.isNew)Ue(r);else{const u=w.value.findIndex(v=>v.preview&&v.preview===r.preview&&v.isNew||v.id&&v.id===r.id);if(u!==-1){const v=w.value.splice(u,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}$("update:modelValue",t.modelValue.filter(v=>!(v.id&&v.id===r.id)&&!(v.preview&&v.preview===r.preview)))}E.value>=P.value.length&&(E.value=Math.max(0,P.value.length-1)),P.value.length===0&&R()}},Ue=async r=>{var v,S;if(r.id||r.image_path)try{await jt.delete(route("inspections.delete-image"),{data:{image_id:r.id,image_path:r.image_path}})}catch(J){console.error("Error deleting image from server:",J),(S=(v=J.response)==null?void 0:v.data)!=null&&S.message?alert(`Failed to delete image from server: ${J.response.data.message}`):alert(`Failed to delete image from server: ${J.message}`);return}r.preview&&r.preview.startsWith("blob:")&&URL.revokeObjectURL(r.preview);const u=t.modelValue.filter(J=>J.id!==r.id);$("update:modelValue",u),w.value=w.value.filter(J=>J.isNew&&r.isNew?J.preview!==r.preview:J.id!==r.id),$("removeImage",{image:r}),L.value&&P.value.length===0?R():L.value&&E.value>=P.value.length&&(E.value=Math.max(0,P.value.length-1))};return st(()=>{try{localStorage.getItem(z)&&console.log("Found backup images, ready for recovery if needed")}catch(r){console.error("Error loading backup:",r)}}),(r,u)=>(n(),i("div",null,[e("input",{ref_key:"galleryInput",ref:A,type:"file",accept:B.value,class:"hidden",onChange:Q,multiple:G.value,disabled:U.value},null,40,io),e("canvas",{ref_key:"processingCanvas",ref:x,class:"hidden"},null,512),e("p",lo,"Foto Maksimal: "+F(a.settings.max_files)+" | Rasio: "+F(a.settings.camera_aspect_ratio),1),P.value.length===0?(n(),i("label",{key:0,onClick:re,class:oe(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:U.value},[e("div",uo,[u[3]||(u[3]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),u[4]||(u[4]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",co,"Tipe: "+F(B.value),1)])],8,ro)):(n(),i("div",{key:1,class:oe(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":a.settings.max_files==1,"bg-transparent":a.settings.max_files>1}]),"aria-label":"Image gallery"},[a.settings.max_files===1?(n(),i("div",go,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:u[1]||(u[1]=v=>ce(0))},[e("img",{src:h(P.value[0]),onError:u[0]||(u[0]=v=>k(P.value[0])),class:"w-full h-full object-cover"},null,40,po),P.value[0].isUploading?(n(),i("div",mo,u[5]||(u[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):d("",!0)]),e("button",{onClick:u[2]||(u[2]=ct(v=>Ue(P.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:U.value},u[6]||(u[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ee(" Hapus Foto ")]),8,vo)])):(n(),i("div",fo,[G.value&&P.value.length<a.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:re,disabled:U.value},u[7]||(u[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,ho)):d("",!0),(n(!0),i(Ne,null,Pe(P.value,(v,S)=>(n(),i("div",{key:v.id||v.preview||S,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:J=>v.isFailed?be(v):ce(S)},[e("img",{src:h(v),onError:J=>k(v),class:"w-full h-full object-cover"},null,40,yo),v.isNew||v.rotation!==0?(n(),i("div",xo,[v.isNew?(n(),i("span",wo,"BARU")):d("",!0),v.rotation!==0?(n(),i("span",ko,"ROTASI")):d("",!0)])):d("",!0),v.isUploading?(n(),i("div",Io,u[8]||(u[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):d("",!0),v.isFailed?(n(),i("div",_o,u[9]||(u[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),e("span",{class:"text-xs font-medium"},"Retry",-1)]))):d("",!0)],8,bo))),128))]))],2)),a.error?(n(),i("p",So,F(a.error),1)):d("",!0),Ae(qs,{show:V.value,settings:a.settings,onClose:Se,onOpenWebcam:he,onTriggerGallery:_e},null,8,["show","settings"]),X(N)!=="HD_Std"?(n(),De(On,{key:3,show:_.value,"aspect-ratio":I.value,settings:a.settings,point:a.point,"camera-quality":X(N),onClose:Ve,onPhotoCaptured:ue},null,8,["show","aspect-ratio","settings","point","camera-quality"])):d("",!0),X(N)==="HD_Std"?(n(),De(no,{key:4,show:_.value,"aspect-ratio":I.value,settings:a.settings,point:a.point,"camera-quality":X(N),onClose:Ve,onPhotoCaptured:ue},null,8,["show","aspect-ratio","settings","point","camera-quality"])):d("",!0),X(N)==="HP_Native"?(n(),De(oo,{key:5,ref_key:"nativeCamera",ref:g,onDirectPhotoCaptured:me},null,512)):d("",!0),Ae(In,{show:L.value,images:P.value,point:a.point,"initial-index":E.value,"allow-multiple":G.value,"max-files":a.settings.max_files,"is-uploading":U.value,"aspect-ratio":I.value,"upload-progress":f.value,"current-upload":m.value,"total-upload":T.value,onClose:R,onSaveImages:Ie,onRemovePreviewImage:Me,onTriggerAddMorePhotos:re,onRetryImage:be},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},Ft=He(Co,[["__scopeId","data-v-c25c1d53"]]),$o={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Ao={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Vo={class:"px-4 pb-2 border-b border-gray-200"},To={class:"text-lg font-semibold text-gray-900"},Mo={key:0,class:"text-sm text-gray-500 mt-1"},Uo={class:"flex-1 overflow-y-auto p-4"},No={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Eo={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(a){return(ee,t)=>(n(),De(gt,{name:"bottom-sheet"},{default:Fe(()=>[a.show?(n(),i("div",$o,[t[1]||(t[1]=e("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),e("div",Ao,[t[0]||(t[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",Vo,[e("h3",To,F(a.title),1),a.subtitle?(n(),i("p",Mo,F(a.subtitle),1)):d("",!0)]),e("div",Uo,[aa(ee.$slots,"default",{},void 0,!0)]),ee.$slots.footer?(n(),i("div",No,[aa(ee.$slots,"footer",{},void 0,!0)])):d("",!0)])])):d("",!0)]),_:3}))}},pa=He(Eo,[["__scopeId","data-v-fd942535"]]),Do={class:"space-y-4"},Po={key:0,class:"mt-2"},Lo={key:1,class:"mt-2"},Ro={key:2,class:"mt-2"},jo={key:3,class:"mt-2"},Bo={key:4,class:"mt-2"},Fo={class:"text-sm font-medium text-gray-700 mb-2"},Oo={key:0,class:"text-red-500"},zo={key:0,class:"text-xs text-red-500"},Ko=["type","name","value","checked","onChange"],qo={key:6,class:"mt-4"},Ho={class:"text-sm font-medium text-gray-700 mb-2"},Go={key:0,class:"text-red-500"},Wo={key:0,class:"text-xs text-red-500"},Jo={key:7,class:"space-y-2"},Yo={key:0,class:"text-red-500"},Zo={key:1,class:"text-xs text-red-500"},Qo={class:"flex gap-2"},Xo=["disabled"],Ot={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:[String,Array],notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(a,{emit:ee}){const t=a,$=ee,g=f=>$("hapus",f),A=se(()=>Array.isArray(t.selectedValue)?t.options.find(f=>t.selectedValue.includes(f.value)):t.options.find(f=>f.value===t.selectedValue)),x=se(()=>{if(Array.isArray(t.selectedValue))return t.options.filter(f=>t.selectedValue.includes(f.value));if(t.selectedValue){const f=typeof t.selectedValue=="string"?t.selectedValue.split(",").map(m=>m.trim()):[t.selectedValue];return t.options.filter(m=>f.includes(m.value))}return[]}),V=se(()=>{var f;if(Array.isArray(t.selectedValue))return x.value.some(m=>{var T;return m.multi&&((T=m.settings)==null?void 0:T.show_textarea)});{const m=t.options.find(T=>T.value===t.selectedValue);return(f=m==null?void 0:m.settings)==null?void 0:f.show_textarea}}),_=se(()=>{var f;if(Array.isArray(t.selectedValue))return x.value.some(m=>{var T;return m.multi&&((T=m.settings)==null?void 0:T.show_image_upload)});{const m=t.options.find(T=>T.value===t.selectedValue);return(f=m==null?void 0:m.settings)==null?void 0:f.show_image_upload}}),L=se(()=>{var f;if(Array.isArray(t.selectedValue)){const m=x.value.filter(z=>{var G;return z.multi&&((G=z.settings)==null?void 0:G.show_textarea)});if(m.length===0)return null;const T={...m[0].settings},q=[];m.forEach(z=>{var G;(G=z.settings)!=null&&G.damage_options&&q.push(...z.settings.damage_options)});const N=q.filter((z,G,B)=>G===B.findIndex(I=>I.value===z.value));return T.damage_options=N,{...m[0],settings:T}}else{const m=t.options.find(T=>T.value===t.selectedValue);return(f=m==null?void 0:m.settings)!=null&&f.show_textarea?m:null}}),w=se(()=>{var f;if(Array.isArray(t.selectedValue))return x.value.find(m=>{var T;return m.multi&&((T=m.settings)==null?void 0:T.show_image_upload)});{const m=t.options.find(T=>T.value===t.selectedValue);return(f=m==null?void 0:m.settings)!=null&&f.show_image_upload?m:null}});se(()=>x.value.find(f=>{var m;return f.multi&&((m=f.settings)==null?void 0:m.show_textarea)})),se(()=>x.value.find(f=>{var m;return f.multi&&((m=f.settings)==null?void 0:m.show_image_upload)}));const E=f=>Array.isArray(t.selectedValue)?t.selectedValue.includes(f.value):t.selectedValue?(typeof t.selectedValue=="string"?t.selectedValue.split(",").map(T=>T.trim()):[t.selectedValue]).includes(f.value):!1,U=(f,m)=>{let T;if(f.multi){const q=Array.isArray(t.selectedValue)?t.selectedValue:[];m.target.checked?T=[...q,f.value]:T=q.filter(N=>N!==f.value)}else T=f.value;$("update:selectedValue",T)},Z=se(()=>{var m,T,q,N,z,G,B;if(t.point.input_type==="text"&&(!((m=t.notesValue)!=null&&m.trim())||t.point.settings.min_length&&t.notesValue.length<t.point.settings.min_length||t.point.settings.max_length&&t.notesValue.length>t.point.settings.max_length)||t.point.input_type==="number"&&(!((T=t.notesValue)!=null&&T.trim())||t.point.settings.min&&t.notesValue.length<t.point.settings.min||t.point.settings.max&&t.notesValue.length>t.point.settings.max)||t.point.input_type==="account"&&(!((q=t.notesValue)!=null&&q.trim())||t.point.settings.min_value&&t.notesValue.length<t.point.settings.min_value||t.point.settings.max_value&&t.notesValue.length>t.point.settings.max_value)||t.point.input_type==="date"&&(!((N=t.notesValue)!=null&&N.trim())||t.point.settings.min_date&&t.notesValue.length<t.point.settings.min_date||t.point.settings.max_date&&t.notesValue.length>t.point.settings.max_date))return!1;if(t.point.input_type==="imageTOradio"){if(t.imagesValue.length===0)return!1;const I=t.imagesValue.some(W=>W.status==="error"),P=t.imagesValue.some(W=>W.status==="uploading");if(I||P)return!1}if(t.options.length&&(!t.selectedValue||Array.isArray(t.selectedValue)&&t.selectedValue.length===0))return!1;const f=A.value;if(t.showTextarea&&((z=f==null?void 0:f.settings)!=null&&z.show_textarea)&&(!((G=t.notesValue)!=null&&G.trim())||f.settings.min_length&&t.notesValue.length<f.settings.min_length||f.settings.max_length&&t.notesValue.length>f.settings.max_length))return!1;if(t.showImageUpload&&((B=f==null?void 0:f.settings)!=null&&B.show_image_upload)){if(t.imagesValue.length===0||f.settings.max_files&&t.imagesValue.length>f.settings.max_files)return!1;const I=t.imagesValue.some(W=>W.status==="error"),P=t.imagesValue.some(W=>W.status==="uploading");if(I||P)return!1}return!0});return(f,m)=>(n(),De(pa,{show:a.show,title:a.title,subtitle:a.subtitle,onClose:m[17]||(m[17]=T=>f.$emit("close"))},{footer:Fe(()=>[a.selectedPoint?(n(),i("button",{key:0,onClick:m[14]||(m[14]=T=>g(a.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},m[19]||(m[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),Ee(" Hapus Data ")]))):d("",!0),e("div",Qo,[e("button",{type:"button",onClick:m[15]||(m[15]=T=>f.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:m[16]||(m[16]=T=>f.$emit("save")),disabled:!Z.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Xo)])]),default:Fe(()=>{var T,q,N,z,G,B,I,P,W,p,h,s,k,O,re,_e,he,Se,Ve,R,D,K,H,Q,ue,me,ce,Te,we,ge,Ie,Ce,be,Me,Ue,r;return[e("div",Do,[a.point.input_type==="text"?(n(),i("div",Po,[Ae(ua,{"model-value":a.notesValue,required:(T=a.point.settings)==null?void 0:T.is_required,"min-length":(q=a.point.settings)==null?void 0:q.min_length,"max-length":(N=a.point.settings)==null?void 0:N.max_length,allowSpace:(z=a.point.settings)==null?void 0:z.allow_space,textTransform:(G=a.point.settings)==null?void 0:G.text_transform,placeholder:((B=a.point.settings)==null?void 0:B.placeholder)||"Masukan text",error:f.error,"onUpdate:modelValue":m[0]||(m[0]=u=>f.$emit("update:notesValue",u)),onSave:m[1]||(m[1]=u=>f.$emit("saveText",u))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):d("",!0),a.point.input_type==="number"?(n(),i("div",Lo,[Ae(ra,{"model-value":a.notesValue,required:(I=a.point.settings)==null?void 0:I.is_required,min:(P=a.point.settings)==null?void 0:P.min,max:(W=a.point.settings)==null?void 0:W.max,step:((p=a.point.settings)==null?void 0:p.step)||1,placeholder:((h=a.point.settings)==null?void 0:h.placeholder)||"Masukan number",error:f.error,"onUpdate:modelValue":m[2]||(m[2]=u=>f.$emit("update:notesValue",u)),onSave:m[3]||(m[3]=u=>f.$emit("saveNumber",u))},null,8,["model-value","required","min","max","step","placeholder","error"])])):d("",!0),a.point.input_type==="account"?(n(),i("div",Ro,[Ae(ca,{"model-value":a.notesValue,required:(s=a.point.settings)==null?void 0:s.is_required,placeholder:((k=a.point.settings)==null?void 0:k.placeholder)||"Masukkan nilai",error:f.error,"point-id":a.pointId,settings:a.point.settings,"onUpdate:modelValue":m[4]||(m[4]=u=>f.$emit("update:notesValue",u)),onSave:m[5]||(m[5]=u=>f.$emit("saveAccount",u))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):d("",!0),a.point.input_type==="date"?(n(),i("div",jo,[Ae(da,{"model-value":a.notesValue,required:(O=a.point.settings)==null?void 0:O.is_required,"min-date":(re=a.point.settings)==null?void 0:re.min_date,"max-date":(_e=a.point.settings)==null?void 0:_e.max_date,error:f.error,"onUpdate:modelValue":m[6]||(m[6]=u=>f.$emit("update:notesValue",u)),onSave:m[7]||(m[7]=u=>f.$emit("saveDate",u))},null,8,["model-value","required","min-date","max-date","error"])])):d("",!0),a.point.input_type==="imageTOradio"?(n(),i("div",Bo,[e("h4",Fo,[(he=a.point.settings)!=null&&he.required?(n(),i("span",Oo,"*")):d("",!0)]),Ae(Ft,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point.inspection_point,"inspection-id":a.inspectionId,settings:a.point.settings,"onUpdate:modelValue":m[8]||(m[8]=u=>f.$emit("update:imagesValue",u)),onSave:m[9]||(m[9]=u=>f.$emit("saveImage",u))},null,8,["model-value","point-id","point","inspection-id","settings"]),(Se=a.point.settings)!=null&&Se.required&&a.imagesValue.length===0?(n(),i("p",zo," Foto wajib diupload ")):d("",!0)])):d("",!0),a.options.length?(n(),i("div",{key:5,class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(Ne,null,Pe(a.options,(u,v)=>(n(),i("label",{key:v,class:"cursor-pointer"},[e("input",{type:u.multi?"checkbox":"radio",name:u.multi?`checkbox-${a.name}`:a.name,value:u.value,checked:E(u),onChange:S=>U(u,S),class:"hidden peer"},null,40,Ko),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":E(u),"border-gray-300 text-gray-700 hover:bg-gray-50":!E(u)}])},F(u.label),3)]))),128))],2)):d("",!0),_.value?(n(),i("div",qo,[e("h4",Ho,[m[18]||(m[18]=Ee(" Upload Foto ")),(R=(Ve=w.value)==null?void 0:Ve.settings)!=null&&R.required?(n(),i("span",Go,"*")):d("",!0)]),Ae(Ft,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,settings:(D=w.value)==null?void 0:D.settings,"onUpdate:modelValue":m[10]||(m[10]=u=>f.$emit("update:imagesValue",u)),onSave:m[11]||(m[11]=u=>f.$emit("saveImage",u))},null,8,["model-value","point-id","point","inspection-id","settings"]),(H=(K=w.value)==null?void 0:K.settings)!=null&&H.required&&a.imagesValue.length===0?(n(),i("p",Wo," Foto wajib diupload ")):d("",!0)])):d("",!0),V.value?(n(),i("div",Jo,[(ue=(Q=L.value)==null?void 0:Q.settings)!=null&&ue.required?(n(),i("span",Yo,"*")):d("",!0),Ae(ga,{"model-value":a.notesValue,"point-id":a.pointId,"inspection-id":a.inspectionId,settings:(me=L.value)==null?void 0:me.settings,required:(Te=(ce=L.value)==null?void 0:ce.settings)==null?void 0:Te.required,"min-length":(ge=(we=L.value)==null?void 0:we.settings)==null?void 0:ge.min_length,"max-length":(Ce=(Ie=L.value)==null?void 0:Ie.settings)==null?void 0:Ce.max_length,placeholder:((Me=(be=L.value)==null?void 0:be.settings)==null?void 0:Me.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":m[12]||(m[12]=u=>f.$emit("update:notesValue",u)),onSave:m[13]||(m[13]=u=>f.$emit("saveTextarea",u))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(r=(Ue=L.value)==null?void 0:Ue.settings)!=null&&r.required&&!a.notesValue?(n(),i("p",Zo," Keterangan wajib diisi ")):d("",!0)])):d("",!0)])]}),_:1},8,["show","title","subtitle"]))}},ei={class:"mt-2 space-y-2"},ti=["type","name","value","checked","onChange","required"],ai={key:0,class:"p-2 rounded-lg bg-gray-50"},si={key:0,class:"mt-2"},ni={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},oi=["src"],ii={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},li={key:1,class:"mt-2"},ri={class:"text-sm text-gray-600"},ui={key:2,class:"mt-2 text-sm text-red-600"},di={__name:"InputRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:ee}){const t=a,$=ee,g=y(t.notes),A=y([...t.images]),x=y(!1),V=y(""),_=y([]),L=y(""),w=y([]);se(()=>t.options.find(I=>I.value===t.modelValue));const E=se(()=>Array.isArray(t.modelValue)?t.options.filter(I=>t.modelValue.includes(I.value)):t.modelValue?[t.options.find(I=>I.value===t.modelValue)].filter(Boolean):[]),U=I=>Array.isArray(t.modelValue)?t.modelValue.includes(I.value):t.modelValue?(typeof t.modelValue=="string"?t.modelValue.split(",").map(W=>W.trim()):[t.modelValue]).includes(I.value):!1,Z=I=>I.settings&&(I.settings.show_textarea||I.settings.show_image_upload);ve(()=>t.notes,I=>{g.value=I}),ve(()=>t.images,I=>{A.value=[...I]}),ve(()=>t.modelValue,I=>{I?L.value=Array.isArray(I)?[...I]:I:L.value=""});const f=(I,P)=>{let W;if(I.multi){const p=Array.isArray(t.modelValue)?t.modelValue:[];P.target.checked?W=[...p,I.value]:W=p.filter(h=>h!==I.value)}else W=I.value;$("update:modelValue",W),Z(I)?T():$("save",{pointId:t.pointId,inspectionId:t.inspectionId,value:W,notes:"",images:[]})},m=I=>I.preview||(I.image_path?`/${I.image_path}`:I),T=()=>{L.value=t.modelValue,V.value=g.value,_.value=[...A.value],w.value=[...A.value],x.value=!0},q=()=>{V.value="",_.value=[],L.value=Array.isArray(t.modelValue)?[...t.modelValue]:t.modelValue,x.value=!1},N=I=>{_.value=I,A.value=[...I],$("update:images",[...I]),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,value:t.modelValue,notes:g.value,images:[...I]})},z=I=>{},G=()=>{L.value!==t.modelValue&&$("update:modelValue",L.value),g.value=V.value,$("update:notes",V.value),A.value=[..._.value],$("update:images",[..._.value]),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,value:L.value,notes:V.value,images:_.value}),x.value=!1},B=I=>{L.value="",V.value="",_.value=[],g.value="",A.value=[],$("update:modelValue",""),$("update:notes",""),$("update:images",[]),$("hapus",I),x.value=!1};return(I,P)=>{var W;return n(),i("div",ei,[e("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(Ne,null,Pe(a.options,(p,h)=>(n(),i("label",{key:h,class:"cursor-pointer"},[e("input",{type:p.multi?"checkbox":"radio",name:p.multi?`checkbox-${a.pointId}`:"radio-"+a.pointId,value:p.value,checked:U(p),onChange:s=>f(p,s),class:"hidden peer",required:a.required&&!p.multi},null,40,ti),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":U(p),"border-gray-300 text-gray-700 hover:bg-gray-50":!U(p)}])},F(p.label),3)]))),128))],2),a.modelValue&&E.value.length>0&&E.value.some(p=>Z(p))?(n(),i("div",ai,[e("div",{class:"flex justify-between items-start"},[P[4]||(P[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:T,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),a.images.length>0&&E.value.some(p=>{var h;return(h=p.settings)==null?void 0:h.show_image_upload})?(n(),i("div",si,[e("div",ni,[(n(!0),i(Ne,null,Pe(a.images,(p,h)=>(n(),i("div",{key:h,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:m(p),class:"w-full h-full object-cover rounded"},null,8,oi),h===3&&a.images.length>4?(n(),i("span",ii," +"+F(a.images.length-4),1)):d("",!0)]))),128))])])):d("",!0),a.notes&&E.value.some(p=>{var h;return(h=p.settings)==null?void 0:h.show_textarea})?(n(),i("div",li,[e("p",ri,F(a.notes),1)])):d("",!0)])):d("",!0),x.value?(n(),De(Ot,{key:(W=a.selectedPoint)==null?void 0:W.id,show:x.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":L.value,"notes-value":V.value,"images-value":_.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":P[0]||(P[0]=p=>L.value=p),"onUpdate:notesValue":P[1]||(P[1]=p=>V.value=p),"onUpdate:imagesValue":P[2]||(P[2]=p=>N(p)),onClose:q,onSave:G,onSaveTextarea:I.handleTextareaSave,onSaveImage:z,onHapus:P[3]||(P[3]=p=>B(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):d("",!0),a.error?(n(),i("p",ui,F(a.error),1)):d("",!0)])}}},ci={class:"mt-2 space-y-2"},gi={key:0,class:"flex flex-wrap gap-3"},pi={key:1,class:"p-2"},mi={key:0,class:"mt-2"},vi={class:"flex gap-2 overflow-x-auto scrollbar-hide"},fi=["src"],hi={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},bi=["type","name","value","checked"],yi={key:1,class:"mt-2"},xi={class:"text-sm text-gray-600"},wi={key:3,class:"mt-2 text-sm text-red-600"},ki={__name:"InputImageToRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:ee}){const t=a,$=ee,g=y(t.notes),A=y([...t.images]),x=y(!1),V=y(""),_=y([]),L=y(""),w=y([]),E=se(()=>{if(Array.isArray(t.modelValue))return t.options.find(B=>t.modelValue.includes(B.value));if(t.modelValue){const B=typeof t.modelValue=="string"?t.modelValue.split(",").map(I=>I.trim()):[t.modelValue];return t.options.find(I=>B.includes(I.value))}return null}),U=se(()=>{if(Array.isArray(t.modelValue))return t.options.filter(B=>t.modelValue.includes(B.value));if(t.modelValue){const B=typeof t.modelValue=="string"?t.modelValue.split(",").map(I=>I.trim()):[t.modelValue];return t.options.filter(I=>B.includes(I.value))}return[]}),Z=se(()=>U.value.some(B=>{var I;return B.multi&&((I=B.settings)==null?void 0:I.show_textarea)}));se(()=>U.value.find(B=>{var I;return B.multi&&((I=B.settings)==null?void 0:I.show_textarea)}));const f=B=>Array.isArray(t.modelValue)?t.modelValue.includes(B.value):t.modelValue?(typeof t.modelValue=="string"?t.modelValue.split(",").map(P=>P.trim()):[t.modelValue]).includes(B.value):!1,m=B=>B.preview||(B.image_path?`/${B.image_path}`:B);ve(()=>t.notes,B=>{g.value=B});const T=()=>{L.value=t.modelValue||"",V.value=g.value,_.value=[...A.value],w.value=[...A.value],x.value=!0},q=()=>{V.value="",_.value=[],L.value="",x.value=!1},N=B=>{_.value=B,A.value=[...B],$("update:images",[...B]),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,value:t.modelValue,notes:g.value,images:[...B]})},z=()=>{L.value!==t.modelValue&&$("update:modelValue",L.value),g.value=V.value,$("update:notes",V.value),A.value=[..._.value],$("update:images",[..._.value]),$("save",{pointId:t.pointId,inspectionId:t.inspectionId,value:L.value,notes:V.value,images:_.value}),x.value=!1},G=B=>{L.value="",V.value="",_.value=[],g.value="",A.value=[],$("update:modelValue",""),$("update:notes",""),$("update:images",[]),$("hapus",B),x.value=!1};return(B,I)=>{var P,W,p;return n(),i("div",ci,[!a.modelValue&&A.value.length===0&&!g.value?(n(),i("div",gi,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:T},I[4]||(I[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",pi,[e("div",{class:"flex justify-between items-start"},[I[5]||(I[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:T,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),A.value.length>0?(n(),i("div",mi,[e("div",vi,[(n(!0),i(Ne,null,Pe(A.value,(h,s)=>(n(),i("div",{key:s,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:m(h),class:"w-full h-full object-cover rounded"},null,8,fi),s===3&&A.value.length>4?(n(),i("span",hi," +"+F(A.value.length-4),1)):d("",!0)]))),128))])])):d("",!0),e("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(Ne,null,Pe(a.options,(h,s)=>(n(),i("label",{key:s,class:"cursor-pointer"},[e("input",{type:h.multi?"checkbox":"radio",name:h.multi?`checkbox-${a.pointId}`:`radio-${a.pointId}`,value:h.value,checked:f(h),disabled:!0,class:"hidden peer"},null,8,bi),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":f(h),"border-gray-300 text-gray-700 hover:bg-gray-50":!f(h)}])},F(h.label),3)]))),128))],2),g.value&&((W=(P=E.value)==null?void 0:P.settings)!=null&&W.show_textarea||Z.value)?(n(),i("div",yi,[e("p",xi,F(g.value),1)])):d("",!0)])),x.value?(n(),De(Ot,{key:(p=a.selectedPoint)==null?void 0:p.id,show:x.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":L.value,"notes-value":V.value,"images-value":_.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":I[0]||(I[0]=h=>L.value=h),"onUpdate:notesValue":I[1]||(I[1]=h=>V.value=h),"onUpdate:imagesValue":I[2]||(I[2]=h=>N(h)),onClose:q,onSave:z,onHapus:I[3]||(I[3]=h=>G(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):d("",!0),a.error?(n(),i("p",wi,F(a.error),1)):d("",!0)])}}},Ii={class:"text-base font-semibold text-indigo-700"},_i={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Si={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ci={class:"text-base font-semibold text-indigo-700"},$i={class:"p-4 space-y-4"},Ai={key:0,class:"flex justify-end py-1"},Vi=["onClick"],Ti={key:1,class:"space-y-2"},Mi={class:"flex items-start justify-between"},Ui={class:"flex-1"},Ni={class:"block text-sm font-medium text-gray-900"},Ei={class:"font-bold"},Di={key:0,class:"text-red-500"},Pi={key:1,class:"italic text-xs text-gray-400 ml-2"},Li={key:0,class:"mt-1"},Ri={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800"},ji={key:0},Bi={key:1},Fi={key:2},Oi={key:3},zi={key:4},Ki={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},qi={key:9,class:"p-3 bg-gray-100 rounded text-sm text-gray-600"},Hi={class:"text-xs mt-1 list-disc list-inside"},Gi={key:0},Wi={key:1},Ji={key:2},Yi={key:3},Zi={key:4},Qi={key:0,class:"text-center py-8 text-gray-500"},Xi={key:0,class:"text-xs text-gray-400"},el={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object,car:Object},emits:["updateResult","removeImage","hapusPoint"],setup(a,{emit:ee}){const t=a,$=ee,g=Lt("vehicleFeatures",y(null));g.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),Dt("vehicleFeatures",g);const A=y(!1),x=y([]),V=y(!0),_=y(null),L=xa(),w={MT:"Manual Transmission (MT)",AT:"Automatic Transmission (AT)",CVT:"Continuously Variable Transmission (CVT)","e-CVT":"Electronic CVT (e-CVT)",DCT:"Dual Clutch Transmission (DCT)",AMT:"Automated Manual Transmission (AMT)",IVT:"Intelligent Variable Transmission (IVT)",SSG:"Seamless Shift Gearbox (SSG)",AGS:"Auto Gear Shift (AGS)",DHT:"Dedicated Hybrid Transmission (DHT)"};st(()=>{const p=new IntersectionObserver(([h])=>{V.value=h.isIntersecting},{threshold:.1});_.value&&p.observe(_.value),wt(()=>{_.value&&p.unobserve(_.value)})});const E=()=>{A.value=!A.value,A.value||(x.value=[])},U=se(()=>(t.category.points||[]).some(p=>p.is_default===!1)),Z=p=>!p||!Array.isArray(p)?[]:p.map(h=>w[h]||h),f=p=>{var O,re;const h=p.settings;if(!m(p))return!0;const s=(O=t.car)==null?void 0:O.transmission,k=(re=t.car)==null?void 0:re.fuel_type;return!(h.transmission&&Array.isArray(h.transmission)&&h.transmission.length>0&&s&&!h.transmission.includes(s)||h.fuel_type&&h.fuel_type.trim()!==""&&k&&h.fuel_type!==k||h.rear_door&&(!g.value||!g.value.rear_door)||h.pick_up&&(!g.value||!g.value.pick_up)||h.box&&(!g.value||!g.value.box))},m=p=>{const h=p.settings;return!!(h!=null&&h.transmission&&Array.isArray(h.transmission)&&h.transmission.length>0||h!=null&&h.fuel_type&&h.fuel_type.trim()!==""||h!=null&&h.rear_door||h!=null&&h.pick_up||h!=null&&h.box)},T=p=>m(p)&&(A.value||f(p)),q=se(()=>{const p=t.category.points||[],h=[];let s=[];return A.value?t.category.isDamageMenu?p.filter(k=>{var O;return k.is_default||z((O=k.inspection_point)==null?void 0:O.id)||A.value}):p:t.category.isDamageMenu?p.filter(k=>{var re;const O=(re=k.inspection_point)==null?void 0:re.id;return z(O)||k.is_default||x.value.includes(O)}):(p.forEach(k=>{var R;const O=(R=k.inspection_point)==null?void 0:R.id,re=z(O),_e=x.value.includes(O),Se=!m(k)||f(k);(k.is_default||re||_e)&&Se?(s.length>0&&(h.push({is_link:!0,count:s.length,hiddenIds:s.map(D=>D.inspection_point.id)}),s.forEach(D=>{x.value.includes(D.inspection_point.id)&&h.push(D)}),s=[]),h.push(k)):(!m(k)||f(k))&&s.push(k)}),s.length>0&&(h.push({is_link:!0,count:s.length,hiddenIds:s.map(k=>k.inspection_point.id)}),s.forEach(k=>{x.value.includes(k.inspection_point.id)&&h.push(k)})),h.filter(k=>{var O,re;return k.is_link||k.is_default||z((O=k.inspection_point)==null?void 0:O.id)||x.value.includes((re=k.inspection_point)==null?void 0:re.id)}))});se(()=>q.value.filter(p=>!p.is_link));const N=p=>{A.value=!1,p.forEach(h=>{x.value.includes(h)||x.value.push(h)})},z=p=>{if(!p)return!1;const h=L.props.existingResults[p]!==void 0,s=L.props.existingImages[p]&&L.props.existingImages[p].length>0,k=t.form.results[p]&&(t.form.results[p].status||t.form.results[p].note),O=t.form.images[p]&&t.form.images[p].length>0;return h||s||k||O},G=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],B=p=>{var k,O,re,_e,he,Se,Ve,R,D;const h=t.form.results[(k=p.inspection_point)==null?void 0:k.id],s=t.form.images[(O=p.inspection_point)==null?void 0:O.id];if(!h)return!1;switch(p.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!h.note;case"select":case"radio":if(!h.status)return!1;const K=(_e=(re=p.settings)==null?void 0:re.radios)==null?void 0:_e.find(Q=>Q.value===h.status);return!(K!=null&&K.settings&&(K.settings.show_textarea&&!((he=h.note)!=null&&he.trim())||K.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!h.status)return!1;const H=(Ve=(Se=p.settings)==null?void 0:Se.radios)==null?void 0:Ve.find(Q=>Q.value===h.status);return!(H!=null&&H.settings&&H.settings.show_textarea&&!((R=h.note)!=null&&R.trim()));case"image":return(s==null?void 0:s.length)>0;default:return!!h.status||!!((D=h.note)!=null&&D.trim())}},I=(p,h,s)=>{$("updateResult",{pointId:p,type:s,value:h})},P=p=>{console.log("Save result for point:",p)},W=p=>{$("hapusPoint",p)};return ve(()=>t.form.results,p=>{},{deep:!0}),ve(()=>t.form.images,p=>{},{deep:!0}),ve(()=>t.car,p=>{console.log("Car data updated:",p)},{deep:!0}),ve(g,p=>{console.log("Vehicle features updated:",p)},{deep:!0}),(p,h)=>(n(),i(Ne,null,[t.head==="vertical"?(n(),i("div",{key:0,class:oe(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[e("h4",Ii,F(a.category.name),1),U.value?(n(),i("button",{key:0,onClick:E,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},F(A.value?"Sembunyikan Semua":"Tampilkan Point Lain"),1)):d("",!0)])):d("",!0),e("div",{class:oe(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",t.head==="vertical"?"pt-6":""])},[!V.value&&U.value?(n(),i("button",{key:0,onClick:E,class:"fixed top-3 right-2 z-10 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[A.value?(n(),i("svg",_i,h[0]||(h[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(n(),i("svg",Si,h[1]||(h[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):d("",!0),t.head==="horizontal"?(n(),i("div",{key:1,ref_key:"categoryHeader",ref:_,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",Ci,F(a.category.name),1),U.value?(n(),i("button",{key:0,onClick:E,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},F(A.value?"Sembunyikan":"Tampilkan Point Lain"),1)):d("",!0)],512)):d("",!0),e("div",$i,[(n(!0),i(Ne,null,Pe(q.value,(s,k)=>{var O,re,_e,he,Se,Ve,R,D,K,H,Q,ue,me,ce,Te,we,ge,Ie,Ce,be,Me,Ue,r,u,v,S,J,ie,de,b,c,te,C,ae,ye,$e,xe,Oe,pt,kt,Ye,mt,vt,ft,It,nt,ht,bt,ot,je,Ge,ze,it,_t,lt,Ze,rt,Qe,Xe,St,Ct,$t,et,At,Vt,Tt,Mt,Ut,Nt;return n(),i("div",{key:k,class:oe(["space-y-2 last:border-0 last:pb-0",s.is_link?"pb-0":"pb-2 border-b border-gray-100"])},[s.is_link?(n(),i("div",Ai,[e("button",{onClick:Y=>N(s.hiddenIds),class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none"}," Tampilkan "+F(s.count)+" Point Tersembunyi ",9,Vi)])):(n(),i("div",Ti,[e("div",Mi,[e("div",Ui,[e("label",Ni,[e("span",Ei,F((O=s.inspection_point)==null?void 0:O.name),1),(re=s.settings)!=null&&re.is_required?(n(),i("span",Di,"*")):d("",!0),!s.is_default&&!z((_e=s.inspection_point)==null?void 0:_e.id)?(n(),i("span",Pi," (opsional) ")):d("",!0)]),T(s)?(n(),i("div",Li,[m(s)?(n(),i("div",Ri,[(he=s.settings)!=null&&he.transmission?(n(),i("div",ji,F(s.settings.transmission.join(", ")),1)):d("",!0),(Se=s.settings)!=null&&Se.fuel_type?(n(),i("div",Bi,F(s.settings.fuel_type),1)):d("",!0),(Ve=s.settings)!=null&&Ve.rear_door?(n(),i("div",Fi," Pintu Belakang ")):d("",!0),(R=s.settings)!=null&&R.pick_up?(n(),i("div",Oi," Tipe Pick Up ")):d("",!0),(D=s.settings)!=null&&D.box?(n(),i("div",zi," Memiliki Box ")):d("",!0)])):d("",!0)])):d("",!0)]),B(s)?(n(),i("span",Ki," ✓ ")):d("",!0)]),s.input_type==="text"&&f(s)?(n(),De(ua,{key:0,modelValue:a.form.results[(K=s.inspection_point)==null?void 0:K.id].note,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"note")}],required:(H=s.settings)==null?void 0:H.is_required,"min-length":(Q=s.settings)==null?void 0:Q.min_length,"max-length":(ue=s.settings)==null?void 0:ue.max_length,allowSpace:(me=s.settings)==null?void 0:me.allow_space,textTransform:(ce=s.settings)==null?void 0:ce.text_transform,placeholder:((Te=s.settings)==null?void 0:Te.placeholder)||"Masukan text",error:a.form.errors[`results.${(we=s.inspection_point)==null?void 0:we.id}.note`],onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):d("",!0),s.input_type==="number"&&f(s)?(n(),De(ra,{key:1,modelValue:a.form.results[(ge=s.inspection_point)==null?void 0:ge.id].note,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"note")}],required:(Ie=s.settings)==null?void 0:Ie.is_required,min:(Ce=s.settings)==null?void 0:Ce.min,max:(be=s.settings)==null?void 0:be.max,step:((Me=s.settings)==null?void 0:Me.step)||1,placeholder:((Ue=s.settings)==null?void 0:Ue.placeholder)||"Masukan number",error:a.form.errors[`results.${(r=s.inspection_point)==null?void 0:r.id}.note`],onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):d("",!0),s.input_type==="account"&&f(s)?(n(),De(ca,{key:2,modelValue:a.form.results[(u=s.inspection_point)==null?void 0:u.id].note,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"note")}],required:(v=s.settings)==null?void 0:v.is_required,placeholder:((S=s.settings)==null?void 0:S.placeholder)||"Masukkan nilai",error:a.form.errors[`results.${(J=s.inspection_point)==null?void 0:J.id}.note`],"point-id":(ie=s.inspection_point)==null?void 0:ie.id,settings:s.settings,onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):d("",!0),s.input_type==="date"&&f(s)?(n(),De(da,{key:3,modelValue:a.form.results[(de=s.inspection_point)==null?void 0:de.id].note,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"note")}],required:(b=s.settings)==null?void 0:b.is_required,"min-date":(c=s.settings)==null?void 0:c.min_date,"max-date":(te=s.settings)==null?void 0:te.max_date,error:a.form.errors[`results.${(C=s.inspection_point)==null?void 0:C.id}.note`],onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):d("",!0),s.input_type==="textarea"&&f(s)?(n(),De(ga,{key:4,modelValue:a.form.results[(ae=s.inspection_point)==null?void 0:ae.id].note,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"note")}],required:(ye=s.settings)==null?void 0:ye.is_required,"min-length":($e=s.settings)==null?void 0:$e.min_length,"max-length":(xe=s.settings)==null?void 0:xe.max_length,placeholder:((Oe=s.settings)==null?void 0:Oe.placeholder)||"Masukkan teks di sini",settings:s.settings,error:a.form.errors[`results.${(pt=s.inspection_point)==null?void 0:pt.id}.note`],onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):d("",!0),s.input_type==="radio"&&f(s)?(n(),De(di,{key:5,modelValue:a.form.results[(kt=s.inspection_point)==null?void 0:kt.id].status,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].status=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"status")}],notes:a.form.results[(Ye=s.inspection_point)==null?void 0:Ye.id].note,images:a.form.images[(mt=s.inspection_point)==null?void 0:mt.id],required:(vt=s.settings)==null?void 0:vt.is_required,"point-id":(ft=s.inspection_point)==null?void 0:ft.id,point:s.inspection_point,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(It=s.inspection_point)==null?void 0:It.name,subtitle:(nt=s.inspection_point)==null?void 0:nt.description,"selected-point":s.inspection_point??null,options:((ht=s.settings)==null?void 0:ht.radios)||G,error:a.form.errors[`results.${(bt=s.inspection_point)==null?void 0:bt.id}.status`],"onUpdate:notes":Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},"onUpdate:images":Y=>{var M;return a.form.images[(M=s.inspection_point)==null?void 0:M.id]=Y},onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)},onHapus:Y=>{var M;return W((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","subtitle","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):d("",!0),s.input_type==="imageTOradio"&&f(s)?(n(),De(ki,{key:6,modelValue:a.form.results[(ot=s.inspection_point)==null?void 0:ot.id].status,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].status=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"status")}],notes:a.form.results[(je=s.inspection_point)==null?void 0:je.id].note,images:a.form.images[(Ge=s.inspection_point)==null?void 0:Ge.id],required:(ze=s.settings)==null?void 0:ze.is_required,"point-id":(it=s.inspection_point)==null?void 0:it.id,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(_t=s.inspection_point)==null?void 0:_t.name,subtitle:(lt=s.inspection_point)==null?void 0:lt.description,point:s,"selected-point":s.inspection_point??null,options:((Ze=s.settings)==null?void 0:Ze.radios)||G,error:a.form.errors[`results.${(rt=s.inspection_point)==null?void 0:rt.id}.status`],"onUpdate:notes":Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},"onUpdate:images":Y=>{var M;return a.form.images[(M=s.inspection_point)==null?void 0:M.id]=Y},onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)},onHapus:Y=>{var M;return W((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","subtitle","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):d("",!0),s.input_type==="image"&&f(s)?(n(),De(Ft,{key:7,modelValue:a.form.images[(Qe=s.inspection_point)==null?void 0:Qe.id],"onUpdate:modelValue":Y=>{var M;return a.form.images[(M=s.inspection_point)==null?void 0:M.id]=Y},error:a.form.errors[`images.${(Xe=s.inspection_point)==null?void 0:Xe.id}`],"inspection-id":a.inspectionId,"point-id":(St=s.inspection_point)==null?void 0:St.id,point:s.inspection_point,"point-name":(Ct=s.inspection_point)==null?void 0:Ct.name,settings:s.settings,"onUpdate:notes":Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].note=Y},"onUpdate:status":Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].status=Y}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):d("",!0),s.input_type==="select"&&f(s)?(n(),De(js,{key:8,modelValue:a.form.results[($t=s.inspection_point)==null?void 0:$t.id].status,"onUpdate:modelValue":[Y=>{var M;return a.form.results[(M=s.inspection_point)==null?void 0:M.id].status=Y},Y=>{var M;return I((M=s.inspection_point)==null?void 0:M.id,Y,"status")}],required:(et=s.settings)==null?void 0:et.is_required,error:a.form.errors[`results.${(At=s.inspection_point)==null?void 0:At.id}.status`],onSave:Y=>{var M;return P((M=s.inspection_point)==null?void 0:M.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):d("",!0),!f(s)&&m(s)?(n(),i("div",qi,[h[2]||(h[2]=e("p",{class:"font-medium"},"Tidak tersedia untuk kendaraan ini",-1)),h[3]||(h[3]=e("p",{class:"text-xs mt-1"},"Point ini hanya tersedia untuk:",-1)),e("ul",Hi,[(Vt=s.settings)!=null&&Vt.transmission?(n(),i("li",Gi," Transmisi: "+F(Z(s.settings.transmission).join(", ")),1)):d("",!0),(Tt=s.settings)!=null&&Tt.fuel_type?(n(),i("li",Wi," Bahan bakar: "+F(s.settings.fuel_type),1)):d("",!0),(Mt=s.settings)!=null&&Mt.rear_door?(n(),i("li",Ji,"Kendaraan dengan pintu belakang")):d("",!0),(Ut=s.settings)!=null&&Ut.pick_up?(n(),i("li",Yi,"Tipe pick up")):d("",!0),(Nt=s.settings)!=null&&Nt.box?(n(),i("li",Zi,"Kendaraan dengan box")):d("",!0)])])):d("",!0)]))],2)}),128)),q.value.filter(s=>!s.is_link).length===0?(n(),i("div",Qi,[h[4]||(h[4]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),h[5]||(h[5]=e("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),a.category.isDamageMenu?(n(),i("p",Xi,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):d("",!0)])):d("",!0)])],2)],64))}},tl=He(el,[["__scopeId","data-v-704b9892"]]),al={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},sl={class:"p-4 space-y-4-6"},nl={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ol=["value"],il={class:"p-4 space-y-4-6"},ll={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},rl=["value"],ul={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},dl={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},cl=["value"],gl={class:"p-4 space-y-2"},pl={class:"flex items-center justify-between mb-2"},ml={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},vl={class:"flex items-center justify-between mb-3"},fl={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},hl=["onClick"],bl={class:"text-sm font-medium text-gray-800 mb-1"},yl={class:"text-xs text-gray-600 line-clamp-2"},xl={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},wl={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},kl={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},Il={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},_l={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},Sl={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(a,{emit:ee}){const t=a,$=ee,g=y(null),A=y(!1),x=y(!1),V=sa({bold:!1,italic:!1,underline:!1}),_=sa({flooded:"",collision:"",collision_severity:"",notes:""}),L=y([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi kendaraan secara umum: <b>BAIK</b><br>
- Tidak ditemukan indikasi kerusakan signifikan<br>
- Semua sistem berfungsi dengan normal<br>`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <b>RINGAN</b><br>
- Area yang terdampak: PERLU DIISI<br>
- Perbaikan yang dilakukan: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat terkena banjir<br>
- Tingkat paparan air: PERLU DIISI<br>
- Komponen yang terdampak: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah umum (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi umum kendaraan: PERLU DIISI<br>
- Masalah utama yang ditemukan: PERLU DIISI<br>
- Komponen yang perlu perhatian: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Status Keseluruhan Kendaraan: PERLU DIISI<br>
- Catatan Utama: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap (Lengkap A, C, B)",content:`<p><strong>A. LAPORAN HASIL INSPEKSI TEKNIS:</strong></p>
- Tanggal Inspeksi: PERLU DIISI<br>
- Kondisi Mesin: PERLU DIISI<br>
- Kondisi Transmisi: PERLU DIISI<br>
- Kondisi Suspensi: PERLU DIISI<br>
- Kondisi Rem: PERLU DIISI<br>
- Kondisi Body: PERLU DIISI<br>
- Kondisi Interior: PERLU DIISI<br>
- Kesimpulan Akhir: PERLU DIISI

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`}]);y(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]);const w=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(k){return console.error("Error parsing settings JSON:",k),{}}return typeof s=="object"&&s!==null?s:{}};se(()=>w(t.inspection.settings).conclusion||{});const E=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],U=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],Z=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];st(()=>{m(),Pt(()=>{f(),N()})});const f=()=>{g.value&&_.notes&&(g.value.innerHTML=_.notes)},m=()=>{const k=w(t.inspection.settings).conclusion||{},O=t.form.conclusion||{};_.flooded=O.flooded||k.flooded||"",_.collision=O.collision||k.collision||"",_.collision_severity=O.collision_severity||k.collision_severity||"",_.notes=O.notes||t.inspection.notes||""},T=s=>{if(!g.value)return;let k=s.content;k=k.replace(/{PLATE_NUMBER}/g,t.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,t.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,_.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,_.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),g.value.innerHTML=k,_.notes=k,x.value=!1,Pt(()=>{g.value.focus(),h()})},q=()=>{g.value&&(g.value.innerHTML="",_.notes="",h())},N=()=>{if(!g.value)return;const s=window.getSelection();s.rangeCount===0||s.isCollapsed||(V.bold=document.queryCommandState("bold"),V.italic=document.queryCommandState("italic"),V.underline=document.queryCommandState("underline"))},z=s=>{if(!g.value)return;g.value.focus();const k=V[s];switch(s){case"bold":document.execCommand("bold",!1,!k);break;case"italic":document.execCommand("italic",!1,!k);break;case"underline":document.execCommand("underline",!1,!k);break}setTimeout(()=>{N(),G()},10)},G=la.debounce(()=>{g.value&&(_.notes=g.value.innerHTML,h())},200),B=s=>{s.preventDefault(),document.execCommand("insertParagraph",!1,null)},I=s=>{s.preventDefault();const k=(s.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,k)},P=()=>{A.value=!0},W=()=>{A.value=!1,g.value&&(_.notes=g.value.innerHTML,h())},p=()=>{h()},h=()=>{const s={flooded:_.flooded,collision:_.collision,collision_severity:_.collision==="yes"?_.collision_severity:null,notes:_.notes};$("updateConclusion",s)};return ve(()=>t.form.conclusion,s=>{s&&(_.flooded=s.flooded!==void 0?s.flooded:_.flooded,_.collision=s.collision!==void 0?s.collision:_.collision,_.collision_severity=s.collision_severity!==void 0?s.collision_severity:_.collision_severity,_.notes=s.notes!==void 0?s.notes:_.notes,g.value&&s.notes!==void 0&&g.value.innerHTML!==s.notes&&(g.value.innerHTML=s.notes))},{deep:!0,immediate:!0}),ve([()=>_.flooded,()=>_.collision,()=>_.collision_severity,()=>_.notes],()=>{h()},{deep:!0}),(s,k)=>(n(),i("div",al,[k[21]||(k[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[e("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),e("div",sl,[k[10]||(k[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ee(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",nl,[(n(),i(Ne,null,Pe(E,O=>e("label",{key:O.value,class:"cursor-pointer"},[Le(e("input",{type:"radio","onUpdate:modelValue":k[0]||(k[0]=re=>_.flooded=re),value:O.value,class:"hidden peer",onChange:p},null,40,ol),[[at,_.flooded]]),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":_.flooded===O.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":_.flooded!==O.value}])},F(O.label),3)])),64))])]),e("div",il,[k[12]||(k[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ee(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ll,[(n(),i(Ne,null,Pe(U,O=>e("label",{key:O.value,class:"cursor-pointer"},[Le(e("input",{type:"radio","onUpdate:modelValue":k[1]||(k[1]=re=>_.collision=re),value:O.value,class:"hidden peer",onChange:p},null,40,rl),[[at,_.collision]]),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":_.collision===O.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":_.collision!==O.value}])},F(O.label),3)])),64))]),Ae(gt,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:Fe(()=>[_.collision==="yes"?(n(),i("div",ul,[k[11]||(k[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ee("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",dl,[(n(),i(Ne,null,Pe(Z,O=>e("label",{key:O.value,class:"cursor-pointer"},[Le(e("input",{type:"radio","onUpdate:modelValue":k[2]||(k[2]=re=>_.collision_severity=re),value:O.value,class:"hidden peer",onChange:p},null,40,cl),[[at,_.collision_severity]]),e("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":_.collision_severity===O.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":_.collision_severity!==O.value}])},F(O.label),3)])),64))])])):d("",!0)]),_:1})]),e("div",gl,[e("div",pl,[k[14]||(k[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),e("button",{type:"button",onClick:k[3]||(k[3]=O=>x.value=!x.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},k[13]||(k[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),Ee(" Template ")]))]),Ae(gt,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:Fe(()=>[x.value?(n(),i("div",ml,[e("div",vl,[k[16]||(k[16]=e("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),e("button",{onClick:k[4]||(k[4]=O=>x.value=!1),class:"text-gray-400 hover:text-gray-600"},k[15]||(k[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",fl,[(n(!0),i(Ne,null,Pe(L.value,O=>(n(),i("button",{key:O.id,onClick:re=>T(O),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[e("div",bl,F(O.name),1),e("div",yl,F(O.description),1)],8,hl))),128))])])):d("",!0)]),_:1}),e("div",xl,[e("button",{type:"button",onClick:k[5]||(k[5]=O=>z("bold")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",V.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},k[17]||(k[17]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:k[6]||(k[6]=O=>z("italic")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",V.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},k[18]||(k[18]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:k[7]||(k[7]=O=>z("underline")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",V.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},k[19]||(k[19]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:k[8]||(k[8]=O=>q()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),Ae(gt,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:Fe(()=>[Object.values(V).some(O=>O)?(n(),i("div",wl,[k[20]||(k[20]=Ee(" Format aktif: ")),V.bold?(n(),i("span",kl,"Bold")):d("",!0),V.italic?(n(),i("span",Il,"Italic")):d("",!0),V.underline?(n(),i("span",_l,"Underline")):d("",!0)])):d("",!0)]),_:1}),e("div",{ref_key:"editorRef",ref:g,contenteditable:"true",class:oe(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!A.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":A.value}]),onInput:k[9]||(k[9]=(...O)=>X(G)&&X(G)(...O)),onBlur:W,onFocus:P,onKeydown:wa(B,["enter"]),onPaste:I,onMouseup:N,onKeyup:N,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Cl=He(Sl,[["__scopeId","data-v-6b429a8f"]]);function na(a,ee){const t=y({x:ee.x,y:ee.y}),$=y(!1),g=y(null),A=y(!1),x=y({x:0,y:0});st(()=>{const U=localStorage.getItem(a);if(U)try{t.value=JSON.parse(U)}catch(Z){console.error("Error parsing saved position:",Z)}});const V=U=>{U.type.includes("touch")?(x.value.x=U.touches[0].clientX,x.value.y=U.touches[0].clientY):(x.value.x=U.clientX,x.value.y=U.clientY),g.value=setTimeout(()=>{A.value=!0,$.value=!0,console.log("Long press activated - drag mode ON")},900)},_=()=>{g.value&&(clearTimeout(g.value),g.value=null),A.value=!1};return{pos:t,dragging:$,startLongPress:V,cancelLongPress:_,onDrag:U=>{if(!$.value||!A.value)return;U.preventDefault();let Z,f;U.type.includes("touch")?(Z=U.touches[0].clientX,f=U.touches[0].clientY):(Z=U.clientX,f=U.clientY),t.value.x=Z-24,t.value.y=f-24},stopDrag:()=>{if($.value&&A.value){console.log("Drag stopped - saving position"),$.value=!1,A.value=!1;try{localStorage.setItem(a,JSON.stringify(t.value))}catch(U){console.error("Error saving position:",U)}}_()},handleClick:U=>!$.value&&!A.value?(console.log("Regular click detected"),!0):(console.log("Click ignored - part of drag operation"),!1)}}const $l={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Al={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},Vl={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Tl={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Ml={class:"flex items-center px-4"},Ul={class:"flex"},Nl={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},El=["onClick","data-category"],Dl={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Pl={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ll={key:3,class:"fixed inset-0 z-30"},Rl={class:"mt-2 space-y-2"},jl={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Bl=["onClick"],Fl={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},Ol={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},zl={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},Kl={class:"relative overflow-hidden"},ql={key:"vehicle"},Hl={key:"conclusion"},Gl={key:1},Wl=["disabled"],Jl={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Yl={class:"space-y-4"},Zl={class:"relative"},Ql={class:"max-h-64 overflow-y-auto"},Xl={key:0,class:"text-center py-4 text-gray-500"},er=["onClick"],tr={class:"font-medium text-gray-900"},ar={class:"text-sm text-gray-500"},sr={class:"text-xs text-gray-400 mt-1"},nr={key:0,class:"text-xs text-green-600 mt-1"},or={key:3,class:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 text-center"},ir={class:"p-4 space-y-6"},lr={class:"flex items-center justify-between"},rr=["aria-checked"],ur={class:"space-y-2"},dr={class:"space-y-2"},cr={class:"space-y-2"},gr={class:"flex space-x-4"},pr={class:"flex items-center"},mr={class:"flex items-center"},vr={key:0,class:"space-y-2"},fr={class:"flex space-x-4"},hr={class:"flex items-center"},br={class:"flex items-center"},yr={key:1,class:"space-y-2"},xr={__name:"IndexLocal",props:{inspection:Object,inspectionId:Object,category:Object,car:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(a){var qt,Ht,Gt,Wt,Jt,Yt,Zt,Qt,Xt,ea;const ee=l=>{if(!l)return{};if(typeof l=="string")try{return JSON.parse(l)||{}}catch(o){return console.error("Error parsing settings JSON:",o),{}}return typeof l=="object"&&l!==null?l:{}},t=a,$=se(()=>`inspection_data_${t.inspection.id}`),g=se(()=>`swipe_toggle_${t.inspection.id}`),A=se(()=>`image_source_${t.inspection.id}`),x=se(()=>`active_category_${t.inspection.id}`),V=()=>{try{const l=localStorage.getItem($.value);return l?JSON.parse(l):{}}catch(l){return console.error("Error reading local storage:",l),{}}},_=l=>{try{localStorage.setItem($.value,JSON.stringify(l))}catch(o){console.error("Error writing to local storage:",o)}},L=()=>{try{localStorage.removeItem($.value),localStorage.removeItem(g.value),localStorage.removeItem(A.value),localStorage.removeItem(x.value)}catch(l){console.error("Error clearing local storage:",l)}},w=()=>{try{const l=localStorage.getItem(g.value);return l?JSON.parse(l):!0}catch(l){return console.error("Error reading swipe toggle state:",l),!0}},E=l=>{try{localStorage.setItem(g.value,JSON.stringify(l))}catch(o){console.error("Error writing swipe toggle state:",o)}},U=()=>{try{return localStorage.getItem(A.value)||"all"}catch(l){return console.error("Error reading image source setting:",l),"all"}},Z=l=>{try{localStorage.setItem(A.value,l)}catch(o){console.error("Error writing image source setting:",o)}},f=se(()=>`camera_quality_${t.inspection.id}`),m=()=>{try{return localStorage.getItem(f.value)||"HD_Std"}catch(l){return console.error("Error reading camera quality setting:",l),"HD_Std"}},T=l=>{try{localStorage.setItem(f.value,l)}catch(o){console.error("Error writing camera quality setting:",o)}},q=()=>{try{return localStorage.getItem(x.value)||v.value[0]}catch(l){return console.error("Error reading active category:",l),v.value[0]}},N=l=>{try{localStorage.setItem(x.value,l)}catch(o){console.error("Error writing active category:",o)}},z=y(((Ht=(qt=t.category)==null?void 0:qt.settings)==null?void 0:Ht.menu_model)||"horizontal"),G=y(((Wt=(Gt=t.category)==null?void 0:Gt.settings)==null?void 0:Wt.position)||"top"),B=y(!1),I=y(!1),{pos:P,dragging:W,startLongPress:p,cancelLongPress:h,onDrag:s,stopDrag:k,handleClick:O}=na("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),re=l=>{O(l)&&_e()},_e=()=>{B.value=!B.value},he=()=>{B.value=!1},Se=l=>l?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:Ve,dragging:R,startLongPress:D,cancelLongPress:K,onDrag:H,stopDrag:Q,handleClick:ue}=na("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),me=l=>{ue(l)&&(ce.value=!0)},ce=y(!1),Te=y(!1),we=y(""),ge=y(null),Ie=y(""),Ce=y(""),be=y(""),Me=y(!1),Ue=y(null),r=(l,o)=>{Me.value=!0,Ue.value=o,Et.visit(l,{onFinish:()=>{Me.value=!1,Ue.value=null}})},u=se(()=>t.appMenus.some(l=>l.input_type==="damage")),v=se(()=>["vehicle",...t.appMenus.map(l=>String(l.id)),"conclusion"]),S=y(v.value[0]),J=y(0),ie=se(()=>{if(S.value==="vehicle"||S.value==="conclusion")return null;const l=t.appMenus.find(o=>String(o.id)===S.value);return l?{...l,points:de(l.menu_point,l.input_type==="damage")}:null}),de=(l,o)=>o?(l||[]).filter(le=>{const ne=le.inspection_point_id;return vt(ne)}):l||[],b=y({plate_number:t.inspection.plate_number,car_id:t.inspection.car_id,car_name:t.inspection.car_name}),c=y({notes:t.inspection.overall_note||"",flooded:((Yt=(Jt=ee(t.inspection.settings))==null?void 0:Jt.conclusion)==null?void 0:Yt.flooded)||null,collision:((Qt=(Zt=ee(t.inspection.settings))==null?void 0:Zt.conclusion)==null?void 0:Qt.collision)||null,collision_severity:((ea=(Xt=ee(t.inspection.settings))==null?void 0:Xt.conclusion)==null?void 0:ea.collision_severity)||null}),C=oa((()=>{const l=[...t.appMenus.flatMap(We=>We.menu_point||[]),...t.damagePoints||[]],o={},le={};l.forEach(We=>{const Ke=We.inspection_point_id,Be=t.existingResults[Ke];o[Ke]={status:(Be==null?void 0:Be.status)||"",note:(Be==null?void 0:Be.note)||""},le[Ke]=t.existingImages[Ke]||[]});const ne=V(),pe={...o,...ne.results||{}},fe={...le,...ne.images||{}},Re={...b.value,...ne.vehicleDetails||{}},ke=ne.overall_note!==void 0?ne.overall_note:t.inspection.overall_note||"";return{inspection_id:t.inspection.id,results:pe,images:fe,overall_note:ke,plate_number:Re.plate_number,car_id:Re.car_id,car_name:Re.car_name}})());ve(C,l=>{_({results:l.results,images:l.images,overall_note:l.overall_note,vehicleDetails:b.value,conclusion:c.value})},{deep:!0}),ve(b,l=>{C.plate_number=l.plate_number,C.car_id=l.car_id,C.car_name=l.car_name},{deep:!0}),ve(c,l=>{C.overall_note=l.notes},{deep:!0});const ae=Lt("vehicleFeatures",y(null));ae.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),Dt("vehicleFeatures",ae);const ye=l=>{var pe,fe;const o=l.settings;if(!$e(l))return!0;const le=(pe=t.car)==null?void 0:pe.transmission,ne=(fe=t.car)==null?void 0:fe.fuel_type;return!(o.transmission&&Array.isArray(o.transmission)&&o.transmission.length>0&&le&&!o.transmission.includes(le)||o.fuel_type&&o.fuel_type.trim()!==""&&ne&&o.fuel_type!==ne||o.rear_door&&(!ae.value||!ae.value.rear_door)||o.pick_up&&(!ae.value||!ae.value.pick_up)||o.box&&(!ae.value||!ae.value.box))},$e=l=>{const o=l.settings;return!!(o!=null&&o.transmission&&Array.isArray(o.transmission)&&o.transmission.length>0||o!=null&&o.fuel_type&&o.fuel_type.trim()!==""||o!=null&&o.rear_door||o!=null&&o.pick_up||o!=null&&o.box)},xe=y(!1),Oe=l=>{xe.value=l},pt=y(!1),kt=l=>{pt.value=l},Ye=se(()=>{var pe;const l=b.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(b.value.plate_number),o=!!((pe=b.value.car_name)!=null&&pe.trim()),le=!pt.value,ne=!xe.value;return l&&o&&le&&ne}),mt=se(()=>{if(!we.value.trim())return t.damagePoints||[];const l=we.value.toLowerCase().trim();return(t.damagePoints||[]).filter(o=>{var le,ne,pe,fe,Re;return((ne=(le=o.inspection_point)==null?void 0:le.name)==null?void 0:ne.toLowerCase().includes(l))||((fe=(pe=o.inspection_point)==null?void 0:pe.description)==null?void 0:fe.toLowerCase().includes(l))||((Re=ft(o))==null?void 0:Re.toLowerCase().includes(l))})}),vt=l=>{const o=C.results[l]&&(C.results[l].status||C.results[l].note),le=C.images[l]&&C.images[l].length>0;return o||le},ft=l=>{var o;return((o=l.inspection_point.component)==null?void 0:o.name)||"Komponen Tidak Diketahui"},It=l=>C.results[l]||null,nt=()=>{var fe;const l=c.value,o=!!l.flooded,le=!!l.collision,ne=l.collision==="yes"?!!l.collision_severity:!0,pe=!!((fe=l.notes)!=null&&fe.trim());return o&&le&&ne&&pe},ht=se(()=>({flooded:c.value.flooded||null,collision:c.value.collision||null,collision_severity:c.value.collision_severity||null,note:c.value.notes||null,isComplete:nt()})),bt=se(()=>{const l=Ye.value,o=t.appMenus.every(ne=>ot(ne)),le=nt();return l&&o&&le}),ot=l=>l.input_type==="damage"?!0:l.id==="conclusion"?nt():l.id==="vehicle"?Ye.value:(de(l.menu_point,!1)||[]).filter(ne=>ne.is_default&&ye(ne)).every(ne=>{var ke,We,Ke,Be,yt,xt;const pe=C.results[ne.inspection_point_id],fe=C.images[ne.inspection_point_id];if(!pe)return!1;const Re=ee(ne.settings);switch(ne.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((ke=pe.note)!=null&&ke.trim());case"select":case"radio":if(!pe.status)return!1;const Je=(We=Re.radios)==null?void 0:We.find(tt=>tt.value===pe.status);return!(Je!=null&&Je.settings&&(Je.settings.show_textarea&&!((Ke=pe.note)!=null&&Ke.trim())||Je.settings.show_image_upload&&(fe==null?void 0:fe.length)===0));case"imageTOradio":if((fe==null?void 0:fe.length)===0||!pe.status)return!1;const j=(Be=Re.radios)==null?void 0:Be.find(tt=>tt.value===pe.status);return!(j!=null&&j.settings&&j.settings.show_textarea&&j.settings.required&&!((yt=pe.note)!=null&&yt.trim()));case"image":return(fe==null?void 0:fe.length)>0;default:return!!pe.status||!!((xt=pe.note)!=null&&xt.trim())}}),je=y(!0),Ge=y(U()),ze=y(m()),it=y(!1),_t=()=>{console.log("Opening settings modal"),it.value=!0},lt=()=>{console.log("Closing settings modal"),it.value=!1},Ze=y(null),rt=y([]),Qe=y(0),Xe=y(!1);Dt("imageSourceSetting",Ge),Dt("cameraQualitySetting",ze);const St=()=>{je.value=!je.value,E(je.value)},Ct=()=>{Z(Ge.value),console.log("Image source setting updated to:",Ge.value)},$t=()=>{T(ze.value),console.log("Camera quality setting updated to:",ze.value)},et=()=>{Ze.value&&Pt(()=>{const l=Ze.value.querySelector(`[data-category="${S.value}"]`);if(!l)return;const o=Ze.value,le=o.clientWidth,ne=l.offsetLeft,pe=l.clientWidth,fe=ne-le/2+pe/2;o.scrollTo({left:fe,behavior:"smooth"})})},At=()=>Qe.value===0?(Qe.value=1,Xe.value=!0,setTimeout(()=>{Qe.value=0,Xe.value=!1},2e3),window.history.pushState(null,null,window.location.href),!1):(Qe.value=0,Xe.value=!1,Et.visit(route("job.index")),!0),Vt=()=>{window.history.state===null&&window.history.replaceState({isBackButtonControlled:!0},""),window.history.pushState({isBackButtonControlled:!0},""),window.addEventListener("popstate",l=>{l.state&&l.state.isBackButtonControlled&&(l.preventDefault(),At())})},Tt=l=>{ge.value=l;const o=l.inspection_point_id,le=C.results[o]||{};Ie.value=le.status||"",Ce.value=le.note||"",ce.value=!1,Te.value=!0},Mt=l=>{ge.value&&(C.images[ge.value.inspection_point_id]=l)},Ut=()=>{if(ge.value){const l=ge.value.inspection_point_id;C.results[l]={...C.results[l],status:Ie.value,note:Ce.value},be.value="Data berhasil disimpan di lokal!",setTimeout(()=>be.value="",1e3)}Rt()},Nt=({pointId:l,type:o,value:le})=>{var ne;(ne=C.results[l])!=null&&ne.hasOwnProperty(o)&&(C.results[l][o]=le)},Y=async l=>{if(l&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{await Et.post(route("inspections.delete-result"),{inspection_id:t.inspection.id,point_id:l},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{C.results[l]&&(C.results[l]={status:"",note:""}),C.images[l]&&(C.images[l]=[]),be.value="Data berhasil dihapus!",setTimeout(()=>be.value="",1e3)},onError:o=>{console.error("Error menghapus hasil:",o)}})}catch(o){console.error("Error menghapus hasil:",o)}Rt()}},M=l=>{Object.assign(b.value,l),Oe(!0)},ma=l=>{console.log("Save car details locally:",l)},va=l=>{console.log("Received conclusion data from child:",l),c.value={...c.value,...l},C.overall_note=l.notes||"",console.log("Conclusion state updated:",c.value)},fa=()=>{if(!bt.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}if(!confirm("Apakah Anda yakin ingin mengirim semua data inspeksi? Data lokal akan dihapus setelah berhasil dikirim."))return;I.value=!0;const l={...C.data(),overall_note:c.value.notes,conclusion:{notes:c.value.notes,flooded:c.value.flooded,collision:c.value.collision,collision_severity:c.value.collision_severity}};Et.post(route("inspections.final-submit-local",{id:t.inspection.id}),l,{preserveScroll:!0,onSuccess:()=>{L()},onError:o=>{console.error("Kesalahan pengiriman:",o),I.value=!1}})},ha=({pointId:l,imageId:o})=>{C.images[l]&&(C.images[l]=C.images[l].filter(le=>le.id!==o))},zt=()=>{ce.value=!1,we.value=""},Rt=()=>{Te.value=!1,ge.value=null,Ie.value="",Ce.value=""},ba=()=>{},ut=l=>{S.value=l,N(l),et()},Kt=l=>{let o=J.value+l;o>=0&&o<v.value.length&&(S.value=v.value[o],et())},ya=()=>{let l=0,o=0,le=null;const ne=ke=>{je.value&&(l=ke.changedTouches[0].screenX)},pe=ke=>{je.value&&(o=ke.changedTouches[0].screenX,fe())},fe=()=>{if(!je.value)return;const ke=250;o<l-ke?Kt(1):o>l+ke&&Kt(-1)},Re=()=>{const ke=document.querySelector(".relative.overflow-hidden");return ke&&(ke.addEventListener("touchstart",ne,{passive:!0}),ke.addEventListener("touchend",pe,{passive:!0})),()=>{ke&&(ke.removeEventListener("touchstart",ne),ke.removeEventListener("touchend",pe))}};return le=Re(),ve(je,ke=>{le&&le(),ke&&(le=Re())}),()=>{le&&le()}};return ve(S,(l,o)=>{et()}),ve(S,l=>{J.value=v.value.indexOf(l)}),ve(ze,l=>{$t()}),st(()=>{const l=V();if(je.value=w(),Ge.value=U(),ze.value=m(),l.vehicleDetails&&(Object.assign(b.value,l.vehicleDetails),C.plate_number=l.vehicleDetails.plate_number,C.car_id=l.vehicleDetails.car_id,C.car_name=l.vehicleDetails.car_name),l.conclusion)console.log("Loading conclusion from localStorage:",l.conclusion),Object.assign(c.value,l.conclusion),C.overall_note=l.conclusion.notes||"";else{const ne=ee(t.inspection.settings).conclusion||{};c.value={notes:t.inspection.notes||"",flooded:ne.flooded||"",collision:ne.collision||"",collision_severity:ne.collision_severity||""},C.overall_note=t.inspection.notes||""}l.results&&Object.assign(C.results,l.results),l.images&&Object.assign(C.images,l.images);const o=q();v.value.includes(o)?S.value=o:(S.value=v.value[0],N(v.value[0])),ya(),Vt(),setTimeout(()=>{et()},100)}),(l,o)=>{var le,ne,pe,fe,Re,ke,We,Ke,Be,yt,xt,Je;return n(),i("div",$l,[X(R)||X(W)?(n(),i("div",Al)):d("",!0),z.value==="vertical"?(n(),i("button",{key:1,onMousedown:o[0]||(o[0]=(...j)=>X(p)&&X(p)(...j)),onMouseup:o[1]||(o[1]=(...j)=>X(k)&&X(k)(...j)),onMouseleave:o[2]||(o[2]=(...j)=>X(h)&&X(h)(...j)),onMousemove:o[3]||(o[3]=(...j)=>X(s)&&X(s)(...j)),onTouchstart:o[4]||(o[4]=(...j)=>X(p)&&X(p)(...j)),onTouchend:o[5]||(o[5]=(...j)=>X(k)&&X(k)(...j)),onTouchmove:o[6]||(o[6]=(...j)=>X(s)&&X(s)(...j)),onClick:re,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:qe({left:X(P).x+"px",top:X(P).y+"px"}),"aria-label":"Toggle vertical menu"},[B.value?(n(),i("svg",Tl,o[31]||(o[31]=[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(n(),i("svg",Vl,o[30]||(o[30]=[e("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):d("",!0),z.value==="horizontal"?(n(),i("div",{key:2,class:oe(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":G.value==="top","fixed bottom-0 left-0 right-0":G.value==="bottom"}])},[e("div",Ml,[e("div",{class:"flex-shrink-0"},[e("button",{onClick:_t,class:"p-2 rounded-full text-gray-600 hover:text-gray-800 hover:bg-gray-100 transition-colors duration-200",title:"Pengaturan"},o[32]||(o[32]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)]))]),e("div",{ref_key:"menuContainer",ref:Ze,class:"flex-1 overflow-x-auto scrollbar-hide py-3 ml-2 space-x-2 menu-container",onScroll:ba},[e("div",Ul,[e("button",{ref_key:"menuItems",ref:rt,onClick:o[7]||(o[7]=j=>ut("vehicle")),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":S.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":S.value!=="vehicle"}]),"data-category":"vehicle"},[o[33]||(o[33]=Ee(" Detail Kendaraan ")),Ye.value?(n(),i("span",Nl," ✓ ")):d("",!0)],2),(n(!0),i(Ne,null,Pe(a.appMenus,j=>(n(),i("button",{key:j.id,ref_for:!0,ref_key:"menuItems",ref:rt,onClick:tt=>ut(String(j.id)),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":S.value===String(j.id),"bg-gray-100 text-gray-700 hover:bg-gray-200":S.value!==String(j.id)}]),"data-category":String(j.id)},[Ee(F(j.name)+" ",1),ot(j)?(n(),i("span",Dl," ✓ ")):d("",!0)],10,El))),128)),e("button",{ref_key:"menuItems",ref:rt,onClick:o[8]||(o[8]=j=>ut("conclusion")),class:oe(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200 menu-item",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":S.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":S.value!=="conclusion"}]),"data-category":"conclusion"},[o[34]||(o[34]=Ee(" Kesimpulan ")),ht.value.isComplete?(n(),i("span",Pl," ✓ ")):d("",!0)],2)])],544)])],2)):d("",!0),z.value==="vertical"&&B.value?(n(),i("div",Ll,[e("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:he}),e("div",{class:oe(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":G.value==="top-right","top-16 left-4":G.value==="top-left","bottom-16 right-4":G.value==="bottom-right","bottom-16 left-4":G.value==="bottom-left"}])},[e("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[o[35]||(o[35]=e("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),e("button",{onClick:he,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),e("div",Rl,[e("button",{onClick:o[9]||(o[9]=j=>{ut("vehicle"),he()}),class:oe([Se(S.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[o[36]||(o[36]=e("span",null,"Detail Kendaraan",-1)),Ye.value?(n(),i("span",jl,"✓")):d("",!0)],2),(n(!0),i(Ne,null,Pe(a.appMenus,j=>(n(),i("button",{key:`vmenu-${j.id}`,onClick:()=>{ut(String(j.id)),he()},class:oe([Se(S.value===String(j.id)),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[e("span",null,F(j.name),1),ot(j)?(n(),i("span",Fl,"✓")):d("",!0)],10,Bl))),128)),e("button",{onClick:o[10]||(o[10]=j=>{ut("conclusion"),he()}),class:oe([Se(S.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[o[37]||(o[37]=e("span",null,"Kesimpulan",-1)),ht.value.isComplete?(n(),i("span",Ol,"✓")):d("",!0)],2)])],2)])):d("",!0),e("div",{class:oe(["max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1",{"pb-4 pt-1":G.value==="top","pb-20 pt-4":G.value==="bottom","pb-4 pt-4":z.value==="vertical"}])},[Ae(gt,{name:"fade"},{default:Fe(()=>[be.value?(n(),i("div",zl,F(be.value),1)):d("",!0)]),_:1}),e("div",Kl,[Ae(gt,{name:"category-slide",mode:"out-in"},{default:Fe(()=>[S.value==="vehicle"?(n(),i("div",ql,[Ae(hs,{inspection:a.inspection,CarDetail:a.CarDetail,allInspections:t.allInspections,onUpdateVehicle:M,onSaveCarDetails:ma,"onUpdate:validation":kt,"onUpdate:hasUnsavedChanges":Oe},null,8,["inspection","CarDetail","allInspections"])])):ie.value&&S.value!=="conclusion"?(n(),i("div",{key:ie.value.id},[Ae(tl,{category:ie.value,"inspection-id":a.inspection.id,car:t.car,form:X(C),head:z.value,onUpdateResult:Nt,onHapusPoint:Y,onRemoveImage:ha},null,8,["category","inspection-id","car","form","head"])])):S.value==="conclusion"?(n(),i("div",Hl,[Ae(Cl,{form:{conclusion:c.value},"inspection-id":a.inspection.id,inspection:a.inspection,settings:a.inspection.settings||{},onUpdateConclusion:va},null,8,["form","inspection-id","inspection","settings"])])):d("",!0)]),_:1})]),S.value==="conclusion"?(n(),i("div",{key:0,class:oe(["flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md",{"mb-4":G.value==="top","mb-20":G.value==="bottom"}])},[Ae(X(ka),{href:l.route("inspections.pending",a.inspectionId),as:"button",type:"button",disabled:Me.value&&Ue.value==="pending",onClick:o[11]||(o[11]=ct(j=>r(l.route("inspections.pending",a.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Fe(()=>[Me.value&&Ue.value==="pending"?(n(),i(Ne,{key:0},[o[38]||(o[38]=e("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),o[39]||(o[39]=e("span",null,"Memproses...",-1))],64)):(n(),i("span",Gl,"Tunda"))]),_:1},8,["href","disabled"]),e("button",{type:"button",onClick:fa,disabled:!bt.value||I.value,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[I.value?(n(),i("svg",Jl,o[40]||(o[40]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):d("",!0),e("span",null,F(I.value?"Mengirim...":"Final Kirim Inspeksi"),1)],8,Wl)],2)):d("",!0),u.value?(n(),i("button",{key:1,onMousedown:o[12]||(o[12]=(...j)=>X(D)&&X(D)(...j)),onMouseup:o[13]||(o[13]=(...j)=>X(Q)&&X(Q)(...j)),onMouseleave:o[14]||(o[14]=(...j)=>X(K)&&X(K)(...j)),onMousemove:o[15]||(o[15]=(...j)=>X(H)&&X(H)(...j)),onTouchstart:o[16]||(o[16]=(...j)=>X(D)&&X(D)(...j)),onTouchend:o[17]||(o[17]=(...j)=>X(Q)&&X(Q)(...j)),onTouchmove:o[18]||(o[18]=(...j)=>X(H)&&X(H)(...j)),onClick:me,class:"fixed z-5 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:qe({left:X(Ve).x+"px",top:X(Ve).y+"px"})},o[41]||(o[41]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):d("",!0),Ae(pa,{show:ce.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:zt},{default:Fe(()=>[e("button",{onClick:zt,class:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10"},o[42]||(o[42]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",Yl,[e("div",Zl,[Le(e("input",{"onUpdate:modelValue":o[19]||(o[19]=j=>we.value=j),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[dt,we.value]]),o[43]||(o[43]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),e("div",Ql,[mt.value.length===0?(n(),i("div",Xl," Tidak ada point yang ditemukan ")):d("",!0),(n(!0),i(Ne,null,Pe(mt.value,j=>{var tt,ta;return n(),i("button",{key:j.id,onClick:wr=>Tt(j),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",tr,F((tt=j.inspection_point)==null?void 0:tt.name),1),e("div",ar,F((ta=j.inspection_point)==null?void 0:ta.description),1),e("div",sr,F(ft(j)),1),vt(j.inspection_point_id)?(n(),i("div",nr," ✓ Sudah ada data ")):d("",!0)],8,er)}),128))])])]),_:1},8,["show"]),Te.value?(n(),De(Ot,{key:(le=ge.value)==null?void 0:le.id,show:Te.value,title:((pe=(ne=ge.value)==null?void 0:ne.inspection_point)==null?void 0:pe.name)||"Detail Point",subtitle:(Re=(fe=ge.value)==null?void 0:fe.inspection_point)==null?void 0:Re.description,name:`point-${(ke=ge.value)==null?void 0:ke.id}`,"inspection-id":a.inspection.id,"point-id":(We=ge.value)==null?void 0:We.inspection_point_id,settings:((Ke=ge.value)==null?void 0:Ke.settings)||{},options:((yt=(Be=ge.value)==null?void 0:Be.settings)==null?void 0:yt.radios)||[],"selected-Point":ge.value,"selected-value":Ie.value,"images-value":X(C).images[(xt=ge.value)==null?void 0:xt.inspection_point_id],"notes-value":Ce.value,point:ge.value,"existing-data":It((Je=ge.value)==null?void 0:Je.inspection_point_id),"onUpdate:selectedValue":o[20]||(o[20]=j=>Ie.value=j),"onUpdate:notesValue":o[21]||(o[21]=j=>Ce.value=j),"onUpdate:imagesValue":Mt,onSave:Ut,onClose:Rt,onHapus:Y},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):d("",!0),Xe.value?(n(),i("div",or,o[44]||(o[44]=[e("p",{class:"text-sm"},"Tekan sekali lagi untuk keluar dari inspeksi",-1),e("p",{class:"text-xs text-gray-300 mt-1"},"Data inspeksi telah disimpan secara lokal",-1)]))):d("",!0),it.value?(n(),i("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:lt},[e("div",{class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:o[29]||(o[29]=ct(()=>{},["stop"]))},[e("div",{class:"flex items-center justify-between p-4 border-b"},[o[46]||(o[46]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Pengaturan Inspeksi",-1)),e("button",{onClick:lt,class:"text-gray-400 hover:text-gray-600 transition-colors"},o[45]||(o[45]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ir,[e("div",lr,[o[47]||(o[47]=e("div",null,[e("label",{class:"text-sm font-medium text-gray-700"},"Swipe Gesture"),e("p",{class:"text-xs text-gray-500"},"Aktifkan navigasi dengan geser")],-1)),e("button",{onClick:St,type:"button",class:oe(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",je.value?"bg-indigo-600":"bg-gray-200"]),role:"switch","aria-checked":je.value},[e("span",{"aria-hidden":"true",class:oe(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",je.value?"translate-x-5":"translate-x-0"])},null,2)],10,rr)]),e("div",ur,[o[49]||(o[49]=e("label",{class:"text-sm font-medium text-gray-700"},"Sumber Gambar",-1)),Le(e("select",{"onUpdate:modelValue":o[22]||(o[22]=j=>Ge.value=j),onChange:Ct,class:"w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},o[48]||(o[48]=[e("option",{value:"all"},"Tanya",-1),e("option",{value:"camera"},"Kamera",-1),e("option",{value:"gallery"},"Galeri",-1)]),544),[[Bt,Ge.value]])]),e("div",dr,[o[51]||(o[51]=e("label",{class:"text-sm font-medium text-gray-700"},"Kualitas Kamera",-1)),Le(e("select",{"onUpdate:modelValue":o[23]||(o[23]=j=>ze.value=j),class:"w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},o[50]||(o[50]=[ia('<option value="HP_Native" data-v-99fd500f>HP</option><option value="HD_Std" data-v-99fd500f>HD Std</option><option value="4K" data-v-99fd500f>4K Rtc</option><option value="HD" data-v-99fd500f>HD Rtc</option><option value="SD" data-v-99fd500f>SD Rtc</option>',5)]),512),[[Bt,ze.value]])]),e("div",cr,[o[54]||(o[54]=e("label",{class:"text-sm font-medium text-gray-700"},"Mode Menu",-1)),e("div",gr,[e("label",pr,[Le(e("input",{type:"radio","onUpdate:modelValue":o[24]||(o[24]=j=>z.value=j),value:"horizontal",class:"text-indigo-600 focus:ring-indigo-500"},null,512),[[at,z.value]]),o[52]||(o[52]=e("span",{class:"ml-2 text-sm text-gray-700"},"Scroll samping",-1))]),e("label",mr,[Le(e("input",{type:"radio","onUpdate:modelValue":o[25]||(o[25]=j=>z.value=j),value:"vertical",class:"text-indigo-600 focus:ring-indigo-500"},null,512),[[at,z.value]]),o[53]||(o[53]=e("span",{class:"ml-2 text-sm text-gray-700"},"Menu Ngambang",-1))])])]),z.value==="horizontal"?(n(),i("div",vr,[o[57]||(o[57]=e("label",{class:"text-sm font-medium text-gray-700"},"Posisi Menu",-1)),e("div",fr,[e("label",hr,[Le(e("input",{type:"radio","onUpdate:modelValue":o[26]||(o[26]=j=>G.value=j),value:"top",class:"text-indigo-600 focus:ring-indigo-500"},null,512),[[at,G.value]]),o[55]||(o[55]=e("span",{class:"ml-2 text-sm text-gray-700"},"Atas",-1))]),e("label",br,[Le(e("input",{type:"radio","onUpdate:modelValue":o[27]||(o[27]=j=>G.value=j),value:"bottom",class:"text-indigo-600 focus:ring-indigo-500"},null,512),[[at,G.value]]),o[56]||(o[56]=e("span",{class:"ml-2 text-sm text-gray-700"},"Bawah",-1))])])])):d("",!0),z.value==="vertical"?(n(),i("div",yr,[o[59]||(o[59]=e("label",{class:"text-sm font-medium text-gray-700"},"Posisi Menu Vertikal",-1)),Le(e("select",{"onUpdate:modelValue":o[28]||(o[28]=j=>G.value=j),class:"w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},o[58]||(o[58]=[e("option",{value:"top-right"},"Atas Kanan",-1),e("option",{value:"top-left"},"Atas Kiri",-1),e("option",{value:"bottom-right"},"Bawah Kanan",-1),e("option",{value:"bottom-left"},"Bawah Kiri",-1)]),512),[[Bt,G.value]])])):d("",!0)]),e("div",{class:"flex justify-end p-4 border-t bg-gray-50"},[e("button",{onClick:lt,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"}," Tutup ")])])])):d("",!0)],2)])}}},Vr=He(xr,[["__scopeId","data-v-99fd500f"]]);export{Vr as default};
