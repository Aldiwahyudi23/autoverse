import{x as Lt,r as V,g as je,q as ue,P as Be,L as ye,c as i,o as n,d as t,b as p,k as Me,z as Ee,A as Fe,n as me,t as z,F as Ve,m as Ue,f as Ce,u as Ne,e as Rt,y as ze,w as De,J as Le,D as Ge,Q as We,j as Se,a as Oe,l as Vt,T as He,R as jt,p as Ft,E as At,I as Ke,B as Bt}from"./vendor-D9AtPSqO.js";import{l as Tt}from"./lodash-BHkPC8MA.js";import{_ as qt}from"./PrimaryButton-C7m5Czsq.js";import{_ as Ot}from"./ActionMessage-BPss2f-D.js";import{F as zt}from"./fuse-Ch1WBRTM.js";import{_ as Re}from"./app-DD5nWmYF.js";import{_ as Mt}from"./InputNumber-Ckafudl2.js";const Ht={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Kt={key:0,class:"p-4 space-y-2"},Gt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Wt={class:"flex items-center space-x-2"},Zt={key:0,class:"text-xs text-red-500 font-normal ml-2"},Xt={key:1,class:"text-xs text-red-500 font-normal ml-2"},Yt={key:2,class:"text-xs text-green-500 font-normal ml-2"},Jt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Qt={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},ea={class:"col-span-2 flex space-x-3"},ta={class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},aa={class:"flex items-start"},sa={class:"text-sm text-blue-700"},na={class:"mt-1"},ia={key:0,class:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-medium mr-2"},oa={key:1,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium mr-2"},la={key:2,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium"},ra={key:3,class:"text-blue-600"},ua={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},da={class:"relative"},ca={key:0,class:"absolute right-3 top-3"},ga={key:1,class:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ma={key:0},pa=["onMousedown"],va={class:"font-medium text-gray-900"},fa={class:"text-sm text-gray-500"},ha={key:1,class:"p-4 text-sm text-gray-500 text-center"},ba={key:0,class:"text-xs text-red-500 font-normal ml-2"},ya={key:0,class:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},xa={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},wa={key:0,class:"mb-4"},ka=["innerHTML"],Ia={key:1},_a={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Sa=["onClick"],$a=["src","alt"],Ca={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Va={class:"text-white text-xs text-center"},Aa={key:2,class:"text-center py-4 text-gray-500 text-sm"},Ta={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ma=["src","alt"],Ua={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Na={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Pa={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ea={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges","update:vehicle-type"],setup(s,{emit:le}){var l,y,v,U,B,re;const e=s,_=le,r=Lt({plate_number:((l=e.inspection)==null?void 0:l.plate_number)||"",car_id:((y=e.inspection)==null?void 0:y.car_id)||null,car_name:((v=e.inspection)==null?void 0:v.car_name)||""}),$=V(((U=e.inspection)==null?void 0:U.plate_number)||""),b=V(((B=e.inspection)==null?void 0:B.car_id)||null),S=V(((re=e.inspection)==null?void 0:re.car_name)||""),w=V(""),L=V(""),h=V(""),E=V(null),T=V({rear_door:!1}),W=V(!1),te=V(""),ne=V(""),F=V(r.car_name),J=V(!1),P=V(!1),oe=V([]),N=V(null),m=V([]),x=V(!1),R=V(0);je(()=>{var g,d,K,j,se;if(G((g=e.inspection)==null?void 0:g.plate_number),(d=e.inspection)!=null&&d.car_id&&((K=e.CarDetail)==null?void 0:K.length)>0){const de=e.CarDetail.find(pe=>pe.id===e.inspection.car_id);de&&ee(de)}else!((j=e.inspection)!=null&&j.car_id)&&((se=e.inspection)!=null&&se.car_name)&&(F.value=e.inspection.car_name,r.car_id=null);window.addEventListener("keydown",Ae),ie(),_("update:hasUnsavedChanges",k.value),_("update:validation",o.value)}),Be(()=>{window.removeEventListener("keydown",Ae)});const ie=()=>{try{const g=localStorage.getItem("vehicle_features");if(g){const d=JSON.parse(g);T.value.rear_door=d.rear_door||!1,d.pick_up?E.value="pick_up":d.box?E.value="box":E.value=null}else T.value.rear_door=!1,E.value=null;D()}catch(g){console.error("Error loading vehicle type from localStorage:",g),T.value.rear_door=!1,E.value=null,D()}},Q=()=>{T.value.rear_door=!T.value.rear_door,O()},Y=g=>{E.value===g?E.value=null:E.value=g,O()},O=()=>{try{const g={rear_door:T.value.rear_door,pick_up:E.value==="pick_up",box:E.value==="box"};localStorage.setItem("vehicle_features",JSON.stringify(g)),D(),console.log("Vehicle features saved to localStorage:",g)}catch(g){console.error("Error saving vehicle type to localStorage:",g)}},D=()=>{const g={rear_door:T.value.rear_door,pick_up:E.value==="pick_up",box:E.value==="box"};_("update:vehicle-type",g)},G=g=>{if(!g){w.value="",L.value="",h.value="";return}const d=g.toUpperCase().trim(),K=d.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(K)w.value=K[1]||"",L.value=K[2]||"",h.value=K[3]||"";else{let j="area",se="",de="",pe="";for(const be of d)j==="area"&&/[A-Z]/.test(be)?se+=be:j==="area"&&/[0-9]/.test(be)?(j="number",de+=be):j==="number"&&/[0-9]/.test(be)?de+=be:j==="number"&&/[A-Z]/.test(be)?(j="suffix",pe+=be):j==="suffix"&&/[A-Z]/.test(be)&&(pe+=be);w.value=se,L.value=de,h.value=pe}ae()},ae=()=>{const g=`${w.value}${L.value}${h.value}`;r.plate_number=g,Te()},I=g=>{g==="area"?w.value=w.value.toUpperCase().replace(/[^A-Z]/g,""):g==="number"?L.value=L.value.replace(/[^0-9]/g,""):g==="suffix"&&(h.value=h.value.toUpperCase().replace(/[^A-Z]/g,"")),ae()},u=ue(()=>{const g=r.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(g)}),c=ue(()=>!F.value||F.value.trim()===""),a=ue(()=>r.plate_number.length>0&&!u.value?"Format plat nomor tidak valid.":null),o=ue(()=>{const g=!r.plate_number||r.plate_number.trim()==="",d=!F.value||F.value.trim()==="";return g||d||!u.value||W.value}),k=ue(()=>{const g=r.plate_number!==$.value,d=r.car_id!==b.value||F.value!==S.value;return g||d}),M=ue(()=>k.value&&!o.value&&r.car_id!==null),f=g=>{var K,j,se;if(!g)return"";const d=[];return(K=g.brand)!=null&&K.name&&d.push(g.brand.name),(j=g.model)!=null&&j.name&&d.push(g.model.name),(se=g.type)!=null&&se.name&&d.push(g.type.name),g.cc&&d.push((g.cc/1e3).toFixed(1)),g.transmission&&d.push(g.transmission),g.year&&d.push(g.year.toString()),g.fuel_type&&d.push(g.fuel_type),g.production_period&&d.push(`(${g.production_period})`),d.join(" ")},q=Tt.debounce(()=>{if(!F.value.trim()){oe.value=[],J.value=!1;return}P.value=!0;try{const g=F.value.trim();if(e.CarDetail&&e.CarDetail.length>0){const d=e.CarDetail.map(se=>({...se,formattedName:f(se)})),j=new zt(d,{keys:["formattedName","brand.name","model.name","type.name"],threshold:.6,findAllMatches:!0,includeScore:!0,shouldSort:!0}).search(g).slice(0,5);oe.value=j.map(se=>se.item)}else oe.value=[];J.value=!0}finally{P.value=!1}},300),A=()=>{if(r.car_id&&(r.car_id=null,N.value=null,m.value=[]),!F.value.trim()){oe.value=[],J.value=!1;return}q()},Z=()=>{setTimeout(()=>{J.value=!1,!r.car_id&&F.value&&(r.car_name=F.value,Te())},200)},ee=async g=>{N.value=g,F.value=f(g),r.car_id=g.id,r.car_name=f(g),J.value=!1,q.cancel(),await ge(g.id),Te(),_("update:hasUnsavedChanges",k.value),_("update:validation",o.value)},ce=g=>!g||!g.file_path?"":`/storage/${g.file_path}`,ge=async g=>{try{const d=await fetch(`/api/cars/${g}/images`);if(d.ok){const K=await d.json();m.value=Array.isArray(K)?K:[]}else m.value=[]}catch(d){console.error("Error loading car images:",d),m.value=[]}},fe=g=>{R.value=g,x.value=!0,document.body.style.overflow="hidden"},Ie=()=>{x.value=!1,document.body.style.overflow=""},$e=()=>{R.value=(R.value+1)%m.value.length},ke=()=>{R.value=(R.value-1+m.value.length)%m.value.length},Ae=g=>{if(x.value)switch(g.key){case"Escape":Ie();break;case"ArrowRight":$e();break;case"ArrowLeft":ke();break}},Te=()=>{const g={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};_("update-vehicle",g)},Pe=()=>{e.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:e.inspection.id}),{preserveScroll:!0,onSuccess:()=>{$.value=r.plate_number,b.value=r.car_id,S.value=r.car_name,_("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:g=>{console.error("Gagal menyimpan data:",g)}})};return ye([()=>r.plate_number,()=>r.car_name],g=>{te.value="",W.value=!1,ne.value="";const d=g[0];if(d&&d.length>=6){const K=e.allInspections.filter(j=>{var se;return j.plate_number===d&&j.id!==((se=e.inspection)==null?void 0:se.id)});if(K.length>0){const j=["draft","in_progress","pending","pending_review","revision"],se=K.find(de=>j.includes(de.status));if(se)W.value=!0,te.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${se.status.replace(/_/g," ").toUpperCase()}.`;else{const de=K.filter(pe=>["approved","rejected","completed","cancelled"].includes(pe.status));if(de.length>0){de.sort((be,xe)=>new Date(xe.created_at)-new Date(be.created_at));const pe=de[0];if(pe.car_id){const be=e.CarDetail.find(xe=>xe.id===pe.car_id);be&&ee(be)}else pe.car_name&&(F.value=pe.car_name,r.car_name=pe.car_name,r.car_id=null);ne.value=`Nomor plat ini sudah pernah diperiksa ${de.length} kali sebelumnya.`}}}}_("update:hasUnsavedChanges",k.value),_("update:validation",o.value)},{deep:!0}),ye([()=>T.value.rear_door,()=>E.value],()=>{O()}),ye(()=>{var g;return(g=e.inspection)==null?void 0:g.car_id},g=>{var d,K;if(g!==r.car_id)if(r.car_id=g,g&&((d=e.CarDetail)==null?void 0:d.length)>0){const j=e.CarDetail.find(se=>se.id===g);j&&ee(j)}else!g&&((K=e.inspection)!=null&&K.car_name)&&(F.value=e.inspection.car_name,r.car_name=e.inspection.car_name,r.car_id=null)}),ye(()=>{var g;return(g=e.inspection)==null?void 0:g.car_name},g=>{g&&g!==F.value&&(F.value=g)}),(g,d)=>{var K;return n(),i("div",Ht,[d[27]||(d[27]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),s.inspection?(n(),i("div",Kt,[t("div",Gt,[d[11]||(d[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",Wt,[Ee(t("input",{"onUpdate:modelValue":d[0]||(d[0]=j=>w.value=j),type:"text",placeholder:"Contoh: B",class:me(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!u.value||W.value}]),onInput:d[1]||(d[1]=j=>I("area")),maxlength:"2"},null,34),[[Fe,w.value]]),Ee(t("input",{"onUpdate:modelValue":d[2]||(d[2]=j=>L.value=j),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:me(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!u.value||W.value}]),onInput:d[3]||(d[3]=j=>I("number")),maxlength:"4"},null,34),[[Fe,L.value]]),Ee(t("input",{"onUpdate:modelValue":d[4]||(d[4]=j=>h.value=j),type:"text",placeholder:"ABC",class:me(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!u.value||W.value}]),onInput:d[5]||(d[5]=j=>I("suffix")),maxlength:"3"},null,34),[[Fe,h.value]])]),a.value?(n(),i("span",Zt,z(a.value),1)):p("",!0),te.value?(n(),i("span",Xt,z(te.value),1)):p("",!0),ne.value?(n(),i("span",Yt,z(ne.value),1)):p("",!0)]),t("div",Jt,[d[15]||(d[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Jenis Kendaraan ",-1)),t("div",Qt,[t("div",{class:me(["w-full px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":T.value.rear_door,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":!T.value.rear_door}]),onClick:Q},d[12]||(d[12]=[t("span",null,"Pintu Belakang",-1)]),2),t("div",ea,[t("div",{class:me(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":E.value==="pick_up","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":E.value!=="pick_up"}]),onClick:d[6]||(d[6]=j=>Y("pick_up"))}," Pick Up ",2),t("div",{class:me(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":E.value==="box","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":E.value!=="box"}]),onClick:d[7]||(d[7]=j=>Y("box"))}," Box ",2)])]),t("div",ta,[t("div",aa,[d[14]||(d[14]=t("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",sa,[d[13]||(d[13]=t("p",{class:"font-medium"},"Status Kendaraan:",-1)),t("p",na,[T.value.rear_door?(n(),i("span",ia," ✓ Mobil Pada Umum nya yang memiliki Pintu Belakang ")):p("",!0),E.value==="pick_up"?(n(),i("span",oa," ✓ Pick Up ")):p("",!0),E.value==="box"?(n(),i("span",la," ✓ Box ")):p("",!0),!T.value.rear_door&&!E.value?(n(),i("span",ra," Pilih jenis kendaraan agar point bisa menyesuaikan dengan tipe kendaraan anda ")):p("",!0)])])])])]),t("div",ua,[d[18]||(d[18]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",da,[Ee(t("input",{"onUpdate:modelValue":d[8]||(d[8]=j=>F.value=j),type:"text",placeholder:"Cari atau ketik nama mobil...",class:me(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":c.value}]),onInput:A,onFocus:d[9]||(d[9]=j=>J.value=!0),onBlur:Z},null,34),[[Fe,F.value]]),P.value?(n(),i("div",ca,d[16]||(d[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):p("",!0),J.value?(n(),i("div",ga,[oe.value.length>0?(n(),i("div",ma,[(n(!0),i(Ve,null,Ue(oe.value,j=>(n(),i("div",{key:j.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:se=>ee(j)},[t("div",va,z(f(j)),1),t("div",fa,z(j.year)+" • "+z(j.cc)+"cc • "+z(j.transmission)+" • "+z(j.fuel_type),1)],40,pa))),128))])):(n(),i("div",ha,d[17]||(d[17]=[Ce(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),Ce(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):p("",!0)]),c.value?(n(),i("span",ba,"Nama mobil tidak boleh kosong.")):p("",!0)]),!Ne(r).car_id&&F.value&&!J.value?(n(),i("div",ya,d[19]||(d[19]=[Rt('<div class="flex items-start" data-v-9712cec1><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-9712cec1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-9712cec1></path></svg><div data-v-9712cec1><p class="text-yellow-800 font-medium mb-1" data-v-9712cec1>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-9712cec1> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-9712cec1>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-9712cec1> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-9712cec1> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-9712cec1>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-9712cec1>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):p("",!0),Ne(r).car_id&&N.value?(n(),i("div",xa,[N.value.description?(n(),i("div",wa,[d[20]||(d[20]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:N.value.description},null,8,ka)])):p("",!0),m.value.length>0?(n(),i("div",Ia,[d[21]||(d[21]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",_a,[(n(!0),i(Ve,null,Ue(m.value,(j,se)=>(n(),i("div",{key:j.id||se,class:"relative group cursor-pointer",onClick:de=>fe(se)},[t("img",{src:ce(j),alt:j.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,$a),j.note?(n(),i("div",Ca,[t("p",Va,z(j.note),1)])):p("",!0)],8,Sa))),128))])])):(n(),i("div",Aa," Tidak ada gambar tersedia untuk mobil ini "))])):p("",!0),x.value?(n(),i("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Ie},[t("div",Ta,[t("button",{onClick:Ie,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},d[22]||(d[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),m.value.length>1?(n(),i("button",{key:0,onClick:ze(ke,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},d[23]||(d[23]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):p("",!0),m.value.length>1?(n(),i("button",{key:1,onClick:ze($e,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},d[24]||(d[24]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):p("",!0),t("img",{src:ce(m.value[R.value]),alt:"Car Image "+(R.value+1),class:"max-w-full max-h-full object-contain",onClick:d[10]||(d[10]=ze(()=>{},["stop"]))},null,8,Ma),m.value.length>1?(n(),i("div",Ua,z(R.value+1)+" / "+z(m.value.length),1)):p("",!0),(K=m.value[R.value])!=null&&K.note?(n(),i("div",Na,z(m.value[R.value].note),1)):p("",!0)])])):p("",!0),Me(qt,{type:"button",onClick:Pe,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!M.value},{default:De(()=>[Ne(r).processing?(n(),i("svg",Pa,d[25]||(d[25]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),t("span",null,z(Ne(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),Me(Ot,{on:Ne(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:De(()=>d[26]||(d[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),Ce(" Tersimpan. ")])),_:1,__:[26]},8,["on"])]),_:1},8,["disabled"])])):p("",!0)])}}},Zo=Re(Ea,[["__scopeId","data-v-9712cec1"]]),Da={class:"mt-1"},La=["value","required","minlength","maxlength","allowSpace","placeholder"],Ra={key:0,class:"mt-2 text-sm text-red-600"},Ut={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(s,{emit:le}){const e=s,_=le,r=ue(()=>{if(!e.modelValue)return"";let b=e.modelValue;switch(e.allowSpace||(b=b.replace(/\s+/g,"")),e.textTransform){case"uppercase":return b.toUpperCase();case"lowercase":return b.toLowerCase();case"capitalize":return b.replace(/\b\w/g,S=>S.toUpperCase());default:return b}}),$=b=>{let S=b.target.value;switch(e.allowSpace||(S=S.replace(/\s+/g,"")),e.textTransform){case"uppercase":S=S.toUpperCase();break;case"lowercase":S=S.toLowerCase();break;case"capitalize":S=S.replace(/\b\w/g,w=>w.toUpperCase());break}_("update:modelValue",S),_("save",e.pointId)};return(b,S)=>(n(),i("div",Da,[t("input",{value:r.value,onInput:$,type:"text",required:s.required,minlength:s.minLength,maxlength:s.maxLength,allowSpace:s.allowSpace,placeholder:s.placeholder,class:me(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:s.textTransform==="uppercase",lowercase:s.textTransform==="lowercase",capitalize:s.textTransform==="capitalize"}])},null,42,La),s.error?(n(),i("p",Ra,z(s.error),1)):p("",!0)]))}},ja={class:"mt-1"},Fa=["value","required","min","max"],Ba={key:0,class:"mt-2 text-sm text-red-600"},Nt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:le}){const e=s,_=le,r=$=>{_("update:modelValue",$.target.value),_("save",e.pointId)};return($,b)=>(n(),i("div",ja,[t("input",{value:s.modelValue,onChange:r,type:"date",required:s.required,min:s.minDate,max:s.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Fa),s.error?(n(),i("p",Ba,z(s.error),1)):p("",!0)]))}},qa={class:"mt-1"},Oa=["value","required","placeholder"],za={key:0,class:"mt-2 text-sm text-red-600"},Pt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(s,{emit:le}){const e=s,_=le,r=V(""),$=ue(()=>{var h,E,T,W;return{currency_symbol:((h=e.settings)==null?void 0:h.currency_symbol)||"Rp",thousands_separator:((E=e.settings)==null?void 0:E.thousands_separator)||",",min_value:((T=e.settings)==null?void 0:T.min_value)!==void 0?Number(e.settings.min_value):0,max_value:((W=e.settings)==null?void 0:W.max_value)!==void 0?Number(e.settings.max_value):1e9}}),b=h=>{if(h==null||h==="")return"";const E=Number(h);if(isNaN(E))return"";let T=E.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return $.value.thousands_separator!==","&&(T=T.replace(/,/g,$.value.thousands_separator)),T},S=h=>h?h.replace(/[^\d]/g,""):"",w=ue(()=>r.value?`${$.value.currency_symbol} ${b(r.value)}`:""),L=h=>{let E=S(h.target.value),T=Number(E);$.value.min_value!==void 0&&T<$.value.min_value&&(E=$.value.min_value.toString()),$.value.max_value!==void 0&&T>$.value.max_value&&(E=$.value.max_value.toString()),r.value=E,_("update:modelValue",E),_("save",e.pointId)};return ye(()=>e.modelValue,h=>{h!=null&&(r.value=h.toString())},{immediate:!0}),(h,E)=>(n(),i("div",qa,[t("input",{value:w.value,onInput:L,type:"text",required:s.required,placeholder:s.placeholder,class:me(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",s.error?"border-red-300":"border-gray-300"])},null,42,Oa),s.error?(n(),i("p",za,z(s.error),1)):p("",!0)]))}},Ha={class:"mt-1 space-y-3"},Ka={key:0,class:"space-y-2"},Ga={class:"flex flex-wrap gap-2"},Wa=["onClick"],Za=["value","required","minlength","maxlength","placeholder"],Xa={class:"flex justify-between items-center mt-1"},Ya={class:"text-xs text-gray-500"},Ja={key:0,class:"text-xs text-red-600"},Et={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(s,{emit:le}){const e=s,_=le,r=V([]),$=V(""),b=h=>r.value.some(E=>E.value===h),S=h=>{b(h.value)?r.value=r.value.filter(te=>te.value!==h.value):r.value.push(h);const T=[...r.value.map(te=>te.value)];$.value.trim()&&T.push($.value.trim());const W=T.join(", ");_("update:modelValue",W),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:W})},w=h=>{const E=h.target.value;_("update:modelValue",E),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:E}),L(E)},L=h=>{var te,ne,F,J;if(!h){r.value=[],$.value="";return}const E=h.split(",").map(P=>P.trim()).filter(P=>P),T=((ne=(te=e.settings)==null?void 0:te.damage_options)==null?void 0:ne.map(P=>P.value))||[];r.value=((J=(F=e.settings)==null?void 0:F.damage_options)==null?void 0:J.filter(P=>E.includes(P.value)))||[];const W=E.filter(P=>!T.includes(P));$.value=W.join(", ")};return ye(()=>e.modelValue,h=>{h!=null&&L(h)},{immediate:!0}),ye(()=>{var h;return(h=e.settings)==null?void 0:h.damage_options},(h,E)=>{if(h!==E){const T=h?h.map(F=>F.value):[];r.value=r.value.filter(F=>T.includes(F.value));const te=[...r.value.map(F=>F.value)];$.value.trim()&&te.push($.value.trim());const ne=te.filter(F=>F).join(", ");_("update:modelValue",ne),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:ne})}},{deep:!0,immediate:!1}),(h,E)=>{var T,W,te;return n(),i("div",Ha,[(T=s.settings)!=null&&T.enable_damage&&((W=s.settings)!=null&&W.damage_options)?(n(),i("div",Ka,[E[0]||(E[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",Ga,[(n(!0),i(Ve,null,Ue(s.settings.damage_options,(ne,F)=>(n(),i("button",{key:F,type:"button",onClick:J=>S(ne),class:me(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":b(ne.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!b(ne.value)}])},z(ne.label),11,Wa))),128))])])):p("",!0),t("div",null,[t("textarea",{value:s.modelValue,onInput:w,required:s.required,minlength:s.minLength,maxlength:s.maxLength,placeholder:s.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Za),t("div",Xa,[t("span",Ya,z(((te=s.modelValue)==null?void 0:te.length)||0)+"/"+z(s.maxLength||400),1),s.error?(n(),i("p",Ja,z(s.error),1)):p("",!0)])])])}}},Qa={class:"mt-1"},es=["value","required"],ts={key:0,class:"mt-2 text-sm text-red-600"},as={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(s,{emit:le}){const e=s,_=le,r=$=>{_("update:modelValue",$.target.value),_("save",e.pointId)};return($,b)=>(n(),i("div",Qa,[t("select",{value:s.modelValue,onChange:r,required:s.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},b[0]||(b[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,es),s.error?(n(),i("p",ts,z(s.error),1)):p("",!0)]))}},ss=Re(as,[["__scopeId","data-v-1b6c0201"]]),ns={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},is={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},os={class:"text-xs text-gray-500 mt-2 text-center"},ls={class:"flex flex-row space-x-4 mb-6"},rs={class:"mt-4 text-right"},us={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(s){return(le,e)=>s.show?(n(),i("div",ns,[t("div",is,[e[7]||(e[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",os,[e[3]||(e[3]=Ce("Ambil Foto Maksimal: ")),t("b",null,z(s.settings.max_files),1),e[4]||(e[4]=Ce(" Dengan Rasio & Ukuran: ")),t("b",null,z(s.settings.camera_aspect_ratio),1)]),t("div",ls,[t("button",{onClick:e[0]||(e[0]=_=>le.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-blue-50 hover:border-blue-400 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-blue-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Ambil Foto",-1)])),t("button",{onClick:e[1]||(e[1]=_=>le.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",rs,[t("button",{onClick:e[2]||(e[2]=_=>le.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):p("",!0)}},ds={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},cs={class:"w-full h-full flex flex-col"},gs={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ms=["disabled"],ps={class:"text-lg font-semibold"},vs={class:"flex items-center gap-2"},fs=["disabled"],hs={key:0,class:"px-4 py-2 bg-indigo-900 text-white"},bs={class:"flex justify-between items-center text-sm"},ys={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},xs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},ws=["src"],ks={key:1,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3"},Is=["disabled"],_s=["disabled"],Ss={key:2,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},$s={key:3,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},Cs=["disabled"],Vs=["disabled"],As=["disabled"],Ts={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ms={class:"flex justify-between items-center w-full"},Us=["disabled"],Ns={key:1,class:"flex-1"},Ps=["disabled"],Es={class:"flex gap-3 w-full"},Ds={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},Ls={class:"flex items-center gap-2"},Rs={key:0,class:"text-center"},js={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(s,{emit:le}){const e=s,_=le,r=V(0),$=V([]),b=ue(()=>$.value.length>0?$.value[r.value]:null);ye(()=>e.images,J=>{$.value=J.map(P=>({...P,rotation:P.isNew&&P.rotation||0})),J.length===0&&e.show&&T()},{deep:!0,immediate:!0}),ye(()=>e.show,J=>{J&&e.images.length>0&&(r.value=e.initialIndex)}),ye(()=>e.uploadProgress,J=>{J===100&&console.log("Upload completed")});const S=J=>J.preview||(J.image_path?`/${J.image_path}`:""),w=J=>{if(b.value&&b.value.isNew&&!e.isUploading){const P=b.value.rotation||0;let oe;J==="left"?oe=P-90:oe=P+90,oe=(oe%360+360)%360,$.value[r.value].rotation=oe,_("update:images",$.value)}},L=()=>{e.isUploading||(r.value=r.value<$.value.length-1?r.value+1:0)},h=()=>{e.isUploading||(r.value=r.value>0?r.value-1:$.value.length-1)},E=()=>{e.isUploading||_("saveImages",$.value)},T=()=>{e.isUploading||_("close")},W=()=>{if(b.value&&!e.isUploading){const J=b.value,P=$.value.findIndex(oe=>oe.isNew&&J.isNew&&oe.preview===J.preview||!oe.isNew&&!J.isNew&&oe.id===J.id);P!==-1&&(_("removePreviewImage",J),$.value.splice(P,1),_("update:images",$.value)),r.value>=$.value.length&&(r.value=Math.max(0,$.value.length-1)),$.value.length===0&&_("close")}},te=()=>{e.isUploading||_("triggerAddMorePhotos")},ne=()=>{b.value&&!e.isUploading&&_("retryImage",b.value)},F=J=>{J.key==="Escape"&&!e.isUploading&&T()};return je(()=>{document.addEventListener("keydown",F)}),Be(()=>{document.removeEventListener("keydown",F)}),(J,P)=>{var oe;return s.show?(n(),i("div",ds,[t("div",cs,[t("div",gs,[t("button",{onClick:T,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:s.isUploading},P[2]||(P[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ms),t("div",ps,z(((oe=s.point)==null?void 0:oe.name)||"Preview")+" ("+z(r.value+1)+"/"+z($.value.length)+") ",1),t("div",vs,[b.value&&b.value.isNew?(n(),i("button",{key:0,onClick:W,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:s.isUploading},P[3]||(P[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,fs)):p("",!0)])]),s.isUploading?(n(),i("div",hs,[t("div",bs,[t("span",null,"Mengupload: "+z(s.currentUpload)+"/"+z(s.totalUpload),1),t("span",null,z(s.uploadProgress)+"%",1)]),t("div",ys,[t("div",{class:"bg-gradient-to-r from-indigo-500 to-sky-400 h-2 rounded-full progress-bar",style:Le({width:s.uploadProgress+"%"})},null,4)])])):p("",!0),t("div",xs,[t("div",{class:"relative w-full max-w-full",style:Le({paddingTop:s.aspectRatio?100/s.aspectRatio+"%":"75%"})},[b.value?(n(),i("img",{key:0,src:S(b.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Le({transform:`rotate(${b.value.rotation}deg)`})},null,12,ws)):p("",!0),b.value&&b.value.isNew&&!b.value.isUploading&&!b.value.isFailed?(n(),i("div",ks,[t("button",{onClick:P[0]||(P[0]=N=>w("left")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:s.isUploading,title:"Putar ke kiri"},P[4]||(P[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9",transform:"rotate(180 12 12)"})],-1)]),8,Is),t("button",{onClick:P[1]||(P[1]=N=>w("right")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:s.isUploading,title:"Putar ke kanan"},P[5]||(P[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9"})],-1)]),8,_s)])):p("",!0),b.value&&b.value.isUploading?(n(),i("div",Ss,P[6]||(P[6]=[t("div",{class:"text-center text-white"},[t("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t("p",{class:"text-sm"},"Mengupload...")],-1)]))):p("",!0),b.value&&b.value.isFailed?(n(),i("div",$s,[P[7]||(P[7]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),P[8]||(P[8]=t("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),t("button",{onClick:ne,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:s.isUploading}," Coba Lagi ",8,Cs)])):p("",!0)],4),$.value.length>1&&!s.isUploading?(n(),i("button",{key:0,onClick:h,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:s.isUploading},P[9]||(P[9]=[t("svg",{xmlns:"http://www.w3.org2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Vs)):p("",!0),$.value.length>1&&!s.isUploading?(n(),i("button",{key:1,onClick:L,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:s.isUploading},P[10]||(P[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,As)):p("",!0)]),t("div",Ts,[t("div",Ms,[b.value&&!b.value.isNew?(n(),i("button",{key:0,onClick:W,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:s.isUploading},P[11]||(P[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ce(" Hapus Foto ")]),8,Us)):(n(),i("div",Ns)),s.allowMultiple&&$.value.length<s.maxFiles&&!s.isUploading?(n(),i("button",{key:2,onClick:te,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:s.isUploading},P[12]||(P[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Ce(" Tambah Foto ")]),8,Ps)):p("",!0)]),t("div",Es,[s.isUploading?(n(),i("button",Ds,[t("div",Ls,[P[13]||(P[13]=t("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),t("span",null,"Mengupload... "+z(s.uploadProgress)+"%",1)])])):(n(),i("button",{key:0,onClick:E,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),s.isUploading?(n(),i("div",Rs,P[14]||(P[14]=[t("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):p("",!0)])])])):p("",!0)}}},Fs=Re(js,[["__scopeId","data-v-0e4bb6d9"]]),Bs={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},qs={class:"webcam-content-box"},Os={class:"webcam-header"},zs={class:"inspection-point-name"},Hs={class:"camera-quality-indicator"},Ks={class:"quality-badge"},Gs={key:1,class:"auto-focus-indicator"},Ws={key:2,class:"error-overlay"},Zs={class:"error-content"},Xs={class:"error-message"},Ys={class:"webcam-footer"},Js={class:"camera-controls"},Qs=["disabled"],en={class:"camera-icon-container"},tn={key:0,class:"camera-spinner"},an={key:1,class:"camera-shutter"},sn=["disabled"],nn={__name:"WebCamRTC",props:{show:Boolean,aspectRatio:{type:Number,default:4/3},settings:{type:Object,default:()=>({enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object,cameraQuality:{type:String}},emits:["close","photoCaptured"],setup(s,{emit:le}){const e=s,_=le,r=V(null),$=V(null);let b=null,S=null;const w=V("environment"),L=V(null),h=V([]),E=V(!1),T=V(!1),W=V(!1),te=V(!1),ne=V(!1),F=V(null),J=V(null),P=V(!1),oe=V(!0),N=V({}),m=ue(()=>({aspectRatio:`${e.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"})),x=async()=>{b&&b.getTracks().forEach(o=>o.stop()),F.value=null,ne.value=!0;try{const o=R();console.log("Mencoba inisialisasi kamera dengan:",o),b=await navigator.mediaDevices.getUserMedia({video:o,audio:!1}),S=b.getVideoTracks()[0],r.value.srcObject=b,await new Promise((k,M)=>{r.value.onloadedmetadata=k,r.value.onerror=M,setTimeout(k,1e3)}),await r.value.play(),await O(),ie(),setTimeout(async()=>{try{await Q()}catch(k){console.warn("Gagal mendapatkan daftar perangkat:",k)}},500),ne.value=!1,console.log("Kamera berhasil diinisialisasi")}catch(o){if(console.error("Error mengakses kamera: ",o),!b)try{console.log("Mencoba fallback berdasarkan kualitas kamera...");let k,M,f,q;switch(e.cameraQuality){case"SD":k=1280,M=720,f=640,q=480;break;case"HD":k=1920,M=1080,f=1280,q=720;break;case"4K":k=3840,M=2160,f=1920,q=1080;break;default:k=1920,M=1080,f=1280,q=720}const A={video:{facingMode:w.value,width:{min:f,ideal:k},height:{min:q,ideal:M}}};b=await navigator.mediaDevices.getUserMedia(A),S=b.getVideoTracks()[0],r.value.srcObject=b,await r.value.play(),ne.value=!1,console.log("Fallback berhasil dengan kualitas:",e.cameraQuality)}catch(k){console.error("Fallback juga gagal:",k),F.value=Y(k),ne.value=!1}}},R=()=>{let o,k,M,f,q,A;switch(e.cameraQuality){case"SD":o=1280,k=720,M=1280,f=720,q=640,A=480;break;case"HD":o=1920,k=1080,M=1920,f=1080,q=1280,A=720;break;case"4K":o=3840,k=2160,M=3840,f=2160,q=1920,A=1080;break;default:o=1920,k=1080,M=1920,f=1080,q=1280,A=720}return{facingMode:{ideal:"environment"},width:{ideal:o,max:M,min:q},height:{ideal:k,max:f,min:A},focusMode:{ideal:["continuous","single-shot","manual"]},exposureMode:{ideal:["continuous","manual"]},whiteBalanceMode:{ideal:["continuous","manual"]}}},ie=async()=>{if(S)try{const o=S.getCapabilities();J.value=o;const k=o.focusMode&&(o.focusMode.includes("continuous")||o.focusMode.includes("single-shot")),M=o.exposureMode&&o.exposureMode.includes("continuous");if(k||M){const f={};k&&(f.focusMode="continuous"),M&&(f.exposureMode="continuous",f.exposureCompensation={ideal:0}),Object.keys(f).length>0&&(await S.applyConstraints({advanced:[f]}),console.log("Auto-focus/exposure diaktifkan"))}T.value=!!o.torch||!!o.fillLightMode}catch(o){console.warn("Tidak bisa mengatur auto-focus/exposure:",o)}},Q=async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(M=>M.stop());const k=await navigator.mediaDevices.enumerateDevices();if(h.value=k.filter(M=>M.kind==="videoinput"),E.value=h.value.length>1,!L.value&&h.value.length>0){const M=h.value.find(f=>f.label.toLowerCase().includes("back")||f.label.toLowerCase().includes("rear")||f.label.toLowerCase().includes("environment"));L.value=M?M.deviceId:h.value[0].deviceId}}catch(o){console.warn("Error getting camera devices:",o)}},Y=o=>{switch(o.name){case"NotAllowedError":return"Izin akses kamera ditolak. Silakan izinkan akses kamera di pengaturan browser.";case"NotFoundError":return"Tidak ada kamera yang ditemukan.";case"NotSupportedError":return"Browser tidak mendukung akses kamera.";case"NotReadableError":return"Kamera sedang digunakan oleh aplikasi lain.";case"OverconstrainedError":return"Perangkat tidak mendukung pengaturan kamera yang diminta.";default:return`Tidak dapat mengakses kamera: ${o.message}`}},O=()=>{var o,k;if(S)try{const M=S.getCapabilities();J.value=M,T.value=!!M.torch||!!M.fillLightMode,console.log("Kamera mendukung:",{maxRes:`${((o=M.width)==null?void 0:o.max)||"N/A"}x${((k=M.height)==null?void 0:k.max)||"N/A"}`,torch:M.torch,focusModes:M.focusMode,exposureModes:M.exposureMode})}catch(M){console.warn("Tidak bisa mendapatkan kemampuan kamera:",M)}},D=async()=>{if(!(!S||!T.value))try{w.value==="environment"?(await S.applyConstraints({advanced:[{torch:!W.value}]}),W.value=!W.value):(console.log("Flash tidak didukung untuk kamera depan"),W.value=!1)}catch(o){console.error("Gagal mengontrol flash:",o),W.value=!1}},G=async()=>{if(!E.value||ne.value)return;ne.value=!0,b&&b.getTracks().forEach(f=>f.stop());const k=(h.value.findIndex(f=>f.deviceId===L.value)+1)%h.value.length;L.value=h.value[k].deviceId;const M=h.value[k];w.value=M.label.toLowerCase().includes("front")?"user":"environment",await x()},ae=async o=>{if(!r.value||!S)return;const k=o.currentTarget.getBoundingClientRect(),M=o.type.includes("mouse")?o.clientX-k.left:o.touches[0].clientX-k.left,f=o.type.includes("mouse")?o.clientY-k.top:o.touches[0].clientY-k.top;P.value=!0,N.value={left:`${M-40}px`,top:`${f-40}px`},setTimeout(()=>{P.value=!1},1e3);try{const q=S.getCapabilities();if(q.focusMode&&q.focusMode.includes("manual")){const A=M/k.width,Z=f/k.height;q.focusDistance&&q.pan&&q.tilt&&await S.applyConstraints({advanced:[{focusMode:"manual",focusDistance:.3,pointsOfInterest:[{x:A,y:Z}]}]})}else q.focusMode&&q.focusMode.includes("single-shot")&&await S.applyConstraints({advanced:[{focusMode:"single-shot"}]})}catch(q){console.warn("Penyesuaian fokus tidak didukung:",q)}},I=async()=>{var o,k;if(!(te.value||!r.value||!$.value)){te.value=!0;try{const M=r.value,f=$.value;await new Promise(ke=>setTimeout(ke,100));const q=M.videoWidth,A=M.videoHeight;let Z,ee,ce,ge;q/A>e.aspectRatio?(ee=A,Z=A*e.aspectRatio,ce=(q-Z)/2,ge=0):(Z=q,ee=q/e.aspectRatio,ce=0,ge=(A-ee)/2),f.width=Z,f.height=ee,f.getContext("2d").drawImage(M,ce,ge,Z,ee,0,0,Z,ee);const Ie=Math.min(.95,.7+q*A/(3840*2160)*.25),$e=await new Promise(ke=>{f.toBlob(ke,"image/jpeg",Ie)});if($e)if($e.size/1024>e.settings.max_size){const ke=await u($e,e.settings.max_size),Ae=`inspeksi_${((o=e.point)==null?void 0:o.name)||"foto"}_${Date.now()}.jpg`,Te=new File([ke],Ae,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",Te)}else{const ke=`inspeksi_${((k=e.point)==null?void 0:k.name)||"foto"}_${Date.now()}.jpg`,Ae=new File([$e],ke,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",Ae)}}catch(M){console.error("Error mengambil foto:",M)}finally{te.value=!1}}},u=async(o,k)=>new Promise(M=>{const f=new Image;f.onload=()=>{const q=document.createElement("canvas");let A=f.width,Z=f.height;const ee=1920;(A>ee||Z>ee)&&(A>Z?(Z=Z*ee/A,A=ee):(A=A*ee/Z,Z=ee)),q.width=A,q.height=Z,q.getContext("2d").drawImage(f,0,0,A,Z);let ge=.9;const fe=()=>{q.toBlob(Ie=>{Ie.size/1024<=k||ge<=.3?M(Ie):(ge-=.1,fe())},"image/jpeg",ge)};fe()},f.src=URL.createObjectURL(o)}),c=()=>{b&&b.getTracks().forEach(o=>o.stop()),_("close")},a=async()=>{F.value=null,await x()};return ye(()=>e.show,async o=>{o?(await Ge(),await x()):b&&b.getTracks().forEach(k=>k.stop())}),Be(()=>{b&&b.getTracks().forEach(o=>o.stop())}),(o,k)=>{var M;return s.show?(n(),i("div",Bs,[t("div",qs,[t("div",Os,[t("div",zs,z(((M=s.point)==null?void 0:M.name)||"Camera"),1),t("div",Hs,[t("span",Ks,z(s.cameraQuality),1)]),t("button",{onClick:c,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},k[0]||(k[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Le(m.value),onTouchstart:ae,onClick:ae},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:$,class:"hidden"},null,512),P.value?(n(),i("div",{key:0,class:"focus-indicator",style:Le(N.value)},k[1]||(k[1]=[t("div",{class:"focus-ring"},null,-1)]),4)):p("",!0),oe.value&&!P.value?(n(),i("div",Gs,k[2]||(k[2]=[t("div",{class:"auto-focus-ring"},null,-1)]))):p("",!0),F.value?(n(),i("div",Ws,[t("div",Zs,[k[3]||(k[3]=t("div",{class:"error-icon"},"⚠️",-1)),k[4]||(k[4]=t("h3",{class:"error-title"},"Gagal Mengakses Kamera",-1)),t("p",Xs,z(F.value),1),t("button",{onClick:a,class:"retry-button"}," Coba Lagi ")])])):p("",!0)],36),t("div",Ys,[t("div",Js,[s.settings.enable_flash&&T.value?(n(),i("button",{key:0,onClick:D,class:me(["control-button flash-button",{active:W.value}])},k[5]||(k[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):p("",!0),t("button",{onClick:I,class:"capture-button",disabled:te.value||ne.value},[t("div",en,[te.value?(n(),i("div",tn)):(n(),i("div",an))])],8,Qs),s.settings.enable_camera_switch&&E.value?(n(),i("button",{key:1,onClick:G,class:"control-button switch-button",disabled:ne.value},k[6]||(k[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]),8,sn)):p("",!0)])])])])):p("",!0)}}},on=Re(nn,[["__scopeId","data-v-472cc13f"]]),ln={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},rn={class:"webcam-content-box"},un={class:"webcam-header"},dn={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},cn={class:"inspection-point-name"},gn={key:0,class:"screen-flash-overlay"},mn={key:2,class:"zoom-controls"},pn=["max"],vn={class:"webcam-footer"},fn={class:"camera-controls"},hn=["disabled"],bn={class:"camera-icon-container"},yn={key:0,class:"camera-spinner"},xn={key:1,class:"camera-body"},wn={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(s,{emit:le}){const e=s,_=le,r=V(null),$=V(null);let b=null,S=null;const w=V("environment"),L=V(!1),h=V(!1),E=V(!1),T=V(!1),W=V(!1),te=V({}),ne=V(!1),F=V(1),J=V(1),P=V(!1),oe=ue(()=>{var I;return((I=e.settings)==null?void 0:I.max_size)||2048}),N=ue(()=>e.aspectRatio?{aspectRatio:`${e.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),m=ue(()=>{if(!e.aspectRatio)return{};const I=e.aspectRatio,u=I>1?80:60,c=I>1?80/I:60*I;return{width:`${u}%`,height:`${c}%`}}),x=async()=>{b&&b.getTracks().forEach(I=>I.stop());try{const I={facingMode:w.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:e.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};b=await navigator.mediaDevices.getUserMedia({video:I,audio:!1}),S=b.getVideoTracks()[0],r.value.srcObject=b,r.value.onloadedmetadata=async()=>{await ie(),await r.value.play()}}catch(I){console.error("Error accessing camera: ",I),alert("Failed to access camera. Please allow camera permission."),_("close")}},R=()=>{b&&b.getTracks().forEach(I=>I.stop()),_("close")},ie=async()=>{if(S)try{const I=await navigator.mediaDevices.enumerateDevices();L.value=I.filter(c=>c.kind==="videoinput").length>1;const u=S.getCapabilities();u.zoom?(P.value=!0,J.value=u.zoom.max,console.log(`Zoom supported. Max zoom: ${J.value}`)):(P.value=!1,console.warn("Zoom is not supported by this camera.")),h.value=u.torch||u.fillLightMode&&u.fillLightMode.includes("torch")}catch(I){console.error("Error checking camera capabilities:",I)}},Q=async I=>{if(!S)return;const u=r.value.getBoundingClientRect(),c=I.clientX-u.left,a=I.clientY-u.top;W.value=!0,te.value={left:`${c}px`,top:`${a}px`,transform:"translate(-50%, -50%)"};try{if(S.getCapabilities().pointsOfInterest){const k=c/u.width,M=a/u.height;await S.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:k,y:M}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(o){console.warn("Manual focus failed:",o)}setTimeout(()=>{W.value=!1,S.getCapabilities().focusMode.includes("continuous")&&S.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},Y=async I=>{if(!S||!P.value)return;const u=Math.min(Math.max(I,1),J.value);F.value=u;try{await S.applyConstraints({advanced:[{zoom:u}]})}catch(c){console.error("Failed to set zoom:",c)}},O=async()=>{if(!(!S||!h.value))try{w.value==="user"?(E.value=!E.value,T.value=E.value):(await S.applyConstraints({advanced:[{torch:!E.value}]}),E.value=!E.value)}catch(I){console.error("Flash toggle failed:",I)}},D=async()=>{L.value&&(w.value=w.value==="environment"?"user":"environment",b&&b.getTracks().forEach(I=>I.stop()),await x())},G=async I=>new Promise(u=>{const c=oe.value*1024;if(I.size<=c){u(I);return}const a=new Image,o=new FileReader;o.onload=k=>{a.onload=()=>{const M=document.createElement("canvas"),f=M.getContext("2d"),q=Math.sqrt(c/I.size);M.width=a.width*q,M.height=a.height*q,f.drawImage(a,0,0,M.width,M.height);let A=.9;const Z=()=>{M.toBlob(ee=>{ee.size>c&&A>.1?(A-=.1,Z()):u(ee)},"image/jpeg",A)};Z()},a.src=k.target.result},o.readAsDataURL(I)}),ae=async()=>{if(!(ne.value||!r.value||!$.value)){ne.value=!0;try{const I=r.value,u=$.value,c=I.videoWidth,a=I.videoHeight;let o,k,M,f;c/a>e.aspectRatio?(k=a,o=a*e.aspectRatio,M=(c-o)/2,f=0):(o=c,k=c/e.aspectRatio,M=0,f=(a-k)/2),u.width=o,u.height=k,u.getContext("2d").drawImage(I,M,f,o,k,0,0,o,k);const A=await new Promise(ee=>{u.toBlob(ee,"image/jpeg",1)}),Z=await G(A);if(Z){const ee=new File([Z],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",ee),T.value=!0,setTimeout(()=>{T.value=!1},100)}}catch(I){console.error("Error capturing photo:",I),alert("Failed to capture photo. Please try again.")}finally{ne.value=!1}}};return ye(()=>e.show,I=>{I?x():R()}),Be(()=>{b&&b.getTracks().forEach(I=>I.stop())}),(I,u)=>{var c;return s.show?(n(),i("div",ln,[t("div",rn,[t("div",un,[t("p",dn,z(s.settings.camera_aspect_ratio),1),t("div",cn,z(((c=s.point)==null?void 0:c.name)||"Camera"),1),t("button",{onClick:R,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},u[2]||(u[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Le(N.value),onClick:Q,onTouchstart:Q},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:$,class:"hidden"},null,512),T.value?(n(),i("div",gn)):p("",!0),t("div",{class:"aspect-ratio-guide",style:Le(m.value)},null,4),W.value?(n(),i("div",{key:1,class:"focus-indicator",style:Le(te.value)},u[3]||(u[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):p("",!0),u[4]||(u[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),P.value?(n(),i("div",mn,[Ee(t("input",{type:"range",min:"1",max:J.value,step:"0.1","onUpdate:modelValue":u[0]||(u[0]=a=>F.value=a),onInput:u[1]||(u[1]=a=>Y(parseFloat(a.target.value))),class:"zoom-slider"},null,40,pn),[[Fe,F.value]])])):p("",!0)],36),t("div",vn,[t("div",fn,[s.settings.enable_flash&&h.value?(n(),i("button",{key:0,onClick:O,class:me(["control-button",{active:E.value,disabled:!h.value}])},u[5]||(u[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):p("",!0),t("button",{onClick:ae,class:"capture-button",disabled:ne.value},[t("div",bn,[ne.value?(n(),i("div",yn)):(n(),i("div",xn,u[6]||(u[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,hn),s.settings.enable_camera_switch&&L.value?(n(),i("button",{key:1,onClick:D,class:"control-button"},u[7]||(u[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):p("",!0)])])])])):p("",!0)}}},kn=Re(wn,[["__scopeId","data-v-d307c818"]]),In={__name:"NativeCameraInput",emits:["photoCaptured"],setup(s,{expose:le,emit:e}){const _=e,r=V(null);le({openCamera:()=>{var S;(S=r.value)==null||S.click()}});const b=async S=>{var L;const w=(L=S.target.files)==null?void 0:L[0];w&&(_("directPhotoCaptured",w),S.target.value="")};return(S,w)=>(n(),i("input",{ref_key:"cameraInput",ref:r,type:"file",accept:"image/*",capture:"environment",class:"hidden",onChange:b},null,544))}},_n=["accept","multiple","disabled"],Sn={class:"text-xs text-gray-500 mb-2"},$n=["disabled"],Cn={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Vn={class:"text-xs text-gray-400 mt-1"},An={key:0,class:"flex items-center gap-4"},Tn=["src"],Mn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Un=["disabled"],Nn={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},Pn=["disabled"],En=["onClick"],Dn=["src","onError"],Ln={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},Rn={key:0},jn={key:1,class:"ml-1"},Fn={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},Bn={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},qn={key:2,class:"mt-1 text-xs text-red-600"},On={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress","isUploading"],setup(s,{emit:le}){const e=s,_=le,r=V(null),$=V(null),b=V(null),S=V(!1),w=V(!1),L=V(!1),h=V([]),E=V(0),T=V(!1),W=V(!1),te=V(0),ne=V(0),F=V(0),J=We("imageSourceSetting",V("all")),P=We("cameraQualitySetting",V("HP_Native")),oe=`inspection-${e.inspectionId}-point-${e.pointId}-backup`,N=ue(()=>{var l;return Number((l=e.settings)==null?void 0:l.max_files)>1}),m=ue(()=>{var y;return(((y=e.settings)==null?void 0:y.allowed_types)||["jpg","png","jpeg"]).map(v=>`.${v}`).join(", ")}),x=ue(()=>{var v;const y=(((v=e.settings)==null?void 0:v.camera_aspect_ratio)||"3:4").split(":");if(y.length===2){const U=parseFloat(y[0]),B=parseFloat(y[1]);if(!isNaN(U)&&!isNaN(B)&&B!==0)return U/B}return 3/4}),R=ue(()=>{const l=[],y=new Set;for(const v of e.modelValue){if(!v||typeof v!="object"||v.id&&y.has(v.id))continue;v.id&&y.add(v.id);const U=ie(v);l.push({...U,rotation:U.rotation||0,isNew:!1,isUploaded:!0,isUploading:!1,isFailed:!1})}for(const v of h.value)v.id&&y.add(v.id),l.push({...v,isUploading:v.isUploading||!1,isFailed:v.isFailed||!1});return l}),ie=l=>{if(!l||typeof l!="object")return{};const y={...l};return["preview","public_url","original_url","optimized_url"].forEach(U=>{y[U]&&(y[U]=Q(y[U]))}),y.image_path&&(y.image_path=y.image_path.replace(/^storage\//,"")),y},Q=l=>{if(!l||typeof l!="string")return l;let y=l.replace(/\/storage\/storage\//g,"/storage/");return y=y.replace(/\/\/storage\/storage\//g,"/storage/"),y.startsWith("storage/")&&(y=`/${y}`),!y.startsWith("/")&&!y.startsWith("http")&&(y=`/storage/${y}`),y},Y=l=>{if(!l||typeof l!="object")return"";const y=O(l);return typeof y!="string"?"":y},O=l=>!l||typeof l!="object"?"":l.preview&&typeof l.preview=="string"?Q(l.preview):l.public_url&&typeof l.public_url=="string"?Q(l.public_url):l.original_url&&typeof l.original_url=="string"?Q(l.original_url):l.optimized_url&&typeof l.optimized_url=="string"?Q(l.optimized_url):l.image_path&&typeof l.image_path=="string"?`/storage/${l.image_path.replace(/^\/?storage\//,"")}`:l.path&&typeof l.path=="string"?`/storage/${l.path.replace(/^\/?storage\//,"")}`:"",D=l=>{W.value=!0;const y=G(l);if(y&&y!==Y(l)){const v=event==null?void 0:event.target;v&&(v.src=y)}},G=l=>{if(!l||typeof l!="object")return"";const y=["original_url","optimized_url","public_url","preview"];for(const v of y)if(l[v]&&typeof l[v]=="string")return Q(l[v]);return""},ae=()=>{L.value&&(L.value=!1),J.value==="camera"?u():J.value==="gallery"?I():S.value=!0},I=()=>{S.value=!1,$.value.click()},u=()=>{var l;S.value=!1,P.value==="HP_Native"?(l=r.value)==null||l.openCamera():w.value=!0},c=()=>{S.value=!1,R.value.length>0&&(L.value=!0)},a=()=>{w.value=!1,R.value.length>0&&(L.value=!0)},o=()=>{L.value=!1,T.value||(h.value.forEach(l=>{l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview)}),h.value=[])},k=l=>new Promise(y=>{const v=new FileReader;v.onload=U=>{const B=new Image;B.onload=()=>{y({file:l,preview:URL.createObjectURL(l),rotation:0,width:B.naturalWidth,height:B.naturalHeight,isNew:!0})},B.onerror=()=>{y({file:l,preview:URL.createObjectURL(l),rotation:0,width:0,height:0,isNew:!0})},B.src=U.target.result},v.readAsDataURL(l)}),M=l=>{var v,U;const y=l.name.split(".").pop().toLowerCase();return((U=(v=e.settings)==null?void 0:v.allowed_types)==null?void 0:U.includes(y))||!1},f=async l=>{const v=(e.settings.max_size||2048)*1024;return new Promise(U=>{const B=new Image,re=new FileReader;re.onload=g=>{B.onload=()=>{const d=document.createElement("canvas"),K=d.getContext("2d"),j=Math.max(B.width,B.height);d.width=j,d.height=j,K.fillStyle="white",K.fillRect(0,0,j,j);const se=(j-B.width)/2,de=(j-B.height)/2;K.drawImage(B,se,de,B.width,B.height);let pe=.9;const be=()=>{d.toBlob(xe=>{if(xe.size>v&&pe>.1)pe-=.1,be();else{const H=new File([xe],l.name,{type:"image/jpeg",lastModified:Date.now()});U(H)}},"image/jpeg",pe)};be()},B.src=g.target.result},re.readAsDataURL(l)})},q=async l=>{const y=Array.from(l.target.files);if(!y.length){S.value=!1,R.value.length>0&&(L.value=!0);return}try{const v=y.filter(K=>!M(K));if(v.length>0){const K=v.map(j=>j.name.split(".").pop()).join(", ");alert(`File type not allowed: ${K}. Allowed types: ${e.settings.allowed_types.join(", ")}`),l.target.value="";return}const U=R.value.length,B=e.settings.max_files-U,re=await Promise.all(y.slice(0,B).map(async K=>await f(K))),g=await Promise.all(re.map(k)),d=N.value?g:g.slice(0,1);N.value?h.value.push(...d):(h.value.forEach(K=>{K.preview&&K.preview.startsWith("blob:")&&URL.revokeObjectURL(K.preview)}),h.value=d),S.value=!1,d.length>0?(E.value=Math.max(0,R.value.length-d.length),L.value=!0):R.value.length>0&&(L.value=!0),l.target.value=""}catch{alert("Failed to process selected images. Please try again."),S.value=!1,R.value.length>0&&(L.value=!0)}},A=async l=>{const y=R.value.length;if(!N.value||y<e.settings.max_files)try{const v=await f(l),U=new Image;U.onload=()=>{const B={file:v,preview:URL.createObjectURL(v),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0};N.value?h.value.push(B):(h.value.forEach(re=>{re.preview&&re.preview.startsWith("blob:")&&URL.revokeObjectURL(re.preview)}),h.value=[B]),w.value=!1,S.value=!1,E.value=R.value.length-1,L.value=!0},U.src=URL.createObjectURL(v)}catch{alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${e.settings.max_files} files allowed.`),w.value=!1,S.value=!1,R.value.length>0&&(L.value=!0)},Z=async l=>{const y=R.value.length;if(!N.value||y<e.settings.max_files)try{const v=await f(l),U=new Image;U.onload=async()=>{const B={file:v,preview:URL.createObjectURL(v),rotation:0,width:U.naturalWidth,height:U.naturalHeight,isNew:!0,isUploading:!0,isFailed:!1};N.value?h.value.push(B):(h.value.forEach(re=>{re.preview&&re.preview.startsWith("blob:")&&URL.revokeObjectURL(re.preview)}),h.value=[B]),S.value=!1,await Pe(B)},U.src=URL.createObjectURL(v)}catch{alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${e.settings.max_files} files allowed.`),S.value=!1,R.value.length>0&&(L.value=!0)},ee=(l=0)=>{E.value=l,L.value=!0},ce=l=>new Promise(y=>{if(l.rotation===0||!b.value){if(!l.isNew&&!l.file){y({file:null,width:l.width,height:l.height,isOriginal:!0});return}y({file:l.file,width:l.width,height:l.height});return}const v=new Image;v.onload=async()=>{try{const U=b.value,B=U.getContext("2d"),re=v.width,g=v.height;let d,K;l.rotation===90||l.rotation===270?(d=g,K=re):(d=re,K=g),U.width=d,U.height=K,B.clearRect(0,0,U.width,U.height),B.translate(U.width/2,U.height/2),B.rotate(l.rotation*Math.PI/180),B.drawImage(v,-re/2,-g/2,re,g),B.setTransform(1,0,0,1,0,0);const j=await new Promise(pe=>{U.toBlob(pe,"image/jpeg",.9)}),se=new File([j],l.file?l.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),de=await f(se);y({file:de,width:d,height:K})}catch{y({file:l.file,width:l.width,height:l.height})}},v.onerror=()=>{y({file:l.file,width:l.width,height:l.height})},v.src=l.preview}),ge=l=>{try{const y={images:l.map(v=>{var U;return{fileName:((U=v.file)==null?void 0:U.name)||`image-${Date.now()}.jpg`,rotation:v.rotation||0,width:v.width||0,height:v.height||0,timestamp:Date.now()}}),inspectionId:e.inspectionId,pointId:e.pointId};localStorage.setItem(oe,JSON.stringify(y))}catch{}},fe=()=>{localStorage.removeItem(oe)},Ie=async l=>{T.value=!0;const y=[],v=[];if(!e.pointId){alert("Error: Point ID is missing. Cannot upload image."),T.value=!1;return}try{ge(l);for(const U of l){if(!U.isNew&&U.rotation===0&&U.id&&U.image_path){y.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:0,preview:U.preview,isUploaded:!0});continue}const{file:B,width:re,height:g,isOriginal:d}=await ce(U);if(d&&!U.isNew){y.push({id:U.id,image_path:U.image_path,width:U.width,height:U.height,rotation:U.rotation||0,preview:U.preview,isUploaded:!0});continue}B&&v.push({file:B,width:re,height:g,rotation:U.rotation||0,originalImage:U})}o(),v.length>0?await $e(v,y):(_("update:modelValue",y),_("save",e.pointId))}catch{alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{T.value=!1}},$e=async(l,y)=>{F.value=l.length,ne.value=0,te.value=0;const v=[...y];let U=0;try{for(let B=0;B<l.length;B++){const re=l[B],g=new FormData;g.append("inspection_id",e.inspectionId),g.append("point_id",e.pointId),g.append("images[]",re.file);const d=h.value.findIndex(K=>{var j;return K.preview===((j=re.originalImage)==null?void 0:j.preview)});d!==-1&&(h.value[d].isUploading=!0,h.value[d].isFailed=!1);try{const j=(await Oe.post(route("inspections.upload-image"),g,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:se=>{if(se.total){const de=Math.round(se.loaded*100/se.total);te.value=Math.round((B+se.loaded/se.total)/l.length*100),ne.value=B+1}}})).data.images;if(j&&j.length>0){const se=j[0];if(v.push({id:se.image_id,image_path:se.path,width:se.width||re.width||0,height:se.height||re.height||0,rotation:re.rotation||0,preview:se.public_url,isUploaded:!0}),d!==-1){const de=h.value.splice(d,1)[0];de.preview&&de.preview.startsWith("blob:")&&URL.revokeObjectURL(de.preview)}U++}}catch{d!==-1&&(h.value[d].isUploading=!1,h.value[d].isFailed=!0)}}U>0&&(_("update:modelValue",v),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:v,newImagesCount:U})),U===l.length&&fe()}catch{l.forEach(re=>{const g=h.value.findIndex(d=>{var K;return d.preview===((K=re.originalImage)==null?void 0:K.preview)});g!==-1&&(h.value[g].isUploading=!1,h.value[g].isFailed=!0)})}finally{te.value=0,ne.value=0,F.value=0,T.value=!1}},ke=async l=>{if(!l||!l.file)return;T.value=!0;const y=[...e.modelValue];try{const v=new FormData;v.append("inspection_id",e.inspectionId),v.append("point_id",e.pointId),v.append("images[]",l.file);const U=h.value.findIndex(g=>g.preview===l.preview);U!==-1&&(h.value[U].isUploading=!0,h.value[U].isFailed=!1);const re=(await Oe.post(route("inspections.upload-image"),v,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(re&&re.length>0){const g=re[0];if(y.push({id:g.image_id,image_path:g.path,width:g.width||l.width||0,height:g.height||l.height||0,rotation:l.rotation||0,preview:g.public_url,isUploaded:!0}),U!==-1){const K=h.value.splice(U,1)[0];K.preview&&K.preview.startsWith("blob:")&&URL.revokeObjectURL(K.preview)}_("update:modelValue",y),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:y,newImagesCount:1}),h.value.some(K=>K.isFailed)||fe()}}catch{previewIndex!==-1&&(h.value[previewIndex].isUploading=!1,h.value[previewIndex].isFailed=!0)}finally{T.value=!1}},Ae=l=>{if(l){if(l.id&&!l.isNew)Te(l);else{const y=h.value.findIndex(v=>v.preview&&v.preview===l.preview&&v.isNew||v.id&&v.id===l.id);if(y!==-1){const v=h.value.splice(y,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}_("update:modelValue",e.modelValue.filter(v=>!(v.id&&v.id===l.id)&&!(v.preview&&v.preview===l.preview)))}E.value>=R.value.length&&(E.value=Math.max(0,R.value.length-1)),R.value.length===0&&o()}},Te=async l=>{var v,U;if(l.id||l.image_path)try{await Oe.delete(route("inspections.delete-image"),{data:{image_id:l.id,image_path:l.image_path}})}catch(B){(U=(v=B.response)==null?void 0:v.data)!=null&&U.message?alert(`Failed to delete image from server: ${B.response.data.message}`):alert(`Failed to delete image from server: ${B.message}`);return}l.preview&&l.preview.startsWith("blob:")&&URL.revokeObjectURL(l.preview);const y=e.modelValue.filter(B=>B.id!==l.id);_("update:modelValue",y),h.value=h.value.filter(B=>B.isNew&&l.isNew?B.preview!==l.preview:B.id!==l.id),_("removeImage",{image:l}),L.value&&R.value.length===0?o():L.value&&E.value>=R.value.length&&(E.value=Math.max(0,R.value.length-1))},Pe=async l=>{if(T.value=!0,!e.pointId){alert("Error: Point ID is missing. Cannot upload image."),T.value=!1;return}try{const{file:y,width:v,height:U}=await ce(l);if(!y)throw new Error("Failed to process image");const B=new FormData;B.append("inspection_id",e.inspectionId),B.append("point_id",e.pointId),B.append("images[]",y);const g=(await Oe.post(route("inspections.upload-image"),B,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:d=>{d.total&&(te.value=Math.round(d.loaded*100/d.total))}})).data.images;if(g&&g.length>0){const d=g[0],K={id:d.image_id,image_path:d.path,width:d.width||v||0,height:d.height||U||0,rotation:l.rotation||0,preview:d.public_url,isUploaded:!0},j=[...e.modelValue,K];_("update:modelValue",j),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:j,newImagesCount:1});const se=h.value.findIndex(de=>de.preview===l.preview);if(se!==-1){const de=h.value.splice(se,1)[0];de.preview&&de.preview.startsWith("blob:")&&URL.revokeObjectURL(de.preview)}}else throw new Error("No image data received from server")}catch{const v=h.value.findIndex(U=>U.preview===l.preview);v!==-1&&(h.value[v].isUploading=!1,h.value[v].isFailed=!0),alert("Failed to upload image. Please try again.")}finally{T.value=!1,te.value=0}};return je(()=>{try{localStorage.getItem(oe)}catch{}}),ye(T,l=>{_("isUploading",l)}),(l,y)=>(n(),i("div",null,[t("input",{ref_key:"galleryInput",ref:$,type:"file",accept:m.value,class:"hidden",onChange:q,multiple:N.value,disabled:T.value},null,40,_n),t("canvas",{ref_key:"processingCanvas",ref:b,class:"hidden"},null,512),t("p",Sn,"Foto Maksimal: "+z(s.settings.max_files)+" | Rasio: "+z(s.settings.camera_aspect_ratio),1),R.value.length===0?(n(),i("label",{key:0,onClick:ae,class:me(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:T.value},[t("div",Cn,[y[3]||(y[3]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),y[4]||(y[4]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",Vn,"Tipe: "+z(m.value),1)])],8,$n)):(n(),i("div",{key:1,class:me(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":s.settings.max_files==1,"bg-transparent":s.settings.max_files>1}]),"aria-label":"Image gallery"},[s.settings.max_files===1?(n(),i("div",An,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:y[1]||(y[1]=v=>ee(0))},[t("img",{src:Y(R.value[0]),onError:y[0]||(y[0]=v=>D(R.value[0])),class:"w-full h-full object-cover"},null,40,Tn),R.value[0].isUploading?(n(),i("div",Mn,y[5]||(y[5]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0)]),t("button",{onClick:y[2]||(y[2]=ze(v=>Te(R.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:T.value},y[6]||(y[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ce(" Hapus Foto ")]),8,Un)])):(n(),i("div",Nn,[N.value&&R.value.length<s.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:ae,disabled:T.value},y[7]||(y[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,Pn)):p("",!0),(n(!0),i(Ve,null,Ue(R.value,(v,U)=>(n(),i("div",{key:v.id||v.preview||U,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:B=>v.isFailed?ke(v):ee(U)},[t("img",{src:Y(v),onError:B=>D(v),class:"w-full h-full object-cover"},null,40,Dn),v.isNew||v.rotation!==0?(n(),i("div",Ln,[v.isNew?(n(),i("span",Rn,"BARU")):p("",!0),v.rotation!==0?(n(),i("span",jn,"ROTASI")):p("",!0)])):p("",!0),v.isUploading?(n(),i("div",Fn,y[8]||(y[8]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0),v.isFailed?(n(),i("div",Bn,y[9]||(y[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("span",{class:"text-xs font-medium"},"Retry",-1)]))):p("",!0)],8,En))),128))]))],2)),s.error?(n(),i("p",qn,z(s.error),1)):p("",!0),Me(us,{show:S.value,settings:s.settings,onClose:c,onOpenWebcam:u,onTriggerGallery:I},null,8,["show","settings"]),Ne(P)!=="HD_Std"?(n(),Se(on,{key:3,show:w.value,"aspect-ratio":x.value,settings:s.settings,point:s.point,"camera-quality":Ne(P),onClose:a,onPhotoCaptured:A},null,8,["show","aspect-ratio","settings","point","camera-quality"])):p("",!0),Ne(P)==="HD_Std"?(n(),Se(kn,{key:4,show:w.value,"aspect-ratio":x.value,settings:s.settings,point:s.point,"camera-quality":Ne(P),onClose:a,onPhotoCaptured:A},null,8,["show","aspect-ratio","settings","point","camera-quality"])):p("",!0),Ne(P)==="HP_Native"?(n(),Se(In,{key:5,ref_key:"nativeCamera",ref:r,onDirectPhotoCaptured:Z},null,512)):p("",!0),Me(Fs,{show:L.value,images:R.value,point:s.point,"initial-index":E.value,"allow-multiple":N.value,"max-files":s.settings.max_files,"is-uploading":T.value,"aspect-ratio":x.value,"upload-progress":te.value,"current-upload":ne.value,"total-upload":F.value,onClose:o,onSaveImages:Ie,onRemovePreviewImage:Ae,onTriggerAddMorePhotos:ae,onRetryImage:ke},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},Ze=Re(On,[["__scopeId","data-v-aa031db1"]]),zn={key:0,class:"fixed inset-0 z-50 overflow-hidden"},Hn={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},Kn={class:"px-4 pb-2 border-b border-gray-200"},Gn={class:"text-lg font-semibold text-gray-900"},Wn={key:0,class:"text-sm text-gray-500 mt-1"},Zn={class:"flex-1 overflow-y-auto p-4"},Xn={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Yn={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(s){return(le,e)=>(n(),Se(He,{name:"bottom-sheet"},{default:De(()=>[s.show?(n(),i("div",zn,[e[1]||(e[1]=t("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),t("div",Hn,[e[0]||(e[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",Kn,[t("h3",Gn,z(s.title),1),s.subtitle?(n(),i("p",Wn,z(s.subtitle),1)):p("",!0)]),t("div",Zn,[Vt(le.$slots,"default",{},void 0,!0)]),le.$slots.footer?(n(),i("div",Xn,[Vt(le.$slots,"footer",{},void 0,!0)])):p("",!0)])])):p("",!0)]),_:3}))}},Jn=Re(Yn,[["__scopeId","data-v-fd942535"]]),Qn={class:"space-y-4"},ei={key:0,class:"mt-2"},ti={key:1,class:"mt-2"},ai={key:2,class:"mt-2"},si={key:3,class:"mt-2"},ni={key:4,class:"mt-2"},ii={class:"text-sm font-medium text-gray-700 mb-2"},oi={key:0,class:"text-red-500"},li={key:0,class:"text-xs text-red-500"},ri=["type","name","value","checked","onChange"],ui={key:6,class:"mt-4"},di={class:"text-sm font-medium text-gray-700 mb-2"},ci={key:0,class:"text-red-500"},gi={key:0,class:"text-xs text-red-500"},mi={key:7,class:"space-y-2"},pi={key:0,class:"text-xs text-red-500"},vi={class:"flex gap-2"},fi=["disabled"],Dt={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:[String,Array],notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(s,{emit:le}){const e=s,_=le,r=N=>_("hapus",N),$=V(!1),b=N=>{$.value=N},S=()=>{const N=w(e.selectedValue);if(N.length===0)return{textareaSettings:null,imageSettings:null};const m=N.filter(o=>o.is_repaired===!0),x=N.filter(o=>!o.is_repaired||o.is_repaired===!1),R=m.length>0?m:x;let ie=null,Q=!1,Y=!1,O=0,D=0,G="",ae=[],I=null,u=!1,c=!1,a=0;if(R.forEach(o=>{var k,M;if((k=o.settings)!=null&&k.show_textarea){if(Q=!0,o.settings.textarea_is_required!==!1&&(Y=!0),o.settings.min_length){const q=parseInt(o.settings.min_length);O=Math.max(O,q)}if(o.settings.max_length){const q=parseInt(o.settings.max_length);D=Math.max(D,q)}o.settings.placeholder&&!G&&(G=o.settings.placeholder),o.settings.damage_options&&Array.isArray(o.settings.damage_options)&&(ae=[...ae,...o.settings.damage_options]),ie||(ie={...o.settings})}if((M=o.settings)!=null&&M.show_image_upload){if(u=!0,o.settings.image_is_required!==!1&&(c=!0),o.settings.max_files){const q=parseInt(o.settings.max_files);a=Math.max(a,q)}I||(I={...o.settings})}}),Q&&ie){ie.textarea_is_required=Y,O>0&&(ie.min_length=O),D>0&&(ie.max_length=D),G&&(ie.placeholder=G),ie.show_textarea=!0;const o=ae.filter((k,M,f)=>M===f.findIndex(q=>q.value===k.value));ie.damage_options=o}return u&&I&&(I.image_is_required=c,a>0&&(I.max_files=a),I.show_image_upload=!0),{textareaSettings:Q?ie:null,imageSettings:u?I:null}},w=N=>{if(!N)return[];if(Array.isArray(N))return e.options.filter(m=>N.includes(m.value));{const m=typeof N=="string"?N.split(",").map(x=>x.trim()):[N];return e.options.filter(x=>m.includes(x.value))}},L=ue(()=>w(e.selectedValue)),h=ue(()=>S()),E=ue(()=>L.value.some(N=>{var m;return((m=N.settings)==null?void 0:m.show_textarea)===!0})),T=ue(()=>L.value.some(N=>{var m;return((m=N.settings)==null?void 0:m.show_image_upload)===!0})),W=ue(()=>h.value.textareaSettings),te=ue(()=>h.value.imageSettings),ne=N=>Array.isArray(e.selectedValue)?e.selectedValue.includes(N.value):e.selectedValue?(typeof e.selectedValue=="string"?e.selectedValue.split(",").map(x=>x.trim()):[e.selectedValue]).includes(N.value):!1,F=(N,m)=>{let x;if(N.multi){const R=Array.isArray(e.selectedValue)?e.selectedValue:[];m.target.checked?x=[...R,N.value]:x=R.filter(ie=>ie!==N.value)}else x=N.value;_("update:selectedValue",x)},J=ue(()=>{var m,x,R,ie,Q,Y,O,D,G;if(!(((m=e.point.settings)==null?void 0:m.is_required)!==!1))return!0;if(e.point.input_type==="radio"||e.point.input_type==="select"){if(!e.selectedValue||Array.isArray(e.selectedValue)&&e.selectedValue.length===0||w(e.selectedValue).length===0)return!1;const I=h.value;if(I.textareaSettings&&I.textareaSettings.textarea_is_required!==!1){if(!((x=e.notesValue)!=null&&x.trim()))return!1;if((R=e.notesValue)!=null&&R.trim()){if(I.textareaSettings.min_length){const u=parseInt(I.textareaSettings.min_length);if(e.notesValue.trim().length<u)return!1}if(I.textareaSettings.max_length){const u=parseInt(I.textareaSettings.max_length);if(e.notesValue.trim().length>u)return!1}}}if(I.imageSettings&&I.imageSettings.image_is_required!==!1){if(!e.imagesValue||e.imagesValue.length===0)return!1;if(e.imagesValue&&e.imagesValue.length>0){if(!e.imagesValue||e.imagesValue.length===0||P(e.imagesValue))return!1;if(I.imageSettings.max_files){const u=parseInt(I.imageSettings.max_files);if(e.imagesValue.length>u)return!1}}}return!0}if(e.point.input_type==="imageTOradio"){if(!e.imagesValue||e.imagesValue.length===0||!e.selectedValue)return!1;const ae=e.point.settings||{};if(ae.max_files){const u=parseInt(ae.max_files);if(e.imagesValue.length>u)return!1}if(P(e.imagesValue))return!1;w(e.selectedValue);const I=S();if(I.textareaSettings&&I.textareaSettings.textarea_is_required!==!1){if(!((ie=e.notesValue)!=null&&ie.trim()))return!1;if((Q=e.notesValue)!=null&&Q.trim()){if(I.textareaSettings.min_length){const u=parseInt(I.textareaSettings.min_length);if(e.notesValue.trim().length<u)return!1}if(I.textareaSettings.max_length){const u=parseInt(I.textareaSettings.max_length);if(e.notesValue.trim().length>u)return!1}}}return!0}if(e.point.input_type==="text"){if(!((Y=e.notesValue)!=null&&Y.trim()))return!1;const ae=e.point.settings||{};if(ae.min_length){const I=parseInt(ae.min_length);if(e.notesValue.length<I)return!1}if(ae.max_length){const I=parseInt(ae.max_length);if(e.notesValue.length>I)return!1}}if(e.point.input_type==="number"){if(!((O=e.notesValue)!=null&&O.trim()))return!1;const ae=parseFloat(e.notesValue);if(isNaN(ae))return!1;const I=e.point.settings||{};if(I.min!==void 0){const u=parseFloat(I.min);if(ae<u)return!1}if(I.max!==void 0){const u=parseFloat(I.max);if(ae>u)return!1}if(I.step){const u=parseFloat(I.step),c=I.min?parseFloat(I.min):0,a=(ae-c)%u;if(Math.abs(a)>1e-5&&Math.abs(a-u)>1e-5)return!1}}if(e.point.input_type==="account"){if(!((D=e.notesValue)!=null&&D.trim()))return!1;const ae=e.notesValue.replace(/[^0-9]/g,""),I=parseFloat(ae);if(isNaN(I))return!1;const u=e.point.settings||{};if(u.min_value){const c=parseFloat(u.min_value);if(I<c)return!1}if(u.max_value){const c=parseFloat(u.max_value);if(I>c)return!1}}if(e.point.input_type==="date"){if(!((G=e.notesValue)!=null&&G.trim()))return!1;const ae=new Date(e.notesValue);if(isNaN(ae.getTime()))return!1;const I=e.point.settings||{};if(I.min_date){const u=new Date(I.min_date);if(ae<u)return!1}if(I.max_date){const u=new Date(I.max_date);if(ae>u)return!1}}return!0}),P=N=>{if(!N||N.length===0)return!1;const m=N.some(R=>R.isFailed===!0),x=$.value===!0;return m||x},oe=ue(()=>{if(!W.value)return null;const N=W.value.textarea_is_required!==!1,m=W.value.min_length?parseInt(W.value.min_length):null;return N&&(!e.notesValue||e.notesValue.trim()==="")?"Keterangan wajib diisi":e.notesValue&&m&&e.notesValue.trim().length<m?`Minimal ${m} karakter (${e.notesValue.trim().length}/${m})`:null});return(N,m)=>(n(),Se(Jn,{show:s.show,title:s.title,subtitle:s.subtitle,onClose:m[17]||(m[17]=x=>N.$emit("close"))},{footer:De(()=>[s.selectedPoint?(n(),i("button",{key:0,onClick:m[14]||(m[14]=x=>r(s.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},m[19]||(m[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),Ce(" Hapus Data ")]))):p("",!0),t("div",vi,[t("button",{type:"button",onClick:m[15]||(m[15]=x=>N.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:m[16]||(m[16]=x=>N.$emit("save")),disabled:!J.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,fi)])]),default:De(()=>{var x,R,ie,Q,Y,O,D,G,ae,I,u,c,a,o,k,M,f,q;return[t("div",Qn,[s.point.input_type==="text"?(n(),i("div",ei,[Me(Ut,{"model-value":s.notesValue,required:(x=s.point.settings)==null?void 0:x.is_required,"min-length":(R=s.point.settings)==null?void 0:R.min_length,"max-length":(ie=s.point.settings)==null?void 0:ie.max_length,allowSpace:(Q=s.point.settings)==null?void 0:Q.allow_space,textTransform:(Y=s.point.settings)==null?void 0:Y.text_transform,placeholder:((O=s.point.settings)==null?void 0:O.placeholder)||"Masukan text",error:N.error,"onUpdate:modelValue":m[0]||(m[0]=A=>N.$emit("update:notesValue",A)),onSave:m[1]||(m[1]=A=>N.$emit("saveText",A))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):p("",!0),s.point.input_type==="number"?(n(),i("div",ti,[Me(Mt,{"model-value":s.notesValue,required:(D=s.point.settings)==null?void 0:D.is_required,min:(G=s.point.settings)==null?void 0:G.min,max:(ae=s.point.settings)==null?void 0:ae.max,step:((I=s.point.settings)==null?void 0:I.step)||1,placeholder:((u=s.point.settings)==null?void 0:u.placeholder)||"Masukan number",error:N.error,"onUpdate:modelValue":m[2]||(m[2]=A=>N.$emit("update:notesValue",A)),onSave:m[3]||(m[3]=A=>N.$emit("saveNumber",A))},null,8,["model-value","required","min","max","step","placeholder","error"])])):p("",!0),s.point.input_type==="account"?(n(),i("div",ai,[Me(Pt,{"model-value":s.notesValue,required:(c=s.point.settings)==null?void 0:c.is_required,placeholder:((a=s.point.settings)==null?void 0:a.placeholder)||"Masukkan nilai",error:N.error,"point-id":s.pointId,settings:s.point.settings,"onUpdate:modelValue":m[4]||(m[4]=A=>N.$emit("update:notesValue",A)),onSave:m[5]||(m[5]=A=>N.$emit("saveAccount",A))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):p("",!0),s.point.input_type==="date"?(n(),i("div",si,[Me(Nt,{"model-value":s.notesValue,required:(o=s.point.settings)==null?void 0:o.is_required,"min-date":(k=s.point.settings)==null?void 0:k.min_date,"max-date":(M=s.point.settings)==null?void 0:M.max_date,error:N.error,"onUpdate:modelValue":m[6]||(m[6]=A=>N.$emit("update:notesValue",A)),onSave:m[7]||(m[7]=A=>N.$emit("saveDate",A))},null,8,["model-value","required","min-date","max-date","error"])])):p("",!0),s.point.input_type==="imageTOradio"?(n(),i("div",ni,[t("h4",ii,[(f=s.point.settings)!=null&&f.required?(n(),i("span",oi,"*")):p("",!0)]),Me(Ze,{"model-value":s.imagesValue,"point-id":s.pointId,point:s.point.inspection_point,"inspection-id":s.inspectionId,settings:s.point.settings,"onUpdate:modelValue":m[8]||(m[8]=A=>N.$emit("update:imagesValue",A)),onSave:m[9]||(m[9]=A=>N.$emit("saveImage",A)),onIsUploading:b},null,8,["model-value","point-id","point","inspection-id","settings"]),(q=s.point.settings)!=null&&q.required&&s.imagesValue.length===0?(n(),i("p",li," Foto wajib diupload ")):p("",!0)])):p("",!0),s.options.length?(n(),i("div",{key:5,class:me(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(s.options.length,3)}`])},[(n(!0),i(Ve,null,Ue(s.options,(A,Z)=>(n(),i("label",{key:Z,class:"cursor-pointer"},[t("input",{type:A.multi?"checkbox":"radio",name:A.multi?`checkbox-${s.name}`:s.name,value:A.value,checked:ne(A),onChange:ee=>F(A,ee),class:"hidden peer"},null,40,ri),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":ne(A),"border-gray-300 text-gray-700 hover:bg-gray-50":!ne(A)}])},z(A.label),3)]))),128))],2)):p("",!0),T.value&&te.value?(n(),i("div",ui,[t("h4",di,[m[18]||(m[18]=Ce(" Upload Foto ")),te.value.image_is_required!==!1?(n(),i("span",ci,"*")):p("",!0)]),Me(Ze,{"model-value":s.imagesValue,"point-id":s.pointId,point:s.point,"inspection-id":s.inspectionId,settings:te.value,"onUpdate:modelValue":m[10]||(m[10]=A=>N.$emit("update:imagesValue",A)),onSave:m[11]||(m[11]=A=>N.$emit("saveImage",A)),onIsUploading:b},null,8,["model-value","point-id","point","inspection-id","settings"]),te.value.image_is_required!==!1&&s.imagesValue.length===0?(n(),i("p",gi," Foto wajib diupload ")):p("",!0)])):p("",!0),E.value&&W.value?(n(),i("div",mi,[Me(Et,{"model-value":s.notesValue,"point-id":s.pointId,"inspection-id":s.inspectionId,settings:W.value,required:W.value.textarea_is_required!==!1,"min-length":W.value.min_length,"max-length":W.value.max_length,placeholder:W.value.placeholder||"Tambahkan keterangan...","onUpdate:modelValue":m[12]||(m[12]=A=>N.$emit("update:notesValue",A)),onSave:m[13]||(m[13]=A=>N.$emit("saveTextarea",A))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),oe.value?(n(),i("p",pi,z(oe.value),1)):p("",!0)])):p("",!0)])]}),_:1},8,["show","title","subtitle"]))}},hi={class:"mt-2 space-y-2"},bi=["type","name","value","checked","onChange","required"],yi={key:0,class:"p-2 rounded-lg bg-gray-50"},xi={key:0,class:"mt-2"},wi={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},ki=["src"],Ii={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},_i={key:1,class:"mt-2"},Si={class:"text-sm text-gray-600"},$i={key:2,class:"mt-2 text-sm text-red-600"},Ci={__name:"InputRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(s,{emit:le}){const e=s,_=le,r=V(e.notes),$=V([...e.images]),b=V(!1),S=V(""),w=V([]),L=V(""),h=V([]);ue(()=>e.options.find(x=>x.value===e.modelValue));const E=ue(()=>Array.isArray(e.modelValue)?e.options.filter(x=>e.modelValue.includes(x.value)):e.modelValue?[e.options.find(x=>x.value===e.modelValue)].filter(Boolean):[]),T=x=>Array.isArray(e.modelValue)?e.modelValue.includes(x.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(ie=>ie.trim()):[e.modelValue]).includes(x.value):!1,W=x=>x.settings&&(x.settings.show_textarea||x.settings.show_image_upload);ye(()=>e.notes,x=>{r.value=x}),ye(()=>e.images,x=>{$.value=[...x]}),ye(()=>e.modelValue,x=>{x?L.value=Array.isArray(x)?[...x]:x:L.value=""});const te=(x,R)=>{let ie;if(x.multi){const Q=Array.isArray(e.modelValue)?e.modelValue:[];R.target.checked?ie=[...Q,x.value]:ie=Q.filter(Y=>Y!==x.value)}else ie=x.value;_("update:modelValue",ie),W(x)?F():_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:ie,notes:"",images:[]})},ne=x=>x.preview||(x.image_path?`/${x.image_path}`:x),F=()=>{L.value=e.modelValue,S.value=r.value,w.value=[...$.value],h.value=[...$.value],b.value=!0},J=()=>{S.value="",w.value=[],L.value=Array.isArray(e.modelValue)?[...e.modelValue]:e.modelValue,b.value=!1},P=x=>{w.value=x,$.value=[...x],_("update:images",[...x]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...x]})},oe=x=>{},N=()=>{L.value!==e.modelValue&&_("update:modelValue",L.value),r.value=S.value,_("update:notes",S.value),$.value=[...w.value],_("update:images",[...w.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:L.value,notes:S.value,images:w.value}),b.value=!1},m=x=>{L.value="",S.value="",w.value=[],r.value="",$.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",x),b.value=!1};return(x,R)=>{var ie;return n(),i("div",hi,[t("div",{class:me(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(s.options.length,3)}`])},[(n(!0),i(Ve,null,Ue(s.options,(Q,Y)=>(n(),i("label",{key:Y,class:"cursor-pointer"},[t("input",{type:Q.multi?"checkbox":"radio",name:Q.multi?`checkbox-${s.pointId}`:"radio-"+s.pointId,value:Q.value,checked:T(Q),onChange:O=>te(Q,O),class:"hidden peer",required:s.required&&!Q.multi},null,40,bi),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":T(Q),"border-gray-300 text-gray-700 hover:bg-gray-50":!T(Q)}])},z(Q.label),3)]))),128))],2),s.modelValue&&E.value.length>0&&E.value.some(Q=>W(Q))?(n(),i("div",yi,[t("div",{class:"flex justify-between items-start"},[R[4]||(R[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:F,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),s.images.length>0&&E.value.some(Q=>{var Y;return(Y=Q.settings)==null?void 0:Y.show_image_upload})?(n(),i("div",xi,[t("div",wi,[(n(!0),i(Ve,null,Ue(s.images,(Q,Y)=>(n(),i("div",{key:Y,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:ne(Q),class:"w-full h-full object-cover rounded"},null,8,ki),Y===3&&s.images.length>4?(n(),i("span",Ii," +"+z(s.images.length-4),1)):p("",!0)]))),128))])])):p("",!0),s.notes&&E.value.some(Q=>{var Y;return(Y=Q.settings)==null?void 0:Y.show_textarea})?(n(),i("div",_i,[t("p",Si,z(s.notes),1)])):p("",!0)])):p("",!0),b.value?(n(),Se(Dt,{key:(ie=s.selectedPoint)==null?void 0:ie.id,show:b.value,title:s.pointName||"Detail",subtitle:s.subtitle||"",name:"modal-radio-"+s.pointId,options:s.options,"selected-value":L.value,"notes-value":S.value,"images-value":w.value,"point-id":s.pointId,point:s.point,"inspection-id":s.inspectionId,"selected-point":s.selectedPoint,"onUpdate:selectedValue":R[0]||(R[0]=Q=>L.value=Q),"onUpdate:notesValue":R[1]||(R[1]=Q=>S.value=Q),"onUpdate:imagesValue":R[2]||(R[2]=Q=>P(Q)),onClose:J,onSave:N,onSaveTextarea:x.handleTextareaSave,onSaveImage:oe,onHapus:R[3]||(R[3]=Q=>m(s.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):p("",!0),s.error?(n(),i("p",$i,z(s.error),1)):p("",!0)])}}},Vi={class:"mt-2 space-y-2"},Ai={key:0,class:"flex flex-wrap gap-3"},Ti={key:1,class:"p-2"},Mi={key:0,class:"mt-2"},Ui={class:"flex gap-2 overflow-x-auto scrollbar-hide"},Ni=["src"],Pi={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Ei=["type","name","value","checked"],Di={key:1,class:"mt-2"},Li={class:"text-sm text-gray-600"},Ri={key:3,class:"mt-2 text-sm text-red-600"},ji={__name:"InputImageToRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(s,{emit:le}){const e=s,_=le,r=V(e.notes),$=V([...e.images]),b=V(!1),S=V(""),w=V([]),L=V(""),h=V([]),E=ue(()=>{if(Array.isArray(e.modelValue))return e.options.find(m=>e.modelValue.includes(m.value));if(e.modelValue){const m=typeof e.modelValue=="string"?e.modelValue.split(",").map(x=>x.trim()):[e.modelValue];return e.options.find(x=>m.includes(x.value))}return null}),T=ue(()=>{if(Array.isArray(e.modelValue))return e.options.filter(m=>e.modelValue.includes(m.value));if(e.modelValue){const m=typeof e.modelValue=="string"?e.modelValue.split(",").map(x=>x.trim()):[e.modelValue];return e.options.filter(x=>m.includes(x.value))}return[]}),W=ue(()=>T.value.some(m=>{var x;return m.multi&&((x=m.settings)==null?void 0:x.show_textarea)}));ue(()=>T.value.find(m=>{var x;return m.multi&&((x=m.settings)==null?void 0:x.show_textarea)}));const te=m=>Array.isArray(e.modelValue)?e.modelValue.includes(m.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(R=>R.trim()):[e.modelValue]).includes(m.value):!1,ne=m=>m.preview||(m.image_path?`/${m.image_path}`:m);ye(()=>e.notes,m=>{r.value=m});const F=()=>{L.value=e.modelValue||"",S.value=r.value,w.value=[...$.value],h.value=[...$.value],b.value=!0},J=()=>{S.value="",w.value=[],L.value="",b.value=!1},P=m=>{w.value=m,$.value=[...m],_("update:images",[...m]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...m]})},oe=()=>{L.value!==e.modelValue&&_("update:modelValue",L.value),r.value=S.value,_("update:notes",S.value),$.value=[...w.value],_("update:images",[...w.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:L.value,notes:S.value,images:w.value}),b.value=!1},N=m=>{L.value="",S.value="",w.value=[],r.value="",$.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",m),b.value=!1};return(m,x)=>{var R,ie,Q;return n(),i("div",Vi,[!s.modelValue&&$.value.length===0&&!r.value?(n(),i("div",Ai,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:F},x[4]||(x[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",Ti,[t("div",{class:"flex justify-between items-start"},[x[5]||(x[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:F,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),$.value.length>0?(n(),i("div",Mi,[t("div",Ui,[(n(!0),i(Ve,null,Ue($.value,(Y,O)=>(n(),i("div",{key:O,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:ne(Y),class:"w-full h-full object-cover rounded"},null,8,Ni),O===3&&$.value.length>4?(n(),i("span",Pi," +"+z($.value.length-4),1)):p("",!0)]))),128))])])):p("",!0),t("div",{class:me(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(s.options.length,3)}`])},[(n(!0),i(Ve,null,Ue(s.options,(Y,O)=>(n(),i("label",{key:O,class:"cursor-pointer"},[t("input",{type:Y.multi?"checkbox":"radio",name:Y.multi?`checkbox-${s.pointId}`:`radio-${s.pointId}`,value:Y.value,checked:te(Y),disabled:!0,class:"hidden peer"},null,8,Ei),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":te(Y),"border-gray-300 text-gray-700 hover:bg-gray-50":!te(Y)}])},z(Y.label),3)]))),128))],2),r.value&&((ie=(R=E.value)==null?void 0:R.settings)!=null&&ie.show_textarea||W.value)?(n(),i("div",Di,[t("p",Li,z(r.value),1)])):p("",!0)])),b.value?(n(),Se(Dt,{key:(Q=s.selectedPoint)==null?void 0:Q.id,show:b.value,title:s.pointName||"Detail",subtitle:s.subtitle||"",name:"modal-radio-"+s.pointId,options:s.options,"selected-value":L.value,"notes-value":S.value,"images-value":w.value,"point-id":s.pointId,point:s.point,"inspection-id":s.inspectionId,"selected-point":s.selectedPoint,"onUpdate:selectedValue":x[0]||(x[0]=Y=>L.value=Y),"onUpdate:notesValue":x[1]||(x[1]=Y=>S.value=Y),"onUpdate:imagesValue":x[2]||(x[2]=Y=>P(Y)),onClose:J,onSave:oe,onHapus:x[3]||(x[3]=Y=>N(s.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):p("",!0),s.error?(n(),i("p",Ri,z(s.error),1)):p("",!0)])}}},Fi={class:"text-base font-semibold text-indigo-700"},Bi={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},qi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Oi={class:"text-base font-semibold text-indigo-700"},zi={class:"p-4 space-y-4"},Hi={key:0,class:"flex justify-end py-1"},Ki=["onClick"],Gi={key:1,class:"space-y-2"},Wi={class:"flex items-start justify-between"},Zi={class:"flex-1"},Xi={class:"block text-sm font-medium text-gray-900"},Yi={class:"font-bold"},Ji={key:0,class:"text-red-500"},Qi={key:1,class:"italic text-xs text-gray-400 ml-2"},eo={key:0,class:"mt-1"},to={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800"},ao={key:0},so={key:1},no={key:2},io={key:3},oo={key:4},lo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},ro={key:9,class:"p-3 bg-gray-100 rounded text-sm text-gray-600"},uo={class:"text-xs mt-1 list-disc list-inside"},co={key:0},go={key:1},mo={key:2},po={key:3},vo={key:4},fo={key:0,class:"text-center py-8 text-gray-500"},ho={key:0,class:"text-xs text-gray-400"},Xo={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object,car:Object,triggeredPoints:Array},emits:["updateResult","removeImage","hapusPoint","triggerPointsChanged"],setup(s,{emit:le}){const e=s,_=le,r=We("vehicleFeatures",V(null));r.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),jt("vehicleFeatures",r);const $=V(!1),b=V([]),S=V(!0),w=V(null),L=ue(()=>e.triggeredPoints||[]),h=Ft(),E={MT:"Manual Transmission (MT)",AT:"Automatic Transmission (AT)",CVT:"Continuously Variable Transmission (CVT)","e-CVT":"Electronic CVT (e-CVT)",DCT:"Dual Clutch Transmission (DCT)",AMT:"Automated Manual Transmission (AMT)",IVT:"Intelligent Variable Transmission (IVT)",SSG:"Seamless Shift Gearbox (SSG)",AGS:"Auto Gear Shift (AGS)",DHT:"Dedicated Hybrid Transmission (DHT)"};je(()=>{const u=new IntersectionObserver(([c])=>{S.value=c.isIntersecting},{threshold:.1});w.value&&u.observe(w.value),Be(()=>{w.value&&u.unobserve(w.value)}),T()});const T=()=>{const u=e.category.points||[];L.value=[],u.forEach(c=>{var o,k,M;const a=c.id;if(a&&(a.toString(),c.input_type==="radio"||c.input_type==="imageTOradio"||c.input_type==="select")){const f=e.form.results[(o=c.inspection_point)==null?void 0:o.id];if(f&&f.status){let q=[];if(Array.isArray(f.status))f.status.forEach(A=>{var ee,ce;const Z=(ce=(ee=c.settings)==null?void 0:ee.radios)==null?void 0:ce.find(ge=>ge.value===A);Z&&q.push(Z)});else{const A=(M=(k=c.settings)==null?void 0:k.radios)==null?void 0:M.find(Z=>Z.value===f.status);A&&q.push(A)}q.forEach(A=>{var Z;(Z=A==null?void 0:A.settings)!=null&&Z.show_trigger&&(A.settings.target_point_id||[]).forEach(ce=>{const ge=ce.toString();L.value.includes(ge)||L.value.push(ge)})})}}})},W=()=>{$.value=!$.value,$.value||(b.value=[])},te=ue(()=>(e.category.points||[]).some(u=>u.is_default===!1)),ne=u=>!u||!Array.isArray(u)?[]:u.map(c=>E[c]||c),F=u=>{var k,M;const c=u.settings;if(!J(u))return!0;const a=(k=e.car)==null?void 0:k.transmission,o=(M=e.car)==null?void 0:M.fuel_type;if(c.transmission&&Array.isArray(c.transmission)&&c.transmission.length>0&&a&&!c.transmission.includes(a)||c.fuel_type&&c.fuel_type.trim()!==""&&o&&c.fuel_type!==o||c.rear_door&&(!r.value||!r.value.rear_door))return!1;if(c.pick_up&&c.box)if(r.value){const f=r.value.pick_up===!0,q=r.value.box===!0;if(!f&&!q)return!1}else return!1;else if(c.pick_up){if(!r.value||!r.value.pick_up)return!1}else if(c.box&&(!r.value||!r.value.box))return!1;return!0},J=u=>{const c=u.settings;return!!(c!=null&&c.transmission&&Array.isArray(c.transmission)&&c.transmission.length>0||c!=null&&c.fuel_type&&c.fuel_type.trim()!==""||c!=null&&c.rear_door||c!=null&&c.pick_up||c!=null&&c.box)},P=u=>{const c=[],a=u.settings;return a!=null&&a.radios&&a.radios.forEach(o=>{var k;if((k=o.settings)!=null&&k.show_trigger&&o.settings.target_point_id){const M=o.settings.target_point_id.map(f=>f.toString());c.push(...M)}}),[...new Set(c)]},oe=u=>{const{pointId:c,value:a,option:o}=u;m(c,a)},N=(u,c,a)=>{G(u,c,a),m(u,c)},m=(u,c)=>{var q,A;const a=e.category.points.find(Z=>{var ee;return((ee=Z.inspection_point)==null?void 0:ee.id)===u});if(!a)return;const k=a.id.toString();P(a).forEach(Z=>{const ee=Z.toString(),ce=L.value.indexOf(ee);ce>-1&&L.value.splice(ce,1)});let f=[];if(Array.isArray(c))c.forEach(Z=>{var ce,ge;const ee=(ge=(ce=a.settings)==null?void 0:ce.radios)==null?void 0:ge.find(fe=>fe.value===Z);ee&&f.push(ee)});else{const Z=(A=(q=a.settings)==null?void 0:q.radios)==null?void 0:A.find(ee=>ee.value===c);Z&&f.push(Z)}f.forEach(Z=>{var ee;(ee=Z==null?void 0:Z.settings)!=null&&ee.show_trigger&&(Z.settings.target_point_id||[]).forEach(ge=>{const fe=ge.toString();L.value.includes(fe)||L.value.push(fe)})}),_("triggerPointsChanged",{pointId:k,targetPointIds:f.flatMap(Z=>{var ee;return((ee=Z.settings)==null?void 0:ee.target_point_id)||[]}),action:"update"})},x=u=>J(u)&&($.value||F(u)),R=u=>{var o;const c=u.id;if(!c)return!0;const a=c.toString();return(o=u.settings)!=null&&o.is_triggered?L.value.includes(a):!0},ie=ue(()=>{const u=e.category.points||[],c=[];let a=[];return $.value?e.category.isDamageMenu?u.filter(o=>o.is_default||Y(o.id)||$.value):u:e.category.isDamageMenu?u.filter(o=>{const k=o.id;return Y(k)||o.is_default||b.value.includes(k)}):(u.forEach(o=>{var ce,ge;const k=o.id,M=Y(k),f=b.value.includes(k),A=!J(o)||F(o),Z=R(o);if((ce=o.settings)!=null&&ce.is_triggered){Z&&(o.is_default||M||f)&&A&&c.push(o);return}(o.is_default||M||f)&&A?(a.length>0&&(c.push({is_link:!0,count:a.length,hiddenIds:a.map(fe=>fe.id)}),a.forEach(fe=>{b.value.includes(fe.id)&&c.push(fe)}),a=[]),c.push(o)):A&&!((ge=o.settings)!=null&&ge.is_triggered)&&a.push(o)}),a.length>0&&(c.push({is_link:!0,count:a.length,hiddenIds:a.map(o=>o.id)}),a.forEach(o=>{b.value.includes(o.id)&&c.push(o)})),c)}),Q=u=>{$.value=!1,u.forEach(c=>{b.value.includes(c)||b.value.push(c)})},Y=u=>{var q;if(!u)return!1;const c=e.category.points.find(A=>A.id===u);if(!c||!((q=c.inspection_point)!=null&&q.id))return!1;const a=c.inspection_point.id,o=h.props.existingResults[a]!==void 0,k=h.props.existingImages[a]&&h.props.existingImages[a].length>0,M=e.form.results[a]&&(e.form.results[a].status||e.form.results[a].note),f=e.form.images[a]&&e.form.images[a].length>0;return o||k||M||f},O=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],D=u=>{var A,Z,ee,ce,ge,fe,Ie,$e,ke,Ae,Te,Pe,l,y,v,U,B,re,g,d,K,j;const c=(A=u.inspection_point)==null?void 0:A.id,a=e.form.results[c],o=e.form.images[c]||[],k=((Z=u.settings)==null?void 0:Z.is_required)!==!1,M=Array.isArray(a==null?void 0:a.status);if(!k)return!0;if(!a)return!1;const f=u.settings||{};switch(u.input_type){case"text":if(!a.note||a.note.trim()==="")return!1;if(f.min_length){const H=parseInt(f.min_length);if(a.note.trim().length<H)return!1}if(f.max_length){const H=parseInt(f.max_length);if(a.note.trim().length>H)return!1}return!0;case"number":if(!a.note||a.note.trim()==="")return!1;const se=parseFloat(a.note);if(isNaN(se))return!1;if(f.min!==void 0){const H=parseFloat(f.min);if(se<H)return!1}if(f.max!==void 0){const H=parseFloat(f.max);if(se>H)return!1}if(f.step){const H=parseFloat(f.step),ve=(se-(f.min||0))%H;if(Math.abs(ve)>1e-5&&Math.abs(ve-H)>1e-5)return!1}return!0;case"textarea":if(!a.note||a.note.trim()==="")return!1;if(f.min_length){const H=parseInt(f.min_length);if(a.note.trim().length<H)return!1}if(f.max_length){const H=parseInt(f.max_length);if(a.note.trim().length>H)return!1}return!0;case"account":if(!a.note||a.note.trim()==="")return!1;const de=a.note.replace(/[^0-9]/g,""),pe=parseFloat(de);if(isNaN(pe))return!1;if(f.min_value){const H=parseFloat(f.min_value);if(pe<H)return!1}if(f.max_value){const H=parseFloat(f.max_value);if(pe>H)return!1}return!0;case"date":if(!a.note||a.note.trim()==="")return!1;const be=new Date(a.note);if(f.min_date){const H=new Date(f.min_date);if(be<H)return!1}if(f.max_date){const H=new Date(f.max_date);if(be>H)return!1}return!0;case"radio":if(!a.status)return!1;if(M){if(a.status.length===0)return!1;let H=!1,ve=!1;for(const we of a.status){const he=(ee=f.radios)==null?void 0:ee.find(_e=>_e.value===we);he&&((ce=he.settings)!=null&&ce.show_textarea&&he.settings.textarea_is_required!==!1&&(H=!0),(ge=he.settings)!=null&&ge.show_image_upload&&he.settings.image_is_required!==!1&&(ve=!0))}if(H&&(!a.note||a.note.trim()===""))return!1;if(a.note&&a.note.trim()!=="")for(const we of a.status){const he=(fe=f.radios)==null?void 0:fe.find(_e=>_e.value===we);if(!(!he||!((Ie=he.settings)!=null&&Ie.show_textarea))){if(he.settings.min_length){const _e=parseInt(he.settings.min_length);if(a.note.trim().length<_e)return!1}if(he.settings.max_length){const _e=parseInt(he.settings.max_length);if(a.note.trim().length>_e)return!1}}}if(ve&&(!o||o.length===0))return!1;if(o&&o.length>0){let we=1;for(const he of a.status){const _e=($e=f.radios)==null?void 0:$e.find(qe=>qe.value===he);(ke=_e==null?void 0:_e.settings)!=null&&ke.show_image_upload&&_e.settings.max_files&&(we=Math.max(we,parseInt(_e.settings.max_files)))}if(o.length>we)return!1}return!0}else{const H=(Ae=f.radios)==null?void 0:Ae.find(ve=>ve.value===a.status);if(!H)return!1;if((Te=H.settings)!=null&&Te.show_textarea){if(H.settings.textarea_is_required!==!1&&(!a.note||a.note.trim()===""))return!1;if(a.note&&a.note.trim()!==""){if(H.settings.min_length){const ve=parseInt(H.settings.min_length);if(a.note.trim().length<ve)return!1}if(H.settings.max_length){const ve=parseInt(H.settings.max_length);if(a.note.trim().length>ve)return!1}}}if((Pe=H.settings)!=null&&Pe.show_image_upload){if(H.settings.image_is_required!==!1&&(!o||o.length===0))return!1;if(o&&o.length>0&&H.settings.max_files){const ve=parseInt(H.settings.max_files);if(o.length>ve)return!1}}return!0}case"select":if(!a.status)return!1;const xe=(l=f.radios)==null?void 0:l.find(H=>H.value===a.status);if(!xe)return!1;if((y=xe.settings)!=null&&y.show_textarea){if(xe.settings.textarea_is_required!==!1&&(!a.note||a.note.trim()===""))return!1;if(a.note&&a.note.trim()!==""){if(xe.settings.min_length){const H=parseInt(xe.settings.min_length);if(a.note.trim().length<H)return!1}if(xe.settings.max_length){const H=parseInt(xe.settings.max_length);if(a.note.trim().length>H)return!1}}}if((v=xe.settings)!=null&&v.show_image_upload){if(xe.settings.image_is_required!==!1&&(!o||o.length===0))return!1;if(o&&o.length>0&&xe.settings.max_files){const H=parseInt(xe.settings.max_files);if(o.length>H)return!1}}return!0;case"imageTOradio":if(!o||o.length===0||!a.status)return!1;if(f.max_files){const H=parseInt(f.max_files);if(o.length>H)return!1}if(M){if(a.status.length===0)return!1;let H=!1;for(const ve of a.status){const we=(U=f.radios)==null?void 0:U.find(he=>he.value===ve);we&&(B=we.settings)!=null&&B.show_textarea&&we.settings.textarea_is_required!==!1&&(H=!0)}if(H&&(!a.note||a.note.trim()===""))return!1;if(a.note&&a.note.trim()!=="")for(const ve of a.status){const we=(re=f.radios)==null?void 0:re.find(he=>he.value===ve);if(!(!we||!((g=we.settings)!=null&&g.show_textarea))){if(we.settings.min_length){const he=parseInt(we.settings.min_length);if(a.note.trim().length<he)return!1}if(we.settings.max_length){const he=parseInt(we.settings.max_length);if(a.note.trim().length>he)return!1}}}return!0}else{const H=(d=f.radios)==null?void 0:d.find(ve=>ve.value===a.status);if(!H)return!1;if((K=H.settings)!=null&&K.show_textarea){if(H.settings.textarea_is_required!==!1&&(!a.note||a.note.trim()===""))return!1;if(a.note&&a.note.trim()!==""){if(H.settings.min_length){const ve=parseInt(H.settings.min_length);if(a.note.trim().length<ve)return!1}if(H.settings.max_length){const ve=parseInt(H.settings.max_length);if(a.note.trim().length>ve)return!1}}}return!0}case"image":if(o.length===0)return!1;if(f.max_files){const H=parseInt(f.max_files);if(o.length>H)return!1}return!0;default:return!!(a.status||(j=a.note)!=null&&j.trim())}},G=(u,c,a)=>{_("updateResult",{pointId:u,type:a,value:c})},ae=u=>{console.log("Save result for point:",u)},I=u=>{_("hapusPoint",u)};return ye(()=>e.form.results,u=>{T()},{deep:!0}),ye(()=>e.form.images,u=>{},{deep:!0}),ye(()=>e.car,u=>{console.log("Car data updated:",u)},{deep:!0}),ye(r,u=>{console.log("Vehicle features updated:",u)},{deep:!0}),(u,c)=>(n(),i(Ve,null,[e.head==="vertical"?(n(),i("div",{key:0,class:me(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[t("h4",Fi,z(s.category.name),1),te.value?(n(),i("button",{key:0,onClick:W,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},z($.value?"Sembunyikan Semua":"Tampilkan Point Lain"),1)):p("",!0)])):p("",!0),t("div",{class:me(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",e.head==="vertical"?"pt-6":""])},[!S.value&&te.value?(n(),i("button",{key:0,onClick:W,class:"fixed top-3 right-2 z-10 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[$.value?(n(),i("svg",Bi,c[3]||(c[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(n(),i("svg",qi,c[4]||(c[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):p("",!0),e.head==="horizontal"?(n(),i("div",{key:1,ref_key:"categoryHeader",ref:w,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",Oi,z(s.category.name),1),te.value?(n(),i("button",{key:0,onClick:W,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},z($.value?"Sembunyikan":"Tampilkan Point Lain"),1)):p("",!0)],512)):p("",!0),t("div",zi,[(n(!0),i(Ve,null,Ue(ie.value,(a,o)=>{var k,M,f,q,A,Z,ee,ce,ge,fe,Ie,$e,ke,Ae,Te,Pe,l,y,v,U,B,re,g,d,K,j,se,de,pe,be,xe,H,ve,we,he,_e,qe,Xe,Ye,Je,Qe,et,tt,at,st,nt,it,ot,lt,rt,ut,dt,ct,gt,mt,pt,vt,ft,ht,bt,yt,xt,wt,kt,It,_t,St,$t,Ct;return n(),i("div",{key:o,class:me(["space-y-2 last:border-0 last:pb-0",a.is_link?"pb-0":"pb-2 border-b border-gray-100"])},[a.is_link?(n(),i("div",Hi,[t("button",{onClick:X=>Q(a.hiddenIds),class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none"}," Tampilkan "+z(a.count)+" Point Tersembunyi ",9,Ki)])):(n(),i("div",Gi,[t("div",Wi,[t("div",Zi,[t("label",Xi,[t("span",Yi,z((k=a.inspection_point)==null?void 0:k.name),1),(M=a.settings)!=null&&M.is_required?(n(),i("span",Ji,"*")):p("",!0),!a.is_default&&!Y((f=a.inspection_point)==null?void 0:f.id)?(n(),i("span",Qi," (opsional) ")):p("",!0)]),x(a)?(n(),i("div",eo,[J(a)?(n(),i("div",to,[(q=a.settings)!=null&&q.transmission?(n(),i("div",ao,z(a.settings.transmission.join(", ")),1)):p("",!0),(A=a.settings)!=null&&A.fuel_type?(n(),i("div",so,z(a.settings.fuel_type),1)):p("",!0),(Z=a.settings)!=null&&Z.rear_door?(n(),i("div",no," Pintu Belakang ")):p("",!0),(ee=a.settings)!=null&&ee.pick_up?(n(),i("div",io," Tipe Pick Up, ")):p("",!0),(ce=a.settings)!=null&&ce.box?(n(),i("div",oo," Tipe Box ")):p("",!0)])):p("",!0)])):p("",!0)]),D(a)?(n(),i("span",lo," ✓ ")):p("",!0)]),a.input_type==="text"&&F(a)?(n(),Se(Ut,{key:0,modelValue:s.form.results[(ge=a.inspection_point)==null?void 0:ge.id].note,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},X=>{var C;return G((C=a.inspection_point)==null?void 0:C.id,X,"note")}],required:(fe=a.settings)==null?void 0:fe.is_required,"min-length":(Ie=a.settings)==null?void 0:Ie.min_length,"max-length":($e=a.settings)==null?void 0:$e.max_length,allowSpace:(ke=a.settings)==null?void 0:ke.allow_space,textTransform:(Ae=a.settings)==null?void 0:Ae.text_transform,placeholder:((Te=a.settings)==null?void 0:Te.placeholder)||"Masukan text",error:s.form.errors[`results.${(Pe=a.inspection_point)==null?void 0:Pe.id}.note`],onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):p("",!0),a.input_type==="number"&&F(a)?(n(),Se(Mt,{key:1,modelValue:s.form.results[(l=a.inspection_point)==null?void 0:l.id].note,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},X=>{var C;return G((C=a.inspection_point)==null?void 0:C.id,X,"note")}],required:(y=a.settings)==null?void 0:y.is_required,min:(v=a.settings)==null?void 0:v.min,max:(U=a.settings)==null?void 0:U.max,step:((B=a.settings)==null?void 0:B.step)||1,placeholder:((re=a.settings)==null?void 0:re.placeholder)||"Masukan number",error:s.form.errors[`results.${(g=a.inspection_point)==null?void 0:g.id}.note`],onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):p("",!0),a.input_type==="account"&&F(a)?(n(),Se(Pt,{key:2,modelValue:s.form.results[(d=a.inspection_point)==null?void 0:d.id].note,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},X=>{var C;return G((C=a.inspection_point)==null?void 0:C.id,X,"note")}],required:(K=a.settings)==null?void 0:K.is_required,placeholder:((j=a.settings)==null?void 0:j.placeholder)||"Masukkan nilai",error:s.form.errors[`results.${(se=a.inspection_point)==null?void 0:se.id}.note`],"point-id":(de=a.inspection_point)==null?void 0:de.id,settings:a.settings,onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):p("",!0),a.input_type==="date"&&F(a)?(n(),Se(Nt,{key:3,modelValue:s.form.results[(pe=a.inspection_point)==null?void 0:pe.id].note,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},X=>{var C;return G((C=a.inspection_point)==null?void 0:C.id,X,"note")}],required:(be=a.settings)==null?void 0:be.is_required,"min-date":(xe=a.settings)==null?void 0:xe.min_date,"max-date":(H=a.settings)==null?void 0:H.max_date,error:s.form.errors[`results.${(ve=a.inspection_point)==null?void 0:ve.id}.note`],onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):p("",!0),a.input_type==="textarea"&&F(a)?(n(),Se(Et,{key:4,modelValue:s.form.results[(we=a.inspection_point)==null?void 0:we.id].note,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},X=>{var C;return G((C=a.inspection_point)==null?void 0:C.id,X,"note")}],required:(he=a.settings)==null?void 0:he.is_required,"min-length":(_e=a.settings)==null?void 0:_e.min_length,"max-length":(qe=a.settings)==null?void 0:qe.max_length,placeholder:((Xe=a.settings)==null?void 0:Xe.placeholder)||"Masukkan teks di sini",settings:a.settings,error:s.form.errors[`results.${(Ye=a.inspection_point)==null?void 0:Ye.id}.note`],onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):p("",!0),a.input_type==="radio"&&F(a)?(n(),Se(Ci,{key:5,modelValue:s.form.results[(Je=a.inspection_point)==null?void 0:Je.id].status,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].status=X},X=>{var C;return N((C=a.inspection_point)==null?void 0:C.id,X,"status")}],notes:s.form.results[(Qe=a.inspection_point)==null?void 0:Qe.id].note,images:s.form.images[(et=a.inspection_point)==null?void 0:et.id],required:(tt=a.settings)==null?void 0:tt.is_required,"point-id":(at=a.inspection_point)==null?void 0:at.id,point:a,"inspection-id":s.inspectionId,settings:a.settings,"point-name":(st=a.inspection_point)==null?void 0:st.name,subtitle:(nt=a.inspection_point)==null?void 0:nt.description,"selected-point":a.inspection_point??null,options:((it=a.settings)==null?void 0:it.radios)||O,error:s.form.errors[`results.${(ot=a.inspection_point)==null?void 0:ot.id}.status`],onTriggerChange:c[0]||(c[0]=X=>oe(X)),"onUpdate:notes":X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},"onUpdate:images":X=>{var C;return s.form.images[(C=a.inspection_point)==null?void 0:C.id]=X},onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)},onHapus:X=>{var C;return I((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","subtitle","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):p("",!0),a.input_type==="imageTOradio"&&F(a)?(n(),Se(ji,{key:6,modelValue:s.form.results[(lt=a.inspection_point)==null?void 0:lt.id].status,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].status=X},X=>{var C;return N((C=a.inspection_point)==null?void 0:C.id,X,"status")}],notes:s.form.results[(rt=a.inspection_point)==null?void 0:rt.id].note,images:s.form.images[(ut=a.inspection_point)==null?void 0:ut.id],required:(dt=a.settings)==null?void 0:dt.is_required,"point-id":(ct=a.inspection_point)==null?void 0:ct.id,"inspection-id":s.inspectionId,settings:a.settings,"point-name":(gt=a.inspection_point)==null?void 0:gt.name,subtitle:(mt=a.inspection_point)==null?void 0:mt.description,point:a,"selected-point":a.inspection_point??null,options:((pt=a.settings)==null?void 0:pt.radios)||O,error:s.form.errors[`results.${(vt=a.inspection_point)==null?void 0:vt.id}.status`],onTriggerChange:c[1]||(c[1]=X=>oe(X)),"onUpdate:notes":X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},"onUpdate:images":X=>{var C;return s.form.images[(C=a.inspection_point)==null?void 0:C.id]=X},onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)},onHapus:X=>{var C;return I((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","subtitle","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):p("",!0),a.input_type==="image"&&F(a)?(n(),Se(Ze,{key:7,modelValue:s.form.images[(ft=a.inspection_point)==null?void 0:ft.id],"onUpdate:modelValue":X=>{var C;return s.form.images[(C=a.inspection_point)==null?void 0:C.id]=X},error:s.form.errors[`images.${(ht=a.inspection_point)==null?void 0:ht.id}`],"inspection-id":s.inspectionId,"point-id":(bt=a.inspection_point)==null?void 0:bt.id,point:a.inspection_point,"point-name":(yt=a.inspection_point)==null?void 0:yt.name,settings:a.settings,"onUpdate:notes":X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].note=X},"onUpdate:status":X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].status=X}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):p("",!0),a.input_type==="select"&&F(a)?(n(),Se(ss,{key:8,modelValue:s.form.results[(xt=a.inspection_point)==null?void 0:xt.id].status,"onUpdate:modelValue":[X=>{var C;return s.form.results[(C=a.inspection_point)==null?void 0:C.id].status=X},X=>{var C;return N((C=a.inspection_point)==null?void 0:C.id,X,"status")}],required:(wt=a.settings)==null?void 0:wt.is_required,error:s.form.errors[`results.${(kt=a.inspection_point)==null?void 0:kt.id}.status`],onTriggerChange:c[2]||(c[2]=X=>oe(X)),onSave:X=>{var C;return ae((C=a.inspection_point)==null?void 0:C.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):p("",!0),!F(a)&&J(a)?(n(),i("div",ro,[c[5]||(c[5]=t("p",{class:"font-medium"},"Tidak tersedia untuk kendaraan ini",-1)),c[6]||(c[6]=t("p",{class:"text-xs mt-1"},"Point ini hanya tersedia untuk:",-1)),t("ul",uo,[(It=a.settings)!=null&&It.transmission?(n(),i("li",co," Transmisi: "+z(ne(a.settings.transmission).join(", ")),1)):p("",!0),(_t=a.settings)!=null&&_t.fuel_type?(n(),i("li",go," Bahan bakar: "+z(a.settings.fuel_type),1)):p("",!0),(St=a.settings)!=null&&St.rear_door?(n(),i("li",mo,"Kendaraan dengan pintu belakang")):p("",!0),($t=a.settings)!=null&&$t.pick_up?(n(),i("li",po,"Tipe pick up")):p("",!0),(Ct=a.settings)!=null&&Ct.box?(n(),i("li",vo,"Kendaraan dengan box")):p("",!0)])])):p("",!0)]))],2)}),128)),ie.value.filter(a=>!a.is_link).length===0?(n(),i("div",fo,[c[7]||(c[7]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),c[8]||(c[8]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),s.category.isDamageMenu?(n(),i("p",ho,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):p("",!0)])):p("",!0)])],2)],64))}},bo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},yo={class:"p-4 space-y-4-6"},xo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},wo=["value"],ko={class:"p-4 space-y-4-6"},Io={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},_o=["value"],So={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},$o={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Co=["value"],Vo={class:"p-4 space-y-2"},Ao={class:"flex items-center justify-between mb-2"},To={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},Mo={class:"flex items-center justify-between mb-3"},Uo={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},No=["onClick"],Po={class:"text-sm font-medium text-gray-800 mb-1"},Eo={class:"text-xs text-gray-600 line-clamp-2"},Do={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Lo={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},Ro={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},jo={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},Fo={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},Bo={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(s,{emit:le}){const e=s,_=le,r=V(null),$=V(!1),b=V(!1),S=At({bold:!1,italic:!1,underline:!1}),w=At({flooded:"",collision:"",collision_severity:"",notes:""}),L=V([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi kendaraan secara umum: <b>BAIK</b><br>
- Tidak ditemukan indikasi kerusakan signifikan<br>
- Semua sistem berfungsi dengan normal<br>`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <b>RINGAN</b><br>
- Area yang terdampak: PERLU DIISI<br>
- Perbaikan yang dilakukan: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat terkena banjir<br>
- Tingkat paparan air: PERLU DIISI<br>
- Komponen yang terdampak: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah umum (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi umum kendaraan: PERLU DIISI<br>
- Masalah utama yang ditemukan: PERLU DIISI<br>
- Komponen yang perlu perhatian: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Status Keseluruhan Kendaraan: PERLU DIISI<br>
- Catatan Utama: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap (Lengkap A, C, B)",content:`<p><strong>A. LAPORAN HASIL INSPEKSI TEKNIS:</strong></p>
- Tanggal Inspeksi: PERLU DIISI<br>
- Kondisi Mesin: PERLU DIISI<br>
- Kondisi Transmisi: PERLU DIISI<br>
- Kondisi Suspensi: PERLU DIISI<br>
- Kondisi Rem: PERLU DIISI<br>
- Kondisi Body: PERLU DIISI<br>
- Kondisi Interior: PERLU DIISI<br>
- Kesimpulan Akhir: PERLU DIISI

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`}]);V(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]);const h=O=>{if(!O)return{};if(typeof O=="string")try{return JSON.parse(O)||{}}catch(D){return console.error("Error parsing settings JSON:",D),{}}return typeof O=="object"&&O!==null?O:{}};ue(()=>h(e.inspection.settings).conclusion||{});const E=[{value:"yes",label:"Ya Banjir"},{value:"no",label:"Tidak"}],T=[{value:"yes",label:"Ya Tabrak"},{value:"no",label:"Tidak"}],W=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];je(()=>{ne(),Ge(()=>{te(),P()})});const te=()=>{r.value&&w.notes&&(r.value.innerHTML=w.notes)},ne=()=>{const D=h(e.inspection.settings).conclusion||{},G=e.form.conclusion||{};w.flooded=G.flooded||D.flooded||"",w.collision=G.collision||D.collision||"",w.collision_severity=G.collision_severity||D.collision_severity||"",w.notes=G.notes||e.inspection.notes||""},F=O=>{if(!r.value)return;let D=O.content;D=D.replace(/{PLATE_NUMBER}/g,e.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,e.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,w.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,w.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),r.value.innerHTML=D,w.notes=D,b.value=!1,Ge(()=>{r.value.focus(),Y()})},J=()=>{r.value&&(r.value.innerHTML="",w.notes="",Y())},P=()=>{if(!r.value)return;const O=window.getSelection();O.rangeCount===0||O.isCollapsed||(S.bold=document.queryCommandState("bold"),S.italic=document.queryCommandState("italic"),S.underline=document.queryCommandState("underline"))},oe=O=>{if(!r.value)return;r.value.focus();const D=S[O];switch(O){case"bold":document.execCommand("bold",!1,!D);break;case"italic":document.execCommand("italic",!1,!D);break;case"underline":document.execCommand("underline",!1,!D);break}setTimeout(()=>{P(),N()},10)},N=Tt.debounce(()=>{r.value&&(w.notes=r.value.innerHTML,Y())},200),m=O=>{O.preventDefault(),document.execCommand("insertParagraph",!1,null)},x=O=>{O.preventDefault();const D=(O.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,D)},R=()=>{$.value=!0},ie=()=>{$.value=!1,r.value&&(w.notes=r.value.innerHTML,Y())},Q=()=>{Y()},Y=()=>{const O={flooded:w.flooded,collision:w.collision,collision_severity:w.collision==="yes"?w.collision_severity:null,notes:w.notes};_("updateConclusion",O)};return ye(()=>e.form.conclusion,O=>{O&&(w.flooded=O.flooded!==void 0?O.flooded:w.flooded,w.collision=O.collision!==void 0?O.collision:w.collision,w.collision_severity=O.collision_severity!==void 0?O.collision_severity:w.collision_severity,w.notes=O.notes!==void 0?O.notes:w.notes,r.value&&O.notes!==void 0&&r.value.innerHTML!==O.notes&&(r.value.innerHTML=O.notes))},{deep:!0,immediate:!0}),ye([()=>w.flooded,()=>w.collision,()=>w.collision_severity,()=>w.notes],()=>{Y()},{deep:!0}),(O,D)=>(n(),i("div",bo,[D[21]||(D[21]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),t("div",yo,[D[10]||(D[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",xo,[(n(),i(Ve,null,Ue(E,G=>t("label",{key:G.value,class:"cursor-pointer"},[Ee(t("input",{type:"radio","onUpdate:modelValue":D[0]||(D[0]=ae=>w.flooded=ae),value:G.value,class:"hidden peer",onChange:Q},null,40,wo),[[Ke,w.flooded]]),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":w.flooded===G.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":w.flooded!==G.value}])},z(G.label),3)])),64))])]),t("div",ko,[D[12]||(D[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Io,[(n(),i(Ve,null,Ue(T,G=>t("label",{key:G.value,class:"cursor-pointer"},[Ee(t("input",{type:"radio","onUpdate:modelValue":D[1]||(D[1]=ae=>w.collision=ae),value:G.value,class:"hidden peer",onChange:Q},null,40,_o),[[Ke,w.collision]]),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":w.collision===G.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":w.collision!==G.value}])},z(G.label),3)])),64))]),Me(He,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:De(()=>[w.collision==="yes"?(n(),i("div",So,[D[11]||(D[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ce("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",$o,[(n(),i(Ve,null,Ue(W,G=>t("label",{key:G.value,class:"cursor-pointer"},[Ee(t("input",{type:"radio","onUpdate:modelValue":D[2]||(D[2]=ae=>w.collision_severity=ae),value:G.value,class:"hidden peer",onChange:Q},null,40,Co),[[Ke,w.collision_severity]]),t("div",{class:me(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":w.collision_severity===G.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":w.collision_severity!==G.value}])},z(G.label),3)])),64))])])):p("",!0)]),_:1})]),t("div",Vo,[t("div",Ao,[D[14]||(D[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),t("button",{type:"button",onClick:D[3]||(D[3]=G=>b.value=!b.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},D[13]||(D[13]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),Ce(" Template ")]))]),Me(He,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:De(()=>[b.value?(n(),i("div",To,[t("div",Mo,[D[16]||(D[16]=t("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),t("button",{onClick:D[4]||(D[4]=G=>b.value=!1),class:"text-gray-400 hover:text-gray-600"},D[15]||(D[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",Uo,[(n(!0),i(Ve,null,Ue(L.value,G=>(n(),i("button",{key:G.id,onClick:ae=>F(G),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[t("div",Po,z(G.name),1),t("div",Eo,z(G.description),1)],8,No))),128))])])):p("",!0)]),_:1}),t("div",Do,[t("button",{type:"button",onClick:D[5]||(D[5]=G=>oe("bold")),class:me(["p-2 rounded transition-all duration-150 ease-in-out font-medium",S.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},D[17]||(D[17]=[t("strong",null,"B",-1)]),2),t("button",{type:"button",onClick:D[6]||(D[6]=G=>oe("italic")),class:me(["p-2 rounded transition-all duration-150 ease-in-out font-medium",S.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},D[18]||(D[18]=[t("em",null,"I",-1)]),2),t("button",{type:"button",onClick:D[7]||(D[7]=G=>oe("underline")),class:me(["p-2 rounded transition-all duration-150 ease-in-out font-medium",S.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},D[19]||(D[19]=[t("u",null,"U",-1)]),2),t("button",{type:"button",onClick:D[8]||(D[8]=G=>J()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),Me(He,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:De(()=>[Object.values(S).some(G=>G)?(n(),i("div",Lo,[D[20]||(D[20]=Ce(" Format aktif: ")),S.bold?(n(),i("span",Ro,"Bold")):p("",!0),S.italic?(n(),i("span",jo,"Italic")):p("",!0),S.underline?(n(),i("span",Fo,"Underline")):p("",!0)])):p("",!0)]),_:1}),t("div",{ref_key:"editorRef",ref:r,contenteditable:"true",class:me(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!$.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":$.value}]),onInput:D[9]||(D[9]=(...G)=>Ne(N)&&Ne(N)(...G)),onBlur:ie,onFocus:R,onKeydown:Bt(m,["enter"]),onPaste:x,onMouseup:P,onKeyup:P,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Yo=Re(Bo,[["__scopeId","data-v-e634ba43"]]);function Jo(s,le){const e=V({x:le.x,y:le.y}),_=V(!1),r=V(null),$=V(!1),b=V({x:0,y:0});je(()=>{const T=localStorage.getItem(s);if(T)try{e.value=JSON.parse(T)}catch(W){console.error("Error parsing saved position:",W)}});const S=T=>{T.type.includes("touch")?(b.value.x=T.touches[0].clientX,b.value.y=T.touches[0].clientY):(b.value.x=T.clientX,b.value.y=T.clientY),r.value=setTimeout(()=>{$.value=!0,_.value=!0,console.log("Long press activated - drag mode ON")},900)},w=()=>{r.value&&(clearTimeout(r.value),r.value=null),$.value=!1};return{pos:e,dragging:_,startLongPress:S,cancelLongPress:w,onDrag:T=>{if(!_.value||!$.value)return;T.preventDefault();let W,te;T.type.includes("touch")?(W=T.touches[0].clientX,te=T.touches[0].clientY):(W=T.clientX,te=T.clientY),e.value.x=W-24,e.value.y=te-24},stopDrag:()=>{if(_.value&&$.value){console.log("Drag stopped - saving position"),_.value=!1,$.value=!1;try{localStorage.setItem(s,JSON.stringify(e.value))}catch(T){console.error("Error saving position:",T)}}w()},handleClick:T=>!_.value&&!$.value?(console.log("Regular click detected"),!0):(console.log("Click ignored - part of drag operation"),!1)}}export{Jn as B,Yo as C,Zo as V,Xo as _,Dt as a,Jo as u};
