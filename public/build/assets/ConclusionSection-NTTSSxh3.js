import{x as Tt,r as E,g as Pe,q as X,E as Le,G as ue,c as i,o as n,d as t,b as c,k as be,z as Ae,A as Me,n as oe,t as R,u as Ue,e as Ut,F as xe,m as we,f as ye,y as Re,w as Ce,N as Ee,L as Fe,a as Be,j as ke,l as xt,T as De,M as Nt,p as Et,O as wt,D as kt,J as je,B as Mt}from"./vendor-g77w9U1W.js";import{l as It}from"./lodash-CGXsUT3p.js";import{_ as Pt}from"./PrimaryButton-CrKKsBb9.js";import{_ as Rt}from"./ActionMessage-C9w22vKV.js";import{_ as Te}from"./app-BtmydV17.js";const Dt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Lt={key:0,class:"p-4 space-y-2"},Bt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},jt={class:"flex items-center space-x-2"},Ft={key:0,class:"text-xs text-red-500 font-normal ml-2"},qt={key:1,class:"text-xs text-red-500 font-normal ml-2"},Ot={key:2,class:"text-xs text-green-500 font-normal ml-2"},Kt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},zt={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Ht={class:"col-span-2 flex space-x-3"},Gt={class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Wt={class:"flex items-start"},Zt={class:"text-sm text-blue-700"},Jt={class:"mt-1"},Xt={key:0,class:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-medium mr-2"},Yt={key:1,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium mr-2"},Qt={key:2,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium"},ea={key:3,class:"text-blue-600"},ta={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},aa={class:"relative"},sa={key:0,class:"absolute right-3 top-3"},na={key:1,class:"text-xs text-red-500 font-normal ml-2"},oa={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ia={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},la={key:0},ra=["onMousedown"],da={class:"font-medium text-gray-900"},ua={class:"text-sm text-gray-500"},ca={key:1,class:"p-4 text-sm text-gray-500 text-center"},pa={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ga={key:0,class:"mb-4"},ma=["innerHTML"],va={key:1},fa={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ha=["onClick"],ba=["src","alt"],ya={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},xa={class:"text-white text-xs text-center"},wa={key:2,class:"text-center py-4 text-gray-500 text-sm"},ka={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ia=["src","alt"],_a={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},$a={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Sa={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Va={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges","update:vehicle-type"],setup(a,{emit:W}){var w,Y,J,ee,G,de;const e=a,_=W,r=Tt({plate_number:((w=e.inspection)==null?void 0:w.plate_number)||"",car_id:((Y=e.inspection)==null?void 0:Y.car_id)||null,car_name:((J=e.inspection)==null?void 0:J.car_name)||""}),I=E(((ee=e.inspection)==null?void 0:ee.plate_number)||""),v=E(((G=e.inspection)==null?void 0:G.car_id)||null),N=E(((de=e.inspection)==null?void 0:de.car_name)||""),f=E(""),C=E(""),U=E(""),V=E(null),L=E({rear_door:!1}),K=E(!1),p=E(""),l=E(""),A=E(r.car_name),P=E(!1),$=E(!1),q=E([]),Z=E(null),S=E([]),b=E(!1),j=E(0);Pe(()=>{var k,h,ne,O,le;if(M((k=e.inspection)==null?void 0:k.plate_number),(h=e.inspection)!=null&&h.car_id&&((ne=e.CarDetail)==null?void 0:ne.length)>0){const pe=e.CarDetail.find(ve=>ve.id===e.inspection.car_id);pe&&ce(pe)}else!((O=e.inspection)!=null&&O.car_id)&&((le=e.inspection)!=null&&le.car_name)&&(A.value=e.inspection.car_name,r.car_id=null);window.addEventListener("keydown",d),H(),_("update:hasUnsavedChanges",te.value),_("update:validation",se.value)}),Le(()=>{window.removeEventListener("keydown",d)});const H=()=>{try{const k=localStorage.getItem("vehicle_features");if(k){const h=JSON.parse(k);L.value.rear_door=h.rear_door||!1,h.pick_up?V.value="pick_up":h.box?V.value="box":V.value=null}else L.value.rear_door=!1,V.value=null;m()}catch(k){console.error("Error loading vehicle type from localStorage:",k),L.value.rear_door=!1,V.value=null,m()}},y=()=>{L.value.rear_door=!L.value.rear_door,s()},g=k=>{V.value===k?V.value=null:V.value=k,s()},s=()=>{try{const k={rear_door:L.value.rear_door,pick_up:V.value==="pick_up",box:V.value==="box"};localStorage.setItem("vehicle_features",JSON.stringify(k)),m(),console.log("Vehicle features saved to localStorage:",k)}catch(k){console.error("Error saving vehicle type to localStorage:",k)}},m=()=>{const k={rear_door:L.value.rear_door,pick_up:V.value==="pick_up",box:V.value==="box"};_("update:vehicle-type",k)},M=k=>{if(!k){f.value="",C.value="",U.value="";return}const h=k.toUpperCase().trim(),ne=h.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(ne)f.value=ne[1]||"",C.value=ne[2]||"",U.value=ne[3]||"";else{let O="area",le="",pe="",ve="";for(const me of h)O==="area"&&/[A-Z]/.test(me)?le+=me:O==="area"&&/[0-9]/.test(me)?(O="number",pe+=me):O==="number"&&/[0-9]/.test(me)?pe+=me:O==="number"&&/[A-Z]/.test(me)?(O="suffix",ve+=me):O==="suffix"&&/[A-Z]/.test(me)&&(ve+=me);f.value=le,C.value=pe,U.value=ve}Q()},Q=()=>{const k=`${f.value}${C.value}${U.value}`;r.plate_number=k,u()},D=k=>{k==="area"?f.value=f.value.toUpperCase().replace(/[^A-Z]/g,""):k==="number"?C.value=C.value.replace(/[^0-9]/g,""):k==="suffix"&&(U.value=U.value.toUpperCase().replace(/[^A-Z]/g,"")),Q()},B=X(()=>{const k=r.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(k)}),z=X(()=>!A.value||A.value.trim()===""),ae=X(()=>r.plate_number.length>0&&!B.value?"Format plat nomor tidak valid.":null),se=X(()=>{const k=!r.plate_number||r.plate_number.trim()==="",h=!A.value||A.value.trim()==="";return k||h||!B.value||K.value}),te=X(()=>{const k=r.plate_number!==I.value,h=r.car_id!==v.value||A.value!==N.value;return k||h}),ie=X(()=>te.value&&!se.value),re=k=>{var ne,O,le;if(!k)return"";const h=[];return(ne=k.brand)!=null&&ne.name&&h.push(k.brand.name),(O=k.model)!=null&&O.name&&h.push(k.model.name),(le=k.type)!=null&&le.name&&h.push(k.type.name),k.cc&&h.push((k.cc/1e3).toFixed(1)),k.transmission&&h.push(k.transmission),k.year&&h.push(k.year.toString()),k.fuel_type&&h.push(k.fuel_type),k.production_period&&h.push(`(${k.production_period})`),h.join(" ")},ge=()=>{r.car_id&&(r.car_id=null,Z.value=null,S.value=[]),fe()},fe=It.debounce(()=>{if(!A.value.trim()){q.value=[],P.value=!1;return}$.value=!0;try{const k=A.value.toLowerCase().trim();q.value=e.CarDetail.filter(h=>re(h).toLowerCase().includes(k)),P.value=!0}finally{$.value=!1}},300),he=()=>{setTimeout(()=>{P.value=!1,r.car_name=A.value,u()},200)},ce=async k=>{Z.value=k,A.value=re(k),r.car_id=k.id,r.car_name=re(k),P.value=!1,await Ve(k.id),u(),_("update:hasUnsavedChanges",te.value),_("update:validation",se.value)},$e=k=>!k||!k.file_path?"":`/storage/${k.file_path}`,Ve=async k=>{try{const h=await fetch(`/api/cars/${k}/images`);if(h.ok){const ne=await h.json();S.value=Array.isArray(ne)?ne:[]}else S.value=[]}catch(h){console.error("Error loading car images:",h),S.value=[]}},Se=k=>{j.value=k,b.value=!0,document.body.style.overflow="hidden"},Ie=()=>{b.value=!1,document.body.style.overflow=""},_e=()=>{j.value=(j.value+1)%S.value.length},o=()=>{j.value=(j.value-1+S.value.length)%S.value.length},d=k=>{if(b.value)switch(k.key){case"Escape":Ie();break;case"ArrowRight":_e();break;case"ArrowLeft":o();break}},u=()=>{const k={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};_("update-vehicle",k)},T=()=>{e.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:e.inspection.id}),{preserveScroll:!0,onSuccess:()=>{I.value=r.plate_number,v.value=r.car_id,N.value=r.car_name,_("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:k=>{console.error("Gagal menyimpan data:",k)}})};return ue([()=>r.plate_number,()=>r.car_name],k=>{p.value="",K.value=!1,l.value="";const h=k[0];if(h&&h.length>=6){const ne=e.allInspections.filter(O=>{var le;return O.plate_number===h&&O.id!==((le=e.inspection)==null?void 0:le.id)});if(ne.length>0){const O=["draft","in_progress","pending","pending_review","revision"],le=ne.find(pe=>O.includes(pe.status));if(le)K.value=!0,p.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${le.status.replace(/_/g," ").toUpperCase()}.`;else{const pe=ne.filter(ve=>["approved","rejected","completed","cancelled"].includes(ve.status));if(pe.length>0){pe.sort((me,Ne)=>new Date(Ne.created_at)-new Date(me.created_at));const ve=pe[0];if(ve.car_id){const me=e.CarDetail.find(Ne=>Ne.id===ve.car_id);me&&ce(me)}else ve.car_name&&(A.value=ve.car_name,r.car_name=ve.car_name,r.car_id=null);l.value=`Nomor plat ini sudah pernah diperiksa ${pe.length} kali sebelumnya.`}}}}_("update:hasUnsavedChanges",te.value),_("update:validation",se.value)},{deep:!0}),ue([()=>L.value.rear_door,()=>V.value],()=>{s()}),(k,h)=>{var ne;return n(),i("div",Dt,[h[27]||(h[27]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),a.inspection?(n(),i("div",Lt,[t("div",Bt,[h[11]||(h[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",jt,[Ae(t("input",{"onUpdate:modelValue":h[0]||(h[0]=O=>f.value=O),type:"text",placeholder:"Contoh: B",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!B.value||K.value}]),onInput:h[1]||(h[1]=O=>D("area")),maxlength:"2"},null,34),[[Me,f.value]]),Ae(t("input",{"onUpdate:modelValue":h[2]||(h[2]=O=>C.value=O),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:oe(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!B.value||K.value}]),onInput:h[3]||(h[3]=O=>D("number")),maxlength:"4"},null,34),[[Me,C.value]]),Ae(t("input",{"onUpdate:modelValue":h[4]||(h[4]=O=>U.value=O),type:"text",placeholder:"ABC",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!B.value||K.value}]),onInput:h[5]||(h[5]=O=>D("suffix")),maxlength:"3"},null,34),[[Me,U.value]])]),ae.value?(n(),i("span",Ft,R(ae.value),1)):c("",!0),p.value?(n(),i("span",qt,R(p.value),1)):c("",!0),l.value?(n(),i("span",Ot,R(l.value),1)):c("",!0)]),t("div",Kt,[h[15]||(h[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Jenis Kendaraan ",-1)),t("div",zt,[t("div",{class:oe(["w-full px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":L.value.rear_door,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":!L.value.rear_door}]),onClick:y},h[12]||(h[12]=[t("span",null,"Pintu Belakang",-1)]),2),t("div",Ht,[t("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":V.value==="pick_up","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":V.value!=="pick_up"}]),onClick:h[6]||(h[6]=O=>g("pick_up"))}," Pick Up ",2),t("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":V.value==="box","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":V.value!=="box"}]),onClick:h[7]||(h[7]=O=>g("box"))}," Box ",2)])]),t("div",Gt,[t("div",Wt,[h[14]||(h[14]=t("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",Zt,[h[13]||(h[13]=t("p",{class:"font-medium"},"Status Kendaraan:",-1)),t("p",Jt,[L.value.rear_door?(n(),i("span",Xt," ✓ Mobil Pada Umum nya yang memiliki Pintu Belakang ")):c("",!0),V.value==="pick_up"?(n(),i("span",Yt," ✓ Pick Up ")):c("",!0),V.value==="box"?(n(),i("span",Qt," ✓ Box ")):c("",!0),!L.value.rear_door&&!V.value?(n(),i("span",ea," Pilih jenis kendaraan agar point bisa menyesuaikan dengan tipe kendaraan anda ")):c("",!0)])])])])]),t("div",ta,[h[19]||(h[19]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",aa,[Ae(t("input",{"onUpdate:modelValue":h[8]||(h[8]=O=>A.value=O),type:"text",placeholder:"Cari atau ketik nama mobil...",class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":z.value}]),onInput:ge,onFocus:h[9]||(h[9]=O=>P.value=!0),onBlur:he},null,34),[[Me,A.value]]),$.value?(n(),i("div",sa,h[16]||(h[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c("",!0),z.value?(n(),i("span",na,"Nama mobil tidak boleh kosong.")):c("",!0),!Ue(r).car_id&&A.value?(n(),i("div",oa,h[17]||(h[17]=[Ut('<div class="flex items-start" data-v-93565d5f><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-93565d5f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-93565d5f></path></svg><div data-v-93565d5f><p class="text-yellow-800 font-medium mb-1" data-v-93565d5f>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-93565d5f>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-93565d5f> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-93565d5f>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-93565d5f>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):c("",!0),P.value?(n(),i("div",ia,[q.value.length>0?(n(),i("div",la,[(n(!0),i(xe,null,we(q.value,O=>(n(),i("div",{key:O.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:le=>ce(O)},[t("div",da,R(re(O)),1),t("div",ua,R(O.year)+" • "+R(O.cc)+"cc • "+R(O.transmission)+" • "+R(O.fuel_type),1)],40,ra))),128))])):(n(),i("div",ca,h[18]||(h[18]=[ye(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),ye(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):c("",!0)])]),Ue(r).car_id&&Z.value?(n(),i("div",pa,[Z.value.description?(n(),i("div",ga,[h[20]||(h[20]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:Z.value.description},null,8,ma)])):c("",!0),S.value.length>0?(n(),i("div",va,[h[21]||(h[21]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",fa,[(n(!0),i(xe,null,we(S.value,(O,le)=>(n(),i("div",{key:O.id||le,class:"relative group cursor-pointer",onClick:pe=>Se(le)},[t("img",{src:$e(O),alt:O.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ba),O.note?(n(),i("div",ya,[t("p",xa,R(O.note),1)])):c("",!0)],8,ha))),128))])])):(n(),i("div",wa," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),b.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:Ie},[t("div",ka,[t("button",{onClick:Ie,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},h[22]||(h[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),S.value.length>1?(n(),i("button",{key:0,onClick:Re(o,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[23]||(h[23]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),S.value.length>1?(n(),i("button",{key:1,onClick:Re(_e,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[24]||(h[24]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),t("img",{src:$e(S.value[j.value]),alt:"Car Image "+(j.value+1),class:"max-w-full max-h-full object-contain",onClick:h[10]||(h[10]=Re(()=>{},["stop"]))},null,8,Ia),S.value.length>1?(n(),i("div",_a,R(j.value+1)+" / "+R(S.value.length),1)):c("",!0),(ne=S.value[j.value])!=null&&ne.note?(n(),i("div",$a,R(S.value[j.value].note),1)):c("",!0)])])):c("",!0),be(Pt,{type:"button",onClick:T,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!ie.value},{default:Ce(()=>[Ue(r).processing?(n(),i("svg",Sa,h[25]||(h[25]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),t("span",null,R(Ue(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),be(Rt,{on:Ue(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Ce(()=>h[26]||(h[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),ye(" Tersimpan. ")])),_:1,__:[26]},8,["on"])]),_:1},8,["disabled"])])):c("",!0)])}}},_i=Te(Va,[["__scopeId","data-v-93565d5f"]]),Aa={class:"mt-1"},Ca=["value","required","minlength","maxlength","allowSpace","placeholder"],Ta={key:0,class:"mt-2 text-sm text-red-600"},_t={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=X(()=>{if(!e.modelValue)return"";let v=e.modelValue;switch(e.allowSpace||(v=v.replace(/\s+/g,"")),e.textTransform){case"uppercase":return v.toUpperCase();case"lowercase":return v.toLowerCase();case"capitalize":return v.replace(/\b\w/g,N=>N.toUpperCase());default:return v}}),I=v=>{let N=v.target.value;switch(e.allowSpace||(N=N.replace(/\s+/g,"")),e.textTransform){case"uppercase":N=N.toUpperCase();break;case"lowercase":N=N.toLowerCase();break;case"capitalize":N=N.replace(/\b\w/g,f=>f.toUpperCase());break}_("update:modelValue",N),_("save",e.pointId)};return(v,N)=>(n(),i("div",Aa,[t("input",{value:r.value,onInput:I,type:"text",required:a.required,minlength:a.minLength,maxlength:a.maxLength,allowSpace:a.allowSpace,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:a.textTransform==="uppercase",lowercase:a.textTransform==="lowercase",capitalize:a.textTransform==="capitalize"}])},null,42,Ca),a.error?(n(),i("p",Ta,R(a.error),1)):c("",!0)]))}},Ua={class:"mt-1"},Na=["value","required","min","max","step","placeholder"],Ea={key:0,class:"mt-2 text-sm text-red-600"},$t={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=I=>{const v=I.target.value;_("update:modelValue",v),_("save",e.pointId)};return(I,v)=>(n(),i("div",Ua,[t("input",{value:a.modelValue,onInput:r,type:"number",required:a.required,min:a.min,max:a.max,step:a.step,placeholder:a.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Na),a.error?(n(),i("p",Ea,R(a.error),1)):c("",!0)]))}},Ma={class:"mt-1"},Pa=["value","required","min","max"],Ra={key:0,class:"mt-2 text-sm text-red-600"},St={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=I=>{_("update:modelValue",I.target.value),_("save",e.pointId)};return(I,v)=>(n(),i("div",Ma,[t("input",{value:a.modelValue,onChange:r,type:"date",required:a.required,min:a.minDate,max:a.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Pa),a.error?(n(),i("p",Ra,R(a.error),1)):c("",!0)]))}},Da={class:"mt-1"},La=["value","required","placeholder"],Ba={key:0,class:"mt-2 text-sm text-red-600"},Vt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=E(""),I=X(()=>{var U,V,L,K;return{currency_symbol:((U=e.settings)==null?void 0:U.currency_symbol)||"Rp",thousands_separator:((V=e.settings)==null?void 0:V.thousands_separator)||",",min_value:((L=e.settings)==null?void 0:L.min_value)!==void 0?Number(e.settings.min_value):0,max_value:((K=e.settings)==null?void 0:K.max_value)!==void 0?Number(e.settings.max_value):1e9}}),v=U=>{if(U==null||U==="")return"";const V=Number(U);if(isNaN(V))return"";let L=V.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return I.value.thousands_separator!==","&&(L=L.replace(/,/g,I.value.thousands_separator)),L},N=U=>U?U.replace(/[^\d]/g,""):"",f=X(()=>r.value?`${I.value.currency_symbol} ${v(r.value)}`:""),C=U=>{let V=N(U.target.value),L=Number(V);I.value.min_value!==void 0&&L<I.value.min_value&&(V=I.value.min_value.toString()),I.value.max_value!==void 0&&L>I.value.max_value&&(V=I.value.max_value.toString()),r.value=V,_("update:modelValue",V),_("save",e.pointId)};return ue(()=>e.modelValue,U=>{U!=null&&(r.value=U.toString())},{immediate:!0}),(U,V)=>(n(),i("div",Da,[t("input",{value:f.value,onInput:C,type:"text",required:a.required,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",a.error?"border-red-300":"border-gray-300"])},null,42,La),a.error?(n(),i("p",Ba,R(a.error),1)):c("",!0)]))}},ja={class:"mt-1 space-y-3"},Fa={key:0,class:"space-y-2"},qa={class:"flex flex-wrap gap-2"},Oa=["onClick"],Ka=["value","required","minlength","maxlength","placeholder"],za={class:"flex justify-between items-center mt-1"},Ha={class:"text-xs text-gray-500"},Ga={key:0,class:"text-xs text-red-600"},At={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=E([]),I=E(""),v=U=>r.value.some(V=>V.value===U),N=U=>{v(U.value)?r.value=r.value.filter(p=>p.value!==U.value):r.value.push(U);const L=[...r.value.map(p=>p.value)];I.value.trim()&&L.push(I.value.trim());const K=L.join(", ");_("update:modelValue",K),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:K})},f=U=>{const V=U.target.value;_("update:modelValue",V),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:V}),C(V)},C=U=>{var p,l,A,P;if(!U){r.value=[],I.value="";return}const V=U.split(",").map($=>$.trim()).filter($=>$),L=((l=(p=e.settings)==null?void 0:p.damage_options)==null?void 0:l.map($=>$.value))||[];r.value=((P=(A=e.settings)==null?void 0:A.damage_options)==null?void 0:P.filter($=>V.includes($.value)))||[];const K=V.filter($=>!L.includes($));I.value=K.join(", ")};return ue(()=>e.modelValue,U=>{U!=null&&C(U)},{immediate:!0}),ue(()=>{var U;return(U=e.settings)==null?void 0:U.damage_options},(U,V)=>{if(U!==V){const L=U?U.map(A=>A.value):[];r.value=r.value.filter(A=>L.includes(A.value));const p=[...r.value.map(A=>A.value)];I.value.trim()&&p.push(I.value.trim());const l=p.filter(A=>A).join(", ");_("update:modelValue",l),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:l})}},{deep:!0,immediate:!1}),(U,V)=>{var L,K,p;return n(),i("div",ja,[(L=a.settings)!=null&&L.enable_damage&&((K=a.settings)!=null&&K.damage_options)?(n(),i("div",Fa,[V[0]||(V[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",qa,[(n(!0),i(xe,null,we(a.settings.damage_options,(l,A)=>(n(),i("button",{key:A,type:"button",onClick:P=>N(l),class:oe(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":v(l.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!v(l.value)}])},R(l.label),11,Oa))),128))])])):c("",!0),t("div",null,[t("textarea",{value:a.modelValue,onInput:f,required:a.required,minlength:a.minLength,maxlength:a.maxLength,placeholder:a.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ka),t("div",za,[t("span",Ha,R(((p=a.modelValue)==null?void 0:p.length)||0)+"/"+R(a.maxLength||400),1),a.error?(n(),i("p",Ga,R(a.error),1)):c("",!0)])])])}}},Wa={class:"mt-1"},Za=["value","required"],Ja={key:0,class:"mt-2 text-sm text-red-600"},Xa={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:W}){const e=a,_=W,r=I=>{_("update:modelValue",I.target.value),_("save",e.pointId)};return(I,v)=>(n(),i("div",Wa,[t("select",{value:a.modelValue,onChange:r,required:a.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},v[0]||(v[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,Za),a.error?(n(),i("p",Ja,R(a.error),1)):c("",!0)]))}},Ya=Te(Xa,[["__scopeId","data-v-1b6c0201"]]),Qa={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},es={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},ts={class:"text-xs text-gray-500 mt-2 text-center"},as={class:"flex flex-row space-x-4 mb-6"},ss={class:"mt-4 text-right"},ns={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(a){return(W,e)=>a.show?(n(),i("div",Qa,[t("div",es,[e[7]||(e[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",ts,[e[3]||(e[3]=ye("Ambil Foto Maksimal: ")),t("b",null,R(a.settings.max_files),1),e[4]||(e[4]=ye(" Dengan Rasio & Ukuran: ")),t("b",null,R(a.settings.camera_aspect_ratio),1)]),t("div",as,[t("button",{onClick:e[0]||(e[0]=_=>W.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:e[1]||(e[1]=_=>W.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",ss,[t("button",{onClick:e[2]||(e[2]=_=>W.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):c("",!0)}},os={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},is={class:"w-full h-full flex flex-col"},ls={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},rs=["disabled"],ds={class:"text-lg font-semibold"},us={class:"flex items-center gap-2"},cs=["disabled"],ps={key:0,class:"px-4 py-2 bg-indigo-900 text-white"},gs={class:"flex justify-between items-center text-sm"},ms={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},vs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},fs=["src"],hs={key:1,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3"},bs=["disabled"],ys=["disabled"],xs={key:2,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},ws={key:3,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},ks=["disabled"],Is=["disabled"],_s=["disabled"],$s={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ss={class:"flex justify-between items-center w-full"},Vs=["disabled"],As={key:1,class:"flex-1"},Cs=["disabled"],Ts={class:"flex gap-3 w-full"},Us={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},Ns={class:"flex items-center gap-2"},Es={key:0,class:"text-center"},Ms={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(a,{emit:W}){const e=a,_=W,r=E(0),I=E([]),v=X(()=>I.value.length>0?I.value[r.value]:null);ue(()=>e.images,P=>{I.value=P.map($=>({...$,rotation:$.isNew&&$.rotation||0})),P.length===0&&e.show&&L()},{deep:!0,immediate:!0}),ue(()=>e.show,P=>{P&&e.images.length>0&&(r.value=e.initialIndex)}),ue(()=>e.uploadProgress,P=>{P===100&&console.log("Upload completed")});const N=P=>P.preview||(P.image_path?`/${P.image_path}`:""),f=P=>{if(v.value&&v.value.isNew&&!e.isUploading){const $=v.value.rotation||0;let q;P==="left"?q=$-90:q=$+90,q=(q%360+360)%360,I.value[r.value].rotation=q,_("update:images",I.value)}},C=()=>{e.isUploading||(r.value=r.value<I.value.length-1?r.value+1:0)},U=()=>{e.isUploading||(r.value=r.value>0?r.value-1:I.value.length-1)},V=()=>{e.isUploading||_("saveImages",I.value)},L=()=>{e.isUploading||_("close")},K=()=>{if(v.value&&!e.isUploading){const P=v.value,$=I.value.findIndex(q=>q.isNew&&P.isNew&&q.preview===P.preview||!q.isNew&&!P.isNew&&q.id===P.id);$!==-1&&(_("removePreviewImage",P),I.value.splice($,1),_("update:images",I.value)),r.value>=I.value.length&&(r.value=Math.max(0,I.value.length-1)),I.value.length===0&&_("close")}},p=()=>{e.isUploading||_("triggerAddMorePhotos")},l=()=>{v.value&&!e.isUploading&&_("retryImage",v.value)},A=P=>{P.key==="Escape"&&!e.isUploading&&L()};return Pe(()=>{document.addEventListener("keydown",A)}),Le(()=>{document.removeEventListener("keydown",A)}),(P,$)=>{var q;return a.show?(n(),i("div",os,[t("div",is,[t("div",ls,[t("button",{onClick:L,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:a.isUploading},$[2]||($[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,rs),t("div",ds,R(((q=a.point)==null?void 0:q.name)||"Preview")+" ("+R(r.value+1)+"/"+R(I.value.length)+") ",1),t("div",us,[v.value&&v.value.isNew?(n(),i("button",{key:0,onClick:K,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:a.isUploading},$[3]||($[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,cs)):c("",!0)])]),a.isUploading?(n(),i("div",ps,[t("div",gs,[t("span",null,"Mengupload: "+R(a.currentUpload)+"/"+R(a.totalUpload),1),t("span",null,R(a.uploadProgress)+"%",1)]),t("div",ms,[t("div",{class:"bg-gradient-to-r from-indigo-500 to-sky-400 h-2 rounded-full progress-bar",style:Ee({width:a.uploadProgress+"%"})},null,4)])])):c("",!0),t("div",vs,[t("div",{class:"relative w-full max-w-full",style:Ee({paddingTop:a.aspectRatio?100/a.aspectRatio+"%":"75%"})},[v.value?(n(),i("img",{key:0,src:N(v.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Ee({transform:`rotate(${v.value.rotation}deg)`})},null,12,fs)):c("",!0),v.value&&v.value.isNew&&!v.value.isUploading&&!v.value.isFailed?(n(),i("div",hs,[t("button",{onClick:$[0]||($[0]=Z=>f("left")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kiri"},$[4]||($[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9",transform:"rotate(180 12 12)"})],-1)]),8,bs),t("button",{onClick:$[1]||($[1]=Z=>f("right")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kanan"},$[5]||($[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9"})],-1)]),8,ys)])):c("",!0),v.value&&v.value.isUploading?(n(),i("div",xs,$[6]||($[6]=[t("div",{class:"text-center text-white"},[t("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t("p",{class:"text-sm"},"Mengupload...")],-1)]))):c("",!0),v.value&&v.value.isFailed?(n(),i("div",ws,[$[7]||($[7]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),$[8]||($[8]=t("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),t("button",{onClick:l,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:a.isUploading}," Coba Lagi ",8,ks)])):c("",!0)],4),I.value.length>1&&!a.isUploading?(n(),i("button",{key:0,onClick:U,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},$[9]||($[9]=[t("svg",{xmlns:"http://www.w3.org2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Is)):c("",!0),I.value.length>1&&!a.isUploading?(n(),i("button",{key:1,onClick:C,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},$[10]||($[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,_s)):c("",!0)]),t("div",$s,[t("div",Ss,[v.value&&!v.value.isNew?(n(),i("button",{key:0,onClick:K,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:a.isUploading},$[11]||($[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ye(" Hapus Foto ")]),8,Vs)):(n(),i("div",As)),a.allowMultiple&&I.value.length<a.maxFiles&&!a.isUploading?(n(),i("button",{key:2,onClick:p,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:a.isUploading},$[12]||($[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ye(" Tambah Foto ")]),8,Cs)):c("",!0)]),t("div",Ts,[a.isUploading?(n(),i("button",Us,[t("div",Ns,[$[13]||($[13]=t("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),t("span",null,"Mengupload... "+R(a.uploadProgress)+"%",1)])])):(n(),i("button",{key:0,onClick:V,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),a.isUploading?(n(),i("div",Es,$[14]||($[14]=[t("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):c("",!0)])])])):c("",!0)}}},Ps=Te(Ms,[["__scopeId","data-v-0e4bb6d9"]]),Rs={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ds={class:"webcam-content-box"},Ls={class:"webcam-header"},Bs={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},js={class:"inspection-point-name"},Fs={key:0,class:"screen-flash-overlay"},qs={key:2,class:"zoom-controls"},Os=["max"],Ks={class:"webcam-footer"},zs={class:"camera-controls"},Hs=["disabled"],Gs={class:"camera-icon-container"},Ws={key:0,class:"camera-spinner"},Zs={key:1,class:"camera-body"},Js={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(a,{emit:W}){const e=a,_=W,r=E(null),I=E(null);let v=null,N=null;const f=E("environment"),C=E(!1),U=E(!1),V=E(!1),L=E(!1),K=E(!1),p=E({}),l=E(!1),A=E(1),P=E(1),$=E(!1),q=X(()=>{var D;return((D=e.settings)==null?void 0:D.max_size)||2048}),Z=X(()=>e.aspectRatio?{aspectRatio:`${e.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),S=X(()=>{if(!e.aspectRatio)return{};const D=e.aspectRatio,B=D>1?80:60,z=D>1?80/D:60*D;return{width:`${B}%`,height:`${z}%`}}),b=async()=>{v&&v.getTracks().forEach(D=>D.stop());try{const D={facingMode:f.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:e.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};v=await navigator.mediaDevices.getUserMedia({video:D,audio:!1}),N=v.getVideoTracks()[0],r.value.srcObject=v,r.value.onloadedmetadata=async()=>{await H(),await r.value.play()}}catch(D){console.error("Error accessing camera: ",D),alert("Failed to access camera. Please allow camera permission."),_("close")}},j=()=>{v&&v.getTracks().forEach(D=>D.stop()),_("close")},H=async()=>{if(N)try{const D=await navigator.mediaDevices.enumerateDevices();C.value=D.filter(z=>z.kind==="videoinput").length>1;const B=N.getCapabilities();B.zoom?($.value=!0,P.value=B.zoom.max,console.log(`Zoom supported. Max zoom: ${P.value}`)):($.value=!1,console.warn("Zoom is not supported by this camera.")),U.value=B.torch||B.fillLightMode&&B.fillLightMode.includes("torch")}catch(D){console.error("Error checking camera capabilities:",D)}},y=async D=>{if(!N)return;const B=r.value.getBoundingClientRect(),z=D.clientX-B.left,ae=D.clientY-B.top;K.value=!0,p.value={left:`${z}px`,top:`${ae}px`,transform:"translate(-50%, -50%)"};try{if(N.getCapabilities().pointsOfInterest){const te=z/B.width,ie=ae/B.height;await N.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:te,y:ie}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(se){console.warn("Manual focus failed:",se)}setTimeout(()=>{K.value=!1,N.getCapabilities().focusMode.includes("continuous")&&N.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},g=async D=>{if(!N||!$.value)return;const B=Math.min(Math.max(D,1),P.value);A.value=B;try{await N.applyConstraints({advanced:[{zoom:B}]})}catch(z){console.error("Failed to set zoom:",z)}},s=async()=>{if(!(!N||!U.value))try{f.value==="user"?(V.value=!V.value,L.value=V.value):(await N.applyConstraints({advanced:[{torch:!V.value}]}),V.value=!V.value)}catch(D){console.error("Flash toggle failed:",D)}},m=async()=>{C.value&&(f.value=f.value==="environment"?"user":"environment",v&&v.getTracks().forEach(D=>D.stop()),await b())},M=async D=>new Promise(B=>{const z=q.value*1024;if(D.size<=z){B(D);return}const ae=new Image,se=new FileReader;se.onload=te=>{ae.onload=()=>{const ie=document.createElement("canvas"),re=ie.getContext("2d"),ge=Math.sqrt(z/D.size);ie.width=ae.width*ge,ie.height=ae.height*ge,re.drawImage(ae,0,0,ie.width,ie.height);let fe=.9;const he=()=>{ie.toBlob(ce=>{ce.size>z&&fe>.1?(fe-=.1,he()):B(ce)},"image/jpeg",fe)};he()},ae.src=te.target.result},se.readAsDataURL(D)}),Q=async()=>{if(!(l.value||!r.value||!I.value)){l.value=!0;try{const D=r.value,B=I.value,z=D.videoWidth,ae=D.videoHeight;let se,te,ie,re;z/ae>e.aspectRatio?(te=ae,se=ae*e.aspectRatio,ie=(z-se)/2,re=0):(se=z,te=z/e.aspectRatio,ie=0,re=(ae-te)/2),B.width=se,B.height=te,B.getContext("2d").drawImage(D,ie,re,se,te,0,0,se,te);const fe=await new Promise(ce=>{B.toBlob(ce,"image/jpeg",1)}),he=await M(fe);if(he){const ce=new File([he],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",ce),L.value=!0,setTimeout(()=>{L.value=!1},100)}}catch(D){console.error("Error capturing photo:",D),alert("Failed to capture photo. Please try again.")}finally{l.value=!1}}};return ue(()=>e.show,D=>{D?b():j()}),Le(()=>{v&&v.getTracks().forEach(D=>D.stop())}),(D,B)=>{var z;return a.show?(n(),i("div",Rs,[t("div",Ds,[t("div",Ls,[t("p",Bs,R(a.settings.camera_aspect_ratio),1),t("div",js,R(((z=a.point)==null?void 0:z.name)||"Camera"),1),t("button",{onClick:j,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},B[2]||(B[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Ee(Z.value),onClick:y,onTouchstart:y},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:I,class:"hidden"},null,512),L.value?(n(),i("div",Fs)):c("",!0),t("div",{class:"aspect-ratio-guide",style:Ee(S.value)},null,4),K.value?(n(),i("div",{key:1,class:"focus-indicator",style:Ee(p.value)},B[3]||(B[3]=[t("div",{class:"focus-ring"},null,-1)]),4)):c("",!0),B[4]||(B[4]=t("div",{class:"hd-badge"},[t("span",{class:"hd-text"},"HD")],-1)),$.value?(n(),i("div",qs,[Ae(t("input",{type:"range",min:"1",max:P.value,step:"0.1","onUpdate:modelValue":B[0]||(B[0]=ae=>A.value=ae),onInput:B[1]||(B[1]=ae=>g(parseFloat(ae.target.value))),class:"zoom-slider"},null,40,Os),[[Me,A.value]])])):c("",!0)],36),t("div",Ks,[t("div",zs,[a.settings.enable_flash&&U.value?(n(),i("button",{key:0,onClick:s,class:oe(["control-button",{active:V.value,disabled:!U.value}])},B[5]||(B[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):c("",!0),t("button",{onClick:Q,class:"capture-button",disabled:l.value},[t("div",Gs,[l.value?(n(),i("div",Ws)):(n(),i("div",Zs,B[6]||(B[6]=[t("div",{class:"camera-lens"},null,-1),t("div",{class:"camera-flash"},null,-1)])))])],8,Hs),a.settings.enable_camera_switch&&C.value?(n(),i("button",{key:1,onClick:m,class:"control-button"},B[7]||(B[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):c("",!0)])])])])):c("",!0)}}},Xs=Te(Js,[["__scopeId","data-v-d307c818"]]),Ys=["accept","multiple","disabled"],Qs={class:"text-xs text-gray-500 mb-2"},en=["disabled"],tn={class:"h-full flex flex-col items-center justify-center p-4 text-center"},an={class:"text-xs text-gray-400 mt-1"},sn={key:0,class:"flex items-center gap-4"},nn=["src"],on={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},ln=["disabled"],rn={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},dn=["disabled"],un=["onClick"],cn=["src","onError"],pn={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},gn={key:0},mn={key:1,class:"ml-1"},vn={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},fn={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},hn={key:2,class:"mt-1 text-xs text-red-600"},bn={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(a,{emit:W}){const e=a,_=W,r=E(null),I=E(null),v=E(!1),N=E(!1),f=E(!1),C=E([]),U=E(0),V=E(!1),L=E(!1),K=E(0),p=E(0),l=E(0),A=Fe("imageSourceSetting",E("all"));Fe("cameraQualitySetting",E("HD"));const P=`inspection-${e.inspectionId}-point-${e.pointId}-backup`,$=X(()=>Number(e.settings.max_files)>1),q=X(()=>e.settings.allowed_types.map(o=>`.${o}`).join(", ")),Z=X(()=>{const o=e.settings.camera_aspect_ratio.split(":");if(o.length===2){const d=parseFloat(o[0]),u=parseFloat(o[1]);if(!isNaN(d)&&!isNaN(u)&&u!==0)return d/u}return 3/4}),S=X(()=>{console.log("🔄 allImages computed called");const o=[],d=new Set;for(const u of e.modelValue){if(!u||typeof u!="object"||u.id&&d.has(u.id))continue;u.id&&d.add(u.id),console.log("📥 Database image:",u),console.log("📥 Type of preview:",typeof u.preview),console.log("📥 Type of public_url:",typeof u.public_url);const T=b(u);o.push({...T,rotation:T.rotation||0,isNew:!1,isUploaded:!0,isUploading:!1,isFailed:!1})}for(const u of C.value)u.id&&d.add(u.id),o.push({...u,isUploading:u.isUploading||!1,isFailed:u.isFailed||!1});return console.log("✅ Final allImages:",o),o}),b=o=>{if(!o||typeof o!="object")return{};const d={...o};return["preview","public_url","original_url","optimized_url"].forEach(T=>{d[T]&&(d[T]=j(d[T]))}),d.image_path&&(d.image_path=d.image_path.replace(/^storage\//,"")),d},j=o=>{if(!o||typeof o!="string")return o;let d=o.replace(/\/storage\/storage\//g,"/storage/");return d=d.replace(/\/\/storage\/storage\//g,"/storage/"),d.startsWith("storage/")&&(d=`/${d}`),!d.startsWith("/")&&!d.startsWith("http")&&(d=`/storage/${d}`),d},H=o=>{if(!o||typeof o!="object")return console.warn("❌ safeImageSrc: image is not object",o),"";const d=y(o);return typeof d!="string"?(console.error("🚨 CRITICAL: getImageSrc returned non-string:",typeof d,d),""):(d&&console.log("✅ safeImageSrc result:",d),d)},y=o=>{if(!o||typeof o!="object")return"";if(console.log("🔍 getImageSrc called with:",o),console.log("🔍 Available fields:",Object.keys(o)),o.preview&&typeof o.preview=="string"){const d=j(o.preview);return console.log("✅ Using preview URL:",d),d}if(o.public_url&&typeof o.public_url=="string"){const d=j(o.public_url);return console.log("✅ Using public_url:",d),d}if(o.original_url&&typeof o.original_url=="string"){const d=j(o.original_url);return console.log("✅ Using original_url:",d),d}if(o.optimized_url&&typeof o.optimized_url=="string"){const d=j(o.optimized_url);return console.log("✅ Using optimized_url:",d),d}if(o.image_path&&typeof o.image_path=="string"){const u=`/storage/${o.image_path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from image_path:",u),u}if(o.path&&typeof o.path=="string"){const u=`/storage/${o.path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from path:",u),u}return console.warn("⚠️ No valid image source found for:",o),""},g=o=>{console.error("❌ Image load error for:",o),console.error("❌ Attempted URL:",H(o)),L.value=!0;const d=s(o);if(d&&d!==H(o)){console.log("🔄 Trying fallback URL:",d);const u=event==null?void 0:event.target;u&&(u.src=d)}},s=o=>{if(!o||typeof o!="object")return"";const d=["original_url","optimized_url","public_url","preview"];for(const u of d)if(o[u]&&typeof o[u]=="string")return j(o[u]);return""},m=()=>{f.value&&(f.value=!1),A.value==="camera"?Q():A.value==="gallery"?M():v.value=!0},M=()=>{v.value=!1,r.value.click()},Q=()=>{v.value=!1,N.value=!0},D=()=>{v.value=!1,S.value.length>0&&(f.value=!0)},B=()=>{N.value=!1,S.value.length>0&&(f.value=!0)},z=()=>{f.value=!1,V.value||(C.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),C.value=[])};ue(()=>e.modelValue,o=>{var d;console.log("🔄 modelValue updated:",o),o&&o.length>0&&(console.log("📊 First image structure:",JSON.stringify(o[0],null,2)),console.log("🔍 Type of preview:",typeof((d=o[0])==null?void 0:d.preview)))},{deep:!0});const ae=o=>new Promise(d=>{const u=new FileReader;u.onload=T=>{const w=new Image;w.onload=()=>{d({file:o,preview:URL.createObjectURL(o),rotation:0,width:w.naturalWidth,height:w.naturalHeight,isNew:!0})},w.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),d({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},w.src=T.target.result},u.readAsDataURL(o)}),se=o=>{const d=o.name.split(".").pop().toLowerCase();return e.settings.allowed_types.includes(d)},te=async o=>{const u=(e.settings.max_size||2048)*1024;return new Promise(T=>{const w=new Image,Y=new FileReader;Y.onload=J=>{w.onload=()=>{const ee=document.createElement("canvas"),G=ee.getContext("2d"),de=Math.max(w.width,w.height);ee.width=de,ee.height=de,G.fillStyle="white",G.fillRect(0,0,de,de);const k=(de-w.width)/2,h=(de-w.height)/2;G.drawImage(w,k,h,w.width,w.height);let ne=.9;const O=()=>{ee.toBlob(le=>{if(le.size>u&&ne>.1)ne-=.1,O();else{const pe=new File([le],o.name,{type:"image/jpeg",lastModified:Date.now()});T(pe)}},"image/jpeg",ne)};O()},w.src=J.target.result},Y.readAsDataURL(o)})},ie=async o=>{const d=Array.from(o.target.files);if(!d.length){v.value=!1,S.value.length>0&&(f.value=!0);return}try{const u=d.filter(G=>!se(G));if(u.length>0){const G=u.map(de=>de.name.split(".").pop()).join(", ");alert(`File type not allowed: ${G}. Allowed types: ${e.settings.allowed_types.join(", ")}`),o.target.value="";return}const T=S.value.length,w=e.settings.max_files-T,Y=await Promise.all(d.slice(0,w).map(async G=>await te(G))),J=await Promise.all(Y.map(ae)),ee=$.value?J:J.slice(0,1);$.value?C.value.push(...ee):(C.value.forEach(G=>{G.preview&&G.preview.startsWith("blob:")&&URL.revokeObjectURL(G.preview)}),C.value=ee),v.value=!1,ee.length>0?(U.value=Math.max(0,S.value.length-ee.length),f.value=!0):S.value.length>0&&(f.value=!0),o.target.value=""}catch(u){console.error("Error processing selected images:",u),alert("Failed to process selected images. Please try again."),v.value=!1,S.value.length>0&&(f.value=!0)}},re=async o=>{const d=S.value.length;if(!$.value||d<e.settings.max_files)try{const u=await te(o),T=new Image;T.onload=()=>{const w={file:u,preview:URL.createObjectURL(u),rotation:0,width:T.naturalWidth,height:T.naturalHeight,isNew:!0};$.value?C.value.push(w):(C.value.forEach(Y=>{Y.preview&&Y.preview.startsWith("blob:")&&URL.revokeObjectURL(Y.preview)}),C.value=[w]),N.value=!1,v.value=!1,U.value=S.value.length-1,f.value=!0},T.src=URL.createObjectURL(u)}catch(u){console.error("Error processing captured image:",u),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${e.settings.max_files} files allowed.`),N.value=!1,v.value=!1,S.value.length>0&&(f.value=!0)},ge=(o=0)=>{U.value=o,f.value=!0},fe=o=>new Promise(d=>{if(o.rotation===0||!I.value){if(!o.isNew&&!o.file){d({file:null,width:o.width,height:o.height,isOriginal:!0});return}d({file:o.file,width:o.width,height:o.height});return}const u=new Image;u.onload=async()=>{try{const T=I.value,w=T.getContext("2d"),Y=u.width,J=u.height;let ee,G;o.rotation===90||o.rotation===270?(ee=J,G=Y):(ee=Y,G=J),T.width=ee,T.height=G,w.clearRect(0,0,T.width,T.height),w.translate(T.width/2,T.height/2),w.rotate(o.rotation*Math.PI/180),w.drawImage(u,-Y/2,-J/2,Y,J),w.setTransform(1,0,0,1,0,0);const de=await new Promise(ne=>{T.toBlob(ne,"image/jpeg",.9)}),k=new File([de],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),h=await te(k);d({file:h,width:ee,height:G})}catch(T){console.error("Error processing rotated image:",T),d({file:o.file,width:o.width,height:o.height})}},u.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),d({file:o.file,width:o.width,height:o.height})},u.src=o.preview}),he=o=>{try{const d={images:o.map(u=>{var T;return{fileName:((T=u.file)==null?void 0:T.name)||`image-${Date.now()}.jpg`,rotation:u.rotation||0,width:u.width||0,height:u.height||0,timestamp:Date.now()}}),inspectionId:e.inspectionId,pointId:e.pointId};localStorage.setItem(P,JSON.stringify(d))}catch(d){console.error("Error saving backup:",d)}},ce=()=>{localStorage.removeItem(P)},$e=async o=>{V.value=!0;const d=[],u=[];if(!e.pointId){alert("Error: Point ID is missing. Cannot upload image."),V.value=!1;return}try{he(o);for(const T of o){if(!T.isNew&&T.rotation===0&&T.id&&T.image_path){d.push({id:T.id,image_path:T.image_path,width:T.width,height:T.height,rotation:0,preview:T.preview,isUploaded:!0});continue}const{file:w,width:Y,height:J,isOriginal:ee}=await fe(T);if(ee&&!T.isNew){d.push({id:T.id,image_path:T.image_path,width:T.width,height:T.height,rotation:T.rotation||0,preview:T.preview,isUploaded:!0});continue}w&&u.push({file:w,width:Y,height:J,rotation:T.rotation||0,originalImage:T})}z(),u.length>0?await Ve(u,d):(_("update:modelValue",d),_("save",e.pointId))}catch(T){console.error("Error during image processing:",T),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{V.value=!1}},Ve=async(o,d)=>{l.value=o.length,p.value=0,K.value=0;const u=[...d];let T=0;try{for(let w=0;w<o.length;w++){const Y=o[w],J=new FormData;J.append("inspection_id",e.inspectionId),J.append("point_id",e.pointId),J.append("images[]",Y.file);const ee=C.value.findIndex(G=>{var de;return G.preview===((de=Y.originalImage)==null?void 0:de.preview)});ee!==-1&&(C.value[ee].isUploading=!0,C.value[ee].isFailed=!1);try{const de=(await Be.post(route("inspections.upload-image"),J,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:k=>{if(k.total){const h=Math.round(k.loaded*100/k.total);K.value=Math.round((w+k.loaded/k.total)/o.length*100),p.value=w+1}}})).data.images;if(de&&de.length>0){const k=de[0];if(u.push({id:k.image_id,image_path:k.path,width:k.width||Y.width||0,height:k.height||Y.height||0,rotation:Y.rotation||0,preview:k.public_url,isUploaded:!0}),ee!==-1){const h=C.value.splice(ee,1)[0];h.preview&&h.preview.startsWith("blob:")&&URL.revokeObjectURL(h.preview)}T++}}catch(G){console.error(`Error uploading image ${w+1}:`,G),ee!==-1&&(C.value[ee].isUploading=!1,C.value[ee].isFailed=!0)}}T>0&&(_("update:modelValue",u),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:u,newImagesCount:T})),T===o.length&&ce(),console.log(`✅ Successfully uploaded ${T}/${o.length} images`)}catch(w){console.error("Error in upload process:",w),o.forEach(Y=>{const J=C.value.findIndex(ee=>{var G;return ee.preview===((G=Y.originalImage)==null?void 0:G.preview)});J!==-1&&(C.value[J].isUploading=!1,C.value[J].isFailed=!0)})}finally{K.value=0,p.value=0,l.value=0,V.value=!1}},Se=async o=>{if(!o||!o.file){console.error("No file to retry upload");return}V.value=!0;const d=[...e.modelValue];try{const u=new FormData;u.append("inspection_id",e.inspectionId),u.append("point_id",e.pointId),u.append("images[]",o.file);const T=C.value.findIndex(J=>J.preview===o.preview);T!==-1&&(C.value[T].isUploading=!0,C.value[T].isFailed=!1);const Y=(await Be.post(route("inspections.upload-image"),u,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(Y&&Y.length>0){const J=Y[0];if(d.push({id:J.image_id,image_path:J.path,width:J.width||o.width||0,height:J.height||o.height||0,rotation:o.rotation||0,preview:J.public_url,isUploaded:!0}),T!==-1){const G=C.value.splice(T,1)[0];G.preview&&G.preview.startsWith("blob:")&&URL.revokeObjectURL(G.preview)}_("update:modelValue",d),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:d,newImagesCount:1}),C.value.some(G=>G.isFailed)||ce(),console.log("✅ Successfully retried upload for 1 image")}}catch(u){console.error("Error retrying upload:",u),previewIndex!==-1&&(C.value[previewIndex].isUploading=!1,C.value[previewIndex].isFailed=!0)}finally{V.value=!1}},Ie=o=>{if(o){if(o.id&&!o.isNew)_e(o);else{const d=C.value.findIndex(u=>u.preview&&u.preview===o.preview&&u.isNew||u.id&&u.id===o.id);if(d!==-1){const u=C.value.splice(d,1)[0];u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview)}_("update:modelValue",e.modelValue.filter(u=>!(u.id&&u.id===o.id)&&!(u.preview&&u.preview===o.preview)))}U.value>=S.value.length&&(U.value=Math.max(0,S.value.length-1)),S.value.length===0&&z()}},_e=async o=>{var u,T;if(o.id||o.image_path)try{await Be.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(w){console.error("Error deleting image from server:",w),(T=(u=w.response)==null?void 0:u.data)!=null&&T.message?alert(`Failed to delete image from server: ${w.response.data.message}`):alert(`Failed to delete image from server: ${w.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const d=e.modelValue.filter(w=>w.id!==o.id);_("update:modelValue",d),C.value=C.value.filter(w=>w.isNew&&o.isNew?w.preview!==o.preview:w.id!==o.id),_("removeImage",{image:o}),f.value&&S.value.length===0?z():f.value&&U.value>=S.value.length&&(U.value=Math.max(0,S.value.length-1))};return Pe(()=>{try{localStorage.getItem(P)&&console.log("Found backup images, ready for recovery if needed")}catch(o){console.error("Error loading backup:",o)}}),(o,d)=>(n(),i("div",null,[t("input",{ref_key:"galleryInput",ref:r,type:"file",accept:q.value,class:"hidden",onChange:ie,multiple:$.value,disabled:V.value},null,40,Ys),t("canvas",{ref_key:"processingCanvas",ref:I,class:"hidden"},null,512),t("p",Qs,"Foto Maksimal: "+R(a.settings.max_files)+" | Rasio: "+R(a.settings.camera_aspect_ratio),1),S.value.length===0?(n(),i("label",{key:0,onClick:m,class:oe(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:V.value},[t("div",tn,[d[3]||(d[3]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),d[4]||(d[4]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",an,"Tipe: "+R(q.value),1)])],8,en)):(n(),i("div",{key:1,class:oe(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":a.settings.max_files==1,"bg-transparent":a.settings.max_files>1}]),"aria-label":"Image gallery"},[a.settings.max_files===1?(n(),i("div",sn,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:d[1]||(d[1]=u=>ge(0))},[t("img",{src:H(S.value[0]),onError:d[0]||(d[0]=u=>g(S.value[0])),class:"w-full h-full object-cover"},null,40,nn),S.value[0].isUploading?(n(),i("div",on,d[5]||(d[5]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0)]),t("button",{onClick:d[2]||(d[2]=Re(u=>_e(S.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:V.value},d[6]||(d[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ye(" Hapus Foto ")]),8,ln)])):(n(),i("div",rn,[$.value&&S.value.length<a.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:m,disabled:V.value},d[7]||(d[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,dn)):c("",!0),(n(!0),i(xe,null,we(S.value,(u,T)=>(n(),i("div",{key:u.id||u.preview||T,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:w=>u.isFailed?Se(u):ge(T)},[t("img",{src:H(u),onError:w=>g(u),class:"w-full h-full object-cover"},null,40,cn),u.isNew||u.rotation!==0?(n(),i("div",pn,[u.isNew?(n(),i("span",gn,"BARU")):c("",!0),u.rotation!==0?(n(),i("span",mn,"ROTASI")):c("",!0)])):c("",!0),u.isUploading?(n(),i("div",vn,d[8]||(d[8]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):c("",!0),u.isFailed?(n(),i("div",fn,d[9]||(d[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("span",{class:"text-xs font-medium"},"Retry",-1)]))):c("",!0)],8,un))),128))]))],2)),a.error?(n(),i("p",hn,R(a.error),1)):c("",!0),be(ns,{show:v.value,settings:a.settings,onClose:D,onOpenWebcam:Q,onTriggerGallery:M},null,8,["show","settings"]),be(Xs,{show:N.value,"aspect-ratio":Z.value,settings:a.settings,point:a.point,onClose:B,onPhotoCaptured:re},null,8,["show","aspect-ratio","settings","point"]),be(Ps,{show:f.value,images:S.value,point:a.point,"initial-index":U.value,"allow-multiple":$.value,"max-files":a.settings.max_files,"is-uploading":V.value,"aspect-ratio":Z.value,"upload-progress":K.value,"current-upload":p.value,"total-upload":l.value,onClose:z,onSaveImages:$e,onRemovePreviewImage:Ie,onTriggerAddMorePhotos:m,onRetryImage:Se},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},qe=Te(bn,[["__scopeId","data-v-7d1b8210"]]),yn={key:0,class:"fixed inset-0 z-50 overflow-hidden"},xn={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},wn={class:"px-4 pb-2 border-b border-gray-200"},kn={class:"text-lg font-semibold text-gray-900"},In={key:0,class:"text-sm text-gray-500 mt-1"},_n={class:"flex-1 overflow-y-auto p-4"},$n={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Sn={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(a){return(W,e)=>(n(),ke(De,{name:"bottom-sheet"},{default:Ce(()=>[a.show?(n(),i("div",yn,[e[1]||(e[1]=t("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),t("div",xn,[e[0]||(e[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",wn,[t("h3",kn,R(a.title),1),a.subtitle?(n(),i("p",In,R(a.subtitle),1)):c("",!0)]),t("div",_n,[xt(W.$slots,"default",{},void 0,!0)]),W.$slots.footer?(n(),i("div",$n,[xt(W.$slots,"footer",{},void 0,!0)])):c("",!0)])])):c("",!0)]),_:3}))}},Vn=Te(Sn,[["__scopeId","data-v-fd942535"]]),An={class:"space-y-4"},Cn={key:0,class:"mt-2"},Tn={key:1,class:"mt-2"},Un={key:2,class:"mt-2"},Nn={key:3,class:"mt-2"},En={key:4,class:"mt-2"},Mn={class:"text-sm font-medium text-gray-700 mb-2"},Pn={key:0,class:"text-red-500"},Rn={key:0,class:"text-xs text-red-500"},Dn=["type","name","value","checked","onChange"],Ln={key:6,class:"mt-4"},Bn={class:"text-sm font-medium text-gray-700 mb-2"},jn={key:0,class:"text-red-500"},Fn={key:0,class:"text-xs text-red-500"},qn={key:7,class:"space-y-2"},On={key:0,class:"text-red-500"},Kn={key:1,class:"text-xs text-red-500"},zn={class:"flex gap-2"},Hn=["disabled"],Ct={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:[String,Array],notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(a,{emit:W}){const e=a,_=W,r=p=>_("hapus",p),I=X(()=>Array.isArray(e.selectedValue)?e.options.find(p=>e.selectedValue.includes(p.value)):e.options.find(p=>p.value===e.selectedValue)),v=X(()=>{if(Array.isArray(e.selectedValue))return e.options.filter(p=>e.selectedValue.includes(p.value));if(e.selectedValue){const p=typeof e.selectedValue=="string"?e.selectedValue.split(",").map(l=>l.trim()):[e.selectedValue];return e.options.filter(l=>p.includes(l.value))}return[]}),N=X(()=>{var p;if(Array.isArray(e.selectedValue))return v.value.some(l=>{var A;return l.multi&&((A=l.settings)==null?void 0:A.show_textarea)});{const l=e.options.find(A=>A.value===e.selectedValue);return(p=l==null?void 0:l.settings)==null?void 0:p.show_textarea}}),f=X(()=>{var p;if(Array.isArray(e.selectedValue))return v.value.some(l=>{var A;return l.multi&&((A=l.settings)==null?void 0:A.show_image_upload)});{const l=e.options.find(A=>A.value===e.selectedValue);return(p=l==null?void 0:l.settings)==null?void 0:p.show_image_upload}}),C=X(()=>{var p;if(Array.isArray(e.selectedValue)){const l=v.value.filter(q=>{var Z;return q.multi&&((Z=q.settings)==null?void 0:Z.show_textarea)});if(l.length===0)return null;const A={...l[0].settings},P=[];l.forEach(q=>{var Z;(Z=q.settings)!=null&&Z.damage_options&&P.push(...q.settings.damage_options)});const $=P.filter((q,Z,S)=>Z===S.findIndex(b=>b.value===q.value));return A.damage_options=$,{...l[0],settings:A}}else{const l=e.options.find(A=>A.value===e.selectedValue);return(p=l==null?void 0:l.settings)!=null&&p.show_textarea?l:null}}),U=X(()=>{var p;if(Array.isArray(e.selectedValue))return v.value.find(l=>{var A;return l.multi&&((A=l.settings)==null?void 0:A.show_image_upload)});{const l=e.options.find(A=>A.value===e.selectedValue);return(p=l==null?void 0:l.settings)!=null&&p.show_image_upload?l:null}});X(()=>v.value.find(p=>{var l;return p.multi&&((l=p.settings)==null?void 0:l.show_textarea)})),X(()=>v.value.find(p=>{var l;return p.multi&&((l=p.settings)==null?void 0:l.show_image_upload)}));const V=p=>Array.isArray(e.selectedValue)?e.selectedValue.includes(p.value):e.selectedValue?(typeof e.selectedValue=="string"?e.selectedValue.split(",").map(A=>A.trim()):[e.selectedValue]).includes(p.value):!1,L=(p,l)=>{let A;if(p.multi){const P=Array.isArray(e.selectedValue)?e.selectedValue:[];l.target.checked?A=[...P,p.value]:A=P.filter($=>$!==p.value)}else A=p.value;_("update:selectedValue",A)},K=X(()=>{var l,A,P,$,q,Z,S;if(e.point.input_type==="text"&&(!((l=e.notesValue)!=null&&l.trim())||e.point.settings.min_length&&e.notesValue.length<e.point.settings.min_length||e.point.settings.max_length&&e.notesValue.length>e.point.settings.max_length)||e.point.input_type==="number"&&(!((A=e.notesValue)!=null&&A.trim())||e.point.settings.min&&e.notesValue.length<e.point.settings.min||e.point.settings.max&&e.notesValue.length>e.point.settings.max)||e.point.input_type==="account"&&(!((P=e.notesValue)!=null&&P.trim())||e.point.settings.min_value&&e.notesValue.length<e.point.settings.min_value||e.point.settings.max_value&&e.notesValue.length>e.point.settings.max_value)||e.point.input_type==="date"&&(!(($=e.notesValue)!=null&&$.trim())||e.point.settings.min_date&&e.notesValue.length<e.point.settings.min_date||e.point.settings.max_date&&e.notesValue.length>e.point.settings.max_date))return!1;if(e.point.input_type==="imageTOradio"){if(e.imagesValue.length===0)return!1;const b=e.imagesValue.some(H=>H.status==="error"),j=e.imagesValue.some(H=>H.status==="uploading");if(b||j)return!1}if(e.options.length&&(!e.selectedValue||Array.isArray(e.selectedValue)&&e.selectedValue.length===0))return!1;const p=I.value;if(e.showTextarea&&((q=p==null?void 0:p.settings)!=null&&q.show_textarea)&&(!((Z=e.notesValue)!=null&&Z.trim())||p.settings.min_length&&e.notesValue.length<p.settings.min_length||p.settings.max_length&&e.notesValue.length>p.settings.max_length))return!1;if(e.showImageUpload&&((S=p==null?void 0:p.settings)!=null&&S.show_image_upload)){if(e.imagesValue.length===0||p.settings.max_files&&e.imagesValue.length>p.settings.max_files)return!1;const b=e.imagesValue.some(H=>H.status==="error"),j=e.imagesValue.some(H=>H.status==="uploading");if(b||j)return!1}return!0});return(p,l)=>(n(),ke(Vn,{show:a.show,title:a.title,subtitle:a.subtitle,onClose:l[17]||(l[17]=A=>p.$emit("close"))},{footer:Ce(()=>[a.selectedPoint?(n(),i("button",{key:0,onClick:l[14]||(l[14]=A=>r(a.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},l[19]||(l[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),ye(" Hapus Data ")]))):c("",!0),t("div",zn,[t("button",{type:"button",onClick:l[15]||(l[15]=A=>p.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:l[16]||(l[16]=A=>p.$emit("save")),disabled:!K.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Hn)])]),default:Ce(()=>{var A,P,$,q,Z,S,b,j,H,y,g,s,m,M,Q,D,B,z,ae,se,te,ie,re,ge,fe,he,ce,$e,Ve,Se,Ie,_e,o,d,u,T;return[t("div",An,[a.point.input_type==="text"?(n(),i("div",Cn,[be(_t,{"model-value":a.notesValue,required:(A=a.point.settings)==null?void 0:A.is_required,"min-length":(P=a.point.settings)==null?void 0:P.min_length,"max-length":($=a.point.settings)==null?void 0:$.max_length,allowSpace:(q=a.point.settings)==null?void 0:q.allow_space,textTransform:(Z=a.point.settings)==null?void 0:Z.text_transform,placeholder:((S=a.point.settings)==null?void 0:S.placeholder)||"Masukan text",error:p.error,"onUpdate:modelValue":l[0]||(l[0]=w=>p.$emit("update:notesValue",w)),onSave:l[1]||(l[1]=w=>p.$emit("saveText",w))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):c("",!0),a.point.input_type==="number"?(n(),i("div",Tn,[be($t,{"model-value":a.notesValue,required:(b=a.point.settings)==null?void 0:b.is_required,min:(j=a.point.settings)==null?void 0:j.min,max:(H=a.point.settings)==null?void 0:H.max,step:((y=a.point.settings)==null?void 0:y.step)||1,placeholder:((g=a.point.settings)==null?void 0:g.placeholder)||"Masukan number",error:p.error,"onUpdate:modelValue":l[2]||(l[2]=w=>p.$emit("update:notesValue",w)),onSave:l[3]||(l[3]=w=>p.$emit("saveNumber",w))},null,8,["model-value","required","min","max","step","placeholder","error"])])):c("",!0),a.point.input_type==="account"?(n(),i("div",Un,[be(Vt,{"model-value":a.notesValue,required:(s=a.point.settings)==null?void 0:s.is_required,placeholder:((m=a.point.settings)==null?void 0:m.placeholder)||"Masukkan nilai",error:p.error,"point-id":a.pointId,settings:a.point.settings,"onUpdate:modelValue":l[4]||(l[4]=w=>p.$emit("update:notesValue",w)),onSave:l[5]||(l[5]=w=>p.$emit("saveAccount",w))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):c("",!0),a.point.input_type==="date"?(n(),i("div",Nn,[be(St,{"model-value":a.notesValue,required:(M=a.point.settings)==null?void 0:M.is_required,"min-date":(Q=a.point.settings)==null?void 0:Q.min_date,"max-date":(D=a.point.settings)==null?void 0:D.max_date,error:p.error,"onUpdate:modelValue":l[6]||(l[6]=w=>p.$emit("update:notesValue",w)),onSave:l[7]||(l[7]=w=>p.$emit("saveDate",w))},null,8,["model-value","required","min-date","max-date","error"])])):c("",!0),a.point.input_type==="imageTOradio"?(n(),i("div",En,[t("h4",Mn,[(B=a.point.settings)!=null&&B.required?(n(),i("span",Pn,"*")):c("",!0)]),be(qe,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point.inspection_point,"inspection-id":a.inspectionId,settings:a.point.settings,"onUpdate:modelValue":l[8]||(l[8]=w=>p.$emit("update:imagesValue",w)),onSave:l[9]||(l[9]=w=>p.$emit("saveImage",w))},null,8,["model-value","point-id","point","inspection-id","settings"]),(z=a.point.settings)!=null&&z.required&&a.imagesValue.length===0?(n(),i("p",Rn," Foto wajib diupload ")):c("",!0)])):c("",!0),a.options.length?(n(),i("div",{key:5,class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(xe,null,we(a.options,(w,Y)=>(n(),i("label",{key:Y,class:"cursor-pointer"},[t("input",{type:w.multi?"checkbox":"radio",name:w.multi?`checkbox-${a.name}`:a.name,value:w.value,checked:V(w),onChange:J=>L(w,J),class:"hidden peer"},null,40,Dn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":V(w),"border-gray-300 text-gray-700 hover:bg-gray-50":!V(w)}])},R(w.label),3)]))),128))],2)):c("",!0),f.value?(n(),i("div",Ln,[t("h4",Bn,[l[18]||(l[18]=ye(" Upload Foto ")),(se=(ae=U.value)==null?void 0:ae.settings)!=null&&se.required?(n(),i("span",jn,"*")):c("",!0)]),be(qe,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,settings:(te=U.value)==null?void 0:te.settings,"onUpdate:modelValue":l[10]||(l[10]=w=>p.$emit("update:imagesValue",w)),onSave:l[11]||(l[11]=w=>p.$emit("saveImage",w))},null,8,["model-value","point-id","point","inspection-id","settings"]),(re=(ie=U.value)==null?void 0:ie.settings)!=null&&re.required&&a.imagesValue.length===0?(n(),i("p",Fn," Foto wajib diupload ")):c("",!0)])):c("",!0),N.value?(n(),i("div",qn,[(fe=(ge=C.value)==null?void 0:ge.settings)!=null&&fe.required?(n(),i("span",On,"*")):c("",!0),be(At,{"model-value":a.notesValue,"point-id":a.pointId,"inspection-id":a.inspectionId,settings:(he=C.value)==null?void 0:he.settings,required:($e=(ce=C.value)==null?void 0:ce.settings)==null?void 0:$e.required,"min-length":(Se=(Ve=C.value)==null?void 0:Ve.settings)==null?void 0:Se.min_length,"max-length":(_e=(Ie=C.value)==null?void 0:Ie.settings)==null?void 0:_e.max_length,placeholder:((d=(o=C.value)==null?void 0:o.settings)==null?void 0:d.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":l[12]||(l[12]=w=>p.$emit("update:notesValue",w)),onSave:l[13]||(l[13]=w=>p.$emit("saveTextarea",w))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(T=(u=C.value)==null?void 0:u.settings)!=null&&T.required&&!a.notesValue?(n(),i("p",Kn," Keterangan wajib diisi ")):c("",!0)])):c("",!0)])]}),_:1},8,["show","title","subtitle"]))}},Gn={class:"mt-2 space-y-2"},Wn=["type","name","value","checked","onChange","required"],Zn={key:0,class:"p-2 rounded-lg bg-gray-50"},Jn={key:0,class:"mt-2"},Xn={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Yn=["src"],Qn={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},eo={key:1,class:"mt-2"},to={class:"text-sm text-gray-600"},ao={key:2,class:"mt-2 text-sm text-red-600"},so={__name:"InputRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:W}){const e=a,_=W,r=E(e.notes),I=E([...e.images]),v=E(!1),N=E(""),f=E([]),C=E(""),U=E([]);X(()=>e.options.find(b=>b.value===e.modelValue));const V=X(()=>Array.isArray(e.modelValue)?e.options.filter(b=>e.modelValue.includes(b.value)):e.modelValue?[e.options.find(b=>b.value===e.modelValue)].filter(Boolean):[]),L=b=>Array.isArray(e.modelValue)?e.modelValue.includes(b.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(H=>H.trim()):[e.modelValue]).includes(b.value):!1,K=b=>b.settings&&(b.settings.show_textarea||b.settings.show_image_upload);ue(()=>e.notes,b=>{r.value=b}),ue(()=>e.images,b=>{I.value=[...b]}),ue(()=>e.modelValue,b=>{b?C.value=Array.isArray(b)?[...b]:b:C.value=""});const p=(b,j)=>{let H;if(b.multi){const y=Array.isArray(e.modelValue)?e.modelValue:[];j.target.checked?H=[...y,b.value]:H=y.filter(g=>g!==b.value)}else H=b.value;_("update:modelValue",H),K(b)?A():_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:H,notes:"",images:[]})},l=b=>b.preview||(b.image_path?`/${b.image_path}`:b),A=()=>{C.value=e.modelValue,N.value=r.value,f.value=[...I.value],U.value=[...I.value],v.value=!0},P=()=>{N.value="",f.value=[],C.value=Array.isArray(e.modelValue)?[...e.modelValue]:e.modelValue,v.value=!1},$=b=>{f.value=b,I.value=[...b],_("update:images",[...b]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...b]})},q=b=>{},Z=()=>{C.value!==e.modelValue&&_("update:modelValue",C.value),r.value=N.value,_("update:notes",N.value),I.value=[...f.value],_("update:images",[...f.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:C.value,notes:N.value,images:f.value}),v.value=!1},S=b=>{C.value="",N.value="",f.value=[],r.value="",I.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",b),v.value=!1};return(b,j)=>{var H;return n(),i("div",Gn,[t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(xe,null,we(a.options,(y,g)=>(n(),i("label",{key:g,class:"cursor-pointer"},[t("input",{type:y.multi?"checkbox":"radio",name:y.multi?`checkbox-${a.pointId}`:"radio-"+a.pointId,value:y.value,checked:L(y),onChange:s=>p(y,s),class:"hidden peer",required:a.required&&!y.multi},null,40,Wn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":L(y),"border-gray-300 text-gray-700 hover:bg-gray-50":!L(y)}])},R(y.label),3)]))),128))],2),a.modelValue&&V.value.length>0&&V.value.some(y=>K(y))?(n(),i("div",Zn,[t("div",{class:"flex justify-between items-start"},[j[4]||(j[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:A,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),a.images.length>0&&V.value.some(y=>{var g;return(g=y.settings)==null?void 0:g.show_image_upload})?(n(),i("div",Jn,[t("div",Xn,[(n(!0),i(xe,null,we(a.images,(y,g)=>(n(),i("div",{key:g,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:l(y),class:"w-full h-full object-cover rounded"},null,8,Yn),g===3&&a.images.length>4?(n(),i("span",Qn," +"+R(a.images.length-4),1)):c("",!0)]))),128))])])):c("",!0),a.notes&&V.value.some(y=>{var g;return(g=y.settings)==null?void 0:g.show_textarea})?(n(),i("div",eo,[t("p",to,R(a.notes),1)])):c("",!0)])):c("",!0),v.value?(n(),ke(Ct,{key:(H=a.selectedPoint)==null?void 0:H.id,show:v.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":C.value,"notes-value":N.value,"images-value":f.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":j[0]||(j[0]=y=>C.value=y),"onUpdate:notesValue":j[1]||(j[1]=y=>N.value=y),"onUpdate:imagesValue":j[2]||(j[2]=y=>$(y)),onClose:P,onSave:Z,onSaveTextarea:b.handleTextareaSave,onSaveImage:q,onHapus:j[3]||(j[3]=y=>S(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):c("",!0),a.error?(n(),i("p",ao,R(a.error),1)):c("",!0)])}}},no={class:"mt-2 space-y-2"},oo={key:0,class:"flex flex-wrap gap-3"},io={key:1,class:"p-2"},lo={key:0,class:"mt-2"},ro={class:"flex gap-2 overflow-x-auto scrollbar-hide"},uo=["src"],co={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},po=["type","name","value","checked"],go={key:1,class:"mt-2"},mo={class:"text-sm text-gray-600"},vo={key:3,class:"mt-2 text-sm text-red-600"},fo={__name:"InputImageToRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:W}){const e=a,_=W,r=E(e.notes),I=E([...e.images]),v=E(!1),N=E(""),f=E([]),C=E(""),U=E([]),V=X(()=>{if(Array.isArray(e.modelValue))return e.options.find(S=>e.modelValue.includes(S.value));if(e.modelValue){const S=typeof e.modelValue=="string"?e.modelValue.split(",").map(b=>b.trim()):[e.modelValue];return e.options.find(b=>S.includes(b.value))}return null}),L=X(()=>{if(Array.isArray(e.modelValue))return e.options.filter(S=>e.modelValue.includes(S.value));if(e.modelValue){const S=typeof e.modelValue=="string"?e.modelValue.split(",").map(b=>b.trim()):[e.modelValue];return e.options.filter(b=>S.includes(b.value))}return[]}),K=X(()=>L.value.some(S=>{var b;return S.multi&&((b=S.settings)==null?void 0:b.show_textarea)}));X(()=>L.value.find(S=>{var b;return S.multi&&((b=S.settings)==null?void 0:b.show_textarea)}));const p=S=>Array.isArray(e.modelValue)?e.modelValue.includes(S.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(j=>j.trim()):[e.modelValue]).includes(S.value):!1,l=S=>S.preview||(S.image_path?`/${S.image_path}`:S);ue(()=>e.notes,S=>{r.value=S});const A=()=>{C.value=e.modelValue||"",N.value=r.value,f.value=[...I.value],U.value=[...I.value],v.value=!0},P=()=>{N.value="",f.value=[],C.value="",v.value=!1},$=S=>{f.value=S,I.value=[...S],_("update:images",[...S]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...S]})},q=()=>{C.value!==e.modelValue&&_("update:modelValue",C.value),r.value=N.value,_("update:notes",N.value),I.value=[...f.value],_("update:images",[...f.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:C.value,notes:N.value,images:f.value}),v.value=!1},Z=S=>{C.value="",N.value="",f.value=[],r.value="",I.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",S),v.value=!1};return(S,b)=>{var j,H,y;return n(),i("div",no,[!a.modelValue&&I.value.length===0&&!r.value?(n(),i("div",oo,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:A},b[4]||(b[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",io,[t("div",{class:"flex justify-between items-start"},[b[5]||(b[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:A,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),I.value.length>0?(n(),i("div",lo,[t("div",ro,[(n(!0),i(xe,null,we(I.value,(g,s)=>(n(),i("div",{key:s,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:l(g),class:"w-full h-full object-cover rounded"},null,8,uo),s===3&&I.value.length>4?(n(),i("span",co," +"+R(I.value.length-4),1)):c("",!0)]))),128))])])):c("",!0),t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(xe,null,we(a.options,(g,s)=>(n(),i("label",{key:s,class:"cursor-pointer"},[t("input",{type:g.multi?"checkbox":"radio",name:g.multi?`checkbox-${a.pointId}`:`radio-${a.pointId}`,value:g.value,checked:p(g),disabled:!0,class:"hidden peer"},null,8,po),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":p(g),"border-gray-300 text-gray-700 hover:bg-gray-50":!p(g)}])},R(g.label),3)]))),128))],2),r.value&&((H=(j=V.value)==null?void 0:j.settings)!=null&&H.show_textarea||K.value)?(n(),i("div",go,[t("p",mo,R(r.value),1)])):c("",!0)])),v.value?(n(),ke(Ct,{key:(y=a.selectedPoint)==null?void 0:y.id,show:v.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":C.value,"notes-value":N.value,"images-value":f.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":b[0]||(b[0]=g=>C.value=g),"onUpdate:notesValue":b[1]||(b[1]=g=>N.value=g),"onUpdate:imagesValue":b[2]||(b[2]=g=>$(g)),onClose:P,onSave:q,onHapus:b[3]||(b[3]=g=>Z(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):c("",!0),a.error?(n(),i("p",vo,R(a.error),1)):c("",!0)])}}},ho={class:"text-base font-semibold text-indigo-700"},bo={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},yo={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},xo={class:"text-base font-semibold text-indigo-700"},wo={class:"p-4 space-y-4"},ko={key:0,class:"flex justify-end py-1"},Io=["onClick"],_o={key:1,class:"space-y-2"},$o={class:"flex items-start justify-between"},So={class:"flex-1"},Vo={class:"block text-sm font-medium text-gray-900"},Ao={class:"font-bold"},Co={key:0,class:"text-red-500"},To={key:1,class:"italic text-xs text-gray-400 ml-2"},Uo={key:0,class:"mt-1"},No={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800"},Eo={key:0},Mo={key:1},Po={key:2},Ro={key:3},Do={key:4},Lo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Bo={key:9,class:"p-3 bg-gray-100 rounded text-sm text-gray-600"},jo={class:"text-xs mt-1 list-disc list-inside"},Fo={key:0},qo={key:1},Oo={key:2},Ko={key:3},zo={key:4},Ho={key:0,class:"text-center py-8 text-gray-500"},Go={key:0,class:"text-xs text-gray-400"},Wo={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object,car:Object},emits:["updateResult","removeImage","hapusPoint"],setup(a,{emit:W}){const e=a,_=W,r=Fe("vehicleFeatures",E(null));r.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),Nt("vehicleFeatures",r);const I=E(!1),v=E([]),N=E(!0),f=E(null),C=Et(),U={MT:"Manual Transmission (MT)",AT:"Automatic Transmission (AT)",CVT:"Continuously Variable Transmission (CVT)","e-CVT":"Electronic CVT (e-CVT)",DCT:"Dual Clutch Transmission (DCT)",AMT:"Automated Manual Transmission (AMT)",IVT:"Intelligent Variable Transmission (IVT)",SSG:"Seamless Shift Gearbox (SSG)",AGS:"Auto Gear Shift (AGS)",DHT:"Dedicated Hybrid Transmission (DHT)"};Pe(()=>{const y=new IntersectionObserver(([g])=>{N.value=g.isIntersecting},{threshold:.1});f.value&&y.observe(f.value),Le(()=>{f.value&&y.unobserve(f.value)})});const V=()=>{I.value=!I.value,I.value||(v.value=[])},L=X(()=>(e.category.points||[]).some(y=>y.is_default===!1)),K=y=>!y||!Array.isArray(y)?[]:y.map(g=>U[g]||g),p=y=>{var M,Q;const g=y.settings;if(!l(y))return!0;const s=(M=e.car)==null?void 0:M.transmission,m=(Q=e.car)==null?void 0:Q.fuel_type;return!(g.transmission&&Array.isArray(g.transmission)&&g.transmission.length>0&&s&&!g.transmission.includes(s)||g.fuel_type&&g.fuel_type.trim()!==""&&m&&g.fuel_type!==m||g.rear_door&&(!r.value||!r.value.rear_door)||g.pick_up&&(!r.value||!r.value.pick_up)||g.box&&(!r.value||!r.value.box))},l=y=>{const g=y.settings;return!!(g!=null&&g.transmission&&Array.isArray(g.transmission)&&g.transmission.length>0||g!=null&&g.fuel_type&&g.fuel_type.trim()!==""||g!=null&&g.rear_door||g!=null&&g.pick_up||g!=null&&g.box)},A=y=>l(y)&&(I.value||p(y)),P=X(()=>{const y=e.category.points||[],g=[];let s=[];return I.value?e.category.isDamageMenu?y.filter(m=>{var M;return m.is_default||q((M=m.inspection_point)==null?void 0:M.id)||I.value}):y:e.category.isDamageMenu?y.filter(m=>{var Q;const M=(Q=m.inspection_point)==null?void 0:Q.id;return q(M)||m.is_default||v.value.includes(M)}):(y.forEach(m=>{var se;const M=(se=m.inspection_point)==null?void 0:se.id,Q=q(M),D=v.value.includes(M),z=!l(m)||p(m);(m.is_default||Q||D)&&z?(s.length>0&&(g.push({is_link:!0,count:s.length,hiddenIds:s.map(te=>te.inspection_point.id)}),s.forEach(te=>{v.value.includes(te.inspection_point.id)&&g.push(te)}),s=[]),g.push(m)):(!l(m)||p(m))&&s.push(m)}),s.length>0&&(g.push({is_link:!0,count:s.length,hiddenIds:s.map(m=>m.inspection_point.id)}),s.forEach(m=>{v.value.includes(m.inspection_point.id)&&g.push(m)})),g.filter(m=>{var M,Q;return m.is_link||m.is_default||q((M=m.inspection_point)==null?void 0:M.id)||v.value.includes((Q=m.inspection_point)==null?void 0:Q.id)}))});X(()=>P.value.filter(y=>!y.is_link));const $=y=>{I.value=!1,y.forEach(g=>{v.value.includes(g)||v.value.push(g)})},q=y=>{if(!y)return!1;const g=C.props.existingResults[y]!==void 0,s=C.props.existingImages[y]&&C.props.existingImages[y].length>0,m=e.form.results[y]&&(e.form.results[y].status||e.form.results[y].note),M=e.form.images[y]&&e.form.images[y].length>0;return g||s||m||M},Z=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],S=y=>{var m,M,Q,D,B,z,ae,se,te;const g=e.form.results[(m=y.inspection_point)==null?void 0:m.id],s=e.form.images[(M=y.inspection_point)==null?void 0:M.id];if(!g)return!1;switch(y.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!g.note;case"select":case"radio":if(!g.status)return!1;const ie=(D=(Q=y.settings)==null?void 0:Q.radios)==null?void 0:D.find(ge=>ge.value===g.status);return!(ie!=null&&ie.settings&&(ie.settings.show_textarea&&!((B=g.note)!=null&&B.trim())||ie.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!g.status)return!1;const re=(ae=(z=y.settings)==null?void 0:z.radios)==null?void 0:ae.find(ge=>ge.value===g.status);return!(re!=null&&re.settings&&re.settings.show_textarea&&!((se=g.note)!=null&&se.trim()));case"image":return(s==null?void 0:s.length)>0;default:return!!g.status||!!((te=g.note)!=null&&te.trim())}},b=(y,g,s)=>{_("updateResult",{pointId:y,type:s,value:g})},j=y=>{console.log("Save result for point:",y)},H=y=>{_("hapusPoint",y)};return ue(()=>e.form.results,y=>{},{deep:!0}),ue(()=>e.form.images,y=>{},{deep:!0}),ue(()=>e.car,y=>{console.log("Car data updated:",y)},{deep:!0}),ue(r,y=>{console.log("Vehicle features updated:",y)},{deep:!0}),(y,g)=>(n(),i(xe,null,[e.head==="vertical"?(n(),i("div",{key:0,class:oe(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[t("h4",ho,R(a.category.name),1),L.value?(n(),i("button",{key:0,onClick:V,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},R(I.value?"Sembunyikan Semua":"Tampilkan Point Lain"),1)):c("",!0)])):c("",!0),t("div",{class:oe(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",e.head==="vertical"?"pt-6":""])},[!N.value&&L.value?(n(),i("button",{key:0,onClick:V,class:"fixed top-3 right-2 z-10 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[I.value?(n(),i("svg",bo,g[0]||(g[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(n(),i("svg",yo,g[1]||(g[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):c("",!0),e.head==="horizontal"?(n(),i("div",{key:1,ref_key:"categoryHeader",ref:f,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",xo,R(a.category.name),1),L.value?(n(),i("button",{key:0,onClick:V,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},R(I.value?"Sembunyikan":"Tampilkan Point Lain"),1)):c("",!0)],512)):c("",!0),t("div",wo,[(n(!0),i(xe,null,we(P.value,(s,m)=>{var M,Q,D,B,z,ae,se,te,ie,re,ge,fe,he,ce,$e,Ve,Se,Ie,_e,o,d,u,T,w,Y,J,ee,G,de,k,h,ne,O,le,pe,ve,me,Ne,Oe,Ke,ze,He,Ge,We,Ze,Je,Xe,Ye,Qe,et,tt,at,st,nt,ot,it,lt,rt,dt,ut,ct,pt,gt,mt,vt,ft,ht,bt,yt;return n(),i("div",{key:m,class:oe(["space-y-2 last:border-0 last:pb-0",s.is_link?"pb-0":"pb-2 border-b border-gray-100"])},[s.is_link?(n(),i("div",ko,[t("button",{onClick:F=>$(s.hiddenIds),class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none"}," Tampilkan "+R(s.count)+" Point Tersembunyi ",9,Io)])):(n(),i("div",_o,[t("div",$o,[t("div",So,[t("label",Vo,[t("span",Ao,R((M=s.inspection_point)==null?void 0:M.name),1),(Q=s.settings)!=null&&Q.is_required?(n(),i("span",Co,"*")):c("",!0),!s.is_default&&!q((D=s.inspection_point)==null?void 0:D.id)?(n(),i("span",To," (opsional) ")):c("",!0)]),A(s)?(n(),i("div",Uo,[l(s)?(n(),i("div",No,[(B=s.settings)!=null&&B.transmission?(n(),i("div",Eo,R(s.settings.transmission.join(", ")),1)):c("",!0),(z=s.settings)!=null&&z.fuel_type?(n(),i("div",Mo,R(s.settings.fuel_type),1)):c("",!0),(ae=s.settings)!=null&&ae.rear_door?(n(),i("div",Po," Pintu Belakang ")):c("",!0),(se=s.settings)!=null&&se.pick_up?(n(),i("div",Ro," Tipe Pick Up ")):c("",!0),(te=s.settings)!=null&&te.box?(n(),i("div",Do," Memiliki Box ")):c("",!0)])):c("",!0)])):c("",!0)]),S(s)?(n(),i("span",Lo," ✓ ")):c("",!0)]),s.input_type==="text"&&p(s)?(n(),ke(_t,{key:0,modelValue:a.form.results[(ie=s.inspection_point)==null?void 0:ie.id].note,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"note")}],required:(re=s.settings)==null?void 0:re.is_required,"min-length":(ge=s.settings)==null?void 0:ge.min_length,"max-length":(fe=s.settings)==null?void 0:fe.max_length,allowSpace:(he=s.settings)==null?void 0:he.allow_space,textTransform:(ce=s.settings)==null?void 0:ce.text_transform,placeholder:(($e=s.settings)==null?void 0:$e.placeholder)||"Masukan text",error:a.form.errors[`results.${(Ve=s.inspection_point)==null?void 0:Ve.id}.note`],onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):c("",!0),s.input_type==="number"&&p(s)?(n(),ke($t,{key:1,modelValue:a.form.results[(Se=s.inspection_point)==null?void 0:Se.id].note,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"note")}],required:(Ie=s.settings)==null?void 0:Ie.is_required,min:(_e=s.settings)==null?void 0:_e.min,max:(o=s.settings)==null?void 0:o.max,step:((d=s.settings)==null?void 0:d.step)||1,placeholder:((u=s.settings)==null?void 0:u.placeholder)||"Masukan number",error:a.form.errors[`results.${(T=s.inspection_point)==null?void 0:T.id}.note`],onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):c("",!0),s.input_type==="account"&&p(s)?(n(),ke(Vt,{key:2,modelValue:a.form.results[(w=s.inspection_point)==null?void 0:w.id].note,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"note")}],required:(Y=s.settings)==null?void 0:Y.is_required,placeholder:((J=s.settings)==null?void 0:J.placeholder)||"Masukkan nilai",error:a.form.errors[`results.${(ee=s.inspection_point)==null?void 0:ee.id}.note`],"point-id":(G=s.inspection_point)==null?void 0:G.id,settings:s.settings,onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):c("",!0),s.input_type==="date"&&p(s)?(n(),ke(St,{key:3,modelValue:a.form.results[(de=s.inspection_point)==null?void 0:de.id].note,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"note")}],required:(k=s.settings)==null?void 0:k.is_required,"min-date":(h=s.settings)==null?void 0:h.min_date,"max-date":(ne=s.settings)==null?void 0:ne.max_date,error:a.form.errors[`results.${(O=s.inspection_point)==null?void 0:O.id}.note`],onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):c("",!0),s.input_type==="textarea"&&p(s)?(n(),ke(At,{key:4,modelValue:a.form.results[(le=s.inspection_point)==null?void 0:le.id].note,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"note")}],required:(pe=s.settings)==null?void 0:pe.is_required,"min-length":(ve=s.settings)==null?void 0:ve.min_length,"max-length":(me=s.settings)==null?void 0:me.max_length,placeholder:((Ne=s.settings)==null?void 0:Ne.placeholder)||"Masukkan teks di sini",settings:s.settings,error:a.form.errors[`results.${(Oe=s.inspection_point)==null?void 0:Oe.id}.note`],onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):c("",!0),s.input_type==="radio"&&p(s)?(n(),ke(so,{key:5,modelValue:a.form.results[(Ke=s.inspection_point)==null?void 0:Ke.id].status,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].status=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"status")}],notes:a.form.results[(ze=s.inspection_point)==null?void 0:ze.id].note,images:a.form.images[(He=s.inspection_point)==null?void 0:He.id],required:(Ge=s.settings)==null?void 0:Ge.is_required,"point-id":(We=s.inspection_point)==null?void 0:We.id,point:s.inspection_point,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(Ze=s.inspection_point)==null?void 0:Ze.name,subtitle:(Je=s.inspection_point)==null?void 0:Je.description,"selected-point":s.inspection_point??null,options:((Xe=s.settings)==null?void 0:Xe.radios)||Z,error:a.form.errors[`results.${(Ye=s.inspection_point)==null?void 0:Ye.id}.status`],"onUpdate:notes":F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},"onUpdate:images":F=>{var x;return a.form.images[(x=s.inspection_point)==null?void 0:x.id]=F},onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)},onHapus:F=>{var x;return H((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","subtitle","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),s.input_type==="imageTOradio"&&p(s)?(n(),ke(fo,{key:6,modelValue:a.form.results[(Qe=s.inspection_point)==null?void 0:Qe.id].status,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].status=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"status")}],notes:a.form.results[(et=s.inspection_point)==null?void 0:et.id].note,images:a.form.images[(tt=s.inspection_point)==null?void 0:tt.id],required:(at=s.settings)==null?void 0:at.is_required,"point-id":(st=s.inspection_point)==null?void 0:st.id,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(nt=s.inspection_point)==null?void 0:nt.name,subtitle:(ot=s.inspection_point)==null?void 0:ot.description,point:s,"selected-point":s.inspection_point??null,options:((it=s.settings)==null?void 0:it.radios)||Z,error:a.form.errors[`results.${(lt=s.inspection_point)==null?void 0:lt.id}.status`],"onUpdate:notes":F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},"onUpdate:images":F=>{var x;return a.form.images[(x=s.inspection_point)==null?void 0:x.id]=F},onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)},onHapus:F=>{var x;return H((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","subtitle","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):c("",!0),s.input_type==="image"&&p(s)?(n(),ke(qe,{key:7,modelValue:a.form.images[(rt=s.inspection_point)==null?void 0:rt.id],"onUpdate:modelValue":F=>{var x;return a.form.images[(x=s.inspection_point)==null?void 0:x.id]=F},error:a.form.errors[`images.${(dt=s.inspection_point)==null?void 0:dt.id}`],"inspection-id":a.inspectionId,"point-id":(ut=s.inspection_point)==null?void 0:ut.id,point:s.inspection_point,"point-name":(ct=s.inspection_point)==null?void 0:ct.name,settings:s.settings,"onUpdate:notes":F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].note=F},"onUpdate:status":F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].status=F}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):c("",!0),s.input_type==="select"&&p(s)?(n(),ke(Ya,{key:8,modelValue:a.form.results[(pt=s.inspection_point)==null?void 0:pt.id].status,"onUpdate:modelValue":[F=>{var x;return a.form.results[(x=s.inspection_point)==null?void 0:x.id].status=F},F=>{var x;return b((x=s.inspection_point)==null?void 0:x.id,F,"status")}],required:(gt=s.settings)==null?void 0:gt.is_required,error:a.form.errors[`results.${(mt=s.inspection_point)==null?void 0:mt.id}.status`],onSave:F=>{var x;return j((x=s.inspection_point)==null?void 0:x.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):c("",!0),!p(s)&&l(s)?(n(),i("div",Bo,[g[2]||(g[2]=t("p",{class:"font-medium"},"Tidak tersedia untuk kendaraan ini",-1)),g[3]||(g[3]=t("p",{class:"text-xs mt-1"},"Point ini hanya tersedia untuk:",-1)),t("ul",jo,[(vt=s.settings)!=null&&vt.transmission?(n(),i("li",Fo," Transmisi: "+R(K(s.settings.transmission).join(", ")),1)):c("",!0),(ft=s.settings)!=null&&ft.fuel_type?(n(),i("li",qo," Bahan bakar: "+R(s.settings.fuel_type),1)):c("",!0),(ht=s.settings)!=null&&ht.rear_door?(n(),i("li",Oo,"Kendaraan dengan pintu belakang")):c("",!0),(bt=s.settings)!=null&&bt.pick_up?(n(),i("li",Ko,"Tipe pick up")):c("",!0),(yt=s.settings)!=null&&yt.box?(n(),i("li",zo,"Kendaraan dengan box")):c("",!0)])])):c("",!0)]))],2)}),128)),P.value.filter(s=>!s.is_link).length===0?(n(),i("div",Ho,[g[4]||(g[4]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),g[5]||(g[5]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),a.category.isDamageMenu?(n(),i("p",Go,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):c("",!0)])):c("",!0)])],2)],64))}},$i=Te(Wo,[["__scopeId","data-v-704b9892"]]),Zo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Jo={class:"p-4 space-y-4-6"},Xo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},Yo=["value"],Qo={class:"p-4 space-y-4-6"},ei={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ti=["value"],ai={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},si={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ni=["value"],oi={class:"p-4 space-y-2"},ii={class:"flex items-center justify-between mb-2"},li={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},ri={class:"flex items-center justify-between mb-3"},di={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},ui=["onClick"],ci={class:"text-sm font-medium text-gray-800 mb-1"},pi={class:"text-xs text-gray-600 line-clamp-2"},gi={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},mi={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},vi={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},fi={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},hi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},bi={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(a,{emit:W}){const e=a,_=W,r=E(null),I=E(!1),v=E(!1),N=wt({bold:!1,italic:!1,underline:!1}),f=wt({flooded:"",collision:"",collision_severity:"",notes:""}),C=E([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi kendaraan secara umum: <b>BAIK</b><br>
- Tidak ditemukan indikasi kerusakan signifikan<br>
- Semua sistem berfungsi dengan normal<br>`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <b>RINGAN</b><br>
- Area yang terdampak: PERLU DIISI<br>
- Perbaikan yang dilakukan: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat terkena banjir<br>
- Tingkat paparan air: PERLU DIISI<br>
- Komponen yang terdampak: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah umum (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi umum kendaraan: PERLU DIISI<br>
- Masalah utama yang ditemukan: PERLU DIISI<br>
- Komponen yang perlu perhatian: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Status Keseluruhan Kendaraan: PERLU DIISI<br>
- Catatan Utama: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap (Lengkap A, C, B)",content:`<p><strong>A. LAPORAN HASIL INSPEKSI TEKNIS:</strong></p>
- Tanggal Inspeksi: PERLU DIISI<br>
- Kondisi Mesin: PERLU DIISI<br>
- Kondisi Transmisi: PERLU DIISI<br>
- Kondisi Suspensi: PERLU DIISI<br>
- Kondisi Rem: PERLU DIISI<br>
- Kondisi Body: PERLU DIISI<br>
- Kondisi Interior: PERLU DIISI<br>
- Kesimpulan Akhir: PERLU DIISI

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`}]);E(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]);const U=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(m){return console.error("Error parsing settings JSON:",m),{}}return typeof s=="object"&&s!==null?s:{}};X(()=>U(e.inspection.settings).conclusion||{});const V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],L=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],K=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Pe(()=>{l(),kt(()=>{p(),$()})});const p=()=>{r.value&&f.notes&&(r.value.innerHTML=f.notes)},l=()=>{const m=U(e.inspection.settings).conclusion||{},M=e.form.conclusion||{};f.flooded=M.flooded||m.flooded||"",f.collision=M.collision||m.collision||"",f.collision_severity=M.collision_severity||m.collision_severity||"",f.notes=M.notes||e.inspection.notes||""},A=s=>{if(!r.value)return;let m=s.content;m=m.replace(/{PLATE_NUMBER}/g,e.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,e.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,f.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,f.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),r.value.innerHTML=m,f.notes=m,v.value=!1,kt(()=>{r.value.focus(),g()})},P=()=>{r.value&&(r.value.innerHTML="",f.notes="",g())},$=()=>{if(!r.value)return;const s=window.getSelection();s.rangeCount===0||s.isCollapsed||(N.bold=document.queryCommandState("bold"),N.italic=document.queryCommandState("italic"),N.underline=document.queryCommandState("underline"))},q=s=>{if(!r.value)return;r.value.focus();const m=N[s];switch(s){case"bold":document.execCommand("bold",!1,!m);break;case"italic":document.execCommand("italic",!1,!m);break;case"underline":document.execCommand("underline",!1,!m);break}setTimeout(()=>{$(),Z()},10)},Z=It.debounce(()=>{r.value&&(f.notes=r.value.innerHTML,g())},200),S=s=>{s.preventDefault(),document.execCommand("insertParagraph",!1,null)},b=s=>{s.preventDefault();const m=(s.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,m)},j=()=>{I.value=!0},H=()=>{I.value=!1,r.value&&(f.notes=r.value.innerHTML,g())},y=()=>{g()},g=()=>{const s={flooded:f.flooded,collision:f.collision,collision_severity:f.collision==="yes"?f.collision_severity:null,notes:f.notes};_("updateConclusion",s)};return ue(()=>e.form.conclusion,s=>{s&&(f.flooded=s.flooded!==void 0?s.flooded:f.flooded,f.collision=s.collision!==void 0?s.collision:f.collision,f.collision_severity=s.collision_severity!==void 0?s.collision_severity:f.collision_severity,f.notes=s.notes!==void 0?s.notes:f.notes,r.value&&s.notes!==void 0&&r.value.innerHTML!==s.notes&&(r.value.innerHTML=s.notes))},{deep:!0,immediate:!0}),ue([()=>f.flooded,()=>f.collision,()=>f.collision_severity,()=>f.notes],()=>{g()},{deep:!0}),(s,m)=>(n(),i("div",Zo,[m[21]||(m[21]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),t("div",Jo,[m[10]||(m[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ye(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Xo,[(n(),i(xe,null,we(V,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ae(t("input",{type:"radio","onUpdate:modelValue":m[0]||(m[0]=Q=>f.flooded=Q),value:M.value,class:"hidden peer",onChange:y},null,40,Yo),[[je,f.flooded]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":f.flooded===M.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":f.flooded!==M.value}])},R(M.label),3)])),64))])]),t("div",Qo,[m[12]||(m[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ye(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ei,[(n(),i(xe,null,we(L,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ae(t("input",{type:"radio","onUpdate:modelValue":m[1]||(m[1]=Q=>f.collision=Q),value:M.value,class:"hidden peer",onChange:y},null,40,ti),[[je,f.collision]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":f.collision===M.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":f.collision!==M.value}])},R(M.label),3)])),64))]),be(De,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:Ce(()=>[f.collision==="yes"?(n(),i("div",ai,[m[11]||(m[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[ye("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",si,[(n(),i(xe,null,we(K,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ae(t("input",{type:"radio","onUpdate:modelValue":m[2]||(m[2]=Q=>f.collision_severity=Q),value:M.value,class:"hidden peer",onChange:y},null,40,ni),[[je,f.collision_severity]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":f.collision_severity===M.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":f.collision_severity!==M.value}])},R(M.label),3)])),64))])])):c("",!0)]),_:1})]),t("div",oi,[t("div",ii,[m[14]||(m[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),t("button",{type:"button",onClick:m[3]||(m[3]=M=>v.value=!v.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},m[13]||(m[13]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),ye(" Template ")]))]),be(De,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:Ce(()=>[v.value?(n(),i("div",li,[t("div",ri,[m[16]||(m[16]=t("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),t("button",{onClick:m[4]||(m[4]=M=>v.value=!1),class:"text-gray-400 hover:text-gray-600"},m[15]||(m[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",di,[(n(!0),i(xe,null,we(C.value,M=>(n(),i("button",{key:M.id,onClick:Q=>A(M),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[t("div",ci,R(M.name),1),t("div",pi,R(M.description),1)],8,ui))),128))])])):c("",!0)]),_:1}),t("div",gi,[t("button",{type:"button",onClick:m[5]||(m[5]=M=>q("bold")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",N.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},m[17]||(m[17]=[t("strong",null,"B",-1)]),2),t("button",{type:"button",onClick:m[6]||(m[6]=M=>q("italic")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",N.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},m[18]||(m[18]=[t("em",null,"I",-1)]),2),t("button",{type:"button",onClick:m[7]||(m[7]=M=>q("underline")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",N.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},m[19]||(m[19]=[t("u",null,"U",-1)]),2),t("button",{type:"button",onClick:m[8]||(m[8]=M=>P()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),be(De,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:Ce(()=>[Object.values(N).some(M=>M)?(n(),i("div",mi,[m[20]||(m[20]=ye(" Format aktif: ")),N.bold?(n(),i("span",vi,"Bold")):c("",!0),N.italic?(n(),i("span",fi,"Italic")):c("",!0),N.underline?(n(),i("span",hi,"Underline")):c("",!0)])):c("",!0)]),_:1}),t("div",{ref_key:"editorRef",ref:r,contenteditable:"true",class:oe(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!I.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":I.value}]),onInput:m[9]||(m[9]=(...M)=>Ue(Z)&&Ue(Z)(...M)),onBlur:H,onFocus:j,onKeydown:Mt(S,["enter"]),onPaste:b,onMouseup:$,onKeyup:$,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Si=Te(bi,[["__scopeId","data-v-6b429a8f"]]);export{Vn as B,$i as C,_i as V,Ct as _,Si as a};
