import{r as w,q,c as g,o as l,d as a,b as m,t as A,f as ke,F as be,m as Fe,j as $,x as ft,G as it,W as He,g as yt,u as c,N as ot,n as Y,k as Ae,w as Ee,T as at,y as ht,S as xt,z as _t,A as wt}from"./vendor-g77w9U1W.js";import{l as Ze}from"./lodash-CGXsUT3p.js";import{_ as bt,a as kt,b as Ct,c as St,d as Mt,e as Dt,I as Vt,f as Ut,V as $t,C as jt,B as Tt,g as qt}from"./ConclusionSection-xlJIVVpZ.js";import{_ as zt}from"./InputNumber-sdp6_31d.js";import{_ as rt}from"./app-DtCC8Y1B.js";import{u as lt}from"./useDraggableButton-BzEK2Xk5.js";import"./PrimaryButton-CrKKsBb9.js";import"./ActionMessage-C9w22vKV.js";const Rt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Lt={class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},Nt={class:"text-xl font-semibold text-indigo-700"},Ot={class:"p-4 space-y-4"},Bt={key:0,class:"flex items-center justify-center text-sm text-gray-500 mb-4"},Ht={class:"flex items-start justify-between"},At={class:"block text-sm font-medium text-gray-700"},Et={key:0,class:"text-red-500"},Ft={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Jt={key:1,class:"text-center py-8 text-gray-500"},Kt={key:0,class:"text-xs text-gray-400"},It={__name:"CategorySection",props:{category:Object,form:Object,inspectionId:String,selectedPoint:Object,isSyncing:Boolean},emits:["saveResult","updateResult","removeImage","hapusPoint","updateImages"],setup(k,{emit:v}){const o=k,E=v,z=w(!1),S=q(()=>(f,p)=>{var s;return f&&((s=o.form.results[f])==null?void 0:s[p])||""}),J=q(()=>f=>f?o.form.images[f]||[]:[]),re=q(()=>(o.category.points||[]).some(f=>f.is_default===!1)),F=q(()=>o.category.isDamageMenu?(o.category.points||[]).filter(p=>{var j;const s=(j=p.inspection_point)==null?void 0:j.id,D=K(s);return z.value||p.is_default||!p.is_default&&D?!0:D}):(o.category.points||[]).filter(s=>{var V;const D=(V=s.inspection_point)==null?void 0:V.id,j=K(D);return!!(z.value||s.is_default||j)})),K=f=>{if(!f)return!1;const p=o.form.results[f]&&(o.form.results[f].status||o.form.results[f].note),s=o.form.images[f]&&o.form.images[f].length>0;return p||s},ue=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],Je=f=>{var D,j,V,I,N,O,B,H,R;const p=o.form.results[(D=f.inspection_point)==null?void 0:D.id],s=o.form.images[(j=f.inspection_point)==null?void 0:j.id];if(!p)return!1;switch(f.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!p.note;case"select":case"radio":if(!p.status)return!1;const h=(I=(V=f.settings)==null?void 0:V.radios)==null?void 0:I.find(T=>T.value===p.status);return!(h!=null&&h.settings&&(h.settings.show_textarea&&!((N=p.note)!=null&&N.trim())||h.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!p.status)return!1;const U=(B=(O=f.settings)==null?void 0:O.radios)==null?void 0:B.find(T=>T.value===p.status);return!(U!=null&&U.settings&&U.settings.show_textarea&&!((H=p.note)!=null&&H.trim()));case"image":return(s==null?void 0:s.length)>0;default:return!!p.status||!!((R=p.note)!=null&&R.trim())}},C=(f,p,s)=>{E("updateResult",{pointId:f,type:s,value:p})},ne=(f,p)=>{E("updateImages",{pointId:f,images:p})},M=f=>{E("saveResult",f)},X=f=>{E("hapusPoint",f)};return(f,p)=>(l(),g("div",Rt,[a("div",Lt,[a("h3",Nt,A(k.category.name),1),re.value?(l(),g("button",{key:0,onClick:p[0]||(p[0]=s=>z.value=!z.value),class:"text-sm text-indigo-700 hover:underline focus:outline-none"},A(z.value?"Sembunyikan Point Yang Tidak Perlu":"Tampilkan Point Tersembunyi"),1)):m("",!0)]),a("div",Ot,[k.isSyncing?(l(),g("div",Bt,p[1]||(p[1]=[a("svg",{class:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),ke(" Menyimpan... ")]))):m("",!0),(l(!0),g(be,null,Fe(F.value,s=>{var D,j,V,I,N,O,B,H,R,h,U,T,W,P,ee,Ce,Ke,x,te,Q,Se,Me,De,Ve,de,b,Ue,ie,$e,oe,ce,pe,je,Te,se,ge,ve,me,qe,ze,Re,Le,Ne,ae,Oe,Be,fe;return l(),g("div",{key:s.id,class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},[a("div",Ht,[a("label",At,[ke(A((D=s.inspection_point)==null?void 0:D.name)+" ",1),(j=s.settings)!=null&&j.is_required?(l(),g("span",Et,"*")):m("",!0)]),Je(s)?(l(),g("span",Ft," ✓ ")):m("",!0)]),s.input_type==="text"?(l(),$(bt,{key:0,"model-value":S.value((V=s.inspection_point)==null?void 0:V.id,"note"),required:(I=s.settings)==null?void 0:I.is_required,"min-length":(N=s.settings)==null?void 0:N.min_length,"max-length":(O=s.settings)==null?void 0:O.max_length,allowSpace:(B=s.settings)==null?void 0:B.allow_space,textTransform:(H=s.settings)==null?void 0:H.text_transform,placeholder:((R=s.settings)==null?void 0:R.placeholder)||"Masukan text","onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","onUpdate:modelValue","onSave"])):m("",!0),s.input_type==="number"?(l(),$(zt,{key:1,"model-value":S.value((h=s.inspection_point)==null?void 0:h.id,"note"),required:(U=s.settings)==null?void 0:U.is_required,min:(T=s.settings)==null?void 0:T.min,max:(W=s.settings)==null?void 0:W.max,step:((P=s.settings)==null?void 0:P.step)||1,placeholder:((ee=s.settings)==null?void 0:ee.placeholder)||"Masukan number","onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","min","max","step","placeholder","onUpdate:modelValue","onSave"])):m("",!0),s.input_type==="account"?(l(),$(kt,{key:2,"model-value":S.value((Ce=s.inspection_point)==null?void 0:Ce.id,"note"),required:(Ke=s.settings)==null?void 0:Ke.is_required,placeholder:((x=s.settings)==null?void 0:x.placeholder)||"Masukkan nilai","point-id":(te=s.inspection_point)==null?void 0:te.id,settings:s.settings,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","placeholder","point-id","settings","onUpdate:modelValue","onSave"])):m("",!0),s.input_type==="date"?(l(),$(Ct,{key:3,"model-value":S.value((Q=s.inspection_point)==null?void 0:Q.id,"note"),required:(Se=s.settings)==null?void 0:Se.is_required,"min-date":(Me=s.settings)==null?void 0:Me.min_date,"max-date":(De=s.settings)==null?void 0:De.max_date,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","min-date","max-date","onUpdate:modelValue","onSave"])):m("",!0),s.input_type==="textarea"?(l(),$(St,{key:4,"model-value":S.value((Ve=s.inspection_point)==null?void 0:Ve.id,"note"),required:(de=s.settings)==null?void 0:de.is_required,"min-length":(b=s.settings)==null?void 0:b.min_length,"max-length":(Ue=s.settings)==null?void 0:Ue.max_length,placeholder:((ie=s.settings)==null?void 0:ie.placeholder)||"Masukkan teks di sini",settings:s.settings,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","min-length","max-length","placeholder","settings","onUpdate:modelValue","onSave"])):m("",!0),s.input_type==="radio"?(l(),$(Mt,{key:5,"model-value":S.value(($e=s.inspection_point)==null?void 0:$e.id,"status"),notes:S.value((oe=s.inspection_point)==null?void 0:oe.id,"note"),images:J.value((ce=s.inspection_point)==null?void 0:ce.id),required:(pe=s.settings)==null?void 0:pe.is_required,"point-id":(je=s.inspection_point)==null?void 0:je.id,point:s.inspection_point,"inspection-id":k.inspectionId,settings:s.settings,"point-name":(Te=s.inspection_point)==null?void 0:Te.name,"selected-point":s.inspection_point??null,options:((se=s.settings)==null?void 0:se.radios)||ue,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"status")},"onUpdate:notes":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},"onUpdate:images":d=>{var n;return ne((n=s.inspection_point)==null?void 0:n.id,d)},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)},onHapus:d=>{var n;return X((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","notes","images","required","point-id","point","inspection-id","settings","point-name","selected-point","options","onUpdate:modelValue","onUpdate:notes","onUpdate:images","onSave","onHapus"])):m("",!0),s.input_type==="imageTOradio"?(l(),$(Dt,{key:6,"model-value":S.value((ge=s.inspection_point)==null?void 0:ge.id,"status"),notes:S.value((ve=s.inspection_point)==null?void 0:ve.id,"note"),images:J.value((me=s.inspection_point)==null?void 0:me.id),required:(qe=s.settings)==null?void 0:qe.is_required,"point-id":(ze=s.inspection_point)==null?void 0:ze.id,"inspection-id":k.inspectionId,settings:s.settings,"point-name":(Re=s.inspection_point)==null?void 0:Re.name,point:s,"selected-point":s.inspection_point??null,options:((Le=s.settings)==null?void 0:Le.radios)||ue,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"status")},"onUpdate:notes":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},"onUpdate:images":d=>{var n;return ne((n=s.inspection_point)==null?void 0:n.id,d)},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)},onHapus:d=>{var n;return X((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","notes","images","required","point-id","inspection-id","settings","point-name","point","selected-point","options","onUpdate:modelValue","onUpdate:notes","onUpdate:images","onSave","onHapus"])):m("",!0),s.input_type==="image"?(l(),$(Vt,{key:7,"model-value":J.value((Ne=s.inspection_point)==null?void 0:Ne.id),"inspection-id":k.inspectionId,"point-id":(ae=s.inspection_point)==null?void 0:ae.id,point:s.inspection_point,"point-name":(Oe=s.inspection_point)==null?void 0:Oe.name,settings:s.settings,"onUpdate:modelValue":d=>{var n;return ne((n=s.inspection_point)==null?void 0:n.id,d)},"onUpdate:notes":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"note")},"onUpdate:status":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"status")}},null,8,["model-value","inspection-id","point-id","point","point-name","settings","onUpdate:modelValue","onUpdate:notes","onUpdate:status"])):m("",!0),s.input_type==="select"?(l(),$(Ut,{key:8,"model-value":S.value((Be=s.inspection_point)==null?void 0:Be.id,"status"),required:(fe=s.settings)==null?void 0:fe.is_required,"onUpdate:modelValue":d=>{var n;return C((n=s.inspection_point)==null?void 0:n.id,d,"status")},onSave:d=>{var n;return M((n=s.inspection_point)==null?void 0:n.id)}},null,8,["model-value","required","onUpdate:modelValue","onSave"])):m("",!0)])}),128)),F.value.length===0?(l(),g("div",Jt,[p[2]||(p[2]=a("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),p[3]||(p[3]=a("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),k.category.isDamageMenu?(l(),g("p",Kt,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):m("",!0)])):m("",!0)])]))}},Wt=rt(It,[["__scopeId","data-v-015de7bc"]]),Qt={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Gt={key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-30 pointer-events-none transition-opacity duration-200"},Zt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Yt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor","stroke-width":"2"},Xt={class:"flex overflow-x-auto scrollbar-hide py-3 px-4"},Pt={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},es=["onClick"],ts={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ss={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},ns={key:3,class:"fixed inset-0 z-30"},is={class:"mt-2 space-y-2"},os={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},as=["onClick"],ls={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},rs={key:0,class:"ml-2 inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-green-500 text-white"},us={class:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-1"},ds={key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-400 text-white px-4 py-2 rounded shadow-lg z-50"},cs={class:"relative overflow-hidden"},ps={key:0,class:"flex justify-end gap-4 mt-2 p-4 bg-white rounded-xl shadow-md"},gs={key:1},vs=["disabled"],ms={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fs={class:"space-y-4"},ys={class:"relative"},hs={class:"max-h-64 overflow-y-auto"},xs={key:0,class:"text-center py-4 text-gray-500"},_s=["onClick"],ws={class:"font-medium text-gray-900"},bs={class:"text-sm text-gray-500"},ks={class:"text-xs text-gray-400 mt-1"},Cs={key:0,class:"text-xs text-green-600 mt-1"},Ss={__name:"InspectionForm",props:{inspection:Object,inspectionId:Object,category:Object,appMenus:Array,damagePoints:Array,existingResults:Object,existingImages:Object,CarDetail:Array,allInspections:Array},setup(k){var Pe,et,tt,st;const v=k,o=w({results:{},images:{}}),E=w(new Map),z=w(!1),S=w(new Set),J=w({}),re=w(((et=(Pe=v.category)==null?void 0:Pe.settings)==null?void 0:et.menu_model)||"horizontal"),F=w(((st=(tt=v.category)==null?void 0:tt.settings)==null?void 0:st.position)||"top"),K=w(!1),{pos:ue,dragging:Je,startLongPress:C,cancelLongPress:ne,onDrag:M,stopDrag:X}=lt("toggleMenuButtonPos",{x:window.innerWidth-80,y:20}),f=()=>{K.value=!K.value},p=()=>{K.value=!1},s=e=>e?"bg-gradient-to-r from-indigo-700 to-sky-600 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-700",{pos:D,dragging:j,startLongPress:V,cancelLongPress:I,onDrag:N,stopDrag:O}=lt("damageButtonPos",{x:window.innerWidth-80,y:window.innerHeight-80}),B=w(!1),H=w(!1),R=w(""),h=w(null),U=w(""),T=w(""),W=w(""),P=w(!1),ee=w(null),Ce=()=>{const e={},t={};[...v.appMenus.flatMap(r=>r.menu_point||[]),...v.damagePoints||[]].forEach(r=>{const y=r.inspection_point_id,_=v.existingResults[y];e[y]={status:(_==null?void 0:_.status)||"",note:(_==null?void 0:_.note)||""},t[y]=v.existingImages[y]||[]}),o.value={results:e,images:t},J.value=JSON.parse(JSON.stringify(o.value))},x=ft({inspection_id:v.inspection.id,results:{},images:{},overall_note:v.inspection.overall_note||""}),te=(e,t,u)=>{const r=`${e}-${t}-${Date.now()}`;E.value.set(r,{pointId:e,type:t,data:u,timestamp:Date.now()}),S.value.add(r)},Q=async()=>{if(!(z.value||E.value.size===0)){z.value=!0;try{const e=Array.from(E.value.entries());for(const[t,u]of e)S.value.has(t)&&(await Se(u),S.value.delete(t),E.value.delete(t),J.value=JSON.parse(JSON.stringify(o.value)))}catch(e){console.error("Sync error:",e)}finally{z.value=!1,S.value.size>0&&setTimeout(()=>Q(),500)}}},Se=async e=>{try{await He.post(route("inspections.save-result"),{inspection_id:v.inspection.id,point_id:e.pointId,status:e.type==="result"?e.data.status:void 0,note:e.type==="result"?e.data.note:void 0,images:e.type==="images"?e.data:void 0},{preserveScroll:!0,preserveState:!0,onError:t=>{console.error("Sync failed:",t)}})}catch(t){console.error("Network error:",t)}},Me=(e,t)=>{const u=[];return Object.keys(t.results).forEach(r=>{const y=e.results[r]||{},_=t.results[r]||{};(y.status!==_.status||y.note!==_.note)&&u.push({pointId:r,type:"result",data:{..._}})}),Object.keys(t.images).forEach(r=>{const y=e.images[r]||[],_=t.images[r]||[];JSON.stringify(y)!==JSON.stringify(_)&&u.push({pointId:r,type:"images",data:[..._]})}),u},De=Ze.debounce(async()=>{await Q()},1e3);it(()=>o.value,(e,t)=>{const u=Me(J.value,e);u.length>0&&(u.forEach(r=>{te(r.pointId,r.type,r.data)}),De())},{deep:!0,immediate:!1});const Ve=q(()=>v.appMenus.some(e=>e.input_type==="damage")),de=q(()=>["vehicle",...v.appMenus.map(e=>e.id),"conclusion"]),b=w(de.value[0]),Ue=w(0);it(b,e=>{Ue.value=de.value.indexOf(e)});const ie=q(()=>{if(b.value==="vehicle"||b.value==="conclusion")return null;const e=v.appMenus.find(t=>t.id===b.value);return e?{...e,points:n(e.menu_point,e.input_type==="damage")}:null}),$e=q(()=>({results:o.value.results,images:o.value.images,isSyncing:z.value})),oe=w({plate_number:v.inspection.plate_number,car_id:v.inspection.car_id,car_name:v.inspection.car_name}),ce=w(!1),pe=w(!1),je=e=>{ce.value=e},Te=e=>{pe.value=e},se=q(()=>{var y;const e=oe.value.plate_number&&/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(oe.value.plate_number),t=!!((y=oe.value.car_name)!=null&&y.trim()),u=!pe.value,r=!ce.value;return e&&t&&u&&r}),ge=q(()=>{if(!R.value.trim())return v.damagePoints||[];const e=R.value.toLowerCase().trim();return(v.damagePoints||[]).filter(t=>{var u,r,y,_,L;return((r=(u=t.inspection_point)==null?void 0:u.name)==null?void 0:r.toLowerCase().includes(e))||((_=(y=t.inspection_point)==null?void 0:y.description)==null?void 0:_.toLowerCase().includes(e))||((L=me(t))==null?void 0:L.toLowerCase().includes(e))})}),ve=e=>{const t=v.existingResults&&v.existingResults[e]!==void 0,u=v.existingImages&&v.existingImages[e]&&v.existingImages[e].length>0,r=o.value.results[e]&&(o.value.results[e].status||o.value.results[e].note),y=o.value.images[e]&&o.value.images[e].length>0;return t||u||r||y},me=e=>{var t;return((t=e.inspection_point.component)==null?void 0:t.name)||"Komponen Tidak Diketahui"},qe=e=>v.existingResults[e]||null,ze=e=>{h.value=e;const t=e.inspection_point_id,u=o.value.results[t]||{};U.value=u.status||"",T.value=u.note||"",B.value=!1,H.value=!0},Re=e=>{if(h.value){const t=h.value.inspection_point_id;o.value.images[t]=e,x.images[t]=e}},Le=()=>{if(h.value){const e=h.value.inspection_point_id;o.value.results[e]={...o.value.results[e],status:U.value,note:T.value},x.results[e]={...o.value.results[e]},te(e,"result",o.value.results[e]),Q(),W.value="Data berhasil disimpan!",setTimeout(()=>W.value="",1e3)}ae()},Ne=()=>{B.value=!1,R.value=""},ae=()=>{H.value=!1,h.value=null,U.value="",T.value=""},Oe=({pointId:e,type:t,value:u})=>{o.value.results[e]||(o.value.results[e]={status:"",note:""}),o.value.results[e][t]=u,x.results[e]||(x.results[e]={status:"",note:""}),x.results[e][t]=u},Be=(e,t)=>{o.value.images[e]=t,x.images[e]=t},fe=Ze.debounce(async e=>{o.value.results[e]&&te(e,"result",o.value.results[e]),o.value.images[e]&&te(e,"images",o.value.images[e]),await Q()},500),d=async e=>{if(e&&confirm("Apakah kamu yakin ingin menghapus data ini?")){try{o.value.results[e]&&(o.value.results[e]={status:"",note:""}),o.value.images[e]&&(o.value.images[e]=[]),x.results[e]&&(x.results[e]={status:"",note:""}),x.images[e]&&(x.images[e]=[]),await He.post(route("inspections.delete-result"),{inspection_id:v.inspection.id,point_id:e},{preserveScroll:!0,onSuccess:()=>{W.value="Data berhasil dihapus!",J.value=JSON.parse(JSON.stringify(o.value))},onError:t=>{console.error("Error menghapus hasil:",t)}})}catch(t){console.error("Error menghapus hasil:",t)}ae()}},n=(e,t)=>t?(e||[]).filter(u=>{const r=u.inspection_point_id;return ve(r)}):e||[],Ie=e=>e.input_type==="damage"?n(e.menu_point,!0).length>0:e.id==="conclusion"?Qe():e.id==="vehicle"?se():(n(e.menu_point,!1)||[]).filter(u=>u.is_default).every(u=>{var L,ye,he,xe,_e,we;const r=o.value.results[u.inspection_point_id],y=o.value.images[u.inspection_point_id];if(!r)return!1;const _=We(u.settings);switch(u.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!((L=r.note)!=null&&L.trim());case"select":case"radio":if(!r.status)return!1;const G=(ye=_.radios)==null?void 0:ye.find(i=>i.value===r.status);return!(G!=null&&G.settings&&(G.settings.show_textarea&&!((he=r.note)!=null&&he.trim())||G.settings.show_image_upload&&(y==null?void 0:y.length)===0));case"imageTOradio":if((y==null?void 0:y.length)===0||!r.status)return!1;const Z=(xe=_.radios)==null?void 0:xe.find(i=>i.value===r.status);return!(Z!=null&&Z.settings&&Z.settings.show_textarea&&Z.settings.required&&!((_e=r.note)!=null&&_e.trim()));case"image":return(y==null?void 0:y.length)>0;default:return!!r.status||!!((we=r.note)!=null&&we.trim())}}),We=e=>{if(!e)return{};if(typeof e=="string")try{return JSON.parse(e)||{}}catch(t){return console.error("Error parsing settings JSON:",t),{}}return typeof e=="object"&&e!==null?e:{}},Qe=()=>{var L;const t=We(v.inspection.settings).conclusion||{},u=!!t.flooded,r=!!t.collision,y=t.collision==="yes"?!!t.collision_severity:!0,_=!!((L=v.inspection.notes)!=null&&L.trim());return u&&r&&y&&_},Ye=q(()=>{const t=We(v.inspection.settings).conclusion||{};return{flooded:t.flooded||null,collision:t.collision||null,collision_severity:t.collision_severity||null,note:v.inspection.notes||null,isComplete:Qe()}}),Xe=q(()=>{const e=se.value,t=v.appMenus.every(r=>Ie(r)),u=Qe();return e&&t&&u}),le=e=>{b.value=e},ut=(e,t)=>{P.value=!0,ee.value=t,He.visit(e,{onFinish:()=>{P.value=!1,ee.value=null}})},dt=e=>{console.log("Update vehicle:",e)},ct=e=>{console.log("Save car details:",e)},pt=e=>{Object.assign(x.conclusion,e),gt()},gt=Ze.debounce(async()=>{try{await He.post(route("inspections.save-conclusion"),{inspection_id:v.inspection.id,...x.conclusion},{preserveScroll:!0,preserveState:!0})}catch(e){console.error("Error menyimpan kesimpulan:",e)}},500),vt=async()=>{if(S.value.size>0&&await Q(),x.results={...o.value.results},x.images={...o.value.images},!Xe.value){alert("Harap lengkapi semua menu inspeksi termasuk kesimpulan sebelum submit final");return}x.post(route("inspections.final-submit",{id:v.inspection.id}),{preserveScroll:!0,onSuccess:()=>{},onError:e=>{console.error("Kesalahan pengiriman:",e)}})},mt=({pointId:e,imageId:t})=>{o.value.images[e]&&(o.value.images[e]=o.value.images[e].filter(u=>u.id!==t),x.images[e]=o.value.images[e],fe(e))};return yt(()=>{Ce()}),(e,t)=>{var u,r,y,_,L,ye,he,xe,_e,we,G,Z;return l(),g("div",Qt,[c(j)||c(Je)?(l(),g("div",Gt)):m("",!0),re.value==="vertical"?(l(),g("button",{key:1,onMousedown:t[0]||(t[0]=(...i)=>c(C)&&c(C)(...i)),onMouseup:t[1]||(t[1]=(...i)=>c(X)&&c(X)(...i)),onMouseleave:t[2]||(t[2]=(...i)=>c(ne)&&c(ne)(...i)),onMousemove:t[3]||(t[3]=(...i)=>c(M)&&c(M)(...i)),onTouchstart:t[4]||(t[4]=(...i)=>c(C)&&c(C)(...i)),onTouchend:t[5]||(t[5]=(...i)=>c(X)&&c(X)(...i)),onTouchmove:t[6]||(t[6]=(...i)=>c(M)&&c(M)(...i)),onClick:f,class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white border shadow-lg rounded-full hover:shadow-xl transition",style:ot({left:c(ue).x+"px",top:c(ue).y+"px"}),"aria-label":"Toggle vertical menu"},[K.value?(l(),g("svg",Yt,t[24]||(t[24]=[a("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]))):(l(),g("svg",Zt,t[23]||(t[23]=[a("path",{"fill-rule":"evenodd",d:"M3 5h14v2H3V5zm0 4h10v2H3V9zm0 4h6v2H3v-2z","clip-rule":"evenodd"},null,-1)])))],36)):m("",!0),re.value==="horizontal"?(l(),g("div",{key:2,class:Y(["z-10 bg-white shadow-sm",{"sticky top-0 mb-2":F.value==="top","fixed bottom-0 left-0 right-0":F.value==="bottom"}])},[a("div",Xt,[a("button",{onClick:t[7]||(t[7]=i=>le("vehicle")),class:Y(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":b.value==="vehicle","bg-gray-100 text-gray-700 hover:bg-gray-200":b.value!=="vehicle"}])},[t[25]||(t[25]=ke(" Detail Kendaraan ")),se.value?(l(),g("span",Pt," ✓ ")):m("",!0)],2),(l(!0),g(be,null,Fe(k.appMenus,i=>(l(),g("button",{key:i.id,onClick:Ge=>le(i.id),class:Y(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":b.value===i.id,"bg-gray-100 text-gray-700 hover:bg-gray-200":b.value!==i.id}])},[ke(A(i.name)+" ",1),Ie(i)?(l(),g("span",ts," ✓ ")):m("",!0)],10,es))),128)),a("button",{onClick:t[8]||(t[8]=i=>le("conclusion")),class:Y(["flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors duration-200",{"bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white":b.value==="conclusion","bg-gray-100 text-gray-700 hover:bg-gray-200":b.value!=="conclusion"}])},[t[26]||(t[26]=ke(" Kesimpulan ")),Ye.value.isComplete?(l(),g("span",ss," ✓ ")):m("",!0)],2)])],2)):m("",!0),re.value==="vertical"&&K.value?(l(),g("div",ns,[a("div",{class:"absolute inset-0 bg-black bg-opacity-30",onClick:p}),a("div",{class:Y(["absolute z-40 w-60 bg-white rounded-xl shadow-xl p-2 max-h-[75vh] overflow-y-auto",{"top-16 right-4":F.value==="top-right","top-16 left-4":F.value==="top-left","bottom-16 right-4":F.value==="bottom-right","bottom-16 left-4":F.value==="bottom-left"}])},[a("div",{class:"flex items-center justify-between px-2 py-1 border-b"},[t[27]||(t[27]=a("div",{class:"text-sm font-semibold"},"Pilih Menu",-1)),a("button",{onClick:p,class:"text-xs text-gray-500 hover:text-gray-700"},"Tutup")]),a("div",is,[a("button",{onClick:t[9]||(t[9]=i=>{le("vehicle"),p()}),class:Y([s(b.value==="vehicle"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[t[28]||(t[28]=a("span",null,"Detail Kendaraan",-1)),se.value?(l(),g("span",os,"✓")):m("",!0)],2),(l(!0),g(be,null,Fe(k.appMenus,i=>(l(),g("button",{key:`vmenu-${i.id}`,onClick:()=>{le(i.id),p()},class:Y([s(b.value===i.id),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[a("span",null,A(i.name),1),Ie(i)?(l(),g("span",ls,"✓")):m("",!0)],10,as))),128)),a("button",{onClick:t[10]||(t[10]=i=>{le("conclusion"),p()}),class:Y([s(b.value==="conclusion"),"w-full flex items-center justify-between px-3 py-2 rounded-md text-sm"])},[t[29]||(t[29]=a("span",null,"Kesimpulan",-1)),Ye.value.isComplete?(l(),g("span",rs,"✓")):m("",!0)],2)])],2)])):m("",!0),a("div",us,[Ae(at,{name:"fade"},{default:Ee(()=>[W.value?(l(),g("div",ds,A(W.value),1)):m("",!0)]),_:1}),a("div",cs,[Ae(at,{name:"category-slide",mode:"out-in"},{default:Ee(()=>[b.value==="vehicle"?(l(),$($t,{key:0,inspection:k.inspection,CarDetail:k.CarDetail,allInspections:v.allInspections,onUpdateVehicle:dt,onSaveCarDetails:ct,"onUpdate:validation":Te,"onUpdate:hasUnsavedChanges":je},null,8,["inspection","CarDetail","allInspections"])):ie.value&&b.value!=="conclusion"?(l(),$(Wt,{key:ie.value.id,category:ie.value,"inspection-id":k.inspection.id,form:$e.value,"is-syncing":z.value,onSaveResult:c(fe),onUpdateResult:Oe,onUpdateImages:Be,onHapusPoint:d,onRemoveImage:mt},null,8,["category","inspection-id","form","is-syncing","onSaveResult"])):b.value==="conclusion"?(l(),$(jt,{key:2,form:c(x),"inspection-id":k.inspection.id,inspection:k.inspection,settings:k.inspection.settings||{},onUpdateConclusion:pt},null,8,["form","inspection-id","inspection","settings"])):m("",!0)]),_:1})]),b.value==="conclusion"?(l(),g("div",ps,[Ae(c(xt),{href:e.route("inspections.pending",k.inspectionId),as:"button",type:"button",disabled:P.value&&ee.value==="pending",onClick:t[11]||(t[11]=ht(i=>ut(e.route("inspections.pending",k.inspectionId),"pending"),["prevent"])),class:"inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded-md shadow-sm bg-yellow-500 text-white hover:bg-yellow-600 transition disabled:opacity-50 disabled:cursor-not-allowed"},{default:Ee(()=>[P.value&&ee.value==="pending"?(l(),g(be,{key:0},[t[30]||(t[30]=a("svg",{class:"animate-spin h-4 w-4 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 \r
                5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 \r
                5.824 3 7.938l3-2.647z`})],-1)),t[31]||(t[31]=a("span",null,"Memproses...",-1))],64)):(l(),g("span",gs,"Tunda"))]),_:1},8,["href","disabled"]),a("button",{type:"button",onClick:vt,disabled:!Xe.value||c(x).processing,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"},[c(x).processing?(l(),g("svg",ms,t[32]||(t[32]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:`M4 12a8 8 0 018-8V0C5.373 0 0 \r
              5.373 0 12h4zm2 5.291A7.962 7.962 0 \r
              014 12H0c0 3.042 1.135 5.824 3 \r
              7.938l3-2.647z`},null,-1)]))):m("",!0),a("span",null,A(c(x).processing?"Mengirim...":"Final Kirim Inspeksi"),1)],8,vs)])):m("",!0),Ve.value?(l(),g("button",{key:1,onMousedown:t[12]||(t[12]=(...i)=>c(V)&&c(V)(...i)),onMouseup:t[13]||(t[13]=(...i)=>c(O)&&c(O)(...i)),onMouseleave:t[14]||(t[14]=(...i)=>c(I)&&c(I)(...i)),onMousemove:t[15]||(t[15]=(...i)=>c(N)&&c(N)(...i)),onTouchstart:t[16]||(t[16]=(...i)=>c(V)&&c(V)(...i)),onTouchend:t[17]||(t[17]=(...i)=>c(O)&&c(O)(...i)),onTouchmove:t[18]||(t[18]=(...i)=>c(N)&&c(N)(...i)),onClick:t[19]||(t[19]=i=>B.value=!0),class:"fixed z-40 p-4 bg-gradient-to-r from-indigo-700 to-sky-600 text-white rounded-full shadow-lg",style:ot({left:c(D).x+"px",top:c(D).y+"px"})},t[33]||(t[33]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1)]),36)):m("",!0),Ae(Tt,{show:B.value,title:"Cari Point Inspeksi",subtitle:"Pilih point inspeksi untuk ditambahkan",onClose:Ne},{default:Ee(()=>[a("div",fs,[a("div",ys,[_t(a("input",{"onUpdate:modelValue":t[20]||(t[20]=i=>R.value=i),type:"text",placeholder:"Cari point inspeksi...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[wt,R.value]]),t[34]||(t[34]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),a("div",hs,[ge.value.length===0?(l(),g("div",xs," Tidak ada point yang ditemukan ")):m("",!0),(l(!0),g(be,null,Fe(ge.value,i=>{var Ge,nt;return l(),g("button",{key:i.id,onClick:Ms=>ze(i),class:"w-full text-left p-3 border-b border-gray-200 hover:bg-gray-50 transition-colors"},[a("div",ws,A((Ge=i.inspection_point)==null?void 0:Ge.name),1),a("div",bs,A((nt=i.inspection_point)==null?void 0:nt.description),1),a("div",ks,A(me(i)),1),ve(i.inspection_point_id)?(l(),g("div",Cs," ✓ Sudah ada data ")):m("",!0)],8,_s)}),128))])])]),_:1},8,["show"]),H.value?(l(),$(qt,{key:(u=h.value)==null?void 0:u.id,show:H.value,title:((y=(r=h.value)==null?void 0:r.inspection_point)==null?void 0:y.name)||"Detail Point",subtitle:(L=(_=h.value)==null?void 0:_.inspection_point)==null?void 0:L.description,name:`point-${(ye=h.value)==null?void 0:ye.id}`,"inspection-id":k.inspection.id,"point-id":(he=h.value)==null?void 0:he.inspection_point_id,settings:((xe=h.value)==null?void 0:xe.settings)||{},options:((we=(_e=h.value)==null?void 0:_e.settings)==null?void 0:we.radios)||[],"selected-Point":h.value,"selected-value":U.value,"images-value":c(x).images[(G=h.value)==null?void 0:G.inspection_point_id],"notes-value":T.value,point:h.value,"existing-data":qe((Z=h.value)==null?void 0:Z.inspection_point_id),"onUpdate:selectedValue":t[21]||(t[21]=i=>U.value=i),"onUpdate:notesValue":t[22]||(t[22]=i=>T.value=i),"onUpdate:imagesValue":Re,onSave:Le,onClose:ae,onHapus:d},null,8,["show","title","subtitle","name","inspection-id","point-id","settings","options","selected-Point","selected-value","images-value","notes-value","point","existing-data"])):m("",!0)])])}}},Rs=rt(Ss,[["__scopeId","data-v-454eaf7b"]]);export{Rs as default};
