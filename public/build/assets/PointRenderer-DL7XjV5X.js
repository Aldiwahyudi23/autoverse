const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TextInput-DlKU5iyX.js","assets/vendor-D9AtPSqO.js","assets/NumberInput-CBSPv0ps.js","assets/SelectInput-64wRePp4.js","assets/RadioGroup-CrqTHmp7.js","assets/CheckboxGroup-BtEeYY9R.js","assets/TextareaInput-DSP311J1.js","assets/DatePicker-D6e4n4aN.js"])))=>i.map(i=>d[i]);
import{a as f}from"./app-DD5nWmYF.js";import{r as p,q as Y,L as Z,c as i,o as s,d as e,b as u,f as I,t as h,n as M,j as ee,M as te,F as D,m as T,z as oe,A as se,N as b,a as j}from"./vendor-D9AtPSqO.js";const ne={class:"point-renderer"},ie={class:"flex justify-between items-start mb-4"},re={class:"text-lg font-semibold text-gray-900"},le={key:0,class:"ml-2 text-red-500"},ae={key:0,class:"mt-1 text-sm text-gray-600"},ue={class:"flex items-center space-x-2"},de={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200"},ce={class:"flex"},pe={class:"text-sm text-blue-800"},ve={class:"mb-4"},me={key:1,class:"mb-3"},ge={key:2,class:"mt-4 pt-4 border-t border-gray-200"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={key:0,class:"col-span-1"},be=["rows","placeholder"],xe={key:1,class:"col-span-1"},ye={class:"mt-1 flex items-center space-x-3"},ke={key:0,class:"text-sm text-gray-500"},we={key:0,class:"mt-3 grid grid-cols-3 gap-2"},_e=["src"],Ce=["onClick"],Ie={key:1,class:"mt-3"},Ve={class:"grid grid-cols-3 gap-2"},De=["src"],Te=["href"],Ee={class:"mt-4 pt-4 border-t border-gray-200 flex justify-end space-x-3"},Pe=["disabled"],Be={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-700",fill:"none",viewBox:"0 0 24 24"},Me={key:1,class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},je=["disabled"],ze={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Le={key:1,class:"-ml-1 mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ne={__name:"PointRenderer",props:{point:Object,inspectionId:Number},emits:["value-changed","save","validation"],setup(l,{emit:z}){const E=b(()=>f(()=>import("./TextInput-DlKU5iyX.js"),__vite__mapDeps([0,1]))),L=b(()=>f(()=>import("./NumberInput-CBSPv0ps.js"),__vite__mapDeps([2,1]))),R=b(()=>f(()=>import("./SelectInput-64wRePp4.js"),__vite__mapDeps([3,1]))),A=b(()=>f(()=>import("./RadioGroup-CrqTHmp7.js"),__vite__mapDeps([4,1]))),N=b(()=>f(()=>import("./CheckboxGroup-BtEeYY9R.js"),__vite__mapDeps([5,1]))),F=b(()=>f(()=>import("./TextareaInput-DSP311J1.js"),__vite__mapDeps([6,1]))),O=b(()=>f(()=>import("./DatePicker-D6e4n4aN.js"),__vite__mapDeps([7,1]))),r=l,g=z,v=p(r.point.currentValue||""),k=p(""),V=p(!1),x=p(!1),w=p(!1),a=p([]),c=p([]),y=p([]),_=p([]),m=Y(()=>v.value!==r.point.currentValue||c.value.length>0||k.value&&r.point.existingDataId),S=()=>({text:E,number:L,select:R,radio:A,checkbox:N,textarea:F,date:O})[r.point.inputType]||E,U=o=>{v.value=o,g("value-changed",{pointId:r.point.id,value:o}),P()},$=()=>{m.value&&B()},G=()=>{a.value.length>0&&(a.value=[],g("validation",{pointId:r.point.id,errors:[]}))},H=()=>{},q=o=>{const t=Array.from(o.target.files);c.value=[...c.value,...t],t.forEach(n=>{const d=new FileReader;d.onload=C=>{y.value.push(C.target.result)},d.readAsDataURL(n)})},J=o=>{c.value.splice(o,1),y.value.splice(o,1)},K=()=>{v.value=r.point.currentValue||"",c.value=[],y.value=[],a.value=[],g("validation",{pointId:r.point.id,errors:[]})},P=async()=>{if(r.point.validationRules){w.value=!0;try{const o=await j.post(`/api/form-inspection/validate/${r.point.id}`,{value:v.value,is_partial:!0,inspection_id:r.inspectionId});a.value=o.data.errors||[],g("validation",{pointId:r.point.id,errors:a.value}),o.data.triggers&&o.data.triggers.length>0&&X(o.data.triggers)}catch(o){console.error("Validation error:",o)}finally{w.value=!1}}},B=async()=>{var o,t;if(m.value){x.value=!0;try{const n=new FormData;n.append("point_id",r.point.id),n.append("value",v.value),k.value&&n.append("notes",k.value),c.value.forEach(C=>{n.append("images[]",C)});const d=await j.post(`/api/form-inspection/${r.inspectionId}/save`,n,{headers:{"Content-Type":"multipart/form-data"}});d.data.success&&(c.value=[],y.value=[],a.value=[],g("save",r.point.id),g("validation",{pointId:r.point.id,errors:[]}),d.data.images&&(_.value=[..._.value,...d.data.images]))}catch(n){console.error("Save error:",n),(t=(o=n.response)==null?void 0:o.data)!=null&&t.errors&&(a.value=n.response.data.errors,g("validation",{pointId:r.point.id,errors:a.value}))}finally{x.value=!1}}},Q=()=>a.value.length>0?"bg-red-100 text-red-800":m.value?"bg-yellow-100 text-yellow-800":r.point.existingDataId?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",W=()=>a.value.length>0?"Error":m.value?"Belum Disimpan":r.point.existingDataId?"Tersimpan":"Belum Diisi",X=o=>{console.log("Triggers received:",o)};return Z(()=>r.point.currentValue,o=>{v.value!==o&&!m.value&&(v.value=o||"")}),(o,t)=>(s(),i("div",ne,[e("div",ie,[e("div",null,[e("h4",re,[I(h(l.point.inspectionPoint.name)+" ",1),l.point.isRequired?(s(),i("span",le,"*")):u("",!0)]),l.point.inspectionPoint.description?(s(),i("p",ae,h(l.point.inspectionPoint.description),1)):u("",!0)]),e("div",ue,[e("span",{class:M(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",Q()])},h(W()),3),l.point.inspectionPoint.notes?(s(),i("button",{key:0,onClick:t[0]||(t[0]=n=>V.value=!V.value),class:"text-gray-400 hover:text-gray-600",title:"Lihat catatan"},t[3]||(t[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):u("",!0)])]),V.value&&l.point.inspectionPoint.notes?(s(),i("div",de,[e("div",ce,[t[4]||(t[4]=e("svg",{class:"w-5 h-5 text-blue-500 mr-2 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[e("p",pe,h(l.point.inspectionPoint.notes),1)])])])):u("",!0),e("div",ve,[(s(),ee(te(S()),{point:l.point,value:v.value,onInput:U,onBlur:$,onFocus:G},null,40,["point","value"]))]),a.value.length?(s(),i("div",me,[(s(!0),i(D,null,T(a.value,(n,d)=>(s(),i("div",{key:d,class:"flex items-start text-sm text-red-600 mt-1"},[t[5]||(t[5]=e("svg",{class:"w-4 h-4 mr-1 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,h(n),1)]))),128))])):u("",!0),l.point.showTextarea||l.point.showImageUpload?(s(),i("div",ge,[e("div",fe,[l.point.showTextarea?(s(),i("div",he,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Catatan Tambahan ",-1)),oe(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>k.value=n),onInput:H,rows:l.point.uiConfig.rows||3,placeholder:l.point.uiConfig.notePlaceholder,class:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"},null,40,be),[[se,k.value]])])):u("",!0),l.point.showImageUpload?(s(),i("div",xe,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Upload Gambar ",-1)),e("div",ye,[e("input",{type:"file",ref:"fileInput",onChange:q,accept:"image/*",multiple:"",class:"hidden"},null,544),e("button",{onClick:t[2]||(t[2]=n=>o.$refs.fileInput.click()),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},t[7]||(t[7]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),I(" Pilih Gambar ")])),c.value.length?(s(),i("div",ke,h(c.value.length)+" file dipilih ",1)):u("",!0)]),y.value.length?(s(),i("div",we,[(s(!0),i(D,null,T(y.value,(n,d)=>(s(),i("div",{key:d,class:"relative"},[e("img",{src:n,class:"h-20 w-full object-cover rounded-lg"},null,8,_e),e("button",{onClick:C=>J(d),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,Ce)]))),128))])):u("",!0),_.value.length?(s(),i("div",Ie,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600 mb-2"},"Gambar yang sudah diupload:",-1)),e("div",Ve,[(s(!0),i(D,null,T(_.value,n=>(s(),i("div",{key:n.id,class:"relative"},[e("img",{src:n.url,class:"h-20 w-full object-cover rounded-lg"},null,8,De),e("a",{href:n.url,target:"_blank",class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-all rounded-lg"},t[8]||(t[8]=[e("svg",{class:"w-6 h-6 text-white opacity-0 hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,Te)]))),128))])])):u("",!0)])):u("",!0)])])):u("",!0),e("div",Ee,[m.value?(s(),i("button",{key:0,onClick:K,type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Reset ")):u("",!0),e("button",{onClick:P,disabled:w.value,type:"button",class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(s(),i("svg",Be,t[11]||(t[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),i("svg",Me,t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),t[13]||(t[13]=I(" Validasi "))],8,Pe),e("button",{onClick:B,disabled:!m.value||x.value,type:"button",class:M(["inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",m.value&&!x.value?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"])},[x.value?(s(),i("svg",ze,t[14]||(t[14]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),i("svg",Le,t[15]||(t[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),I(" "+h(x.value?"Menyimpan...":"Simpan"),1)],10,je)])]))}};export{Ne as default};
