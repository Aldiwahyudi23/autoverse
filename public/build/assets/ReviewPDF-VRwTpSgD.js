import{r as h,q as D,O as Ft,G as nt,c as n,o as r,b as m,d as t,t as d,y as pt,z as R,f as A,A as st,J as X,F as E,a as lt,j as Pt,m as q,n as Z,p as Rt,g as At,k as gt,L as Nt}from"./vendor-CUNG9NG6.js";import{_ as zt}from"./app-cu8ZgYRt.js";const Lt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Ut={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},Vt={class:"flex items-center justify-between p-4 border-b"},Ot={class:"text-lg font-bold"},qt={class:"p-4"},Ht={class:"space-y-4"},Kt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Gt={class:"space-y-2"},Jt={class:"flex items-center"},Yt={class:"flex items-center"},Wt={class:"space-y-2"},Qt={class:"flex items-center"},Xt={class:"flex items-center"},Zt={class:"flex items-center"},te={class:"relative"},ee={class:"flex justify-end space-x-3 mt-6 pt-4 border-t"},se=["disabled"],oe=["disabled"],ae={key:0},re={key:1},ne={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},le={class:"bg-white rounded-lg shadow-xl w-96 mx-4"},ie={class:"p-6"},de={class:"text-gray-700 mb-6"},ue={class:"flex justify-end space-x-3"},ce=["disabled"],ge={key:0},pe={key:1},mt={__name:"RepairEstimationModal",props:{showModal:Boolean,estimationData:Object,inspectionId:[String,Number],encryptedIds:String},emits:["close","saved","deleted"],setup(k,{emit:C}){const v=k,_=C,f=h(!1),w=h(!1),$=D(()=>{var u;return!!((u=v.estimationData)!=null&&u.id)}),l=Ft({part_name:"",repair_description:"",urgency:"segera",status:"perlu",estimated_cost:0,notes:""}),N=D({get:()=>l.estimated_cost?new Intl.NumberFormat("id-ID").format(l.estimated_cost):"",set:u=>{const o=u.replace(/[^\d]/g,"");l.estimated_cost=o?parseInt(o,10):0}}),F=()=>{l.part_name="",l.repair_description="",l.urgency="segera",l.status="perlu",l.estimated_cost=0,l.notes=""},z=u=>{const g=u.target.value.replace(/[^\d]/g,"");g?(l.estimated_cost=parseInt(g,10),u.target.value=new Intl.NumberFormat("id-ID").format(l.estimated_cost)):(l.estimated_cost=0,u.target.value="")},U=u=>{l.estimated_cost>0&&(u.target.value=new Intl.NumberFormat("id-ID").format(l.estimated_cost))};nt(()=>v.estimationData,u=>{u&&Object.assign(l,u)},{immediate:!0});const j=async()=>{let u=null;$.value?_("saved",{...l,id:v.estimationData.id}):(u="temp-"+Date.now(),_("saved",{...l,id:u}));try{f.value=!0;const o=$.value?route("repair-estimations.update",{inspection:v.inspectionId,repair_estimation:v.estimationData.id}):route("repair-estimations.store",v.inspectionId),g=$.value?"put":"post",i=await lt[g](o,l);_("saved",i.data),S()}catch(o){u&&_("error",u),console.error("Error saving estimation:",o),alert("Gagal menyimpan estimasi. Silakan coba lagi.")}finally{f.value=!1}},M=()=>{w.value=!0},H=async()=>{try{f.value=!0,await lt.delete(route("repair-estimations.destroy",{inspection:v.inspectionId,repair_estimation:v.estimationData.id})),_("deleted",v.estimationData.id),w.value=!1,S()}catch(u){console.error("Error deleting estimation:",u),alert("Gagal menghapus estimasi. Silakan coba lagi.")}finally{f.value=!1}},S=()=>{F(),_("close")};return nt(()=>v.showModal,u=>{u&&v.estimationData?Object.assign(l,v.estimationData):u&&!v.estimationData&&F()}),(u,o)=>(r(),n(E,null,[k.showModal?(r(),n("div",Lt,[t("div",Ut,[t("div",Vt,[t("h3",Ot,d($.value?"Edit Estimasi Perbaikan":"Tambah Estimasi Perbaikan"),1),t("button",{onClick:S,class:"text-gray-400 hover:text-gray-600"},o[10]||(o[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",qt,[t("form",{onSubmit:pt(j,["prevent"])},[t("div",Ht,[t("div",null,[o[11]||(o[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[A(" Nama Part/Komponen "),t("span",{class:"text-red-500"},"*")],-1)),R(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=g=>l.part_name=g),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contoh: Radiator, Rem Depan, dll"},null,512),[[st,l.part_name]])]),t("div",null,[o[12]||(o[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[A(" Deskripsi Perbaikan "),t("span",{class:"text-red-500"},"*")],-1)),R(t("textarea",{"onUpdate:modelValue":o[1]||(o[1]=g=>l.repair_description=g),required:"",rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Jelaskan jenis perbaikan yang diperlukan"},null,512),[[st,l.repair_description]])]),t("div",Kt,[t("div",null,[o[15]||(o[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[A(" Urgensi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Gt,[t("label",Jt,[R(t("input",{type:"radio","onUpdate:modelValue":o[2]||(o[2]=g=>l.urgency=g),value:"segera",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[X,l.urgency]]),o[13]||(o[13]=t("span",{class:"ml-2 text-sm text-gray-700"},"Segera",-1))]),t("label",Yt,[R(t("input",{type:"radio","onUpdate:modelValue":o[3]||(o[3]=g=>l.urgency=g),value:"jangka_panjang",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[X,l.urgency]]),o[14]||(o[14]=t("span",{class:"ml-2 text-sm text-gray-700"},"Jangka Panjang",-1))])])]),t("div",null,[o[19]||(o[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[A(" Status "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Wt,[t("label",Qt,[R(t("input",{type:"radio","onUpdate:modelValue":o[4]||(o[4]=g=>l.status=g),value:"perlu",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[X,l.status]]),o[16]||(o[16]=t("span",{class:"ml-2 text-sm text-gray-700"},"Perlu",-1))]),t("label",Xt,[R(t("input",{type:"radio","onUpdate:modelValue":o[5]||(o[5]=g=>l.status=g),value:"disarankan",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[X,l.status]]),o[17]||(o[17]=t("span",{class:"ml-2 text-sm text-gray-700"},"Disarankan",-1))]),t("label",Zt,[R(t("input",{type:"radio","onUpdate:modelValue":o[6]||(o[6]=g=>l.status=g),value:"opsional",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[X,l.status]]),o[18]||(o[18]=t("span",{class:"ml-2 text-sm text-gray-700"},"Opsional",-1))])])])]),t("div",null,[o[21]||(o[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[A(" Estimasi Biaya (Rp) "),t("span",{class:"text-red-500"},"*")],-1)),t("div",te,[o[20]||(o[20]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"Rp")],-1)),R(t("input",{type:"text","onUpdate:modelValue":o[7]||(o[7]=g=>N.value=g),onInput:z,onBlur:U,required:"",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"},null,544),[[st,N.value]])]),o[22]||(o[22]=t("p",{class:"text-xs text-gray-500 mt-1"}," Masukkan angka tanpa titik atau koma ",-1))]),t("div",null,[o[23]||(o[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Catatan Tambahan ",-1)),R(t("textarea",{"onUpdate:modelValue":o[8]||(o[8]=g=>l.notes=g),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Catatan khusus atau informasi tambahan"},null,512),[[st,l.notes]])])]),t("div",ee,[t("button",{type:"button",onClick:S,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Batal "),$.value?(r(),n("button",{key:0,type:"button",onClick:M,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:f.value}," Hapus ",8,se)):m("",!0),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:f.value},[f.value?(r(),n("span",ae,o[24]||(o[24]=[t("svg",{class:"animate-spin h-5 w-5 inline-block",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),A(" Menyimpan... ")]))):(r(),n("span",re,d($.value?"Update":"Simpan"),1))],8,oe)])],32)])])])):m("",!0),w.value?(r(),n("div",ne,[t("div",le,[t("div",ie,[o[27]||(o[27]=t("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Hapus",-1)),t("p",de,[o[25]||(o[25]=A(' Apakah Anda yakin ingin menghapus estimasi perbaikan untuk "')),t("strong",null,d(l.part_name),1),o[26]||(o[26]=A('"? '))]),t("div",ue,[t("button",{onClick:o[9]||(o[9]=g=>w.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{onClick:H,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",disabled:f.value},[f.value?(r(),n("span",ge,"Menghapus...")):(r(),n("span",pe,"Ya, Hapus"))],8,ce)])])])])):m("",!0)],64))}},me={class:"mt-8 pt-6 border-t border-gray-300"},be={class:"flex justify-between items-center mb-4"},ye={key:0,class:"overflow-x-auto"},ve={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},fe={class:"bg-gray-100"},xe={key:0,class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},he={class:"p-3 border border-gray-300"},ke={class:"p-3 border border-gray-300 font-medium"},_e={class:"p-3 border border-gray-300"},we={class:"p-3 border border-gray-300"},Ce={class:"flex flex-col gap-1"},Ie={class:"p-3 border border-gray-300 font-bold text-right"},$e={key:0,class:"p-3 border border-gray-300"},Ee={class:"flex gap-2"},De=["onClick"],je=["onClick"],Me={class:"bg-gray-100"},Se=["colspan"],Te={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded-lg"},Be={__name:"RepairEstimationSection",props:{estimations:{type:Array,default:()=>[]},inspectionId:{type:[String,Number],required:!0},encryptedIds:{type:String,required:!0},canEdit:{type:Boolean,default:!1}},emits:["update:estimations","update:totalCost"],setup(k,{emit:C}){const v=k,_=C,f=h(!1),w=h(null),$=D(()=>v.estimations.reduce((i,a)=>i+parseFloat(a.estimated_cost||0),0));nt($,i=>{_("update:totalCost",i)});const l=i=>i?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(i):"Rp 0",N=i=>i==="segera"?"Segera":"Jangka Panjang",F=i=>({perlu:"Perlu",disarankan:"Disarankan",opsional:"Opsional"})[i]||i,z=i=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{segera:"bg-red-100 text-red-800",jangka_panjang:"bg-yellow-100 text-yellow-800"}[i]||"bg-gray-100 text-gray-800"}`,U=i=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{perlu:"bg-red-100 text-red-800",disarankan:"bg-yellow-100 text-yellow-800",opsional:"bg-blue-100 text-blue-800"}[i]||"bg-gray-100 text-gray-800"}`,j=()=>{w.value=null,f.value=!0},M=i=>{w.value=i,f.value=!0},H=i=>{w.value=i,f.value=!0},S=()=>{f.value=!1,w.value=null},u=i=>{const a=v.estimations.findIndex(b=>b.id===i.id);if(a!==-1){const b=[...v.estimations];b[a]=i,_("update:estimations",b)}else _("update:estimations",[...v.estimations,i]);S()},o=i=>{const a=v.estimations.filter(b=>b.id!==i);_("update:estimations",a),S()},g=i=>{const a=v.estimations.filter(b=>b.id!==i);_("update:estimations",a)};return(i,a)=>(r(),n("div",me,[t("div",be,[a[1]||(a[1]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Estimasi Perbaikan",-1)),k.canEdit?(r(),n("button",{key:0,onClick:j,class:"bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200 flex items-center gap-2"},a[0]||(a[0]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),A(" Tambah Estimasi ")]))):m("",!0)]),k.estimations.length>0?(r(),n("div",ye,[t("table",ve,[t("thead",fe,[t("tr",null,[a[2]||(a[2]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"No",-1)),a[3]||(a[3]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Part/Komponen",-1)),a[4]||(a[4]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Deskripsi Perbaikan",-1)),a[5]||(a[5]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Urgensi & Status",-1)),a[6]||(a[6]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Estimasi Biaya",-1)),k.canEdit?(r(),n("th",xe,"Aksi")):m("",!0)])]),t("tbody",null,[(r(!0),n(E,null,q(k.estimations,(b,L)=>(r(),n("tr",{key:b.id,class:Z(L%2===0?"bg-white":"bg-gray-50")},[t("td",he,d(L+1),1),t("td",ke,d(b.part_name),1),t("td",_e,d(b.repair_description),1),t("td",we,[t("div",Ce,[t("span",{class:Z(z(b.urgency))},d(N(b.urgency)),3),t("span",{class:Z(U(b.status))},d(F(b.status)),3)])]),t("td",Ie,d(l(b.estimated_cost)),1),k.canEdit?(r(),n("td",$e,[t("div",Ee,[t("button",{onClick:ot=>M(b),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"}," Edit ",8,De),t("button",{onClick:ot=>H(b),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"}," Hapus ",8,je)])])):m("",!0)],2))),128))]),t("tfoot",Me,[t("tr",null,[a[7]||(a[7]=t("td",{colspan:"4",class:"p-3 border border-gray-300 text-right font-bold"}," Total Estimasi: ",-1)),t("td",{colspan:k.canEdit?2:1,class:"p-3 border border-gray-300 font-bold text-right text-green-700"},d(l($.value)),9,Se)])])])])):(r(),n("div",Te,[a[8]||(a[8]=t("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),a[9]||(a[9]=t("p",{class:"text-gray-500"},"Belum ada estimasi perbaikan.",-1)),k.canEdit?(r(),n("button",{key:0,onClick:j,class:"mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"}," Tambah Estimasi Pertama ")):m("",!0)])),f.value?(r(),Pt(mt,{key:2,"show-modal":f.value,"estimation-data":w.value,"inspection-id":k.inspectionId,"encrypted-ids":k.encryptedIds,onClose:S,onSaved:u,onDeleted:o,onError:g},null,8,["show-modal","estimation-data","inspection-id","encrypted-ids"])):m("",!0)]))}},Fe={class:"p-6 bg-white rounded-lg shadow-md"},Pe={key:0,class:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded"},Re={class:"flex"},Ae={key:1,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},Ne={class:"flex"},ze={key:2},Le={class:"header flex flex-col gap-5 mb-6 mt-6"},Ue={class:"flex items-center gap-5"},Ve=["src"],Oe={key:1,class:"w-40 h-40 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-gray-400"},qe={class:"mt-8"},He={class:"text-3xl font-bold m-0 text-gray-800"},Ke={key:0,class:"car-info"},Ge={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},Je={class:"bg-gray-50"},Ye={class:"p-2 border border-gray-300 text-gray-600"},We={class:"bg-gray-50"},Qe={class:"p-2 border border-gray-300 text-gray-600"},Xe={class:"p-2 border border-gray-300 text-gray-600"},Ze={class:"bg-gray-50"},ts={class:"p-2 border border-gray-300 text-gray-600"},es={class:"p-2 border border-gray-300 text-gray-600"},ss={class:"bg-gray-50"},os={class:"p-2 border border-gray-300 text-gray-600"},as={class:"p-2 border border-gray-300 text-gray-600"},rs={class:"bg-gray-50"},ns={class:"p-2 border border-gray-300 text-gray-600"},ls={class:"p-2 border border-gray-300 text-gray-600"},is={class:"bg-gray-50"},ds={class:"p-2 border border-gray-300 text-gray-600"},us={class:"bg-gray-50"},cs={class:"p-2 border border-gray-300 text-gray-600"},gs={class:"bg-gray-50"},ps={class:"p-2 border border-gray-300 text-gray-600"},ms={class:"bg-gray-50"},bs={class:"p-2 border border-gray-300 text-gray-600"},ys={class:"bg-gray-50"},vs={class:"p-2 border border-gray-300 text-gray-600"},fs={key:1,style:{width:"100%",margin:"15px 0","border-collapse":"collapse"}},xs={style:{width:"50%",padding:"6px","vertical-align":"top"}},hs={style:{"text-align":"center"}},ks={key:0,src:"/images/icons/banjir.png",alt:"Banjir",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},_s={key:1,src:"/images/icons/aman.png",alt:"Aman",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},ws={key:2,style:{"font-weight":"bold","font-size":"15px",color:"#dc3545","margin-top":"8px","margin-bottom":"0"}},Cs={key:3,style:{"font-weight":"bold","font-size":"15px",color:"#28a745","margin-top":"8px","margin-bottom":"0"}},Is={style:{width:"50%",padding:"6px","vertical-align":"top"}},$s={style:{"text-align":"center"}},Es=["src"],Ds={key:2,class:"conclusion p-4 bg-gray-50 border-l-4 border-gray-800 rounded-lg"},js={class:"m-0 text-gray-600"},Ms=["innerHTML"],Ss={class:"component-title bg-gray-100 px-3 py-2 border-l-4 border-gray-800 font-bold rounded-l-lg"},Ts={key:0,class:"images flex flex-wrap gap-2 mt-4"},Bs=["src","onClick"],Fs={key:1,class:"w-28 h-28 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Ps={class:"point-name inline-block min-w-[160px] font-bold align-top text-gray-700"},Rs={class:"point-content inline-block w-[calc(100%-70px)] align-top"},As={key:0,class:"status-badges-container"},Ns=["onClick"],zs={key:1,class:"point-note italic text-gray-600 my-1"},Ls={key:0,class:"inspection-images flex flex-wrap gap-2 mt-4"},Us=["src","onClick"],Vs={key:1,class:"w-20 h-20 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Os={key:1,class:"textarea-note italic text-gray-600 my-2"},qs={key:0,class:"mt-2 mb-6"},Hs={key:3,class:"flex flex-col items-center justify-center h-96 text-center"},Ks=["href"],Gs={key:4,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Js={class:"bg-white p-6 rounded-lg shadow-xl w-96 max-w-sm"},Ys={class:"flex justify-end space-x-4"},Ws=["disabled"],Qs={key:0},Xs={key:1},Zs={key:1,class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 cursor-not-allowed"},to={class:"relative w-full h-full flex items-center justify-center p-4"},eo=["src"],so={key:1,class:"text-white text-lg"},oo={key:6,class:"fixed bottom-6 right-6 flex flex-col gap-2 z-40"},ao={__name:"ReviewPDF",props:{inspection:{type:Object,required:!0},menu_points:{type:Array,default:()=>[]},coverImage:{type:Object,default:null},encryptedIds:Object,repairEstimations:{type:Array,default:()=>[]},totalRepairCost:{type:Number,default:0}},setup(k){const C=k,v=Rt(),_=h(!1),f=h(!1),w=h(C.repairEstimations),$=h(C.totalRepairCost),l=h(!1),N=h(null),F=h(!1),z=h(""),U=h(0),j=h(null),M=D(()=>{var s;return((s=v.props.global)==null?void 0:s.has_roles)||[]});D(()=>M.value.includes("quality_control")||M.value.includes("qc"));const H=D(()=>(M.value.includes("quality_control")||M.value.includes("qc"))&&a.value.status==="pending_review"),S=D(()=>(M.value.includes("quality_control")||M.value.includes("qc"))&&a.value.status==="pending_review"),u=h(!1),o=h(""),g=s=>{o.value=s,u.value=!0},i=()=>{u.value=!1,o.value=""},a=h(C.inspection),b=h(C.menu_points),L=h(C.coverImage),ot=async()=>{if(a.value.status==="in_progress")try{const s=await lt.get(route("inspections.detail",C.encryptedIds));a.value=s.data.inspection,b.value=s.data.menu_points,L.value=s.data.coverImage,w.value=s.data.repairEstimations||[],$.value=s.data.totalRepairCost||0}catch(s){console.error("Polling gagal:",s)}};At(()=>{setInterval(ot,5e3);const s=()=>{const e=window.scrollY;e>U.value?z.value="down":e<U.value&&(z.value="up"),U.value=e,e>200?(F.value=!0,j.value&&clearTimeout(j.value),j.value=setTimeout(()=>{F.value=!1},2e3)):F.value=!1};return window.addEventListener("scroll",s),()=>{window.removeEventListener("scroll",s),j.value&&clearTimeout(j.value)}});const bt=s=>{w.value=s},yt=s=>{$.value=s},vt=s=>{var e;N.value={part_name:((e=s.inspection_point)==null?void 0:e.name)||"",repair_description:"",urgency:"segera",status:"perlu",estimated_cost:0,notes:""},l.value=!0},it=()=>{l.value=!1,N.value=null},ft=s=>{w.value.push(s),it()},xt=()=>{window.scrollTo({top:0,behavior:"smooth"})},ht=()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},kt=D(()=>{if(!b.value)return[];const s=new Map;b.value.forEach(c=>{var I;const p=(I=c.inspection_point)==null?void 0:I.component,y=(p==null?void 0:p.id)||0;s.has(y)||s.set(y,{component:p||{id:0,name:"Tanpa Komponen",order:9999},points:[]}),s.get(y).points.push(c)});const e=Array.from(s.values()).sort((c,p)=>c.component.order===p.component.order?new Date(c.component.created_at)-new Date(p.component.created_at):(c.component.order||9999)-(p.component.order||9999));return e.forEach(c=>{c.points.sort((p,y)=>p.order===y.order?new Date(p.created_at)-new Date(y.created_at):(p.order||9999)-(y.order||9999))}),e}),_t=()=>{f.value=!0,setTimeout(()=>{window.location.href=route("inspections.download.pdf",C.encryptedIds),f.value=!1,_.value=!1},2e3)},wt=D(()=>{const s=C.menu_points.some(c=>J(c)||Y(c)),e=C.coverImage&&C.coverImage.image_path;return s||e}),at=s=>s&&s.length>0,K=s=>`/${s}`,J=s=>{var e;return((e=s.inspection_point)==null?void 0:e.results)&&s.inspection_point.results.length>0},Y=s=>{var e;return((e=s.inspection_point)==null?void 0:e.images)&&s.inspection_point.images.length>0},dt=s=>J(s)&&s.inspection_point.results[0].note,W=s=>{var c,p;if(!J(s))return[];const e=(p=(c=s.inspection_point)==null?void 0:c.results[0])==null?void 0:p.status;return e?Array.isArray(e)?e:typeof e=="string"&&e.includes(",")?e.split(",").map(y=>y.trim()).filter(y=>y.length>0):[e]:[]},Ct=s=>{const e=s.input_type||"",c=W(s);return["radio","imageTOradio"].includes(e)&&c.length>0},It=s=>{const e=s.input_type||"";return["text","number","date","textarea"].includes(e)&&dt(s)},$t=s=>{var p,y,I;const e=s.input_type||"",c=s.settings||{};if((p=s.inspection_point)!=null&&p.results[0],e==="image"&&Y(s)||e==="imageTOradio"&&Y(s))return!0;if(e==="radio"){const P=W(s);for(const V of P)if((((I=(((y=c.radios)==null?void 0:y.find(et=>et.value===V))||{}).settings)==null?void 0:I.show_image_upload)||!1)&&Y(s))return!0}return!1},Et=s=>{var p,y,I;const e=s.settings||{};(p=s.inspection_point)!=null&&p.results[0];const c=W(s);for(const P of c)if((I=(((y=e.radios)==null?void 0:y.find(G=>G.value===P))||{}).settings)!=null&&I.show_textarea)return!0;return!1},Dt=s=>{if(!s)return"status-warning";const e=String(s).toLowerCase().trim();return["normal","ada","baik","good","ok"].includes(e)?"status-good":["tidak normal","tidak ada","rusak","bad","not ok","rusak","repaired"].includes(e)?"status-bad":"status-warning"},jt=s=>W(s).some(c=>{const p=String(c).toLowerCase().trim();return!["normal","ada","baik","good","ok"].includes(p)}),Mt=s=>{var y;const e=s.input_type||"",c=((y=s.inspection_point)==null?void 0:y.results[0])||{},p=s.settings||{};if(e==="account"&&c.note){const I=c.note.replace(/[^\d.-]/g,""),P=parseFloat(I);if(isNaN(P))return c.note;const V=p.currency_symbol||"Rp";return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:2}).format(P).replace("Rp",V)}return c.note},St=D(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"/images/icons/aman.png";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"/images/icons/beruntun.png":s==="heavy"?"/images/icons/berat.png":"/images/icons/ringan.png"}),Tt=D(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"Bebas Tabrak";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"Tabrak Beruntun":s==="heavy"?"Tabrak Berat":"Tabrak Ringan"}),Bt=D(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"#28a745";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"#fd7e14":s==="heavy"?"#dc3545":"#ffc107"});return(s,e)=>{var c,p,y,I,P,V,G,tt,et,ut,ct;return r(),n("div",Fe,[s.$page.props.flash.success?(r(),n("div",Pe,[t("div",Re,[e[4]||(e[4]=t("svg",{class:"w-5 h-5 text-green-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),t("span",null,d(s.$page.props.flash.success),1)])])):m("",!0),s.$page.props.flash.error?(r(),n("div",Ae,[t("div",Ne,[e[5]||(e[5]=t("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("span",null,d(s.$page.props.flash.error),1)])])):m("",!0),wt.value?(r(),n("div",ze,[t("div",Le,[t("div",Ue,[L.value&&at(L.value.image_path)?(r(),n("img",{key:0,src:K(L.value.image_path),alt:"Foto Utama",class:"w-40 h-40 object-cover rounded-lg border border-gray-300 cursor-pointer hover:opacity-90 transition-opacity",onClick:e[0]||(e[0]=T=>g(K(L.value.image_path)))},null,8,Ve)):(r(),n("div",Oe,e[6]||(e[6]=[t("span",null,"Gambar tidak tersedia",-1)]))),t("div",qe,[t("h2",He,d(a.value.car_name),1)])]),a.value.car_id?(r(),n("div",Ke,[t("table",Ge,[t("tr",Je,[e[7]||(e[7]=t("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"ID Order",-1)),t("td",Ye,d(a.value.order_code),1)]),t("tr",We,[e[8]||(e[8]=t("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"Nomor Polisi",-1)),t("td",Qe,d(a.value.plate_number),1)]),t("tr",null,[e[9]||(e[9]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Merek",-1)),t("td",Xe,d((p=(c=a.value.car)==null?void 0:c.brand)==null?void 0:p.name),1)]),t("tr",Ze,[e[10]||(e[10]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Model",-1)),t("td",ts,d((I=(y=a.value.car)==null?void 0:y.model)==null?void 0:I.name),1)]),t("tr",null,[e[11]||(e[11]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tipe",-1)),t("td",es,d((V=(P=a.value.car)==null?void 0:P.type)==null?void 0:V.name),1)]),t("tr",ss,[e[12]||(e[12]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"CC",-1)),t("td",os,d((G=a.value.car)==null?void 0:G.cc),1)]),t("tr",null,[e[13]||(e[13]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Bahan Bakar",-1)),t("td",as,d((tt=a.value.car)==null?void 0:tt.fuel_type),1)]),t("tr",rs,[e[14]||(e[14]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Transmisi",-1)),t("td",ns,d((et=a.value.car)==null?void 0:et.transmission),1)]),t("tr",null,[e[15]||(e[15]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Periode Model",-1)),t("td",ls,d(((ut=a.value.car)==null?void 0:ut.production_period)||"-"),1)]),t("tr",is,[e[16]||(e[16]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tahun Pembuatan",-1)),t("td",ds,d((ct=a.value.car)==null?void 0:ct.year),1)]),t("tr",us,[e[17]||(e[17]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Warna",-1)),t("td",cs,d(a.value.color),1)]),t("tr",gs,[e[18]||(e[18]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Rangka",-1)),t("td",ps,d(a.value.noka),1)]),t("tr",ms,[e[19]||(e[19]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Mesin",-1)),t("td",bs,d(a.value.nosin),1)]),t("tr",ys,[e[20]||(e[20]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"KM",-1)),t("td",vs,d(a.value.km),1)])])])):m("",!0),a.value.settings?(r(),n("table",fs,[t("tr",null,[t("td",xs,[t("div",hs,[a.value.settings.conclusion.flooded==="yes"?(r(),n("img",ks)):(r(),n("img",_s)),a.value.settings.conclusion.flooded==="yes"?(r(),n("p",ws," Bekas Banjir ")):(r(),n("p",Cs," Bebas Banjir "))])]),t("td",Is,[t("div",$s,[a.value.settings.conclusion.collision==="yes"?(r(),n(E,{key:0},[t("img",{src:St.value,alt:"Tabrak",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},null,8,Es),t("p",{style:Nt({fontWeight:"bold",fontSize:"15px",color:Bt.value,marginTop:"8px",marginBottom:"0"})},d(Tt.value),5)],64)):(r(),n(E,{key:1},[e[21]||(e[21]=t("img",{src:"/images/icons/aman.png",alt:"Aman",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},null,-1)),e[22]||(e[22]=t("p",{style:{"font-weight":"bold","font-size":"15px",color:"#28a745","margin-top":"8px","margin-bottom":"0"}}," Bebas Tabrak ",-1))],64))])])])])):m("",!0),a.value.notes?(r(),n("div",Ds,[e[23]||(e[23]=t("h3",{class:"text-lg font-bold mb-2 text-gray-800"},"Kesimpulan Inspeksi:",-1)),t("p",js,[t("div",{innerHTML:a.value.notes||"-"},null,8,Ms)])])):m("",!0)]),e[28]||(e[28]=t("h2",{class:"text-2xl font-bold border-b-2 border-gray-800 pb-2 mb-6"},"Hasil Inspeksi",-1)),(r(!0),n(E,null,q(kt.value,T=>(r(),n("div",{key:T.component.id,class:Z(["section mb-6",T.component.name==="Foto Kendaraan"?"photo-component":""])},[t("div",Ss,d(T.component.name||"Tanpa Komponen"),1),T.component.name==="Foto Kendaraan"?(r(),n("div",Ts,[(r(!0),n(E,null,q(T.points,x=>{var Q;return r(),n("div",{key:x.id},[(r(!0),n(E,null,q((Q=x.inspection_point)==null?void 0:Q.images,(O,rt)=>(r(),n("div",{key:O.id,class:"image-container"},[at(O.image_path)?(r(),n("img",{key:0,src:K(O.image_path),alt:"Foto Kendaraan",class:"w-28 h-28 object-cover border border-gray-300 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:B=>g(K(O.image_path))},null,8,Bs)):(r(),n("div",Fs,e[24]||(e[24]=[t("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])}),128))])):(r(!0),n(E,{key:1},q(T.points,x=>{var Q,O,rt;return r(),n("div",{key:x.id,class:"point ml-4 py-3 border-b border-gray-100"},[J(x)||Y(x)?(r(),n(E,{key:0},[t("span",Ps,d(((Q=x.inspection_point)==null?void 0:Q.name)||"-"),1),t("div",Rs,[J(x)?(r(),n(E,{key:0},[Ct(x)?(r(),n("div",As,[(r(!0),n(E,null,q(W(x),B=>(r(),n("span",{key:B,class:Z(["status-badge",Dt(B)])},d(B.trim()),3))),128)),H.value&&jt(x)&&T.component.name!=="Dokumen"?(r(),n("button",{key:0,onClick:B=>vt(x),class:"ml-2 bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 transition-colors inline-flex items-center",title:"Tambah Estimasi Perbaikan"},e[25]||(e[25]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]),8,Ns)):m("",!0)])):m("",!0),It(x)?(r(),n("div",zs,d(Mt(x)),1)):m("",!0)],64)):m("",!0)]),$t(x)?(r(),n("div",Ls,[(r(!0),n(E,null,q((O=x.inspection_point)==null?void 0:O.images,(B,ro)=>(r(),n("div",{key:B.id,class:"image-container"},[at(B.image_path)?(r(),n("img",{key:0,src:K(B.image_path),alt:"image",class:"w-20 h-20 object-cover border border-gray-300 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:no=>g(K(B.image_path))},null,8,Us)):(r(),n("div",Vs,e[26]||(e[26]=[t("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])):m("",!0),Et(x)&&dt(x)?(r(),n("div",Os,d((rt=x.inspection_point)==null?void 0:rt.results[0].note),1)):m("",!0)],64)):m("",!0)])}),128))],2))),128)),gt(Be,{estimations:w.value,"inspection-id":a.value.id,"encrypted-ids":k.encryptedIds,"can-edit":H.value,"onUpdate:estimations":bt,"onUpdate:totalCost":yt},null,8,["estimations","inspection-id","encrypted-ids","can-edit"]),S.value?(r(),n("div",qs,[t("button",{onClick:e[1]||(e[1]=T=>_.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"}," Setujui Laporan "),e[27]||(e[27]=t("p",{class:"text-sm text-gray-500 mt-2 italic"}," Catatan: Halaman ini hanya simulasi dan mungkin berbeda dengan tampilan file PDF. Silakan periksa lebih detail untuk memastikan tidak ada kesalahan. Jika sudah yakin, silakan setujui untuk proses selanjutnya. ",-1))])):m("",!0)])):(r(),n("div",Hs,[e[29]||(e[29]=t("p",{class:"text-lg font-semibold text-gray-700"}," Data sudah tidak ada, karena sudah dijadikan PDF. ",-1)),t("a",{href:s.route("inspections.download.approved.pdf",k.encryptedIds),class:"mt-4 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Download PDF ",8,Ks)])),_.value?(r(),n("div",Gs,[t("div",Js,[e[31]||(e[31]=t("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Laporan",-1)),e[32]||(e[32]=t("p",{class:"text-gray-700 mb-6"}," Apakah Anda yakin semua data sudah sesuai? Setelah disetujui, laporan akan diproses menjadi file PDF. ",-1)),t("div",Ys,[t("button",{onClick:e[2]||(e[2]=T=>_.value=!1),class:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400"}," Batal "),a.value.file?(r(),n("button",Zs,e[30]||(e[30]=[t("span",null,"Laporan sudah di buat",-1)]))):(r(),n("button",{key:0,onClick:_t,class:"bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 transition-colors duration-200",disabled:f.value},[f.value?(r(),n("span",Qs,"Membuat file PDF...")):(r(),n("span",Xs,"Setujui Laporan"))],8,Ws))])])])):m("",!0),u.value?(r(),n("div",{key:5,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:i},[t("div",to,[t("button",{onClick:i,class:"absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-70 transition-all"},e[33]||(e[33]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),o.value?(r(),n("img",{key:0,src:o.value,alt:"Full size image",class:"max-w-[90vw] max-h-[90vh] w-auto h-auto object-contain",onClick:e[3]||(e[3]=pt(()=>{},["stop"]))},null,8,eo)):(r(),n("div",so," Gambar tidak dapat dimuat "))])])):m("",!0),gt(mt,{showModal:l.value,estimationData:N.value,inspectionId:a.value.id,encryptedIds:k.encryptedIds,onClose:it,onSaved:ft},null,8,["showModal","estimationData","inspectionId","encryptedIds"]),F.value?(r(),n("div",oo,[z.value==="up"?(r(),n("button",{key:0,onClick:xt,class:"bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110",title:"Scroll ke atas"},e[34]||(e[34]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})],-1)]))):m("",!0),z.value==="down"?(r(),n("button",{key:1,onClick:ht,class:"bg-green-600 hover:bg-green-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110",title:"Scroll ke bawah"},e[35]||(e[35]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V4"})],-1)]))):m("",!0)])):m("",!0)])}}},uo=zt(ao,[["__scopeId","data-v-26068696"]]);export{uo as default};
