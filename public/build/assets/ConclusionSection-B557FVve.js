import{x as Tt,r as N,g as Me,q as se,E as Re,G as de,c as i,o as n,d as t,b as p,k as ke,z as Ne,A as Pe,n as oe,t as L,u as Ve,e as Nt,F as _e,m as $e,f as Ie,y as De,w as Ce,N as Ee,D as Fe,L as qe,a as je,j as Ae,l as wt,T as Le,M as Ut,p as Et,O as kt,J as Be,B as Mt}from"./vendor-g77w9U1W.js";import{l as It}from"./lodash-CGXsUT3p.js";import{_ as Pt}from"./PrimaryButton-CrKKsBb9.js";import{_ as Dt}from"./ActionMessage-C9w22vKV.js";import{_ as Te}from"./app-BGZBwQRK.js";const Lt={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Rt={key:0,class:"p-4 space-y-2"},jt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Bt={class:"flex items-center space-x-2"},Ft={key:0,class:"text-xs text-red-500 font-normal ml-2"},qt={key:1,class:"text-xs text-red-500 font-normal ml-2"},Ot={key:2,class:"text-xs text-green-500 font-normal ml-2"},Kt={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Ht={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},zt={class:"col-span-2 flex space-x-3"},Gt={class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},Wt={class:"flex items-start"},Zt={class:"text-sm text-blue-700"},Jt={class:"mt-1"},Qt={key:0,class:"inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-medium mr-2"},Yt={key:1,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium mr-2"},Xt={key:2,class:"inline-flex items-center px-2 py-1 rounded bg-green-100 text-green-800 text-xs font-medium"},ea={key:3,class:"text-blue-600"},ta={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},aa={class:"relative"},sa={key:0,class:"absolute right-3 top-3"},na={key:1,class:"text-xs text-red-500 font-normal ml-2"},oa={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ia={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},la={key:0},ra=["onMousedown"],ua={class:"font-medium text-gray-900"},da={class:"text-sm text-gray-500"},ca={key:1,class:"p-4 text-sm text-gray-500 text-center"},pa={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ga={key:0,class:"mb-4"},ma=["innerHTML"],va={key:1},fa={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ha=["onClick"],ba=["src","alt"],ya={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},xa={class:"text-white text-xs text-center"},wa={key:2,class:"text-center py-4 text-gray-500 text-sm"},ka={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ia=["src","alt"],_a={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},$a={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Sa={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Aa={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges","update:vehicle-type"],setup(a,{emit:Q}){var v,j,ee,te,ae,J;const e=a,_=Q,r=Tt({plate_number:((v=e.inspection)==null?void 0:v.plate_number)||"",car_id:((j=e.inspection)==null?void 0:j.car_id)||null,car_name:((ee=e.inspection)==null?void 0:ee.car_name)||""}),I=N(((te=e.inspection)==null?void 0:te.plate_number)||""),f=N(((ae=e.inspection)==null?void 0:ae.car_id)||null),U=N(((J=e.inspection)==null?void 0:J.car_name)||""),y=N(""),A=N(""),C=N(""),V=N(null),B=N({rear_door:!1}),G=N(!1),c=N(""),l=N(""),$=N(r.car_name),R=N(!1),S=N(!1),F=N([]),Z=N(null),D=N([]),d=N(!1),H=N(0);Me(()=>{var k,h,ne,K,re;if(M((k=e.inspection)==null?void 0:k.plate_number),(h=e.inspection)!=null&&h.car_id&&((ne=e.CarDetail)==null?void 0:ne.length)>0){const ue=e.CarDetail.find(ve=>ve.id===e.inspection.car_id);ue&&le(ue)}else!((K=e.inspection)!=null&&K.car_id)&&((re=e.inspection)!=null&&re.car_name)&&($.value=e.inspection.car_name,r.car_id=null);window.addEventListener("keydown",o),W(),_("update:hasUnsavedChanges",T.value),_("update:validation",E.value)}),Re(()=>{window.removeEventListener("keydown",o)});const W=()=>{try{const k=localStorage.getItem("vehicle_features");if(k){const h=JSON.parse(k);B.value.rear_door=h.rear_door||!1,h.pick_up?V.value="pick_up":h.box?V.value="box":V.value=null}else B.value.rear_door=!1,V.value=null;b()}catch(k){console.error("Error loading vehicle type from localStorage:",k),B.value.rear_door=!1,V.value=null,b()}},x=()=>{B.value.rear_door=!B.value.rear_door,s()},g=k=>{V.value===k?V.value=null:V.value=k,s()},s=()=>{try{const k={rear_door:B.value.rear_door,pick_up:V.value==="pick_up",box:V.value==="box"};localStorage.setItem("vehicle_features",JSON.stringify(k)),b(),console.log("Vehicle features saved to localStorage:",k)}catch(k){console.error("Error saving vehicle type to localStorage:",k)}},b=()=>{const k={rear_door:B.value.rear_door,pick_up:V.value==="pick_up",box:V.value==="box"};_("update:vehicle-type",k)},M=k=>{if(!k){y.value="",A.value="",C.value="";return}const h=k.toUpperCase().trim(),ne=h.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(ne)y.value=ne[1]||"",A.value=ne[2]||"",C.value=ne[3]||"";else{let K="area",re="",ue="",ve="";for(const fe of h)K==="area"&&/[A-Z]/.test(fe)?re+=fe:K==="area"&&/[0-9]/.test(fe)?(K="number",ue+=fe):K==="number"&&/[0-9]/.test(fe)?ue+=fe:K==="number"&&/[A-Z]/.test(fe)?(K="suffix",ve+=fe):K==="suffix"&&/[A-Z]/.test(fe)&&(ve+=fe);y.value=re,A.value=ue,C.value=ve}Y()},Y=()=>{const k=`${y.value}${A.value}${C.value}`;r.plate_number=k,u()},ce=k=>{k==="area"?y.value=y.value.toUpperCase().replace(/[^A-Z]/g,""):k==="number"?A.value=A.value.replace(/[^0-9]/g,""):k==="suffix"&&(C.value=C.value.toUpperCase().replace(/[^A-Z]/g,"")),Y()},pe=se(()=>{const k=r.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(k)}),he=se(()=>!$.value||$.value.trim()===""),ge=se(()=>r.plate_number.length>0&&!pe.value?"Format plat nomor tidak valid.":null),E=se(()=>{const k=!r.plate_number||r.plate_number.trim()==="",h=!$.value||$.value.trim()==="";return k||h||!pe.value||G.value}),T=se(()=>{const k=r.plate_number!==I.value,h=r.car_id!==f.value||$.value!==U.value;return k||h}),P=se(()=>T.value&&!E.value),q=k=>{var ne,K,re;if(!k)return"";const h=[];return(ne=k.brand)!=null&&ne.name&&h.push(k.brand.name),(K=k.model)!=null&&K.name&&h.push(k.model.name),(re=k.type)!=null&&re.name&&h.push(k.type.name),k.cc&&h.push((k.cc/1e3).toFixed(1)),k.transmission&&h.push(k.transmission),k.year&&h.push(k.year.toString()),k.fuel_type&&h.push(k.fuel_type),k.production_period&&h.push(`(${k.production_period})`),h.join(" ")},z=()=>{r.car_id&&(r.car_id=null,Z.value=null,D.value=[]),X()},X=It.debounce(()=>{if(!$.value.trim()){F.value=[],R.value=!1;return}S.value=!0;try{const k=$.value.toLowerCase().trim();F.value=e.CarDetail.filter(h=>q(h).toLowerCase().includes(k)),R.value=!0}finally{S.value=!1}},300),ie=()=>{setTimeout(()=>{R.value=!1,r.car_name=$.value,u()},200)},le=async k=>{Z.value=k,$.value=q(k),r.car_id=k.id,r.car_name=q(k),R.value=!1,await be(k.id),u(),_("update:hasUnsavedChanges",T.value),_("update:validation",E.value)},xe=k=>!k||!k.file_path?"":`/storage/${k.file_path}`,be=async k=>{try{const h=await fetch(`/api/cars/${k}/images`);if(h.ok){const ne=await h.json();D.value=Array.isArray(ne)?ne:[]}else D.value=[]}catch(h){console.error("Error loading car images:",h),D.value=[]}},Se=k=>{H.value=k,d.value=!0,document.body.style.overflow="hidden"},ye=()=>{d.value=!1,document.body.style.overflow=""},we=()=>{H.value=(H.value+1)%D.value.length},me=()=>{H.value=(H.value-1+D.value.length)%D.value.length},o=k=>{if(d.value)switch(k.key){case"Escape":ye();break;case"ArrowRight":we();break;case"ArrowLeft":me();break}},u=()=>{const k={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};_("update-vehicle",k)},m=()=>{e.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:e.inspection.id}),{preserveScroll:!0,onSuccess:()=>{I.value=r.plate_number,f.value=r.car_id,U.value=r.car_name,_("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:k=>{console.error("Gagal menyimpan data:",k)}})};return de([()=>r.plate_number,()=>r.car_name],k=>{c.value="",G.value=!1,l.value="";const h=k[0];if(h&&h.length>=6){const ne=e.allInspections.filter(K=>{var re;return K.plate_number===h&&K.id!==((re=e.inspection)==null?void 0:re.id)});if(ne.length>0){const K=["draft","in_progress","pending","pending_review","revision"],re=ne.find(ue=>K.includes(ue.status));if(re)G.value=!0,c.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${re.status.replace(/_/g," ").toUpperCase()}.`;else{const ue=ne.filter(ve=>["approved","rejected","completed","cancelled"].includes(ve.status));if(ue.length>0){ue.sort((fe,Ue)=>new Date(Ue.created_at)-new Date(fe.created_at));const ve=ue[0];if(ve.car_id){const fe=e.CarDetail.find(Ue=>Ue.id===ve.car_id);fe&&le(fe)}else ve.car_name&&($.value=ve.car_name,r.car_name=ve.car_name,r.car_id=null);l.value=`Nomor plat ini sudah pernah diperiksa ${ue.length} kali sebelumnya.`}}}}_("update:hasUnsavedChanges",T.value),_("update:validation",E.value)},{deep:!0}),de([()=>B.value.rear_door,()=>V.value],()=>{s()}),(k,h)=>{var ne;return n(),i("div",Lt,[h[27]||(h[27]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),a.inspection?(n(),i("div",Rt,[t("div",jt,[h[11]||(h[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),t("div",Bt,[Ne(t("input",{"onUpdate:modelValue":h[0]||(h[0]=K=>y.value=K),type:"text",placeholder:"Contoh: B",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!pe.value||G.value}]),onInput:h[1]||(h[1]=K=>ce("area")),maxlength:"2"},null,34),[[Pe,y.value]]),Ne(t("input",{"onUpdate:modelValue":h[2]||(h[2]=K=>A.value=K),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:oe(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!pe.value||G.value}]),onInput:h[3]||(h[3]=K=>ce("number")),maxlength:"4"},null,34),[[Pe,A.value]]),Ne(t("input",{"onUpdate:modelValue":h[4]||(h[4]=K=>C.value=K),type:"text",placeholder:"ABC",class:oe(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!pe.value||G.value}]),onInput:h[5]||(h[5]=K=>ce("suffix")),maxlength:"3"},null,34),[[Pe,C.value]])]),ge.value?(n(),i("span",Ft,L(ge.value),1)):p("",!0),c.value?(n(),i("span",qt,L(c.value),1)):p("",!0),l.value?(n(),i("span",Ot,L(l.value),1)):p("",!0)]),t("div",Kt,[h[15]||(h[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Jenis Kendaraan ",-1)),t("div",Ht,[t("div",{class:oe(["w-full px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":B.value.rear_door,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":!B.value.rear_door}]),onClick:x},h[12]||(h[12]=[t("span",null,"Pintu Belakang",-1)]),2),t("div",zt,[t("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":V.value==="pick_up","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":V.value!=="pick_up"}]),onClick:h[6]||(h[6]=K=>g("pick_up"))}," Pick Up ",2),t("div",{class:oe(["flex-1 px-4 py-3 border-2 rounded-lg text-center transition-all duration-200 whitespace-nowrap text-sm font-medium cursor-pointer",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm":V.value==="box","border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":V.value!=="box"}]),onClick:h[7]||(h[7]=K=>g("box"))}," Box ",2)])]),t("div",Gt,[t("div",Wt,[h[14]||(h[14]=t("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",Zt,[h[13]||(h[13]=t("p",{class:"font-medium"},"Status Kendaraan:",-1)),t("p",Jt,[B.value.rear_door?(n(),i("span",Qt," ✓ Mobil Pada Umum nya yang memiliki Pintu Belakang ")):p("",!0),V.value==="pick_up"?(n(),i("span",Yt," ✓ Pick Up ")):p("",!0),V.value==="box"?(n(),i("span",Xt," ✓ Box ")):p("",!0),!B.value.rear_door&&!V.value?(n(),i("span",ea," Pilih jenis kendaraan agar point bisa menyesuaikan dengan tipe kendaraan anda ")):p("",!0)])])])])]),t("div",ta,[h[19]||(h[19]=t("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),t("div",aa,[Ne(t("input",{"onUpdate:modelValue":h[8]||(h[8]=K=>$.value=K),type:"text",placeholder:"Cari atau ketik nama mobil...",class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":he.value}]),onInput:z,onFocus:h[9]||(h[9]=K=>R.value=!0),onBlur:ie},null,34),[[Pe,$.value]]),S.value?(n(),i("div",sa,h[16]||(h[16]=[t("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):p("",!0),he.value?(n(),i("span",na,"Nama mobil tidak boleh kosong.")):p("",!0),!Ve(r).car_id&&$.value?(n(),i("div",oa,h[17]||(h[17]=[Nt('<div class="flex items-start" data-v-93565d5f><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-93565d5f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-93565d5f></path></svg><div data-v-93565d5f><p class="text-yellow-800 font-medium mb-1" data-v-93565d5f>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-93565d5f>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-93565d5f> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-93565d5f> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-93565d5f>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-93565d5f>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):p("",!0),R.value?(n(),i("div",ia,[F.value.length>0?(n(),i("div",la,[(n(!0),i(_e,null,$e(F.value,K=>(n(),i("div",{key:K.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:re=>le(K)},[t("div",ua,L(q(K)),1),t("div",da,L(K.year)+" • "+L(K.cc)+"cc • "+L(K.transmission)+" • "+L(K.fuel_type),1)],40,ra))),128))])):(n(),i("div",ca,h[18]||(h[18]=[Ie(" Tidak ada data mobil yang cocok. "),t("br",null,null,-1),Ie(" Silakan input manual dengan format: "),t("br",null,null,-1),t("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):p("",!0)])]),Ve(r).car_id&&Z.value?(n(),i("div",pa,[Z.value.description?(n(),i("div",ga,[h[20]||(h[20]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:Z.value.description},null,8,ma)])):p("",!0),D.value.length>0?(n(),i("div",va,[h[21]||(h[21]=t("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),t("div",fa,[(n(!0),i(_e,null,$e(D.value,(K,re)=>(n(),i("div",{key:K.id||re,class:"relative group cursor-pointer",onClick:ue=>Se(re)},[t("img",{src:xe(K),alt:K.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ba),K.note?(n(),i("div",ya,[t("p",xa,L(K.note),1)])):p("",!0)],8,ha))),128))])])):(n(),i("div",wa," Tidak ada gambar tersedia untuk mobil ini "))])):p("",!0),d.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:ye},[t("div",ka,[t("button",{onClick:ye,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},h[22]||(h[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),D.value.length>1?(n(),i("button",{key:0,onClick:De(me,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[23]||(h[23]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):p("",!0),D.value.length>1?(n(),i("button",{key:1,onClick:De(we,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},h[24]||(h[24]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):p("",!0),t("img",{src:xe(D.value[H.value]),alt:"Car Image "+(H.value+1),class:"max-w-full max-h-full object-contain",onClick:h[10]||(h[10]=De(()=>{},["stop"]))},null,8,Ia),D.value.length>1?(n(),i("div",_a,L(H.value+1)+" / "+L(D.value.length),1)):p("",!0),(ne=D.value[H.value])!=null&&ne.note?(n(),i("div",$a,L(D.value[H.value].note),1)):p("",!0)])])):p("",!0),ke(Pt,{type:"button",onClick:m,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!P.value},{default:Ce(()=>[Ve(r).processing?(n(),i("svg",Sa,h[25]||(h[25]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),t("span",null,L(Ve(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ke(Dt,{on:Ve(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:Ce(()=>h[26]||(h[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),Ie(" Tersimpan. ")])),_:1,__:[26]},8,["on"])]),_:1},8,["disabled"])])):p("",!0)])}}},Ai=Te(Aa,[["__scopeId","data-v-93565d5f"]]),Va={class:"mt-1"},Ca=["value","required","minlength","maxlength","allowSpace","placeholder"],Ta={key:0,class:"mt-2 text-sm text-red-600"},_t={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=se(()=>{if(!e.modelValue)return"";let f=e.modelValue;switch(e.allowSpace||(f=f.replace(/\s+/g,"")),e.textTransform){case"uppercase":return f.toUpperCase();case"lowercase":return f.toLowerCase();case"capitalize":return f.replace(/\b\w/g,U=>U.toUpperCase());default:return f}}),I=f=>{let U=f.target.value;switch(e.allowSpace||(U=U.replace(/\s+/g,"")),e.textTransform){case"uppercase":U=U.toUpperCase();break;case"lowercase":U=U.toLowerCase();break;case"capitalize":U=U.replace(/\b\w/g,y=>y.toUpperCase());break}_("update:modelValue",U),_("save",e.pointId)};return(f,U)=>(n(),i("div",Va,[t("input",{value:r.value,onInput:I,type:"text",required:a.required,minlength:a.minLength,maxlength:a.maxLength,allowSpace:a.allowSpace,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:a.textTransform==="uppercase",lowercase:a.textTransform==="lowercase",capitalize:a.textTransform==="capitalize"}])},null,42,Ca),a.error?(n(),i("p",Ta,L(a.error),1)):p("",!0)]))}},Na={class:"mt-1"},Ua=["value","required","min","max","step","placeholder"],Ea={key:0,class:"mt-2 text-sm text-red-600"},$t={__name:"InputNumber",props:{modelValue:[String,Number],required:Boolean,min:[String,Number],max:[String,Number],step:[String,Number],placeholder:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=I=>{const f=I.target.value;_("update:modelValue",f),_("save",e.pointId)};return(I,f)=>(n(),i("div",Na,[t("input",{value:a.modelValue,onInput:r,type:"number",required:a.required,min:a.min,max:a.max,step:a.step,placeholder:a.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Ua),a.error?(n(),i("p",Ea,L(a.error),1)):p("",!0)]))}},Ma={class:"mt-1"},Pa=["value","required","min","max"],Da={key:0,class:"mt-2 text-sm text-red-600"},St={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=I=>{_("update:modelValue",I.target.value),_("save",e.pointId)};return(I,f)=>(n(),i("div",Ma,[t("input",{value:a.modelValue,onChange:r,type:"date",required:a.required,min:a.minDate,max:a.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Pa),a.error?(n(),i("p",Da,L(a.error),1)):p("",!0)]))}},La={class:"mt-1"},Ra=["value","required","placeholder"],ja={key:0,class:"mt-2 text-sm text-red-600"},At={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=N(""),I=se(()=>{var C,V,B,G;return{currency_symbol:((C=e.settings)==null?void 0:C.currency_symbol)||"Rp",thousands_separator:((V=e.settings)==null?void 0:V.thousands_separator)||",",min_value:((B=e.settings)==null?void 0:B.min_value)!==void 0?Number(e.settings.min_value):0,max_value:((G=e.settings)==null?void 0:G.max_value)!==void 0?Number(e.settings.max_value):1e9}}),f=C=>{if(C==null||C==="")return"";const V=Number(C);if(isNaN(V))return"";let B=V.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return I.value.thousands_separator!==","&&(B=B.replace(/,/g,I.value.thousands_separator)),B},U=C=>C?C.replace(/[^\d]/g,""):"",y=se(()=>r.value?`${I.value.currency_symbol} ${f(r.value)}`:""),A=C=>{let V=U(C.target.value),B=Number(V);I.value.min_value!==void 0&&B<I.value.min_value&&(V=I.value.min_value.toString()),I.value.max_value!==void 0&&B>I.value.max_value&&(V=I.value.max_value.toString()),r.value=V,_("update:modelValue",V),_("save",e.pointId)};return de(()=>e.modelValue,C=>{C!=null&&(r.value=C.toString())},{immediate:!0}),(C,V)=>(n(),i("div",La,[t("input",{value:y.value,onInput:A,type:"text",required:a.required,placeholder:a.placeholder,class:oe(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",a.error?"border-red-300":"border-gray-300"])},null,42,Ra),a.error?(n(),i("p",ja,L(a.error),1)):p("",!0)]))}},Ba={class:"mt-1 space-y-3"},Fa={key:0,class:"space-y-2"},qa={class:"flex flex-wrap gap-2"},Oa=["onClick"],Ka=["value","required","minlength","maxlength","placeholder"],Ha={class:"flex justify-between items-center mt-1"},za={class:"text-xs text-gray-500"},Ga={key:0,class:"text-xs text-red-600"},Vt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=N([]),I=N(""),f=C=>r.value.some(V=>V.value===C),U=C=>{f(C.value)?r.value=r.value.filter(c=>c.value!==C.value):r.value.push(C);const B=[...r.value.map(c=>c.value)];I.value.trim()&&B.push(I.value.trim());const G=B.join(", ");_("update:modelValue",G),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:G})},y=C=>{const V=C.target.value;_("update:modelValue",V),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:V}),A(V)},A=C=>{var c,l,$,R;if(!C){r.value=[],I.value="";return}const V=C.split(",").map(S=>S.trim()).filter(S=>S),B=((l=(c=e.settings)==null?void 0:c.damage_options)==null?void 0:l.map(S=>S.value))||[];r.value=((R=($=e.settings)==null?void 0:$.damage_options)==null?void 0:R.filter(S=>V.includes(S.value)))||[];const G=V.filter(S=>!B.includes(S));I.value=G.join(", ")};return de(()=>e.modelValue,C=>{C!=null&&A(C)},{immediate:!0}),de(()=>{var C;return(C=e.settings)==null?void 0:C.damage_options},(C,V)=>{if(C!==V){const B=C?C.map($=>$.value):[];r.value=r.value.filter($=>B.includes($.value));const c=[...r.value.map($=>$.value)];I.value.trim()&&c.push(I.value.trim());const l=c.filter($=>$).join(", ");_("update:modelValue",l),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,notes:l})}},{deep:!0,immediate:!1}),(C,V)=>{var B,G,c;return n(),i("div",Ba,[(B=a.settings)!=null&&B.enable_damage&&((G=a.settings)!=null&&G.damage_options)?(n(),i("div",Fa,[V[0]||(V[0]=t("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),t("div",qa,[(n(!0),i(_e,null,$e(a.settings.damage_options,(l,$)=>(n(),i("button",{key:$,type:"button",onClick:R=>U(l),class:oe(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":f(l.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!f(l.value)}])},L(l.label),11,Oa))),128))])])):p("",!0),t("div",null,[t("textarea",{value:a.modelValue,onInput:y,required:a.required,minlength:a.minLength,maxlength:a.maxLength,placeholder:a.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Ka),t("div",Ha,[t("span",za,L(((c=a.modelValue)==null?void 0:c.length)||0)+"/"+L(a.maxLength||400),1),a.error?(n(),i("p",Ga,L(a.error),1)):p("",!0)])])])}}},Wa={class:"mt-1"},Za=["value","required"],Ja={key:0,class:"mt-2 text-sm text-red-600"},Qa={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(a,{emit:Q}){const e=a,_=Q,r=I=>{_("update:modelValue",I.target.value),_("save",e.pointId)};return(I,f)=>(n(),i("div",Wa,[t("select",{value:a.modelValue,onChange:r,required:a.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},f[0]||(f[0]=[t("option",{value:"",disabled:""},"Select status",-1),t("option",{value:"good"},"Good",-1),t("option",{value:"bad"},"Bad",-1),t("option",{value:"na"},"N/A",-1)]),40,Za),a.error?(n(),i("p",Ja,L(a.error),1)):p("",!0)]))}},Ya=Te(Qa,[["__scopeId","data-v-1b6c0201"]]),Xa={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},es={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},ts={class:"text-xs text-gray-500 mt-2 text-center"},as={class:"flex flex-row space-x-4 mb-6"},ss={class:"mt-4 text-right"},ns={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(a){return(Q,e)=>a.show?(n(),i("div",Xa,[t("div",es,[e[7]||(e[7]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),t("p",ts,[e[3]||(e[3]=Ie("Ambil Foto Maksimal: ")),t("b",null,L(a.settings.max_files),1),e[4]||(e[4]=Ie(" Dengan Rasio & Ukuran: ")),t("b",null,L(a.settings.camera_aspect_ratio),1)]),t("div",as,[t("button",{onClick:e[0]||(e[0]=_=>Q.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"text-sm font-medium"},"Kamera",-1)])),t("button",{onClick:e[1]||(e[1]=_=>Q.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),t("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),t("div",ss,[t("button",{onClick:e[2]||(e[2]=_=>Q.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):p("",!0)}},os={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},is={class:"w-full h-full flex flex-col"},ls={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},rs=["disabled"],us={class:"text-lg font-semibold"},ds={class:"flex items-center gap-2"},cs=["disabled"],ps={key:0,class:"px-4 py-2 bg-indigo-900 text-white"},gs={class:"flex justify-between items-center text-sm"},ms={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},vs={class:"flex-1 flex items-center justify-center overflow-hidden relative"},fs=["src"],hs={key:1,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-3"},bs=["disabled"],ys=["disabled"],xs={key:2,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},ws={key:3,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},ks=["disabled"],Is=["disabled"],_s=["disabled"],$s={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Ss={class:"flex justify-between items-center w-full"},As=["disabled"],Vs={key:1,class:"flex-1"},Cs=["disabled"],Ts={class:"flex gap-3 w-full"},Ns={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},Us={class:"flex items-center gap-2"},Es={key:0,class:"text-center"},Ms={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images","retryImage"],setup(a,{emit:Q}){const e=a,_=Q,r=N(0),I=N([]),f=se(()=>I.value.length>0?I.value[r.value]:null);de(()=>e.images,R=>{I.value=R.map(S=>({...S,rotation:S.isNew&&S.rotation||0})),R.length===0&&e.show&&B()},{deep:!0,immediate:!0}),de(()=>e.show,R=>{R&&e.images.length>0&&(r.value=e.initialIndex)}),de(()=>e.uploadProgress,R=>{R===100&&console.log("Upload completed")});const U=R=>R.preview||(R.image_path?`/${R.image_path}`:""),y=R=>{if(f.value&&f.value.isNew&&!e.isUploading){const S=f.value.rotation||0;let F;R==="left"?F=S-90:F=S+90,F=(F%360+360)%360,I.value[r.value].rotation=F,_("update:images",I.value)}},A=()=>{e.isUploading||(r.value=r.value<I.value.length-1?r.value+1:0)},C=()=>{e.isUploading||(r.value=r.value>0?r.value-1:I.value.length-1)},V=()=>{e.isUploading||_("saveImages",I.value)},B=()=>{e.isUploading||_("close")},G=()=>{if(f.value&&!e.isUploading){const R=f.value,S=I.value.findIndex(F=>F.isNew&&R.isNew&&F.preview===R.preview||!F.isNew&&!R.isNew&&F.id===R.id);S!==-1&&(_("removePreviewImage",R),I.value.splice(S,1),_("update:images",I.value)),r.value>=I.value.length&&(r.value=Math.max(0,I.value.length-1)),I.value.length===0&&_("close")}},c=()=>{e.isUploading||_("triggerAddMorePhotos")},l=()=>{f.value&&!e.isUploading&&_("retryImage",f.value)},$=R=>{R.key==="Escape"&&!e.isUploading&&B()};return Me(()=>{document.addEventListener("keydown",$)}),Re(()=>{document.removeEventListener("keydown",$)}),(R,S)=>{var F;return a.show?(n(),i("div",os,[t("div",is,[t("div",ls,[t("button",{onClick:B,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:a.isUploading},S[2]||(S[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,rs),t("div",us,L(((F=a.point)==null?void 0:F.name)||"Preview")+" ("+L(r.value+1)+"/"+L(I.value.length)+") ",1),t("div",ds,[f.value&&f.value.isNew?(n(),i("button",{key:0,onClick:G,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:a.isUploading},S[3]||(S[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,cs)):p("",!0)])]),a.isUploading?(n(),i("div",ps,[t("div",gs,[t("span",null,"Mengupload: "+L(a.currentUpload)+"/"+L(a.totalUpload),1),t("span",null,L(a.uploadProgress)+"%",1)]),t("div",ms,[t("div",{class:"bg-gradient-to-r from-indigo-500 to-sky-400 h-2 rounded-full progress-bar",style:Ee({width:a.uploadProgress+"%"})},null,4)])])):p("",!0),t("div",vs,[t("div",{class:"relative w-full max-w-full",style:Ee({paddingTop:a.aspectRatio?100/a.aspectRatio+"%":"75%"})},[f.value?(n(),i("img",{key:0,src:U(f.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:Ee({transform:`rotate(${f.value.rotation}deg)`})},null,12,fs)):p("",!0),f.value&&f.value.isNew&&!f.value.isUploading&&!f.value.isFailed?(n(),i("div",hs,[t("button",{onClick:S[0]||(S[0]=Z=>y("left")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kiri"},S[4]||(S[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9",transform:"rotate(180 12 12)"})],-1)]),8,bs),t("button",{onClick:S[1]||(S[1]=Z=>y("right")),class:"p-3 bg-black bg-opacity-60 text-white rounded-full hover:bg-opacity-80 transition-colors",disabled:a.isUploading,title:"Putar ke kanan"},S[5]||(S[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12a9 9 0 1018 0 9 9 0 00-18 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l3-3m0 0l3 3m-3-3v9"})],-1)]),8,ys)])):p("",!0),f.value&&f.value.isUploading?(n(),i("div",xs,S[6]||(S[6]=[t("div",{class:"text-center text-white"},[t("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t("p",{class:"text-sm"},"Mengupload...")],-1)]))):p("",!0),f.value&&f.value.isFailed?(n(),i("div",ws,[S[7]||(S[7]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),S[8]||(S[8]=t("p",{class:"text-lg font-medium mb-2"},"Upload Gagal",-1)),t("button",{onClick:l,class:"px-4 py-2 bg-white text-red-600 rounded-lg font-medium hover:bg-gray-100 transition-colors",disabled:a.isUploading}," Coba Lagi ",8,ks)])):p("",!0)],4),I.value.length>1&&!a.isUploading?(n(),i("button",{key:0,onClick:C,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},S[9]||(S[9]=[t("svg",{xmlns:"http://www.w3.org2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Is)):p("",!0),I.value.length>1&&!a.isUploading?(n(),i("button",{key:1,onClick:A,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:a.isUploading},S[10]||(S[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,_s)):p("",!0)]),t("div",$s,[t("div",Ss,[f.value&&!f.value.isNew?(n(),i("button",{key:0,onClick:G,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:a.isUploading},S[11]||(S[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ie(" Hapus Foto ")]),8,As)):(n(),i("div",Vs)),a.allowMultiple&&I.value.length<a.maxFiles&&!a.isUploading?(n(),i("button",{key:2,onClick:c,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:a.isUploading},S[12]||(S[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Ie(" Tambah Foto ")]),8,Cs)):p("",!0)]),t("div",Ts,[a.isUploading?(n(),i("button",Ns,[t("div",Us,[S[13]||(S[13]=t("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),t("span",null,"Mengupload... "+L(a.uploadProgress)+"%",1)])])):(n(),i("button",{key:0,onClick:V,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),a.isUploading?(n(),i("div",Es,S[14]||(S[14]=[t("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):p("",!0)])])])):p("",!0)}}},Ps=Te(Ms,[["__scopeId","data-v-0e4bb6d9"]]),Ds={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},Ls={class:"webcam-content-box"},Rs={class:"webcam-header"},js={class:"inspection-point-name"},Bs={class:"camera-quality-indicator"},Fs={class:"quality-badge"},qs={key:1,class:"auto-focus-indicator"},Os={key:2,class:"error-overlay"},Ks={class:"error-content"},Hs={class:"error-message"},zs={class:"webcam-footer"},Gs={class:"camera-controls"},Ws=["disabled"],Zs={class:"camera-icon-container"},Js={key:0,class:"camera-spinner"},Qs={key:1,class:"camera-shutter"},Ys=["disabled"],Xs={__name:"WebCamRTC",props:{show:Boolean,aspectRatio:{type:Number,default:4/3},settings:{type:Object,default:()=>({enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object,cameraQuality:{type:String}},emits:["close","photoCaptured"],setup(a,{emit:Q}){const e=a,_=Q,r=N(null),I=N(null);let f=null,U=null;const y=N("environment"),A=N(null),C=N([]),V=N(!1),B=N(!1),G=N(!1),c=N(!1),l=N(!1),$=N(null),R=N(null),S=N(!1),F=N(!0),Z=N({}),D=se(()=>({aspectRatio:`${e.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"})),d=async()=>{f&&f.getTracks().forEach(E=>E.stop()),$.value=null,l.value=!0;try{const E=H();console.log("Mencoba inisialisasi kamera dengan:",E),f=await navigator.mediaDevices.getUserMedia({video:E,audio:!1}),U=f.getVideoTracks()[0],r.value.srcObject=f,await new Promise((T,P)=>{r.value.onloadedmetadata=T,r.value.onerror=P,setTimeout(T,1e3)}),await r.value.play(),await s(),W(),setTimeout(async()=>{try{await x()}catch(T){console.warn("Gagal mendapatkan daftar perangkat:",T)}},500),l.value=!1,console.log("Kamera berhasil diinisialisasi")}catch(E){if(console.error("Error mengakses kamera: ",E),!f)try{console.log("Mencoba fallback berdasarkan kualitas kamera...");let T,P,q,z;switch(e.cameraQuality){case"SD":T=1280,P=720,q=640,z=480;break;case"HD":T=1920,P=1080,q=1280,z=720;break;case"4K":T=3840,P=2160,q=1920,z=1080;break;default:T=1920,P=1080,q=1280,z=720}const X={video:{facingMode:y.value,width:{min:q,ideal:T},height:{min:z,ideal:P}}};f=await navigator.mediaDevices.getUserMedia(X),U=f.getVideoTracks()[0],r.value.srcObject=f,await r.value.play(),l.value=!1,console.log("Fallback berhasil dengan kualitas:",e.cameraQuality)}catch(T){console.error("Fallback juga gagal:",T),$.value=g(T),l.value=!1}}},H=()=>{let E,T,P,q,z,X;switch(e.cameraQuality){case"SD":E=1280,T=720,P=1280,q=720,z=640,X=480;break;case"HD":E=1920,T=1080,P=1920,q=1080,z=1280,X=720;break;case"4K":E=3840,T=2160,P=3840,q=2160,z=1920,X=1080;break;default:E=1920,T=1080,P=1920,q=1080,z=1280,X=720}return{facingMode:{ideal:"environment"},width:{ideal:E,max:P,min:z},height:{ideal:T,max:q,min:X},focusMode:{ideal:["continuous","single-shot","manual"]},exposureMode:{ideal:["continuous","manual"]},whiteBalanceMode:{ideal:["continuous","manual"]}}},W=async()=>{if(U)try{const E=U.getCapabilities();R.value=E;const T=E.focusMode&&(E.focusMode.includes("continuous")||E.focusMode.includes("single-shot")),P=E.exposureMode&&E.exposureMode.includes("continuous");if(T||P){const q={};T&&(q.focusMode="continuous"),P&&(q.exposureMode="continuous",q.exposureCompensation={ideal:0}),Object.keys(q).length>0&&(await U.applyConstraints({advanced:[q]}),console.log("Auto-focus/exposure diaktifkan"))}B.value=!!E.torch||!!E.fillLightMode}catch(E){console.warn("Tidak bisa mengatur auto-focus/exposure:",E)}},x=async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(P=>P.stop());const T=await navigator.mediaDevices.enumerateDevices();if(C.value=T.filter(P=>P.kind==="videoinput"),V.value=C.value.length>1,!A.value&&C.value.length>0){const P=C.value.find(q=>q.label.toLowerCase().includes("back")||q.label.toLowerCase().includes("rear")||q.label.toLowerCase().includes("environment"));A.value=P?P.deviceId:C.value[0].deviceId}}catch(E){console.warn("Error getting camera devices:",E)}},g=E=>{switch(E.name){case"NotAllowedError":return"Izin akses kamera ditolak. Silakan izinkan akses kamera di pengaturan browser.";case"NotFoundError":return"Tidak ada kamera yang ditemukan.";case"NotSupportedError":return"Browser tidak mendukung akses kamera.";case"NotReadableError":return"Kamera sedang digunakan oleh aplikasi lain.";case"OverconstrainedError":return"Perangkat tidak mendukung pengaturan kamera yang diminta.";default:return`Tidak dapat mengakses kamera: ${E.message}`}},s=()=>{var E,T;if(U)try{const P=U.getCapabilities();R.value=P,B.value=!!P.torch||!!P.fillLightMode,console.log("Kamera mendukung:",{maxRes:`${((E=P.width)==null?void 0:E.max)||"N/A"}x${((T=P.height)==null?void 0:T.max)||"N/A"}`,torch:P.torch,focusModes:P.focusMode,exposureModes:P.exposureMode})}catch(P){console.warn("Tidak bisa mendapatkan kemampuan kamera:",P)}},b=async()=>{if(!(!U||!B.value))try{y.value==="environment"?(await U.applyConstraints({advanced:[{torch:!G.value}]}),G.value=!G.value):(console.log("Flash tidak didukung untuk kamera depan"),G.value=!1)}catch(E){console.error("Gagal mengontrol flash:",E),G.value=!1}},M=async()=>{if(!V.value||l.value)return;l.value=!0,f&&f.getTracks().forEach(q=>q.stop());const T=(C.value.findIndex(q=>q.deviceId===A.value)+1)%C.value.length;A.value=C.value[T].deviceId;const P=C.value[T];y.value=P.label.toLowerCase().includes("front")?"user":"environment",await d()},Y=async E=>{if(!r.value||!U)return;const T=E.currentTarget.getBoundingClientRect(),P=E.type.includes("mouse")?E.clientX-T.left:E.touches[0].clientX-T.left,q=E.type.includes("mouse")?E.clientY-T.top:E.touches[0].clientY-T.top;S.value=!0,Z.value={left:`${P-40}px`,top:`${q-40}px`},setTimeout(()=>{S.value=!1},1e3);try{const z=U.getCapabilities();if(z.focusMode&&z.focusMode.includes("manual")){const X=P/T.width,ie=q/T.height;z.focusDistance&&z.pan&&z.tilt&&await U.applyConstraints({advanced:[{focusMode:"manual",focusDistance:.3,pointsOfInterest:[{x:X,y:ie}]}]})}else z.focusMode&&z.focusMode.includes("single-shot")&&await U.applyConstraints({advanced:[{focusMode:"single-shot"}]})}catch(z){console.warn("Penyesuaian fokus tidak didukung:",z)}},ce=async()=>{var E,T;if(!(c.value||!r.value||!I.value)){c.value=!0;try{const P=r.value,q=I.value;await new Promise(me=>setTimeout(me,100));const z=P.videoWidth,X=P.videoHeight;let ie,le,xe,be;z/X>e.aspectRatio?(le=X,ie=X*e.aspectRatio,xe=(z-ie)/2,be=0):(ie=z,le=z/e.aspectRatio,xe=0,be=(X-le)/2),q.width=ie,q.height=le,q.getContext("2d").drawImage(P,xe,be,ie,le,0,0,ie,le);const ye=Math.min(.95,.7+z*X/(3840*2160)*.25),we=await new Promise(me=>{q.toBlob(me,"image/jpeg",ye)});if(we)if(we.size/1024>e.settings.max_size){const me=await pe(we,e.settings.max_size),o=`inspeksi_${((E=e.point)==null?void 0:E.name)||"foto"}_${Date.now()}.jpg`,u=new File([me],o,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",u)}else{const me=`inspeksi_${((T=e.point)==null?void 0:T.name)||"foto"}_${Date.now()}.jpg`,o=new File([we],me,{type:"image/jpeg",lastModified:Date.now()});_("photoCaptured",o)}}catch(P){console.error("Error mengambil foto:",P)}finally{c.value=!1}}},pe=async(E,T)=>new Promise(P=>{const q=new Image;q.onload=()=>{const z=document.createElement("canvas");let X=q.width,ie=q.height;const le=1920;(X>le||ie>le)&&(X>ie?(ie=ie*le/X,X=le):(X=X*le/ie,ie=le)),z.width=X,z.height=ie,z.getContext("2d").drawImage(q,0,0,X,ie);let be=.9;const Se=()=>{z.toBlob(ye=>{ye.size/1024<=T||be<=.3?P(ye):(be-=.1,Se())},"image/jpeg",be)};Se()},q.src=URL.createObjectURL(E)}),he=()=>{f&&f.getTracks().forEach(E=>E.stop()),_("close")},ge=async()=>{$.value=null,await d()};return de(()=>e.show,async E=>{E?(await Fe(),await d()):f&&f.getTracks().forEach(T=>T.stop())}),Re(()=>{f&&f.getTracks().forEach(E=>E.stop())}),(E,T)=>{var P;return a.show?(n(),i("div",Ds,[t("div",Ls,[t("div",Rs,[t("div",js,L(((P=a.point)==null?void 0:P.name)||"Camera"),1),t("div",Bs,[t("span",Fs,L(a.cameraQuality),1)]),t("button",{onClick:he,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},T[0]||(T[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",{class:"webcam-video-container",style:Ee(D.value),onTouchstart:Y,onClick:Y},[t("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),t("canvas",{ref_key:"webcamCanvas",ref:I,class:"hidden"},null,512),S.value?(n(),i("div",{key:0,class:"focus-indicator",style:Ee(Z.value)},T[1]||(T[1]=[t("div",{class:"focus-ring"},null,-1)]),4)):p("",!0),F.value&&!S.value?(n(),i("div",qs,T[2]||(T[2]=[t("div",{class:"auto-focus-ring"},null,-1)]))):p("",!0),$.value?(n(),i("div",Os,[t("div",Ks,[T[3]||(T[3]=t("div",{class:"error-icon"},"⚠️",-1)),T[4]||(T[4]=t("h3",{class:"error-title"},"Gagal Mengakses Kamera",-1)),t("p",Hs,L($.value),1),t("button",{onClick:ge,class:"retry-button"}," Coba Lagi ")])])):p("",!0)],36),t("div",zs,[t("div",Gs,[a.settings.enable_flash&&B.value?(n(),i("button",{key:0,onClick:b,class:oe(["control-button flash-button",{active:G.value}])},T[5]||(T[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):p("",!0),t("button",{onClick:ce,class:"capture-button",disabled:c.value||l.value},[t("div",Zs,[c.value?(n(),i("div",Js)):(n(),i("div",Qs))])],8,Ws),a.settings.enable_camera_switch&&V.value?(n(),i("button",{key:1,onClick:M,class:"control-button switch-button",disabled:l.value},T[6]||(T[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]),8,Ys)):p("",!0)])])])])):p("",!0)}}},en=Te(Xs,[["__scopeId","data-v-472cc13f"]]),tn=["accept","multiple","disabled"],an={class:"text-xs text-gray-500 mb-2"},sn=["disabled"],nn={class:"h-full flex flex-col items-center justify-center p-4 text-center"},on={class:"text-xs text-gray-400 mt-1"},ln={key:0,class:"flex items-center gap-4"},rn=["src"],un={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},dn=["disabled"],cn={key:1,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},pn=["disabled"],gn=["onClick"],mn=["src","onError"],vn={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},fn={key:0},hn={key:1,class:"ml-1"},bn={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},yn={key:2,class:"absolute inset-0 bg-red-500 bg-opacity-80 flex flex-col items-center justify-center text-white"},xn={key:2,class:"mt-1 text-xs text-red-600"},wn={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(a,{emit:Q}){const e=a,_=Q,r=N(null),I=N(null),f=N(!1),U=N(!1),y=N(!1),A=N([]),C=N(0),V=N(!1),B=N(!1),G=N(0),c=N(0),l=N(0),$=qe("imageSourceSetting",N("all")),R=qe("cameraQualitySetting",N("HD")),S=`inspection-${e.inspectionId}-point-${e.pointId}-backup`,F=se(()=>Number(e.settings.max_files)>1),Z=se(()=>e.settings.allowed_types.map(o=>`.${o}`).join(", ")),D=se(()=>{const o=e.settings.camera_aspect_ratio.split(":");if(o.length===2){const u=parseFloat(o[0]),m=parseFloat(o[1]);if(!isNaN(u)&&!isNaN(m)&&m!==0)return u/m}return 3/4}),d=se(()=>{console.log("🔄 allImages computed called");const o=[],u=new Set;for(const m of e.modelValue){if(!m||typeof m!="object"||m.id&&u.has(m.id))continue;m.id&&u.add(m.id),console.log("📥 Database image:",m),console.log("📥 Type of preview:",typeof m.preview),console.log("📥 Type of public_url:",typeof m.public_url);const v=H(m);o.push({...v,rotation:v.rotation||0,isNew:!1,isUploaded:!0,isUploading:!1,isFailed:!1})}for(const m of A.value)m.id&&u.add(m.id),o.push({...m,isUploading:m.isUploading||!1,isFailed:m.isFailed||!1});return console.log("✅ Final allImages:",o),o}),H=o=>{if(!o||typeof o!="object")return{};const u={...o};return["preview","public_url","original_url","optimized_url"].forEach(v=>{u[v]&&(u[v]=W(u[v]))}),u.image_path&&(u.image_path=u.image_path.replace(/^storage\//,"")),u},W=o=>{if(!o||typeof o!="string")return o;let u=o.replace(/\/storage\/storage\//g,"/storage/");return u=u.replace(/\/\/storage\/storage\//g,"/storage/"),u.startsWith("storage/")&&(u=`/${u}`),!u.startsWith("/")&&!u.startsWith("http")&&(u=`/storage/${u}`),u},x=o=>{if(!o||typeof o!="object")return console.warn("❌ safeImageSrc: image is not object",o),"";const u=g(o);return typeof u!="string"?(console.error("🚨 CRITICAL: getImageSrc returned non-string:",typeof u,u),""):(u&&console.log("✅ safeImageSrc result:",u),u)},g=o=>{if(!o||typeof o!="object")return"";if(console.log("🔍 getImageSrc called with:",o),console.log("🔍 Available fields:",Object.keys(o)),o.preview&&typeof o.preview=="string"){const u=W(o.preview);return console.log("✅ Using preview URL:",u),u}if(o.public_url&&typeof o.public_url=="string"){const u=W(o.public_url);return console.log("✅ Using public_url:",u),u}if(o.original_url&&typeof o.original_url=="string"){const u=W(o.original_url);return console.log("✅ Using original_url:",u),u}if(o.optimized_url&&typeof o.optimized_url=="string"){const u=W(o.optimized_url);return console.log("✅ Using optimized_url:",u),u}if(o.image_path&&typeof o.image_path=="string"){const m=`/storage/${o.image_path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from image_path:",m),m}if(o.path&&typeof o.path=="string"){const m=`/storage/${o.path.replace(/^\/?storage\//,"")}`;return console.log("✅ Generated from path:",m),m}return console.warn("⚠️ No valid image source found for:",o),""},s=o=>{console.error("❌ Image load error for:",o),console.error("❌ Attempted URL:",x(o)),B.value=!0;const u=b(o);if(u&&u!==x(o)){console.log("🔄 Trying fallback URL:",u);const m=event==null?void 0:event.target;m&&(m.src=u)}},b=o=>{if(!o||typeof o!="object")return"";const u=["original_url","optimized_url","public_url","preview"];for(const m of u)if(o[m]&&typeof o[m]=="string")return W(o[m]);return""},M=()=>{y.value&&(y.value=!1),$.value==="camera"?ce():$.value==="gallery"?Y():f.value=!0},Y=()=>{f.value=!1,r.value.click()},ce=()=>{f.value=!1,U.value=!0},pe=()=>{f.value=!1,d.value.length>0&&(y.value=!0)},he=()=>{U.value=!1,d.value.length>0&&(y.value=!0)},ge=()=>{y.value=!1,V.value||(A.value.forEach(o=>{o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview)}),A.value=[])};de(()=>e.modelValue,o=>{var u;console.log("🔄 modelValue updated:",o),o&&o.length>0&&(console.log("📊 First image structure:",JSON.stringify(o[0],null,2)),console.log("🔍 Type of preview:",typeof((u=o[0])==null?void 0:u.preview)))},{deep:!0});const E=o=>new Promise(u=>{const m=new FileReader;m.onload=v=>{const j=new Image;j.onload=()=>{u({file:o,preview:URL.createObjectURL(o),rotation:0,width:j.naturalWidth,height:j.naturalHeight,isNew:!0})},j.onerror=()=>{console.error("Failed to load image for dimensions:",o.name),u({file:o,preview:URL.createObjectURL(o),rotation:0,width:0,height:0,isNew:!0})},j.src=v.target.result},m.readAsDataURL(o)}),T=o=>{const u=o.name.split(".").pop().toLowerCase();return e.settings.allowed_types.includes(u)},P=async o=>{const m=(e.settings.max_size||2048)*1024;return new Promise(v=>{const j=new Image,ee=new FileReader;ee.onload=te=>{j.onload=()=>{const ae=document.createElement("canvas"),J=ae.getContext("2d"),k=Math.max(j.width,j.height);ae.width=k,ae.height=k,J.fillStyle="white",J.fillRect(0,0,k,k);const h=(k-j.width)/2,ne=(k-j.height)/2;J.drawImage(j,h,ne,j.width,j.height);let K=.9;const re=()=>{ae.toBlob(ue=>{if(ue.size>m&&K>.1)K-=.1,re();else{const ve=new File([ue],o.name,{type:"image/jpeg",lastModified:Date.now()});v(ve)}},"image/jpeg",K)};re()},j.src=te.target.result},ee.readAsDataURL(o)})},q=async o=>{const u=Array.from(o.target.files);if(!u.length){f.value=!1,d.value.length>0&&(y.value=!0);return}try{const m=u.filter(J=>!T(J));if(m.length>0){const J=m.map(k=>k.name.split(".").pop()).join(", ");alert(`File type not allowed: ${J}. Allowed types: ${e.settings.allowed_types.join(", ")}`),o.target.value="";return}const v=d.value.length,j=e.settings.max_files-v,ee=await Promise.all(u.slice(0,j).map(async J=>await P(J))),te=await Promise.all(ee.map(E)),ae=F.value?te:te.slice(0,1);F.value?A.value.push(...ae):(A.value.forEach(J=>{J.preview&&J.preview.startsWith("blob:")&&URL.revokeObjectURL(J.preview)}),A.value=ae),f.value=!1,ae.length>0?(C.value=Math.max(0,d.value.length-ae.length),y.value=!0):d.value.length>0&&(y.value=!0),o.target.value=""}catch(m){console.error("Error processing selected images:",m),alert("Failed to process selected images. Please try again."),f.value=!1,d.value.length>0&&(y.value=!0)}},z=async o=>{const u=d.value.length;if(!F.value||u<e.settings.max_files)try{const m=await P(o),v=new Image;v.onload=()=>{const j={file:m,preview:URL.createObjectURL(m),rotation:0,width:v.naturalWidth,height:v.naturalHeight,isNew:!0};F.value?A.value.push(j):(A.value.forEach(ee=>{ee.preview&&ee.preview.startsWith("blob:")&&URL.revokeObjectURL(ee.preview)}),A.value=[j]),U.value=!1,f.value=!1,C.value=d.value.length-1,y.value=!0},v.src=URL.createObjectURL(m)}catch(m){console.error("Error processing captured image:",m),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${e.settings.max_files} files allowed.`),U.value=!1,f.value=!1,d.value.length>0&&(y.value=!0)},X=(o=0)=>{C.value=o,y.value=!0},ie=o=>new Promise(u=>{if(o.rotation===0||!I.value){if(!o.isNew&&!o.file){u({file:null,width:o.width,height:o.height,isOriginal:!0});return}u({file:o.file,width:o.width,height:o.height});return}const m=new Image;m.onload=async()=>{try{const v=I.value,j=v.getContext("2d"),ee=m.width,te=m.height;let ae,J;o.rotation===90||o.rotation===270?(ae=te,J=ee):(ae=ee,J=te),v.width=ae,v.height=J,j.clearRect(0,0,v.width,v.height),j.translate(v.width/2,v.height/2),j.rotate(o.rotation*Math.PI/180),j.drawImage(m,-ee/2,-te/2,ee,te),j.setTransform(1,0,0,1,0,0);const k=await new Promise(K=>{v.toBlob(K,"image/jpeg",.9)}),h=new File([k],o.file?o.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),ne=await P(h);u({file:ne,width:ae,height:J})}catch(v){console.error("Error processing rotated image:",v),u({file:o.file,width:o.width,height:o.height})}},m.onerror=()=>{console.error("Failed to load image for rotation processing:",o.preview),u({file:o.file,width:o.width,height:o.height})},m.src=o.preview}),le=o=>{try{const u={images:o.map(m=>{var v;return{fileName:((v=m.file)==null?void 0:v.name)||`image-${Date.now()}.jpg`,rotation:m.rotation||0,width:m.width||0,height:m.height||0,timestamp:Date.now()}}),inspectionId:e.inspectionId,pointId:e.pointId};localStorage.setItem(S,JSON.stringify(u))}catch(u){console.error("Error saving backup:",u)}},xe=()=>{localStorage.removeItem(S)},be=async o=>{V.value=!0;const u=[],m=[];if(!e.pointId){alert("Error: Point ID is missing. Cannot upload image."),V.value=!1;return}try{le(o);for(const v of o){if(!v.isNew&&v.rotation===0&&v.id&&v.image_path){u.push({id:v.id,image_path:v.image_path,width:v.width,height:v.height,rotation:0,preview:v.preview,isUploaded:!0});continue}const{file:j,width:ee,height:te,isOriginal:ae}=await ie(v);if(ae&&!v.isNew){u.push({id:v.id,image_path:v.image_path,width:v.width,height:v.height,rotation:v.rotation||0,preview:v.preview,isUploaded:!0});continue}j&&m.push({file:j,width:ee,height:te,rotation:v.rotation||0,originalImage:v})}ge(),m.length>0?await Se(m,u):(_("update:modelValue",u),_("save",e.pointId))}catch(v){console.error("Error during image processing:",v),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{V.value=!1}},Se=async(o,u)=>{l.value=o.length,c.value=0,G.value=0;const m=[...u];let v=0;try{for(let j=0;j<o.length;j++){const ee=o[j],te=new FormData;te.append("inspection_id",e.inspectionId),te.append("point_id",e.pointId),te.append("images[]",ee.file);const ae=A.value.findIndex(J=>{var k;return J.preview===((k=ee.originalImage)==null?void 0:k.preview)});ae!==-1&&(A.value[ae].isUploading=!0,A.value[ae].isFailed=!1);try{const k=(await je.post(route("inspections.upload-image"),te,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:h=>{if(h.total){const ne=Math.round(h.loaded*100/h.total);G.value=Math.round((j+h.loaded/h.total)/o.length*100),c.value=j+1}}})).data.images;if(k&&k.length>0){const h=k[0];if(m.push({id:h.image_id,image_path:h.path,width:h.width||ee.width||0,height:h.height||ee.height||0,rotation:ee.rotation||0,preview:h.public_url,isUploaded:!0}),ae!==-1){const ne=A.value.splice(ae,1)[0];ne.preview&&ne.preview.startsWith("blob:")&&URL.revokeObjectURL(ne.preview)}v++}}catch(J){console.error(`Error uploading image ${j+1}:`,J),ae!==-1&&(A.value[ae].isUploading=!1,A.value[ae].isFailed=!0)}}v>0&&(_("update:modelValue",m),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:m,newImagesCount:v})),v===o.length&&xe(),console.log(`✅ Successfully uploaded ${v}/${o.length} images`)}catch(j){console.error("Error in upload process:",j),o.forEach(ee=>{const te=A.value.findIndex(ae=>{var J;return ae.preview===((J=ee.originalImage)==null?void 0:J.preview)});te!==-1&&(A.value[te].isUploading=!1,A.value[te].isFailed=!0)})}finally{G.value=0,c.value=0,l.value=0,V.value=!1}},ye=async o=>{if(!o||!o.file){console.error("No file to retry upload");return}V.value=!0;const u=[...e.modelValue];try{const m=new FormData;m.append("inspection_id",e.inspectionId),m.append("point_id",e.pointId),m.append("images[]",o.file);const v=A.value.findIndex(te=>te.preview===o.preview);v!==-1&&(A.value[v].isUploading=!0,A.value[v].isFailed=!1);const ee=(await je.post(route("inspections.upload-image"),m,{headers:{"Content-Type":"multipart/form-data"}})).data.images;if(ee&&ee.length>0){const te=ee[0];if(u.push({id:te.image_id,image_path:te.path,width:te.width||o.width||0,height:te.height||o.height||0,rotation:o.rotation||0,preview:te.public_url,isUploaded:!0}),v!==-1){const J=A.value.splice(v,1)[0];J.preview&&J.preview.startsWith("blob:")&&URL.revokeObjectURL(J.preview)}_("update:modelValue",u),_("save",e.pointId),_("uploaded",{pointId:e.pointId,images:u,newImagesCount:1}),A.value.some(J=>J.isFailed)||xe(),console.log("✅ Successfully retried upload for 1 image")}}catch(m){console.error("Error retrying upload:",m),previewIndex!==-1&&(A.value[previewIndex].isUploading=!1,A.value[previewIndex].isFailed=!0)}finally{V.value=!1}},we=o=>{if(o){if(o.id&&!o.isNew)me(o);else{const u=A.value.findIndex(m=>m.preview&&m.preview===o.preview&&m.isNew||m.id&&m.id===o.id);if(u!==-1){const m=A.value.splice(u,1)[0];m.preview&&m.preview.startsWith("blob:")&&URL.revokeObjectURL(m.preview)}_("update:modelValue",e.modelValue.filter(m=>!(m.id&&m.id===o.id)&&!(m.preview&&m.preview===o.preview)))}C.value>=d.value.length&&(C.value=Math.max(0,d.value.length-1)),d.value.length===0&&ge()}},me=async o=>{var m,v;if(o.id||o.image_path)try{await je.delete(route("inspections.delete-image"),{data:{image_id:o.id,image_path:o.image_path}})}catch(j){console.error("Error deleting image from server:",j),(v=(m=j.response)==null?void 0:m.data)!=null&&v.message?alert(`Failed to delete image from server: ${j.response.data.message}`):alert(`Failed to delete image from server: ${j.message}`);return}o.preview&&o.preview.startsWith("blob:")&&URL.revokeObjectURL(o.preview);const u=e.modelValue.filter(j=>j.id!==o.id);_("update:modelValue",u),A.value=A.value.filter(j=>j.isNew&&o.isNew?j.preview!==o.preview:j.id!==o.id),_("removeImage",{image:o}),y.value&&d.value.length===0?ge():y.value&&C.value>=d.value.length&&(C.value=Math.max(0,d.value.length-1))};return Me(()=>{try{localStorage.getItem(S)&&console.log("Found backup images, ready for recovery if needed")}catch(o){console.error("Error loading backup:",o)}}),(o,u)=>(n(),i("div",null,[t("input",{ref_key:"galleryInput",ref:r,type:"file",accept:Z.value,class:"hidden",onChange:q,multiple:F.value,disabled:V.value},null,40,tn),t("canvas",{ref_key:"processingCanvas",ref:I,class:"hidden"},null,512),t("p",an,"Foto Maksimal: "+L(a.settings.max_files)+" | Rasio: "+L(a.settings.camera_aspect_ratio),1),d.value.length===0?(n(),i("label",{key:0,onClick:M,class:oe(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:V.value},[t("div",nn,[u[3]||(u[3]=t("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),u[4]||(u[4]=t("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),t("p",on,"Tipe: "+L(Z.value),1)])],8,sn)):(n(),i("div",{key:1,class:oe(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":a.settings.max_files==1,"bg-transparent":a.settings.max_files>1}]),"aria-label":"Image gallery"},[a.settings.max_files===1?(n(),i("div",ln,[t("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:u[1]||(u[1]=m=>X(0))},[t("img",{src:x(d.value[0]),onError:u[0]||(u[0]=m=>s(d.value[0])),class:"w-full h-full object-cover"},null,40,rn),d.value[0].isUploading?(n(),i("div",un,u[5]||(u[5]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0)]),t("button",{onClick:u[2]||(u[2]=De(m=>me(d.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:V.value},u[6]||(u[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ie(" Hapus Foto ")]),8,dn)])):(n(),i("div",cn,[F.value&&d.value.length<a.settings.max_files?(n(),i("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:M,disabled:V.value},u[7]||(u[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,pn)):p("",!0),(n(!0),i(_e,null,$e(d.value,(m,v)=>(n(),i("div",{key:m.id||m.preview||v,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:j=>m.isFailed?ye(m):X(v)},[t("img",{src:x(m),onError:j=>s(m),class:"w-full h-full object-cover"},null,40,mn),m.isNew||m.rotation!==0?(n(),i("div",vn,[m.isNew?(n(),i("span",fn,"BARU")):p("",!0),m.rotation!==0?(n(),i("span",hn,"ROTASI")):p("",!0)])):p("",!0),m.isUploading?(n(),i("div",bn,u[8]||(u[8]=[t("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0),m.isFailed?(n(),i("div",yn,u[9]||(u[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("span",{class:"text-xs font-medium"},"Retry",-1)]))):p("",!0)],8,gn))),128))]))],2)),a.error?(n(),i("p",xn,L(a.error),1)):p("",!0),ke(ns,{show:f.value,settings:a.settings,onClose:pe,onOpenWebcam:ce,onTriggerGallery:Y},null,8,["show","settings"]),ke(en,{show:U.value,"aspect-ratio":D.value,settings:a.settings,point:a.point,"camera-quality":Ve(R),onClose:he,onPhotoCaptured:z},null,8,["show","aspect-ratio","settings","point","camera-quality"]),ke(Ps,{show:y.value,images:d.value,point:a.point,"initial-index":C.value,"allow-multiple":F.value,"max-files":a.settings.max_files,"is-uploading":V.value,"aspect-ratio":D.value,"upload-progress":G.value,"current-upload":c.value,"total-upload":l.value,onClose:ge,onSaveImages:be,onRemovePreviewImage:we,onTriggerAddMorePhotos:M,onRetryImage:ye},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},Oe=Te(wn,[["__scopeId","data-v-cd447cb4"]]),kn={key:0,class:"fixed inset-0 z-50 overflow-hidden"},In={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},_n={class:"px-4 pb-2 border-b border-gray-200"},$n={class:"text-lg font-semibold text-gray-900"},Sn={key:0,class:"text-sm text-gray-500 mt-1"},An={class:"flex-1 overflow-y-auto p-4"},Vn={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Cn={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},setup(a){return(Q,e)=>(n(),Ae(Le,{name:"bottom-sheet"},{default:Ce(()=>[a.show?(n(),i("div",kn,[e[1]||(e[1]=t("div",{class:"absolute inset-0 bg-black bg-opacity-50"},null,-1)),t("div",In,[e[0]||(e[0]=t("div",{class:"flex justify-center py-3"},[t("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),t("div",_n,[t("h3",$n,L(a.title),1),a.subtitle?(n(),i("p",Sn,L(a.subtitle),1)):p("",!0)]),t("div",An,[wt(Q.$slots,"default",{},void 0,!0)]),Q.$slots.footer?(n(),i("div",Vn,[wt(Q.$slots,"footer",{},void 0,!0)])):p("",!0)])])):p("",!0)]),_:3}))}},Tn=Te(Cn,[["__scopeId","data-v-fd942535"]]),Nn={class:"space-y-4"},Un={key:0,class:"mt-2"},En={key:1,class:"mt-2"},Mn={key:2,class:"mt-2"},Pn={key:3,class:"mt-2"},Dn={key:4,class:"mt-2"},Ln={class:"text-sm font-medium text-gray-700 mb-2"},Rn={key:0,class:"text-red-500"},jn={key:0,class:"text-xs text-red-500"},Bn=["type","name","value","checked","onChange"],Fn={key:6,class:"mt-4"},qn={class:"text-sm font-medium text-gray-700 mb-2"},On={key:0,class:"text-red-500"},Kn={key:0,class:"text-xs text-red-500"},Hn={key:7,class:"space-y-2"},zn={key:0,class:"text-red-500"},Gn={key:1,class:"text-xs text-red-500"},Wn={class:"flex gap-2"},Zn=["disabled"],Ct={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:[String,Array],notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(a,{emit:Q}){const e=a,_=Q,r=c=>_("hapus",c),I=se(()=>Array.isArray(e.selectedValue)?e.options.find(c=>e.selectedValue.includes(c.value)):e.options.find(c=>c.value===e.selectedValue)),f=se(()=>{if(Array.isArray(e.selectedValue))return e.options.filter(c=>e.selectedValue.includes(c.value));if(e.selectedValue){const c=typeof e.selectedValue=="string"?e.selectedValue.split(",").map(l=>l.trim()):[e.selectedValue];return e.options.filter(l=>c.includes(l.value))}return[]}),U=se(()=>{var c;if(Array.isArray(e.selectedValue))return f.value.some(l=>{var $;return l.multi&&(($=l.settings)==null?void 0:$.show_textarea)});{const l=e.options.find($=>$.value===e.selectedValue);return(c=l==null?void 0:l.settings)==null?void 0:c.show_textarea}}),y=se(()=>{var c;if(Array.isArray(e.selectedValue))return f.value.some(l=>{var $;return l.multi&&(($=l.settings)==null?void 0:$.show_image_upload)});{const l=e.options.find($=>$.value===e.selectedValue);return(c=l==null?void 0:l.settings)==null?void 0:c.show_image_upload}}),A=se(()=>{var c;if(Array.isArray(e.selectedValue)){const l=f.value.filter(F=>{var Z;return F.multi&&((Z=F.settings)==null?void 0:Z.show_textarea)});if(l.length===0)return null;const $={...l[0].settings},R=[];l.forEach(F=>{var Z;(Z=F.settings)!=null&&Z.damage_options&&R.push(...F.settings.damage_options)});const S=R.filter((F,Z,D)=>Z===D.findIndex(d=>d.value===F.value));return $.damage_options=S,{...l[0],settings:$}}else{const l=e.options.find($=>$.value===e.selectedValue);return(c=l==null?void 0:l.settings)!=null&&c.show_textarea?l:null}}),C=se(()=>{var c;if(Array.isArray(e.selectedValue))return f.value.find(l=>{var $;return l.multi&&(($=l.settings)==null?void 0:$.show_image_upload)});{const l=e.options.find($=>$.value===e.selectedValue);return(c=l==null?void 0:l.settings)!=null&&c.show_image_upload?l:null}});se(()=>f.value.find(c=>{var l;return c.multi&&((l=c.settings)==null?void 0:l.show_textarea)})),se(()=>f.value.find(c=>{var l;return c.multi&&((l=c.settings)==null?void 0:l.show_image_upload)}));const V=c=>Array.isArray(e.selectedValue)?e.selectedValue.includes(c.value):e.selectedValue?(typeof e.selectedValue=="string"?e.selectedValue.split(",").map($=>$.trim()):[e.selectedValue]).includes(c.value):!1,B=(c,l)=>{let $;if(c.multi){const R=Array.isArray(e.selectedValue)?e.selectedValue:[];l.target.checked?$=[...R,c.value]:$=R.filter(S=>S!==c.value)}else $=c.value;_("update:selectedValue",$)},G=se(()=>{var l,$,R,S,F,Z,D;if(e.point.input_type==="text"&&(!((l=e.notesValue)!=null&&l.trim())||e.point.settings.min_length&&e.notesValue.length<e.point.settings.min_length||e.point.settings.max_length&&e.notesValue.length>e.point.settings.max_length)||e.point.input_type==="number"&&(!(($=e.notesValue)!=null&&$.trim())||e.point.settings.min&&e.notesValue.length<e.point.settings.min||e.point.settings.max&&e.notesValue.length>e.point.settings.max)||e.point.input_type==="account"&&(!((R=e.notesValue)!=null&&R.trim())||e.point.settings.min_value&&e.notesValue.length<e.point.settings.min_value||e.point.settings.max_value&&e.notesValue.length>e.point.settings.max_value)||e.point.input_type==="date"&&(!((S=e.notesValue)!=null&&S.trim())||e.point.settings.min_date&&e.notesValue.length<e.point.settings.min_date||e.point.settings.max_date&&e.notesValue.length>e.point.settings.max_date))return!1;if(e.point.input_type==="imageTOradio"){if(e.imagesValue.length===0)return!1;const d=e.imagesValue.some(W=>W.status==="error"),H=e.imagesValue.some(W=>W.status==="uploading");if(d||H)return!1}if(e.options.length&&(!e.selectedValue||Array.isArray(e.selectedValue)&&e.selectedValue.length===0))return!1;const c=I.value;if(e.showTextarea&&((F=c==null?void 0:c.settings)!=null&&F.show_textarea)&&(!((Z=e.notesValue)!=null&&Z.trim())||c.settings.min_length&&e.notesValue.length<c.settings.min_length||c.settings.max_length&&e.notesValue.length>c.settings.max_length))return!1;if(e.showImageUpload&&((D=c==null?void 0:c.settings)!=null&&D.show_image_upload)){if(e.imagesValue.length===0||c.settings.max_files&&e.imagesValue.length>c.settings.max_files)return!1;const d=e.imagesValue.some(W=>W.status==="error"),H=e.imagesValue.some(W=>W.status==="uploading");if(d||H)return!1}return!0});return(c,l)=>(n(),Ae(Tn,{show:a.show,title:a.title,subtitle:a.subtitle,onClose:l[17]||(l[17]=$=>c.$emit("close"))},{footer:Ce(()=>[a.selectedPoint?(n(),i("button",{key:0,onClick:l[14]||(l[14]=$=>r(a.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},l[19]||(l[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),Ie(" Hapus Data ")]))):p("",!0),t("div",Wn,[t("button",{type:"button",onClick:l[15]||(l[15]=$=>c.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{type:"button",onClick:l[16]||(l[16]=$=>c.$emit("save")),disabled:!G.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Zn)])]),default:Ce(()=>{var $,R,S,F,Z,D,d,H,W,x,g,s,b,M,Y,ce,pe,he,ge,E,T,P,q,z,X,ie,le,xe,be,Se,ye,we,me,o,u,m;return[t("div",Nn,[a.point.input_type==="text"?(n(),i("div",Un,[ke(_t,{"model-value":a.notesValue,required:($=a.point.settings)==null?void 0:$.is_required,"min-length":(R=a.point.settings)==null?void 0:R.min_length,"max-length":(S=a.point.settings)==null?void 0:S.max_length,allowSpace:(F=a.point.settings)==null?void 0:F.allow_space,textTransform:(Z=a.point.settings)==null?void 0:Z.text_transform,placeholder:((D=a.point.settings)==null?void 0:D.placeholder)||"Masukan text",error:c.error,"onUpdate:modelValue":l[0]||(l[0]=v=>c.$emit("update:notesValue",v)),onSave:l[1]||(l[1]=v=>c.$emit("saveText",v))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):p("",!0),a.point.input_type==="number"?(n(),i("div",En,[ke($t,{"model-value":a.notesValue,required:(d=a.point.settings)==null?void 0:d.is_required,min:(H=a.point.settings)==null?void 0:H.min,max:(W=a.point.settings)==null?void 0:W.max,step:((x=a.point.settings)==null?void 0:x.step)||1,placeholder:((g=a.point.settings)==null?void 0:g.placeholder)||"Masukan number",error:c.error,"onUpdate:modelValue":l[2]||(l[2]=v=>c.$emit("update:notesValue",v)),onSave:l[3]||(l[3]=v=>c.$emit("saveNumber",v))},null,8,["model-value","required","min","max","step","placeholder","error"])])):p("",!0),a.point.input_type==="account"?(n(),i("div",Mn,[ke(At,{"model-value":a.notesValue,required:(s=a.point.settings)==null?void 0:s.is_required,placeholder:((b=a.point.settings)==null?void 0:b.placeholder)||"Masukkan nilai",error:c.error,"point-id":a.pointId,settings:a.point.settings,"onUpdate:modelValue":l[4]||(l[4]=v=>c.$emit("update:notesValue",v)),onSave:l[5]||(l[5]=v=>c.$emit("saveAccount",v))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):p("",!0),a.point.input_type==="date"?(n(),i("div",Pn,[ke(St,{"model-value":a.notesValue,required:(M=a.point.settings)==null?void 0:M.is_required,"min-date":(Y=a.point.settings)==null?void 0:Y.min_date,"max-date":(ce=a.point.settings)==null?void 0:ce.max_date,error:c.error,"onUpdate:modelValue":l[6]||(l[6]=v=>c.$emit("update:notesValue",v)),onSave:l[7]||(l[7]=v=>c.$emit("saveDate",v))},null,8,["model-value","required","min-date","max-date","error"])])):p("",!0),a.point.input_type==="imageTOradio"?(n(),i("div",Dn,[t("h4",Ln,[(pe=a.point.settings)!=null&&pe.required?(n(),i("span",Rn,"*")):p("",!0)]),ke(Oe,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point.inspection_point,"inspection-id":a.inspectionId,settings:a.point.settings,"onUpdate:modelValue":l[8]||(l[8]=v=>c.$emit("update:imagesValue",v)),onSave:l[9]||(l[9]=v=>c.$emit("saveImage",v))},null,8,["model-value","point-id","point","inspection-id","settings"]),(he=a.point.settings)!=null&&he.required&&a.imagesValue.length===0?(n(),i("p",jn," Foto wajib diupload ")):p("",!0)])):p("",!0),a.options.length?(n(),i("div",{key:5,class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(_e,null,$e(a.options,(v,j)=>(n(),i("label",{key:j,class:"cursor-pointer"},[t("input",{type:v.multi?"checkbox":"radio",name:v.multi?`checkbox-${a.name}`:a.name,value:v.value,checked:V(v),onChange:ee=>B(v,ee),class:"hidden peer"},null,40,Bn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":V(v),"border-gray-300 text-gray-700 hover:bg-gray-50":!V(v)}])},L(v.label),3)]))),128))],2)):p("",!0),y.value?(n(),i("div",Fn,[t("h4",qn,[l[18]||(l[18]=Ie(" Upload Foto ")),(E=(ge=C.value)==null?void 0:ge.settings)!=null&&E.required?(n(),i("span",On,"*")):p("",!0)]),ke(Oe,{"model-value":a.imagesValue,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,settings:(T=C.value)==null?void 0:T.settings,"onUpdate:modelValue":l[10]||(l[10]=v=>c.$emit("update:imagesValue",v)),onSave:l[11]||(l[11]=v=>c.$emit("saveImage",v))},null,8,["model-value","point-id","point","inspection-id","settings"]),(q=(P=C.value)==null?void 0:P.settings)!=null&&q.required&&a.imagesValue.length===0?(n(),i("p",Kn," Foto wajib diupload ")):p("",!0)])):p("",!0),U.value?(n(),i("div",Hn,[(X=(z=A.value)==null?void 0:z.settings)!=null&&X.required?(n(),i("span",zn,"*")):p("",!0),ke(Vt,{"model-value":a.notesValue,"point-id":a.pointId,"inspection-id":a.inspectionId,settings:(ie=A.value)==null?void 0:ie.settings,required:(xe=(le=A.value)==null?void 0:le.settings)==null?void 0:xe.required,"min-length":(Se=(be=A.value)==null?void 0:be.settings)==null?void 0:Se.min_length,"max-length":(we=(ye=A.value)==null?void 0:ye.settings)==null?void 0:we.max_length,placeholder:((o=(me=A.value)==null?void 0:me.settings)==null?void 0:o.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":l[12]||(l[12]=v=>c.$emit("update:notesValue",v)),onSave:l[13]||(l[13]=v=>c.$emit("saveTextarea",v))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(m=(u=A.value)==null?void 0:u.settings)!=null&&m.required&&!a.notesValue?(n(),i("p",Gn," Keterangan wajib diisi ")):p("",!0)])):p("",!0)])]}),_:1},8,["show","title","subtitle"]))}},Jn={class:"mt-2 space-y-2"},Qn=["type","name","value","checked","onChange","required"],Yn={key:0,class:"p-2 rounded-lg bg-gray-50"},Xn={key:0,class:"mt-2"},eo={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},to=["src"],ao={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},so={key:1,class:"mt-2"},no={class:"text-sm text-gray-600"},oo={key:2,class:"mt-2 text-sm text-red-600"},io={__name:"InputRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:Q}){const e=a,_=Q,r=N(e.notes),I=N([...e.images]),f=N(!1),U=N(""),y=N([]),A=N(""),C=N([]);se(()=>e.options.find(d=>d.value===e.modelValue));const V=se(()=>Array.isArray(e.modelValue)?e.options.filter(d=>e.modelValue.includes(d.value)):e.modelValue?[e.options.find(d=>d.value===e.modelValue)].filter(Boolean):[]),B=d=>Array.isArray(e.modelValue)?e.modelValue.includes(d.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(W=>W.trim()):[e.modelValue]).includes(d.value):!1,G=d=>d.settings&&(d.settings.show_textarea||d.settings.show_image_upload);de(()=>e.notes,d=>{r.value=d}),de(()=>e.images,d=>{I.value=[...d]}),de(()=>e.modelValue,d=>{d?A.value=Array.isArray(d)?[...d]:d:A.value=""});const c=(d,H)=>{let W;if(d.multi){const x=Array.isArray(e.modelValue)?e.modelValue:[];H.target.checked?W=[...x,d.value]:W=x.filter(g=>g!==d.value)}else W=d.value;_("update:modelValue",W),G(d)?$():_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:W,notes:"",images:[]})},l=d=>d.preview||(d.image_path?`/${d.image_path}`:d),$=()=>{A.value=e.modelValue,U.value=r.value,y.value=[...I.value],C.value=[...I.value],f.value=!0},R=()=>{U.value="",y.value=[],A.value=Array.isArray(e.modelValue)?[...e.modelValue]:e.modelValue,f.value=!1},S=d=>{y.value=d,I.value=[...d],_("update:images",[...d]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...d]})},F=d=>{},Z=()=>{A.value!==e.modelValue&&_("update:modelValue",A.value),r.value=U.value,_("update:notes",U.value),I.value=[...y.value],_("update:images",[...y.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:A.value,notes:U.value,images:y.value}),f.value=!1},D=d=>{A.value="",U.value="",y.value=[],r.value="",I.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",d),f.value=!1};return(d,H)=>{var W;return n(),i("div",Jn,[t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(_e,null,$e(a.options,(x,g)=>(n(),i("label",{key:g,class:"cursor-pointer"},[t("input",{type:x.multi?"checkbox":"radio",name:x.multi?`checkbox-${a.pointId}`:"radio-"+a.pointId,value:x.value,checked:B(x),onChange:s=>c(x,s),class:"hidden peer",required:a.required&&!x.multi},null,40,Qn),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":B(x),"border-gray-300 text-gray-700 hover:bg-gray-50":!B(x)}])},L(x.label),3)]))),128))],2),a.modelValue&&V.value.length>0&&V.value.some(x=>G(x))?(n(),i("div",Yn,[t("div",{class:"flex justify-between items-start"},[H[4]||(H[4]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),t("button",{onClick:$,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),a.images.length>0&&V.value.some(x=>{var g;return(g=x.settings)==null?void 0:g.show_image_upload})?(n(),i("div",Xn,[t("div",eo,[(n(!0),i(_e,null,$e(a.images,(x,g)=>(n(),i("div",{key:g,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:l(x),class:"w-full h-full object-cover rounded"},null,8,to),g===3&&a.images.length>4?(n(),i("span",ao," +"+L(a.images.length-4),1)):p("",!0)]))),128))])])):p("",!0),a.notes&&V.value.some(x=>{var g;return(g=x.settings)==null?void 0:g.show_textarea})?(n(),i("div",so,[t("p",no,L(a.notes),1)])):p("",!0)])):p("",!0),f.value?(n(),Ae(Ct,{key:(W=a.selectedPoint)==null?void 0:W.id,show:f.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":A.value,"notes-value":U.value,"images-value":y.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":H[0]||(H[0]=x=>A.value=x),"onUpdate:notesValue":H[1]||(H[1]=x=>U.value=x),"onUpdate:imagesValue":H[2]||(H[2]=x=>S(x)),onClose:R,onSave:Z,onSaveTextarea:d.handleTextareaSave,onSaveImage:F,onHapus:H[3]||(H[3]=x=>D(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):p("",!0),a.error?(n(),i("p",oo,L(a.error),1)):p("",!0)])}}},lo={class:"mt-2 space-y-2"},ro={key:0,class:"flex flex-wrap gap-3"},uo={key:1,class:"p-2"},co={key:0,class:"mt-2"},po={class:"flex gap-2 overflow-x-auto scrollbar-hide"},go=["src"],mo={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},vo=["type","name","value","checked"],fo={key:1,class:"mt-2"},ho={class:"text-sm text-gray-600"},bo={key:3,class:"mt-2 text-sm text-red-600"},yo={__name:"InputImageToRadio",props:{modelValue:[String,Array],required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,subtitle:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(a,{emit:Q}){const e=a,_=Q,r=N(e.notes),I=N([...e.images]),f=N(!1),U=N(""),y=N([]),A=N(""),C=N([]),V=se(()=>{if(Array.isArray(e.modelValue))return e.options.find(D=>e.modelValue.includes(D.value));if(e.modelValue){const D=typeof e.modelValue=="string"?e.modelValue.split(",").map(d=>d.trim()):[e.modelValue];return e.options.find(d=>D.includes(d.value))}return null}),B=se(()=>{if(Array.isArray(e.modelValue))return e.options.filter(D=>e.modelValue.includes(D.value));if(e.modelValue){const D=typeof e.modelValue=="string"?e.modelValue.split(",").map(d=>d.trim()):[e.modelValue];return e.options.filter(d=>D.includes(d.value))}return[]}),G=se(()=>B.value.some(D=>{var d;return D.multi&&((d=D.settings)==null?void 0:d.show_textarea)}));se(()=>B.value.find(D=>{var d;return D.multi&&((d=D.settings)==null?void 0:d.show_textarea)}));const c=D=>Array.isArray(e.modelValue)?e.modelValue.includes(D.value):e.modelValue?(typeof e.modelValue=="string"?e.modelValue.split(",").map(H=>H.trim()):[e.modelValue]).includes(D.value):!1,l=D=>D.preview||(D.image_path?`/${D.image_path}`:D);de(()=>e.notes,D=>{r.value=D});const $=()=>{A.value=e.modelValue||"",U.value=r.value,y.value=[...I.value],C.value=[...I.value],f.value=!0},R=()=>{U.value="",y.value=[],A.value="",f.value=!1},S=D=>{y.value=D,I.value=[...D],_("update:images",[...D]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:e.modelValue,notes:r.value,images:[...D]})},F=()=>{A.value!==e.modelValue&&_("update:modelValue",A.value),r.value=U.value,_("update:notes",U.value),I.value=[...y.value],_("update:images",[...y.value]),_("save",{pointId:e.pointId,inspectionId:e.inspectionId,value:A.value,notes:U.value,images:y.value}),f.value=!1},Z=D=>{A.value="",U.value="",y.value=[],r.value="",I.value=[],_("update:modelValue",""),_("update:notes",""),_("update:images",[]),_("hapus",D),f.value=!1};return(D,d)=>{var H,W,x;return n(),i("div",lo,[!a.modelValue&&I.value.length===0&&!r.value?(n(),i("div",ro,[t("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:$},d[4]||(d[4]=[t("div",{class:"flex flex-col items-center text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),t("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(n(),i("div",uo,[t("div",{class:"flex justify-between items-start"},[d[5]||(d[5]=t("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),t("button",{onClick:$,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),I.value.length>0?(n(),i("div",co,[t("div",po,[(n(!0),i(_e,null,$e(I.value,(g,s)=>(n(),i("div",{key:s,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[t("img",{src:l(g),class:"w-full h-full object-cover rounded"},null,8,go),s===3&&I.value.length>4?(n(),i("span",mo," +"+L(I.value.length-4),1)):p("",!0)]))),128))])])):p("",!0),t("div",{class:oe(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(a.options.length,3)}`])},[(n(!0),i(_e,null,$e(a.options,(g,s)=>(n(),i("label",{key:s,class:"cursor-pointer"},[t("input",{type:g.multi?"checkbox":"radio",name:g.multi?`checkbox-${a.pointId}`:`radio-${a.pointId}`,value:g.value,checked:c(g),disabled:!0,class:"hidden peer"},null,8,vo),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":c(g),"border-gray-300 text-gray-700 hover:bg-gray-50":!c(g)}])},L(g.label),3)]))),128))],2),r.value&&((W=(H=V.value)==null?void 0:H.settings)!=null&&W.show_textarea||G.value)?(n(),i("div",fo,[t("p",ho,L(r.value),1)])):p("",!0)])),f.value?(n(),Ae(Ct,{key:(x=a.selectedPoint)==null?void 0:x.id,show:f.value,title:a.pointName||"Detail",subtitle:a.subtitle||"",name:"modal-radio-"+a.pointId,options:a.options,"selected-value":A.value,"notes-value":U.value,"images-value":y.value,"point-id":a.pointId,point:a.point,"inspection-id":a.inspectionId,"selected-point":a.selectedPoint,"onUpdate:selectedValue":d[0]||(d[0]=g=>A.value=g),"onUpdate:notesValue":d[1]||(d[1]=g=>U.value=g),"onUpdate:imagesValue":d[2]||(d[2]=g=>S(g)),onClose:R,onSave:F,onHapus:d[3]||(d[3]=g=>Z(a.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):p("",!0),a.error?(n(),i("p",bo,L(a.error),1)):p("",!0)])}}},xo={class:"text-base font-semibold text-indigo-700"},wo={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ko={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Io={class:"text-base font-semibold text-indigo-700"},_o={class:"p-4 space-y-4"},$o={key:0,class:"flex justify-end py-1"},So=["onClick"],Ao={key:1,class:"space-y-2"},Vo={class:"flex items-start justify-between"},Co={class:"flex-1"},To={class:"block text-sm font-medium text-gray-900"},No={class:"font-bold"},Uo={key:0,class:"text-red-500"},Eo={key:1,class:"italic text-xs text-gray-400 ml-2"},Mo={key:0,class:"mt-1"},Po={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800"},Do={key:0},Lo={key:1},Ro={key:2},jo={key:3},Bo={key:4},Fo={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},qo={key:9,class:"p-3 bg-gray-100 rounded text-sm text-gray-600"},Oo={class:"text-xs mt-1 list-disc list-inside"},Ko={key:0},Ho={key:1},zo={key:2},Go={key:3},Wo={key:4},Zo={key:0,class:"text-center py-8 text-gray-500"},Jo={key:0,class:"text-xs text-gray-400"},Qo={__name:"CategorySection",props:{category:Object,form:Object,head:Object,inspectionId:String,selectedPoint:Object,car:Object},emits:["updateResult","removeImage","hapusPoint"],setup(a,{emit:Q}){const e=a,_=Q,r=qe("vehicleFeatures",N(null));r.value=JSON.parse(localStorage.getItem("vehicle_features")||"{}"),Ut("vehicleFeatures",r);const I=N(!1),f=N([]),U=N(!0),y=N(null),A=Et(),C={MT:"Manual Transmission (MT)",AT:"Automatic Transmission (AT)",CVT:"Continuously Variable Transmission (CVT)","e-CVT":"Electronic CVT (e-CVT)",DCT:"Dual Clutch Transmission (DCT)",AMT:"Automated Manual Transmission (AMT)",IVT:"Intelligent Variable Transmission (IVT)",SSG:"Seamless Shift Gearbox (SSG)",AGS:"Auto Gear Shift (AGS)",DHT:"Dedicated Hybrid Transmission (DHT)"};Me(()=>{const x=new IntersectionObserver(([g])=>{U.value=g.isIntersecting},{threshold:.1});y.value&&x.observe(y.value),Re(()=>{y.value&&x.unobserve(y.value)})});const V=()=>{I.value=!I.value,I.value||(f.value=[])},B=se(()=>(e.category.points||[]).some(x=>x.is_default===!1)),G=x=>!x||!Array.isArray(x)?[]:x.map(g=>C[g]||g),c=x=>{var M,Y;const g=x.settings;if(!l(x))return!0;const s=(M=e.car)==null?void 0:M.transmission,b=(Y=e.car)==null?void 0:Y.fuel_type;return!(g.transmission&&Array.isArray(g.transmission)&&g.transmission.length>0&&s&&!g.transmission.includes(s)||g.fuel_type&&g.fuel_type.trim()!==""&&b&&g.fuel_type!==b||g.rear_door&&(!r.value||!r.value.rear_door)||g.pick_up&&(!r.value||!r.value.pick_up)||g.box&&(!r.value||!r.value.box))},l=x=>{const g=x.settings;return!!(g!=null&&g.transmission&&Array.isArray(g.transmission)&&g.transmission.length>0||g!=null&&g.fuel_type&&g.fuel_type.trim()!==""||g!=null&&g.rear_door||g!=null&&g.pick_up||g!=null&&g.box)},$=x=>l(x)&&(I.value||c(x)),R=se(()=>{const x=e.category.points||[],g=[];let s=[];return I.value?e.category.isDamageMenu?x.filter(b=>{var M;return b.is_default||F((M=b.inspection_point)==null?void 0:M.id)||I.value}):x:e.category.isDamageMenu?x.filter(b=>{var Y;const M=(Y=b.inspection_point)==null?void 0:Y.id;return F(M)||b.is_default||f.value.includes(M)}):(x.forEach(b=>{var E;const M=(E=b.inspection_point)==null?void 0:E.id,Y=F(M),ce=f.value.includes(M),he=!l(b)||c(b);(b.is_default||Y||ce)&&he?(s.length>0&&(g.push({is_link:!0,count:s.length,hiddenIds:s.map(T=>T.inspection_point.id)}),s.forEach(T=>{f.value.includes(T.inspection_point.id)&&g.push(T)}),s=[]),g.push(b)):(!l(b)||c(b))&&s.push(b)}),s.length>0&&(g.push({is_link:!0,count:s.length,hiddenIds:s.map(b=>b.inspection_point.id)}),s.forEach(b=>{f.value.includes(b.inspection_point.id)&&g.push(b)})),g.filter(b=>{var M,Y;return b.is_link||b.is_default||F((M=b.inspection_point)==null?void 0:M.id)||f.value.includes((Y=b.inspection_point)==null?void 0:Y.id)}))});se(()=>R.value.filter(x=>!x.is_link));const S=x=>{I.value=!1,x.forEach(g=>{f.value.includes(g)||f.value.push(g)})},F=x=>{if(!x)return!1;const g=A.props.existingResults[x]!==void 0,s=A.props.existingImages[x]&&A.props.existingImages[x].length>0,b=e.form.results[x]&&(e.form.results[x].status||e.form.results[x].note),M=e.form.images[x]&&e.form.images[x].length>0;return g||s||b||M},Z=[{value:"good",label:"Good"},{value:"bad",label:"Bad"},{value:"na",label:"N/A"}],D=x=>{var b,M,Y,ce,pe,he,ge,E,T;const g=e.form.results[(b=x.inspection_point)==null?void 0:b.id],s=e.form.images[(M=x.inspection_point)==null?void 0:M.id];if(!g)return!1;switch(x.input_type){case"text":case"number":case"date":case"account":case"textarea":return!!g.note;case"select":case"radio":if(!g.status)return!1;const P=(ce=(Y=x.settings)==null?void 0:Y.radios)==null?void 0:ce.find(z=>z.value===g.status);return!(P!=null&&P.settings&&(P.settings.show_textarea&&!((pe=g.note)!=null&&pe.trim())||P.settings.show_image_upload&&(s==null?void 0:s.length)===0));case"imageTOradio":if((s==null?void 0:s.length)===0||!g.status)return!1;const q=(ge=(he=x.settings)==null?void 0:he.radios)==null?void 0:ge.find(z=>z.value===g.status);return!(q!=null&&q.settings&&q.settings.show_textarea&&!((E=g.note)!=null&&E.trim()));case"image":return(s==null?void 0:s.length)>0;default:return!!g.status||!!((T=g.note)!=null&&T.trim())}},d=(x,g,s)=>{_("updateResult",{pointId:x,type:s,value:g})},H=x=>{console.log("Save result for point:",x)},W=x=>{_("hapusPoint",x)};return de(()=>e.form.results,x=>{},{deep:!0}),de(()=>e.form.images,x=>{},{deep:!0}),de(()=>e.car,x=>{console.log("Car data updated:",x)},{deep:!0}),de(r,x=>{console.log("Vehicle features updated:",x)},{deep:!0}),(x,g)=>(n(),i(_e,null,[e.head==="vertical"?(n(),i("div",{key:0,class:oe(["px-6 py-2 border-b flex items-center justify-between bg-indigo-200","fixed top-0 left-0 right-0 z-20"])},[t("h4",xo,L(a.category.name),1),B.value?(n(),i("button",{key:0,onClick:V,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},L(I.value?"Sembunyikan Semua":"Tampilkan Point Lain"),1)):p("",!0)])):p("",!0),t("div",{class:oe(["bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100",e.head==="vertical"?"pt-6":""])},[!U.value&&B.value?(n(),i("button",{key:0,onClick:V,class:"fixed top-3 right-2 z-10 bg-indigo-600 text-white p-2 rounded-full shadow-lg"},[I.value?(n(),i("svg",wo,g[0]||(g[0]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):(n(),i("svg",ko,g[1]||(g[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.006-3.362M9.88 9.88a3 3 0 104.24 4.24M6.1 6.1l11.8 11.8"},null,-1)])))])):p("",!0),e.head==="horizontal"?(n(),i("div",{key:1,ref_key:"categoryHeader",ref:y,class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",Io,L(a.category.name),1),B.value?(n(),i("button",{key:0,onClick:V,class:"text-sm text-indigo-700 hover:underline focus:outline-none"},L(I.value?"Sembunyikan":"Tampilkan Point Lain"),1)):p("",!0)],512)):p("",!0),t("div",_o,[(n(!0),i(_e,null,$e(R.value,(s,b)=>{var M,Y,ce,pe,he,ge,E,T,P,q,z,X,ie,le,xe,be,Se,ye,we,me,o,u,m,v,j,ee,te,ae,J,k,h,ne,K,re,ue,ve,fe,Ue,Ke,He,ze,Ge,We,Ze,Je,Qe,Ye,Xe,et,tt,at,st,nt,ot,it,lt,rt,ut,dt,ct,pt,gt,mt,vt,ft,ht,bt,yt,xt;return n(),i("div",{key:b,class:oe(["space-y-2 last:border-0 last:pb-0",s.is_link?"pb-0":"pb-2 border-b border-gray-100"])},[s.is_link?(n(),i("div",$o,[t("button",{onClick:O=>S(s.hiddenIds),class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none"}," Tampilkan "+L(s.count)+" Point Tersembunyi ",9,So)])):(n(),i("div",Ao,[t("div",Vo,[t("div",Co,[t("label",To,[t("span",No,L((M=s.inspection_point)==null?void 0:M.name),1),(Y=s.settings)!=null&&Y.is_required?(n(),i("span",Uo,"*")):p("",!0),!s.is_default&&!F((ce=s.inspection_point)==null?void 0:ce.id)?(n(),i("span",Eo," (opsional) ")):p("",!0)]),$(s)?(n(),i("div",Mo,[l(s)?(n(),i("div",Po,[(pe=s.settings)!=null&&pe.transmission?(n(),i("div",Do,L(s.settings.transmission.join(", ")),1)):p("",!0),(he=s.settings)!=null&&he.fuel_type?(n(),i("div",Lo,L(s.settings.fuel_type),1)):p("",!0),(ge=s.settings)!=null&&ge.rear_door?(n(),i("div",Ro," Pintu Belakang ")):p("",!0),(E=s.settings)!=null&&E.pick_up?(n(),i("div",jo," Tipe Pick Up ")):p("",!0),(T=s.settings)!=null&&T.box?(n(),i("div",Bo," Memiliki Box ")):p("",!0)])):p("",!0)])):p("",!0)]),D(s)?(n(),i("span",Fo," ✓ ")):p("",!0)]),s.input_type==="text"&&c(s)?(n(),Ae(_t,{key:0,modelValue:a.form.results[(P=s.inspection_point)==null?void 0:P.id].note,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"note")}],required:(q=s.settings)==null?void 0:q.is_required,"min-length":(z=s.settings)==null?void 0:z.min_length,"max-length":(X=s.settings)==null?void 0:X.max_length,allowSpace:(ie=s.settings)==null?void 0:ie.allow_space,textTransform:(le=s.settings)==null?void 0:le.text_transform,placeholder:((xe=s.settings)==null?void 0:xe.placeholder)||"Masukan text",error:a.form.errors[`results.${(be=s.inspection_point)==null?void 0:be.id}.note`],onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","allowSpace","textTransform","placeholder","error","onSave"])):p("",!0),s.input_type==="number"&&c(s)?(n(),Ae($t,{key:1,modelValue:a.form.results[(Se=s.inspection_point)==null?void 0:Se.id].note,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"note")}],required:(ye=s.settings)==null?void 0:ye.is_required,min:(we=s.settings)==null?void 0:we.min,max:(me=s.settings)==null?void 0:me.max,step:((o=s.settings)==null?void 0:o.step)||1,placeholder:((u=s.settings)==null?void 0:u.placeholder)||"Masukan number",error:a.form.errors[`results.${(m=s.inspection_point)==null?void 0:m.id}.note`],onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","min","max","step","placeholder","error","onSave"])):p("",!0),s.input_type==="account"&&c(s)?(n(),Ae(At,{key:2,modelValue:a.form.results[(v=s.inspection_point)==null?void 0:v.id].note,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"note")}],required:(j=s.settings)==null?void 0:j.is_required,placeholder:((ee=s.settings)==null?void 0:ee.placeholder)||"Masukkan nilai",error:a.form.errors[`results.${(te=s.inspection_point)==null?void 0:te.id}.note`],"point-id":(ae=s.inspection_point)==null?void 0:ae.id,settings:s.settings,onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","placeholder","error","point-id","settings","onSave"])):p("",!0),s.input_type==="date"&&c(s)?(n(),Ae(St,{key:3,modelValue:a.form.results[(J=s.inspection_point)==null?void 0:J.id].note,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"note")}],required:(k=s.settings)==null?void 0:k.is_required,"min-date":(h=s.settings)==null?void 0:h.min_date,"max-date":(ne=s.settings)==null?void 0:ne.max_date,error:a.form.errors[`results.${(K=s.inspection_point)==null?void 0:K.id}.note`],onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-date","max-date","error","onSave"])):p("",!0),s.input_type==="textarea"&&c(s)?(n(),Ae(Vt,{key:4,modelValue:a.form.results[(re=s.inspection_point)==null?void 0:re.id].note,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"note")}],required:(ue=s.settings)==null?void 0:ue.is_required,"min-length":(ve=s.settings)==null?void 0:ve.min_length,"max-length":(fe=s.settings)==null?void 0:fe.max_length,placeholder:((Ue=s.settings)==null?void 0:Ue.placeholder)||"Masukkan teks di sini",settings:s.settings,error:a.form.errors[`results.${(Ke=s.inspection_point)==null?void 0:Ke.id}.note`],onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","min-length","max-length","placeholder","settings","error","onSave"])):p("",!0),s.input_type==="radio"&&c(s)?(n(),Ae(io,{key:5,modelValue:a.form.results[(He=s.inspection_point)==null?void 0:He.id].status,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].status=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"status")}],notes:a.form.results[(ze=s.inspection_point)==null?void 0:ze.id].note,images:a.form.images[(Ge=s.inspection_point)==null?void 0:Ge.id],required:(We=s.settings)==null?void 0:We.is_required,"point-id":(Ze=s.inspection_point)==null?void 0:Ze.id,point:s.inspection_point,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(Je=s.inspection_point)==null?void 0:Je.name,subtitle:(Qe=s.inspection_point)==null?void 0:Qe.description,"selected-point":s.inspection_point??null,options:((Ye=s.settings)==null?void 0:Ye.radios)||Z,error:a.form.errors[`results.${(Xe=s.inspection_point)==null?void 0:Xe.id}.status`],"onUpdate:notes":O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},"onUpdate:images":O=>{var w;return a.form.images[(w=s.inspection_point)==null?void 0:w.id]=O},onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)},onHapus:O=>{var w;return W((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","point","inspection-id","settings","point-name","subtitle","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):p("",!0),s.input_type==="imageTOradio"&&c(s)?(n(),Ae(yo,{key:6,modelValue:a.form.results[(et=s.inspection_point)==null?void 0:et.id].status,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].status=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"status")}],notes:a.form.results[(tt=s.inspection_point)==null?void 0:tt.id].note,images:a.form.images[(at=s.inspection_point)==null?void 0:at.id],required:(st=s.settings)==null?void 0:st.is_required,"point-id":(nt=s.inspection_point)==null?void 0:nt.id,"inspection-id":a.inspectionId,settings:s.settings,"point-name":(ot=s.inspection_point)==null?void 0:ot.name,subtitle:(it=s.inspection_point)==null?void 0:it.description,point:s,"selected-point":s.inspection_point??null,options:((lt=s.settings)==null?void 0:lt.radios)||Z,error:a.form.errors[`results.${(rt=s.inspection_point)==null?void 0:rt.id}.status`],"onUpdate:notes":O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},"onUpdate:images":O=>{var w;return a.form.images[(w=s.inspection_point)==null?void 0:w.id]=O},onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)},onHapus:O=>{var w;return W((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","notes","images","required","point-id","inspection-id","settings","point-name","subtitle","point","selected-point","options","error","onUpdate:notes","onUpdate:images","onSave","onHapus"])):p("",!0),s.input_type==="image"&&c(s)?(n(),Ae(Oe,{key:7,modelValue:a.form.images[(ut=s.inspection_point)==null?void 0:ut.id],"onUpdate:modelValue":O=>{var w;return a.form.images[(w=s.inspection_point)==null?void 0:w.id]=O},error:a.form.errors[`images.${(dt=s.inspection_point)==null?void 0:dt.id}`],"inspection-id":a.inspectionId,"point-id":(ct=s.inspection_point)==null?void 0:ct.id,point:s.inspection_point,"point-name":(pt=s.inspection_point)==null?void 0:pt.name,settings:s.settings,"onUpdate:notes":O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].note=O},"onUpdate:status":O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].status=O}},null,8,["modelValue","onUpdate:modelValue","error","inspection-id","point-id","point","point-name","settings","onUpdate:notes","onUpdate:status"])):p("",!0),s.input_type==="select"&&c(s)?(n(),Ae(Ya,{key:8,modelValue:a.form.results[(gt=s.inspection_point)==null?void 0:gt.id].status,"onUpdate:modelValue":[O=>{var w;return a.form.results[(w=s.inspection_point)==null?void 0:w.id].status=O},O=>{var w;return d((w=s.inspection_point)==null?void 0:w.id,O,"status")}],required:(mt=s.settings)==null?void 0:mt.is_required,error:a.form.errors[`results.${(vt=s.inspection_point)==null?void 0:vt.id}.status`],onSave:O=>{var w;return H((w=s.inspection_point)==null?void 0:w.id)}},null,8,["modelValue","onUpdate:modelValue","required","error","onSave"])):p("",!0),!c(s)&&l(s)?(n(),i("div",qo,[g[2]||(g[2]=t("p",{class:"font-medium"},"Tidak tersedia untuk kendaraan ini",-1)),g[3]||(g[3]=t("p",{class:"text-xs mt-1"},"Point ini hanya tersedia untuk:",-1)),t("ul",Oo,[(ft=s.settings)!=null&&ft.transmission?(n(),i("li",Ko," Transmisi: "+L(G(s.settings.transmission).join(", ")),1)):p("",!0),(ht=s.settings)!=null&&ht.fuel_type?(n(),i("li",Ho," Bahan bakar: "+L(s.settings.fuel_type),1)):p("",!0),(bt=s.settings)!=null&&bt.rear_door?(n(),i("li",zo,"Kendaraan dengan pintu belakang")):p("",!0),(yt=s.settings)!=null&&yt.pick_up?(n(),i("li",Go,"Tipe pick up")):p("",!0),(xt=s.settings)!=null&&xt.box?(n(),i("li",Wo,"Kendaraan dengan box")):p("",!0)])])):p("",!0)]))],2)}),128)),R.value.filter(s=>!s.is_link).length===0?(n(),i("div",Zo,[g[4]||(g[4]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),g[5]||(g[5]=t("p",{class:"mt-2 text-sm"},"Tidak ada data untuk ditampilkan",-1)),a.category.isDamageMenu?(n(),i("p",Jo,' Tambahkan data melalui tombol "+" di pojok kanan bawah ')):p("",!0)])):p("",!0)])],2)],64))}},Vi=Te(Qo,[["__scopeId","data-v-704b9892"]]),Yo={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Xo={class:"p-4 space-y-4-6"},ei={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ti=["value"],ai={class:"p-4 space-y-4-6"},si={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ni=["value"],oi={key:0,class:"p-4 space-y-4 bg-blue-50 rounded-lg border border-blue-200"},ii={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},li=["value"],ri={class:"p-4 space-y-2"},ui={class:"flex items-center justify-between mb-2"},di={key:0,class:"mb-4 p-4 bg-white border border-gray-200 rounded-lg shadow-lg"},ci={class:"flex items-center justify-between mb-3"},pi={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},gi=["onClick"],mi={class:"text-sm font-medium text-gray-800 mb-1"},vi={class:"text-xs text-gray-600 line-clamp-2"},fi={class:"flex flex-wrap gap-1 mb-2 p-2 bg-gray-100 rounded-md"},hi={key:0,class:"text-xs text-gray-500 mb-2 bg-gray-50 p-2 rounded border"},bi={key:0,class:"font-bold mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},yi={key:1,class:"italic mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},xi={key:2,class:"underline mx-1 bg-indigo-100 text-indigo-700 px-2 py-1 rounded"},wi={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0},form:{type:Object,required:!0}},emits:["updateConclusion"],setup(a,{emit:Q}){const e=a,_=Q,r=N(null),I=N(!1),f=N(!1),U=kt({bold:!1,italic:!1,underline:!1}),y=kt({flooded:"",collision:"",collision_severity:"",notes:""}),A=N([{id:1,name:"Kendaraan Normal",description:"Template untuk kendaraan dalam kondisi normal tanpa masalah signifikan (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi kendaraan secara umum: <b>BAIK</b><br>
- Tidak ditemukan indikasi kerusakan signifikan<br>
- Semua sistem berfungsi dengan normal<br>`},{id:2,name:"Kendaraan Bekas Tabrakan Ringan",description:"Template untuk kendaraan dengan riwayat tabrakan ringan (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat tabrakan dengan tingkat kerusakan: <b>RINGAN</b><br>
- Area yang terdampak: PERLU DIISI<br>
- Perbaikan yang dilakukan: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:3,name:"Kendaraan Bekas Banjir",description:"Template untuk kendaraan dengan riwayat terkena banjir (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kendaraan memiliki riwayat terkena banjir<br>
- Tingkat paparan air: PERLU DIISI<br>
- Komponen yang terdampak: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:4,name:"Kendaraan dengan Multiple Issues",description:"Template untuk kendaraan dengan beberapa masalah umum (Lengkap A, C, B)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Kondisi umum kendaraan: PERLU DIISI<br>
- Masalah utama yang ditemukan: PERLU DIISI<br>
- Komponen yang perlu perhatian: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI<br>

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`},{id:5,name:"Template Singkat",description:"Template ringkas untuk kesimpulan cepat (Ringkas)",content:`<p><strong>A. HASIL INSPEKSI:</strong></p>
- Status Keseluruhan Kendaraan: PERLU DIISI<br>
- Catatan Utama: PERLU DIISI<br>
- Status Tabrak/Banjir: PERLU DIISI`},{id:6,name:"Template Teknis Detail",description:"Template detail untuk laporan teknis lengkap (Lengkap A, C, B)",content:`<p><strong>A. LAPORAN HASIL INSPEKSI TEKNIS:</strong></p>
- Tanggal Inspeksi: PERLU DIISI<br>
- Kondisi Mesin: PERLU DIISI<br>
- Kondisi Transmisi: PERLU DIISI<br>
- Kondisi Suspensi: PERLU DIISI<br>
- Kondisi Rem: PERLU DIISI<br>
- Kondisi Body: PERLU DIISI<br>
- Kondisi Interior: PERLU DIISI<br>
- Kesimpulan Akhir: PERLU DIISI

<p><strong>C. ESTIMASI PERBAIKAN DAN PERAWATAN:</strong></p>
<p>* PERBAIKAN & PENGGANTIAN PART DALAM WAKTU DEKAT/ SEGERA:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p>* PERBAIKAN & PENGGANTIAN PART TENGGANG WAKTU MINIMAL 6 BULAN S/D 1 TAHUN KE DEPAN:</p>
- PERLU DIISI<br>
- Estimasi Biaya: PERLU DIISI
<p><em>Note: Estimasi perbaikan bisa lebih murah/lebih mahal. Opsional tergantung lokasi/daerah dan ketersediaan spare part.</em></p>`}]);N(["{PLATE_NUMBER}","{CAR_NAME}","{INSPECTION_DATE}","{DAMAGED_AREA}","{REPAIR_DETAILS}","{WATER_LEVEL}","{AFFECTED_COMPONENTS}","{OVERALL_CONDITION}","{MAIN_ISSUES}","{ATTENTION_NEEDED}","{REPAIR_COST_ESTIMATE}","{RECOMMENDATION}","{OVERALL_STATUS}","{ADDITIONAL_NOTES}","{ENGINE_CONDITION}","{TRANSMISSION_CONDITION}","{SUSPENSION_CONDITION}","{BRAKE_CONDITION}","{BODY_CONDITION}","{INTERIOR_CONDITION}","{FINAL_CONCLUSION}"]);const C=s=>{if(!s)return{};if(typeof s=="string")try{return JSON.parse(s)||{}}catch(b){return console.error("Error parsing settings JSON:",b),{}}return typeof s=="object"&&s!==null?s:{}};se(()=>C(e.inspection.settings).conclusion||{});const V=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],B=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],G=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Me(()=>{l(),Fe(()=>{c(),S()})});const c=()=>{r.value&&y.notes&&(r.value.innerHTML=y.notes)},l=()=>{const b=C(e.inspection.settings).conclusion||{},M=e.form.conclusion||{};y.flooded=M.flooded||b.flooded||"",y.collision=M.collision||b.collision||"",y.collision_severity=M.collision_severity||b.collision_severity||"",y.notes=M.notes||e.inspection.notes||""},$=s=>{if(!r.value)return;let b=s.content;b=b.replace(/{PLATE_NUMBER}/g,e.inspection.plate_number||"[NOMOR_PLAT]").replace(/{CAR_NAME}/g,e.inspection.car_name||"[NAMA_MOBIL]").replace(/{INSPECTION_DATE}/g,new Date().toLocaleDateString("id-ID")).replace(/{FLOOD_STATUS}/g,y.flooded==="yes"?"Pernah terkena banjir":"Tidak pernah terkena banjir").replace(/{COLLISION_STATUS}/g,y.collision==="yes"?"Pernah mengalami tabrakan":"Tidak pernah mengalami tabrakan"),r.value.innerHTML=b,y.notes=b,f.value=!1,Fe(()=>{r.value.focus(),g()})},R=()=>{r.value&&(r.value.innerHTML="",y.notes="",g())},S=()=>{if(!r.value)return;const s=window.getSelection();s.rangeCount===0||s.isCollapsed||(U.bold=document.queryCommandState("bold"),U.italic=document.queryCommandState("italic"),U.underline=document.queryCommandState("underline"))},F=s=>{if(!r.value)return;r.value.focus();const b=U[s];switch(s){case"bold":document.execCommand("bold",!1,!b);break;case"italic":document.execCommand("italic",!1,!b);break;case"underline":document.execCommand("underline",!1,!b);break}setTimeout(()=>{S(),Z()},10)},Z=It.debounce(()=>{r.value&&(y.notes=r.value.innerHTML,g())},200),D=s=>{s.preventDefault(),document.execCommand("insertParagraph",!1,null)},d=s=>{s.preventDefault();const b=(s.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,b)},H=()=>{I.value=!0},W=()=>{I.value=!1,r.value&&(y.notes=r.value.innerHTML,g())},x=()=>{g()},g=()=>{const s={flooded:y.flooded,collision:y.collision,collision_severity:y.collision==="yes"?y.collision_severity:null,notes:y.notes};_("updateConclusion",s)};return de(()=>e.form.conclusion,s=>{s&&(y.flooded=s.flooded!==void 0?s.flooded:y.flooded,y.collision=s.collision!==void 0?s.collision:y.collision,y.collision_severity=s.collision_severity!==void 0?s.collision_severity:y.collision_severity,y.notes=s.notes!==void 0?s.notes:y.notes,r.value&&s.notes!==void 0&&r.value.innerHTML!==s.notes&&(r.value.innerHTML=s.notes))},{deep:!0,immediate:!0}),de([()=>y.flooded,()=>y.collision,()=>y.collision_severity,()=>y.notes],()=>{g()},{deep:!0}),(s,b)=>(n(),i("div",Yo,[b[21]||(b[21]=t("div",{class:"bg-indigo-200 px-6 py-2 border-b flex items-center justify-between"},[t("h4",{class:"text-base font-semibold text-indigo-700"}," Detail Kendaraan ")],-1)),t("div",Xo,[b[10]||(b[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ie(" Apakah kendaraan pernah terkena banjir? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ei,[(n(),i(_e,null,$e(V,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ne(t("input",{type:"radio","onUpdate:modelValue":b[0]||(b[0]=Y=>y.flooded=Y),value:M.value,class:"hidden peer",onChange:x},null,40,ti),[[Be,y.flooded]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":y.flooded===M.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":y.flooded!==M.value}])},L(M.label),3)])),64))])]),t("div",ai,[b[12]||(b[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ie(" Apakah kendaraan pernah mengalami tabrakan? "),t("span",{class:"text-red-500"},"*")],-1)),t("div",si,[(n(),i(_e,null,$e(B,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ne(t("input",{type:"radio","onUpdate:modelValue":b[1]||(b[1]=Y=>y.collision=Y),value:M.value,class:"hidden peer",onChange:x},null,40,ni),[[Be,y.collision]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700 shadow-sm scale-[0.98]":y.collision===M.value,"border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400":y.collision!==M.value}])},L(M.label),3)])),64))]),ke(Le,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 transform -translate-y-2","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-2"},{default:Ce(()=>[y.collision==="yes"?(n(),i("div",oi,[b[11]||(b[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[Ie("Tingkat kerusakan: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ii,[(n(),i(_e,null,$e(G,M=>t("label",{key:M.value,class:"cursor-pointer"},[Ne(t("input",{type:"radio","onUpdate:modelValue":b[2]||(b[2]=Y=>y.collision_severity=Y),value:M.value,class:"hidden peer",onChange:x},null,40,li),[[Be,y.collision_severity]]),t("div",{class:oe(["w-full px-4 py-3 border rounded-lg text-center transition-all duration-200 ease-in-out whitespace-nowrap text-sm font-medium",{"border-blue-500 bg-blue-100 text-blue-700 shadow-sm scale-[0.98]":y.collision_severity===M.value,"border-gray-300 text-gray-700 hover:bg-white hover:border-gray-400":y.collision_severity!==M.value}])},L(M.label),3)])),64))])])):p("",!0)]),_:1})]),t("div",ri,[t("div",ui,[b[14]||(b[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Catatan Kesimpulan",-1)),t("button",{type:"button",onClick:b[3]||(b[3]=M=>f.value=!f.value),class:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all duration-200"},b[13]||(b[13]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),Ie(" Template ")]))]),ke(Le,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform scale-95","enter-to-class":"opacity-100 transform scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform scale-100","leave-to-class":"opacity-0 transform scale-95"},{default:Ce(()=>[f.value?(n(),i("div",di,[t("div",ci,[b[16]||(b[16]=t("h5",{class:"text-sm font-semibold text-gray-700"},"Pilih Template Kesimpulan",-1)),t("button",{onClick:b[4]||(b[4]=M=>f.value=!1),class:"text-gray-400 hover:text-gray-600"},b[15]||(b[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",pi,[(n(!0),i(_e,null,$e(A.value,M=>(n(),i("button",{key:M.id,onClick:Y=>$(M),class:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-150"},[t("div",mi,L(M.name),1),t("div",vi,L(M.description),1)],8,gi))),128))])])):p("",!0)]),_:1}),t("div",fi,[t("button",{type:"button",onClick:b[5]||(b[5]=M=>F("bold")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",U.bold?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Bold"},b[17]||(b[17]=[t("strong",null,"B",-1)]),2),t("button",{type:"button",onClick:b[6]||(b[6]=M=>F("italic")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",U.italic?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Italic"},b[18]||(b[18]=[t("em",null,"I",-1)]),2),t("button",{type:"button",onClick:b[7]||(b[7]=M=>F("underline")),class:oe(["p-2 rounded transition-all duration-150 ease-in-out font-medium",U.underline?"bg-indigo-500 text-white shadow-sm":"hover:bg-gray-200 hover:shadow-sm"]),title:"Underline"},b[19]||(b[19]=[t("u",null,"U",-1)]),2),t("button",{type:"button",onClick:b[8]||(b[8]=M=>R()),class:"p-2 rounded transition-all duration-150 ease-in-out hover:bg-gray-200 hover:shadow-sm ml-2",title:"Clear Template"}," 🗑️ Clear ")]),ke(Le,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 transform -translate-y-1","enter-to-class":"opacity-100 transform translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-1"},{default:Ce(()=>[Object.values(U).some(M=>M)?(n(),i("div",hi,[b[20]||(b[20]=Ie(" Format aktif: ")),U.bold?(n(),i("span",bi,"Bold")):p("",!0),U.italic?(n(),i("span",yi,"Italic")):p("",!0),U.underline?(n(),i("span",xi,"Underline")):p("",!0)])):p("",!0)]),_:1}),t("div",{ref_key:"editorRef",ref:r,contenteditable:"true",class:oe(["w-full min-h-[120px] p-3 rounded-md border border-gray-300 shadow-sm transition-all duration-200 ease-in-out prose max-w-none",{"bg-white border-gray-300":!I.value,"bg-blue-50 border-indigo-500 ring-2 ring-indigo-200":I.value}]),onInput:b[9]||(b[9]=(...M)=>Ve(Z)&&Ve(Z)(...M)),onBlur:W,onFocus:H,onKeydown:Mt(D,["enter"]),onPaste:d,onMouseup:S,onKeyup:S,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34)])]))}},Ci=Te(wi,[["__scopeId","data-v-6b429a8f"]]);export{Tn as B,Vi as C,Ai as V,Ct as _,Ci as a};
