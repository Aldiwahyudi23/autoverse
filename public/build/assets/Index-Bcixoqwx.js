import{x as le,p as de,r as _,q as h,O as L,L as H,g as ue,P as ce,j as $,o as n,w as me,k as K,d as o,u as r,v as pe,c as a,b as u,t as f,z as x,F as C,m as I,H as j,C as ge,A as O,n as J,f as fe,y as V}from"./vendor-D9AtPSqO.js";import{A as be}from"./AppLayout-C-o7je2P.js";import{_ as _e,a as ve,b as ye}from"./CarSelectionWizard-BjuZ7F9C.js";import{_ as xe}from"./app-DD5nWmYF.js";import"./lodash-BHkPC8MA.js";import"./fuse-Ch1WBRTM.js";const he={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},ke={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},we={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},Ce={class:"mb-2 flex justify-end"},Ie={class:"mb-4"},Ae=["value"],Me={class:"mb-4 flex items-center justify-between"},Te={class:"relative inline-flex items-center cursor-pointer"},Le=["disabled"],$e={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je=["min"],Ve={key:0,class:"mb-4"},Be=["value","disabled"],Ue={key:0,class:"text-xs text-gray-500"},Pe={key:0,class:"text-xs text-gray-500 mt-1"},Se={key:1,class:"mb-6"},De=["value"],Ee={class:"mt-6 flex justify-end"},ze=["disabled"],qe={key:4,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ne={key:0,class:"mb-4"},Fe=["innerHTML"],Re={key:1},Ge={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},He=["onClick"],Ke=["src","alt"],Oe={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},Je={class:"text-white text-xs text-center"},We={key:2,class:"text-center py-4 text-gray-500 text-sm"},Qe={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Xe=["src","alt"],Ye={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Ze={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},et={__name:"Index",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(B){const b=B,t=le({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null,region_id:null}),A=de(),v=A.props.global.user,U=A.props.global.region,d=A.props.global.has_roles,P=_(!1),W=_(new Date().toISOString().split("T")[0]),S=_([]),M=_(!1),c=_(null),l=_([]),k=_(!1),p=_(0),w=_("search"),Q=()=>{w.value=w.value==="search"?"wizard":"search",t.car_id=null,t.car_name="",c.value=null,l.value=[]},D=h(()=>d.includes("admin_plann"));L(()=>{D.value&&(t.is_scheduled=!0)});const E=s=>{var e,g,i;s.car_id&&s.car_name?(t.car_id=s.car_id,t.car_name=s.car_name,c.value=b.CarDetail.find(y=>y.id===s.car_id)||null):s.id&&(t.car_id=s.id,t.car_name=`${(e=s.brand)==null?void 0:e.name} ${(g=s.model)==null?void 0:g.name} ${(i=s.type)==null?void 0:i.name} ${ee(s.cc)} ${te(s.transmission)} ${s.fuel_type} ${s.year} (${s.production_period})`,c.value=s)},z=h(()=>b.activeInspections),X=h(()=>!(!t.plate_number.trim()||!t.category_id||!t.car_id&&!t.car_name.trim()||t.is_scheduled&&(!t.scheduled_at_date||!t.scheduled_at_time)||(d.includes("Admin")||d.includes("coordinator"))&&!t.inspector_id)),Y=h(()=>t.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),Z=h(()=>{const s=b.team.filter(m=>m.status==="active"),e=d.includes("Admin"),g=d.includes("admin_plann"),i=d.includes("coordinator"),y=d.includes("admin_region");return e?s.filter(m=>m.region_id===t.region_id):g?s.filter(m=>m.region_id===t.region_id):i?t.region_id?s.filter(m=>m.region_id===t.region_id):s.filter(m=>m.region_id===U.id):y?s.filter(m=>m.region_id===U.id):[]}),ee=s=>(s/1e3).toFixed(1)+"L",te=s=>({AT:"Automatic",MT:"Manual",CVT:"CVT",AMT:"AMT"})[s]||s,se=s=>{P.value=!s},oe=s=>{console.log("Car data received from plate validation:",s),s?(t.car_id=s.id,t.car_name=s.name,s.id&&(c.value=b.CarDetail.find(e=>e.id===s.id)||null,c.value&&ie(c.value.id)),s.inspectionData&&console.log("Inspection data available:",s.inspectionData)):(t.car_id=null,t.car_name="",c.value=null,l.value=[])},ie=async s=>{try{const e=await fetch(`/api/cars/${s}/images`);if(e.ok){const g=await e.json();l.value=Array.isArray(g)?g:[]}else l.value=[]}catch(e){console.error("Error loading car images:",e),l.value=[]}},q=s=>{l.value=s},N=s=>s!=null&&s.file_path?`/storage/${s.file_path}`:"",re=s=>{p.value=s,k.value=!0,document.body.style.overflow="hidden"},T=()=>{k.value=!1,document.body.style.overflow=""},F=()=>{p.value=(p.value+1)%l.value.length},R=()=>{p.value=(p.value-1+l.value.length)%l.value.length},G=s=>{if(k.value)switch(s.key){case"Escape":T();break;case"ArrowRight":F();break;case"ArrowLeft":R();break}};L(()=>{const s=d.includes("Admin")||d.includes("coordinator");t.inspector_id=(v==null?void 0:v.id)||null}),L(()=>{z.value&&(t.is_scheduled=!0)}),H(()=>t.car_id,s=>{s?c.value=b.CarDetail.find(e=>e.id===s)||null:(c.value=null,l.value=[])}),H(()=>t.region_id,s=>{s&&(d.includes("Admin")||d.includes("coordinator")||d.includes("admin_plann"))&&(t.inspector_id=null)});const ne=async()=>{try{M.value=!0;const s=await fetch("/api/regions/active-with-teams");if(s.ok){const e=await s.json();S.value=e.regions||[]}else console.error("Failed to fetch regions")}catch(s){console.error("Error fetching regions:",s)}finally{M.value=!1}};ue(()=>{window.addEventListener("keydown",G),ne()}),ce(()=>{window.removeEventListener("keydown",G)});const ae=()=>{t.plate_number,t.car_id,t.car_name,t.category_id,t.is_scheduled,t.inspector_id,t.is_scheduled&&(`${t.scheduled_at_date}${t.scheduled_at_time}`,t.region_id),t.post(route("inspections.store"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>{}})};return(s,e)=>(n(),$(be,{title:"Buat Inspeksi Baru"},{default:me(()=>{var g;return[K(r(pe),{title:"Inspek Baru"}),o("div",he,[o("div",ke,[e[25]||(e[25]=o("div",{class:"mb-4"},[o("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),o("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),r(t).errors.form_error?(n(),a("div",we,f(r(t).errors.form_error),1)):u("",!0),K(_e,{"plate-number":r(t).plate_number,"onUpdate:plateNumber":e[0]||(e[0]=i=>r(t).plate_number=i),inspections:b.inspection,"car-detail":b.CarDetail,onPlateValidityUpdate:se,onCarDataUpdate:oe},null,8,["plate-number","inspections","car-detail"]),o("div",Ce,[o("button",{onClick:Q,class:"text-sm text-indigo-600 hover:text-indigo-800 underline"},f(w.value==="search"?"Ganti ke Pilihan Dropdown":"Ganti ke Pencarian Teks"),1)]),w.value==="search"?(n(),$(ve,{key:1,"car-id":r(t).car_id,"onUpdate:carId":e[1]||(e[1]=i=>r(t).car_id=i),"car-name":r(t).car_name,"onUpdate:carName":e[2]||(e[2]=i=>r(t).car_name=i),"car-detail":b.CarDetail,onCarSelected:E,onCarImagesLoaded:q},null,8,["car-id","car-name","car-detail"])):(n(),$(ye,{key:2,"car-detail":b.CarDetail,onCarSelected:E,onCarImagesLoaded:q},null,8,["car-detail"])),o("div",Ie,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),x(o("select",{id:"category","onUpdate:modelValue":e[3]||(e[3]=i=>r(t).category_id=i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[10]||(e[10]=o("option",{value:"",disabled:""},"Pilih Kategori",-1)),(n(!0),a(C,null,I(B.Category,i=>(n(),a("option",{key:i.id,value:i.id},f(i.name),9,Ae))),128))],512),[[j,r(t).category_id]])]),o("div",Me,[e[13]||(e[13]=o("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),o("label",Te,[x(o("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=i=>r(t).is_scheduled=i),id:"schedule-toggle",class:"sr-only peer",disabled:z.value||D.value},null,8,Le),[[ge,r(t).is_scheduled]]),e[12]||(e[12]=o("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),r(t).is_scheduled?(n(),a("div",$e,[o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),x(o("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[5]||(e[5]=i=>r(t).scheduled_at_date=i),min:W.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,8,je),[[O,r(t).scheduled_at_date]])]),o("div",null,[e[15]||(e[15]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),x(o("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[6]||(e[6]=i=>r(t).scheduled_at_time=i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[O,r(t).scheduled_at_time]])]),r(d).includes("Admin")||r(d).includes("coordinator")||r(d).includes("admin_plann")?(n(),a("div",Ve,[e[17]||(e[17]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"region"}," Area Inspeksi * ",-1)),x(o("select",{id:"region","onUpdate:modelValue":e[7]||(e[7]=i=>r(t).region_id=i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[16]||(e[16]=o("option",{value:"",disabled:""},"Pilih Area Inspeksi",-1)),(n(!0),a(C,null,I(S.value,i=>(n(),a("option",{key:i.id,value:i.id,disabled:!i.has_active_team,class:J({"text-gray-400":!i.has_active_team})},[fe(f(i.name)+" ",1),i.has_active_team?u("",!0):(n(),a("span",Ue,"(Tidak tersedia)"))],10,Be))),128))],512),[[j,r(t).region_id]]),M.value?(n(),a("p",Pe,"Memuat data area...")):u("",!0)])):u("",!0),r(d).includes("Admin")||r(d).includes("coordinator")||r(d).includes("admin_plann")?(n(),a("div",Se,[e[19]||(e[19]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),x(o("select",{id:"inspector","onUpdate:modelValue":e[8]||(e[8]=i=>r(t).inspector_id=i),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[18]||(e[18]=o("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(n(!0),a(C,null,I(Z.value,i=>(n(),a("option",{key:i.id,value:i.user.id},f(i.user.name),9,De))),128))],512),[[j,r(t).inspector_id]])])):u("",!0)])):u("",!0),o("div",Ee,[o("button",{onClick:ae,disabled:!X.value||r(t).processing||P.value,class:J({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600 border border-transparent text-white hover:bg-blue-700":!r(t).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600 border-transparent text-white hover:bg-green-700":r(t).is_scheduled})},f(Y.value),11,ze)]),r(t).car_id&&c.value?(n(),a("div",qe,[c.value.description?(n(),a("div",Ne,[e[20]||(e[20]=o("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),o("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:c.value.description},null,8,Fe)])):u("",!0),l.value.length>0?(n(),a("div",Re,[e[21]||(e[21]=o("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),o("div",Ge,[(n(!0),a(C,null,I(l.value,(i,y)=>(n(),a("div",{key:i.id||y,class:"relative group cursor-pointer",onClick:m=>re(y)},[o("img",{src:N(i),alt:i.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ke),i.note?(n(),a("div",Oe,[o("p",Je,f(i.note),1)])):u("",!0)],8,He))),128))])])):(n(),a("div",We," Tidak ada gambar tersedia untuk mobil ini "))])):u("",!0),k.value?(n(),a("div",{key:5,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:T},[o("div",Qe,[o("button",{onClick:T,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[22]||(e[22]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),l.value.length>1?(n(),a("button",{key:0,onClick:V(R,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[23]||(e[23]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):u("",!0),l.value.length>1?(n(),a("button",{key:1,onClick:V(F,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[24]||(e[24]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):u("",!0),o("img",{src:N(l.value[p.value]),alt:"Car Image "+(p.value+1),class:"max-w-full max-h-full object-contain",onClick:e[9]||(e[9]=V(()=>{},["stop"]))},null,8,Xe),l.value.length>1?(n(),a("div",Ye,f(p.value+1)+" / "+f(l.value.length),1)):u("",!0),(g=l.value[p.value])!=null&&g.note?(n(),a("div",Ze,f(l.value[p.value].note),1)):u("",!0)])])):u("",!0)])])]}),_:1}))}},at=xe(et,[["__scopeId","data-v-cd6f3615"]]);export{at as default};
