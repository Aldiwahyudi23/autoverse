import{r as w,q as E,O as Et,G as rt,c as r,o as n,b as v,d as t,t as c,y as gt,z as F,f as P,A as ot,J as Q,F as D,a as it,j as jt,m as z,n as X,p as Mt,g as St,k as ct,N as Bt}from"./vendor-g77w9U1W.js";import{_ as Tt}from"./app-o8vJnppO.js";const Ft={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Pt={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},Nt={class:"flex items-center justify-between p-4 border-b"},Rt={class:"text-lg font-bold"},At={class:"p-4"},Ut={class:"space-y-4"},Vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={class:"space-y-2"},zt={class:"flex items-center"},qt={class:"flex items-center"},Lt={class:"space-y-2"},Ht={class:"flex items-center"},Kt={class:"flex items-center"},Gt={class:"flex items-center"},Jt={class:"relative"},Wt={class:"flex justify-end space-x-3 mt-6 pt-4 border-t"},Yt=["disabled"],Qt=["disabled"],Xt={key:0},Zt={key:1},te={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},ee={class:"bg-white rounded-lg shadow-xl w-96 mx-4"},se={class:"p-6"},oe={class:"text-gray-700 mb-6"},ae={class:"flex justify-end space-x-3"},ne=["disabled"],re={key:0},ie={key:1},pt={__name:"RepairEstimationModal",props:{showModal:Boolean,estimationData:Object,inspectionId:[String,Number],encryptedIds:String},emits:["close","saved","deleted"],setup(h,{emit:C}){const y=h,k=C,b=w(!1),_=w(!1),$=E(()=>{var a;return!!((a=y.estimationData)!=null&&a.id)}),i=Et({part_name:"",repair_description:"",urgency:"segera",status:"perlu",estimated_cost:0,notes:""}),N=E({get:()=>i.estimated_cost?new Intl.NumberFormat("id-ID").format(i.estimated_cost):"",set:a=>{const o=a.replace(/[^\d]/g,"");i.estimated_cost=o?parseInt(o,10):0}}),j=()=>{i.part_name="",i.repair_description="",i.urgency="segera",i.status="perlu",i.estimated_cost=0,i.notes=""},q=a=>{const u=a.target.value.replace(/[^\d]/g,"");u?(i.estimated_cost=parseInt(u,10),a.target.value=new Intl.NumberFormat("id-ID").format(i.estimated_cost)):(i.estimated_cost=0,a.target.value="")},K=a=>{i.estimated_cost>0&&(a.target.value=new Intl.NumberFormat("id-ID").format(i.estimated_cost))};rt(()=>y.estimationData,a=>{a&&Object.assign(i,a)},{immediate:!0});const R=async()=>{let a=null;$.value?k("saved",{...i,id:y.estimationData.id}):(a="temp-"+Date.now(),k("saved",{...i,id:a}));try{b.value=!0;const o=$.value?route("repair-estimations.update",{inspection:y.inspectionId,repair_estimation:y.estimationData.id}):route("repair-estimations.store",y.inspectionId),u=$.value?"put":"post",d=await it[u](o,i);k("saved",d.data),M()}catch(o){a&&k("error",a),console.error("Error saving estimation:",o),alert("Gagal menyimpan estimasi. Silakan coba lagi.")}finally{b.value=!1}},A=()=>{_.value=!0},U=async()=>{try{b.value=!0,await it.delete(route("repair-estimations.destroy",{inspection:y.inspectionId,repair_estimation:y.estimationData.id})),k("deleted",y.estimationData.id),_.value=!1,M()}catch(a){console.error("Error deleting estimation:",a),alert("Gagal menghapus estimasi. Silakan coba lagi.")}finally{b.value=!1}},M=()=>{j(),k("close")};return rt(()=>y.showModal,a=>{a&&y.estimationData?Object.assign(i,y.estimationData):a&&!y.estimationData&&j()}),(a,o)=>(n(),r(D,null,[h.showModal?(n(),r("div",Ft,[t("div",Pt,[t("div",Nt,[t("h3",Rt,c($.value?"Edit Estimasi Perbaikan":"Tambah Estimasi Perbaikan"),1),t("button",{onClick:M,class:"text-gray-400 hover:text-gray-600"},o[10]||(o[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",At,[t("form",{onSubmit:gt(R,["prevent"])},[t("div",Ut,[t("div",null,[o[11]||(o[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[P(" Nama Part/Komponen "),t("span",{class:"text-red-500"},"*")],-1)),F(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=u=>i.part_name=u),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contoh: Radiator, Rem Depan, dll"},null,512),[[ot,i.part_name]])]),t("div",null,[o[12]||(o[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[P(" Deskripsi Perbaikan "),t("span",{class:"text-red-500"},"*")],-1)),F(t("textarea",{"onUpdate:modelValue":o[1]||(o[1]=u=>i.repair_description=u),required:"",rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Jelaskan jenis perbaikan yang diperlukan"},null,512),[[ot,i.repair_description]])]),t("div",Vt,[t("div",null,[o[15]||(o[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[P(" Urgensi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ot,[t("label",zt,[F(t("input",{type:"radio","onUpdate:modelValue":o[2]||(o[2]=u=>i.urgency=u),value:"segera",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Q,i.urgency]]),o[13]||(o[13]=t("span",{class:"ml-2 text-sm text-gray-700"},"Segera",-1))]),t("label",qt,[F(t("input",{type:"radio","onUpdate:modelValue":o[3]||(o[3]=u=>i.urgency=u),value:"jangka_panjang",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Q,i.urgency]]),o[14]||(o[14]=t("span",{class:"ml-2 text-sm text-gray-700"},"Jangka Panjang",-1))])])]),t("div",null,[o[19]||(o[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[P(" Status "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Lt,[t("label",Ht,[F(t("input",{type:"radio","onUpdate:modelValue":o[4]||(o[4]=u=>i.status=u),value:"perlu",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Q,i.status]]),o[16]||(o[16]=t("span",{class:"ml-2 text-sm text-gray-700"},"Perlu",-1))]),t("label",Kt,[F(t("input",{type:"radio","onUpdate:modelValue":o[5]||(o[5]=u=>i.status=u),value:"disarankan",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Q,i.status]]),o[17]||(o[17]=t("span",{class:"ml-2 text-sm text-gray-700"},"Disarankan",-1))]),t("label",Gt,[F(t("input",{type:"radio","onUpdate:modelValue":o[6]||(o[6]=u=>i.status=u),value:"opsional",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[Q,i.status]]),o[18]||(o[18]=t("span",{class:"ml-2 text-sm text-gray-700"},"Opsional",-1))])])])]),t("div",null,[o[21]||(o[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[P(" Estimasi Biaya (Rp) "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Jt,[o[20]||(o[20]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"Rp")],-1)),F(t("input",{type:"text","onUpdate:modelValue":o[7]||(o[7]=u=>N.value=u),onInput:q,onBlur:K,required:"",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"},null,544),[[ot,N.value]])]),o[22]||(o[22]=t("p",{class:"text-xs text-gray-500 mt-1"}," Masukkan angka tanpa titik atau koma ",-1))]),t("div",null,[o[23]||(o[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Catatan Tambahan ",-1)),F(t("textarea",{"onUpdate:modelValue":o[8]||(o[8]=u=>i.notes=u),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Catatan khusus atau informasi tambahan"},null,512),[[ot,i.notes]])])]),t("div",Wt,[t("button",{type:"button",onClick:M,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Batal "),$.value?(n(),r("button",{key:0,type:"button",onClick:A,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:b.value}," Hapus ",8,Yt)):v("",!0),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:b.value},[b.value?(n(),r("span",Xt,o[24]||(o[24]=[t("svg",{class:"animate-spin h-5 w-5 inline-block",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),P(" Menyimpan... ")]))):(n(),r("span",Zt,c($.value?"Update":"Simpan"),1))],8,Qt)])],32)])])])):v("",!0),_.value?(n(),r("div",te,[t("div",ee,[t("div",se,[o[27]||(o[27]=t("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Hapus",-1)),t("p",oe,[o[25]||(o[25]=P(' Apakah Anda yakin ingin menghapus estimasi perbaikan untuk "')),t("strong",null,c(i.part_name),1),o[26]||(o[26]=P('"? '))]),t("div",ae,[t("button",{onClick:o[9]||(o[9]=u=>_.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{onClick:U,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",disabled:b.value},[b.value?(n(),r("span",re,"Menghapus...")):(n(),r("span",ie,"Ya, Hapus"))],8,ne)])])])])):v("",!0)],64))}},le={class:"mt-8 pt-6 border-t border-gray-300"},de={class:"flex justify-between items-center mb-4"},ue={key:0,class:"overflow-x-auto"},ce={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},ge={class:"bg-gray-100"},pe={key:0,class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},me={class:"p-3 border border-gray-300"},ye={class:"p-3 border border-gray-300 font-medium"},be={class:"p-3 border border-gray-300"},fe={class:"p-3 border border-gray-300"},ve={class:"flex flex-col gap-1"},xe={class:"p-3 border border-gray-300 font-bold text-right"},he={key:0,class:"p-3 border border-gray-300"},ke={class:"flex gap-2"},_e=["onClick"],we=["onClick"],Ce={class:"bg-gray-100"},Ie=["colspan"],$e={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded-lg"},De={__name:"RepairEstimationSection",props:{estimations:{type:Array,default:()=>[]},inspectionId:{type:[String,Number],required:!0},encryptedIds:{type:String,required:!0},canEdit:{type:Boolean,default:!1}},emits:["update:estimations","update:totalCost"],setup(h,{emit:C}){const y=h,k=C,b=w(!1),_=w(null),$=E(()=>y.estimations.reduce((d,l)=>d+parseFloat(l.estimated_cost||0),0));rt($,d=>{k("update:totalCost",d)});const i=d=>d?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(d):"Rp 0",N=d=>d==="segera"?"Segera":"Jangka Panjang",j=d=>({perlu:"Perlu",disarankan:"Disarankan",opsional:"Opsional"})[d]||d,q=d=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{segera:"bg-red-100 text-red-800",jangka_panjang:"bg-yellow-100 text-yellow-800"}[d]||"bg-gray-100 text-gray-800"}`,K=d=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{perlu:"bg-red-100 text-red-800",disarankan:"bg-yellow-100 text-yellow-800",opsional:"bg-blue-100 text-blue-800"}[d]||"bg-gray-100 text-gray-800"}`,R=()=>{_.value=null,b.value=!0},A=d=>{_.value=d,b.value=!0},U=d=>{_.value=d,b.value=!0},M=()=>{b.value=!1,_.value=null},a=d=>{const l=y.estimations.findIndex(f=>f.id===d.id);if(l!==-1){const f=[...y.estimations];f[l]=d,k("update:estimations",f)}else k("update:estimations",[...y.estimations,d]);M()},o=d=>{const l=y.estimations.filter(f=>f.id!==d);k("update:estimations",l),M()},u=d=>{const l=y.estimations.filter(f=>f.id!==d);k("update:estimations",l)};return(d,l)=>(n(),r("div",le,[t("div",de,[l[1]||(l[1]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Estimasi Perbaikan",-1)),h.canEdit?(n(),r("button",{key:0,onClick:R,class:"bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200 flex items-center gap-2"},l[0]||(l[0]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),P(" Tambah Estimasi ")]))):v("",!0)]),h.estimations.length>0?(n(),r("div",ue,[t("table",ce,[t("thead",ge,[t("tr",null,[l[2]||(l[2]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"No",-1)),l[3]||(l[3]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Part/Komponen",-1)),l[4]||(l[4]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Deskripsi Perbaikan",-1)),l[5]||(l[5]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Urgensi & Status",-1)),l[6]||(l[6]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Estimasi Biaya",-1)),h.canEdit?(n(),r("th",pe,"Aksi")):v("",!0)])]),t("tbody",null,[(n(!0),r(D,null,z(h.estimations,(f,Z)=>(n(),r("tr",{key:f.id,class:X(Z%2===0?"bg-white":"bg-gray-50")},[t("td",me,c(Z+1),1),t("td",ye,c(f.part_name),1),t("td",be,c(f.repair_description),1),t("td",fe,[t("div",ve,[t("span",{class:X(q(f.urgency))},c(N(f.urgency)),3),t("span",{class:X(K(f.status))},c(j(f.status)),3)])]),t("td",xe,c(i(f.estimated_cost)),1),h.canEdit?(n(),r("td",he,[t("div",ke,[t("button",{onClick:tt=>A(f),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"}," Edit ",8,_e),t("button",{onClick:tt=>U(f),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"}," Hapus ",8,we)])])):v("",!0)],2))),128))]),t("tfoot",Ce,[t("tr",null,[l[7]||(l[7]=t("td",{colspan:"4",class:"p-3 border border-gray-300 text-right font-bold"}," Total Estimasi: ",-1)),t("td",{colspan:h.canEdit?2:1,class:"p-3 border border-gray-300 font-bold text-right text-green-700"},c(i($.value)),9,Ie)])])])])):(n(),r("div",$e,[l[8]||(l[8]=t("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),l[9]||(l[9]=t("p",{class:"text-gray-500"},"Belum ada estimasi perbaikan.",-1)),h.canEdit?(n(),r("button",{key:0,onClick:R,class:"mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"}," Tambah Estimasi Pertama ")):v("",!0)])),b.value?(n(),jt(pt,{key:2,"show-modal":b.value,"estimation-data":_.value,"inspection-id":h.inspectionId,"encrypted-ids":h.encryptedIds,onClose:M,onSaved:a,onDeleted:o,onError:u},null,8,["show-modal","estimation-data","inspection-id","encrypted-ids"])):v("",!0)]))}},Ee={class:"p-6 bg-white rounded-lg shadow-md"},je={key:0},Me={class:"header flex flex-col gap-5 mb-6 mt-6"},Se={class:"flex items-center gap-5"},Be=["src"],Te={key:1,class:"w-40 h-40 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-gray-400"},Fe={class:"mt-8"},Pe={class:"text-3xl font-bold m-0 text-gray-800"},Ne={key:0,class:"car-info"},Re={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},Ae={class:"bg-gray-50"},Ue={class:"p-2 border border-gray-300 text-gray-600"},Ve={class:"bg-gray-50"},Oe={class:"p-2 border border-gray-300 text-gray-600"},ze={class:"p-2 border border-gray-300 text-gray-600"},qe={class:"bg-gray-50"},Le={class:"p-2 border border-gray-300 text-gray-600"},He={class:"p-2 border border-gray-300 text-gray-600"},Ke={class:"bg-gray-50"},Ge={class:"p-2 border border-gray-300 text-gray-600"},Je={class:"p-2 border border-gray-300 text-gray-600"},We={class:"bg-gray-50"},Ye={class:"p-2 border border-gray-300 text-gray-600"},Qe={class:"p-2 border border-gray-300 text-gray-600"},Xe={class:"bg-gray-50"},Ze={class:"p-2 border border-gray-300 text-gray-600"},ts={class:"bg-gray-50"},es={class:"p-2 border border-gray-300 text-gray-600"},ss={class:"bg-gray-50"},os={class:"p-2 border border-gray-300 text-gray-600"},as={class:"bg-gray-50"},ns={class:"p-2 border border-gray-300 text-gray-600"},rs={class:"bg-gray-50"},is={class:"p-2 border border-gray-300 text-gray-600"},ls={key:1,style:{width:"100%",margin:"15px 0","border-collapse":"collapse"}},ds={style:{width:"50%",padding:"6px","vertical-align":"top"}},us={style:{"text-align":"center"}},cs={key:0,src:"/images/icons/banjir.png",alt:"Banjir",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},gs={key:1,src:"/images/icons/aman.png",alt:"Aman",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},ps={key:2,style:{"font-weight":"bold","font-size":"15px",color:"#dc3545","margin-top":"8px","margin-bottom":"0"}},ms={key:3,style:{"font-weight":"bold","font-size":"15px",color:"#28a745","margin-top":"8px","margin-bottom":"0"}},ys={style:{width:"50%",padding:"6px","vertical-align":"top"}},bs={style:{"text-align":"center"}},fs=["src"],vs={key:2,class:"conclusion p-4 bg-gray-50 border-l-4 border-gray-800 rounded-lg"},xs={class:"m-0 text-gray-600"},hs=["innerHTML"],ks={class:"component-title bg-gray-100 px-3 py-2 border-l-4 border-gray-800 font-bold rounded-l-lg"},_s={key:0,class:"images flex flex-wrap gap-2 mt-4"},ws=["src","onClick"],Cs={key:1,class:"w-28 h-28 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Is={class:"point-name inline-block min-w-[160px] font-bold align-top text-gray-700"},$s={class:"point-content inline-block w-[calc(100%-70px)] align-top"},Ds={key:0,class:"status-badges-container"},Es=["onClick"],js={key:1,class:"point-note italic text-gray-600 my-1"},Ms={key:0,class:"inspection-images flex flex-wrap gap-2 mt-4"},Ss=["src","onClick"],Bs={key:1,class:"w-20 h-20 border border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 text-xs text-gray-400"},Ts={key:1,class:"textarea-note italic text-gray-600 my-2"},Fs={key:0,class:"mt-2 mb-6"},Ps={key:1,class:"flex flex-col items-center justify-center h-96 text-center"},Ns=["href"],Rs={key:2,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},As={class:"bg-white p-6 rounded-lg shadow-xl w-96 max-w-sm"},Us={class:"flex justify-end space-x-4"},Vs=["disabled"],Os={key:0},zs={key:1},qs={key:1,class:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 cursor-not-allowed"},Ls={class:"relative w-full h-full flex items-center justify-center p-4"},Hs=["src"],Ks={key:1,class:"text-white text-lg"},Gs={__name:"ReviewPDF",props:{inspection:{type:Object,required:!0},menu_points:{type:Array,default:()=>[]},coverImage:{type:Object,default:null},encryptedIds:Object,repairEstimations:{type:Array,default:()=>[]},totalRepairCost:{type:Number,default:0}},setup(h){const C=h,y=Mt(),k=w(!1),b=w(!1),_=w(C.repairEstimations),$=w(C.totalRepairCost),i=w(!1),N=w(null),j=E(()=>{var s;return((s=y.props.global)==null?void 0:s.has_roles)||[]});E(()=>j.value.includes("quality_control")||j.value.includes("qc"));const q=E(()=>(j.value.includes("quality_control")||j.value.includes("qc"))&&a.value.status==="pending_review"),K=E(()=>(j.value.includes("quality_control")||j.value.includes("qc"))&&a.value.status==="pending_review"),R=w(!1),A=w(""),U=s=>{A.value=s,R.value=!0},M=()=>{R.value=!1,A.value=""},a=w(C.inspection),o=w(C.menu_points),u=w(C.coverImage),d=async()=>{if(a.value.status==="in_progress")try{const s=await it.get(route("inspections.detail",C.encryptedIds));a.value=s.data.inspection,o.value=s.data.menu_points,u.value=s.data.coverImage,_.value=s.data.repairEstimations||[],$.value=s.data.totalRepairCost||0}catch(s){console.error("Polling gagal:",s)}};St(()=>{setInterval(d,5e3)});const l=s=>{_.value=s},f=s=>{$.value=s},Z=s=>{var e;N.value={part_name:((e=s.inspection_point)==null?void 0:e.name)||"",repair_description:"",urgency:"segera",status:"perlu",estimated_cost:0,notes:""},i.value=!0},tt=()=>{i.value=!1,N.value=null},mt=s=>{_.value.push(s),tt()},yt=E(()=>{if(!o.value)return[];const s=new Map;o.value.forEach(g=>{var I;const p=(I=g.inspection_point)==null?void 0:I.component,m=(p==null?void 0:p.id)||0;s.has(m)||s.set(m,{component:p||{id:0,name:"Tanpa Komponen",order:9999},points:[]}),s.get(m).points.push(g)});const e=Array.from(s.values()).sort((g,p)=>g.component.order===p.component.order?new Date(g.component.created_at)-new Date(p.component.created_at):(g.component.order||9999)-(p.component.order||9999));return e.forEach(g=>{g.points.sort((p,m)=>p.order===m.order?new Date(p.created_at)-new Date(m.created_at):(p.order||9999)-(m.order||9999))}),e}),bt=()=>{b.value=!0,setTimeout(()=>{window.location.href=route("inspections.download.pdf",C.encryptedIds),b.value=!1,k.value=!1},2e3)},ft=E(()=>{const s=C.menu_points.some(g=>G(g)||J(g)),e=C.coverImage&&C.coverImage.image_path;return s||e}),at=s=>s&&s.length>0,L=s=>`/${s}`,G=s=>{var e;return((e=s.inspection_point)==null?void 0:e.results)&&s.inspection_point.results.length>0},J=s=>{var e;return((e=s.inspection_point)==null?void 0:e.images)&&s.inspection_point.images.length>0},lt=s=>G(s)&&s.inspection_point.results[0].note,W=s=>{var g,p;if(!G(s))return[];const e=(p=(g=s.inspection_point)==null?void 0:g.results[0])==null?void 0:p.status;return e?Array.isArray(e)?e:typeof e=="string"&&e.includes(",")?e.split(",").map(m=>m.trim()).filter(m=>m.length>0):[e]:[]},vt=s=>{const e=s.input_type||"",g=W(s);return["radio","imageTOradio"].includes(e)&&g.length>0},xt=s=>{const e=s.input_type||"";return["text","number","date","textarea"].includes(e)&&lt(s)},ht=s=>{var p,m,I;const e=s.input_type||"",g=s.settings||{};if((p=s.inspection_point)!=null&&p.results[0],e==="image"&&J(s)||e==="imageTOradio"&&J(s))return!0;if(e==="radio"){const T=W(s);for(const V of T)if((((I=(((m=g.radios)==null?void 0:m.find(st=>st.value===V))||{}).settings)==null?void 0:I.show_image_upload)||!1)&&J(s))return!0}return!1},kt=s=>{var p,m,I;const e=s.settings||{};(p=s.inspection_point)!=null&&p.results[0];const g=W(s);for(const T of g)if((I=(((m=e.radios)==null?void 0:m.find(H=>H.value===T))||{}).settings)!=null&&I.show_textarea)return!0;return!1},_t=s=>{if(!s)return"status-warning";const e=String(s).toLowerCase().trim();return["normal","ada","baik","good","ok"].includes(e)?"status-good":["tidak normal","tidak ada","rusak","bad","not ok"].includes(e)?"status-bad":"status-warning"},wt=s=>W(s).some(g=>{const p=String(g).toLowerCase().trim();return!["normal","ada","baik","good","ok"].includes(p)}),Ct=s=>{var m;const e=s.input_type||"",g=((m=s.inspection_point)==null?void 0:m.results[0])||{},p=s.settings||{};if(e==="account"&&g.note){const I=g.note.replace(/[^\d.-]/g,""),T=parseFloat(I);if(isNaN(T))return g.note;const V=p.currency_symbol||"Rp";return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:2}).format(T).replace("Rp",V)}return g.note},It=E(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"/images/icons/aman.png";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"/images/icons/beruntun.png":s==="heavy"?"/images/icons/berat.png":"/images/icons/ringan.png"}),$t=E(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"Bebas Tabrak";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"Tabrak Beruntun":s==="heavy"?"Tabrak Berat":"Tabrak Ringan"}),Dt=E(()=>{if(!a.value.settings||a.value.settings.conclusion.collision!=="yes")return"#28a745";const s=a.value.settings.conclusion.collision_severity;return s==="moderate"?"#fd7e14":s==="heavy"?"#dc3545":"#ffc107"});return(s,e)=>{var g,p,m,I,T,V,H,et,st,dt,ut;return n(),r("div",Ee,[ft.value?(n(),r("div",je,[t("div",Me,[t("div",Se,[u.value&&at(u.value.image_path)?(n(),r("img",{key:0,src:L(u.value.image_path),alt:"Foto Utama",class:"w-40 h-40 object-cover rounded-lg border border-gray-300 cursor-pointer hover:opacity-90 transition-opacity",onClick:e[0]||(e[0]=S=>U(L(u.value.image_path)))},null,8,Be)):(n(),r("div",Te,e[4]||(e[4]=[t("span",null,"Gambar tidak tersedia",-1)]))),t("div",Fe,[t("h2",Pe,c(a.value.car_name),1)])]),a.value.car_id?(n(),r("div",Ne,[t("table",Re,[t("tr",Ae,[e[5]||(e[5]=t("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"ID Order",-1)),t("td",Ue,c(a.value.order_code),1)]),t("tr",Ve,[e[6]||(e[6]=t("td",{class:"p-2 border border-gray-300 font-bold w-1/3 text-gray-700"},"Nomor Polisi",-1)),t("td",Oe,c(a.value.plate_number),1)]),t("tr",null,[e[7]||(e[7]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Merek",-1)),t("td",ze,c((p=(g=a.value.car)==null?void 0:g.brand)==null?void 0:p.name),1)]),t("tr",qe,[e[8]||(e[8]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Model",-1)),t("td",Le,c((I=(m=a.value.car)==null?void 0:m.model)==null?void 0:I.name),1)]),t("tr",null,[e[9]||(e[9]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tipe",-1)),t("td",He,c((V=(T=a.value.car)==null?void 0:T.type)==null?void 0:V.name),1)]),t("tr",Ke,[e[10]||(e[10]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"CC",-1)),t("td",Ge,c((H=a.value.car)==null?void 0:H.cc),1)]),t("tr",null,[e[11]||(e[11]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Bahan Bakar",-1)),t("td",Je,c((et=a.value.car)==null?void 0:et.fuel_type),1)]),t("tr",We,[e[12]||(e[12]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Transmisi",-1)),t("td",Ye,c((st=a.value.car)==null?void 0:st.transmission),1)]),t("tr",null,[e[13]||(e[13]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Periode Model",-1)),t("td",Qe,c(((dt=a.value.car)==null?void 0:dt.production_period)||"-"),1)]),t("tr",Xe,[e[14]||(e[14]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Tahun Pembuatan",-1)),t("td",Ze,c((ut=a.value.car)==null?void 0:ut.year),1)]),t("tr",ts,[e[15]||(e[15]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"Warna",-1)),t("td",es,c(a.value.color),1)]),t("tr",ss,[e[16]||(e[16]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Rangka",-1)),t("td",os,c(a.value.noka),1)]),t("tr",as,[e[17]||(e[17]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"No Mesin",-1)),t("td",ns,c(a.value.nosin),1)]),t("tr",rs,[e[18]||(e[18]=t("td",{class:"p-2 border border-gray-300 font-bold text-gray-700"},"KM",-1)),t("td",is,c(a.value.km),1)])])])):v("",!0),a.value.settings?(n(),r("table",ls,[t("tr",null,[t("td",ds,[t("div",us,[a.value.settings.conclusion.flooded==="yes"?(n(),r("img",cs)):(n(),r("img",gs)),a.value.settings.conclusion.flooded==="yes"?(n(),r("p",ps," Bekas Banjir ")):(n(),r("p",ms," Bebas Banjir "))])]),t("td",ys,[t("div",bs,[a.value.settings.conclusion.collision==="yes"?(n(),r(D,{key:0},[t("img",{src:It.value,alt:"Tabrak",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},null,8,fs),t("p",{style:Bt({fontWeight:"bold",fontSize:"15px",color:Dt.value,marginTop:"8px",marginBottom:"0"})},c($t.value),5)],64)):(n(),r(D,{key:1},[e[19]||(e[19]=t("img",{src:"/images/icons/aman.png",alt:"Aman",style:{width:"80px",height:"80px",display:"block",margin:"0 auto"}},null,-1)),e[20]||(e[20]=t("p",{style:{"font-weight":"bold","font-size":"15px",color:"#28a745","margin-top":"8px","margin-bottom":"0"}}," Bebas Tabrak ",-1))],64))])])])])):v("",!0),a.value.notes?(n(),r("div",vs,[e[21]||(e[21]=t("h3",{class:"text-lg font-bold mb-2 text-gray-800"},"Kesimpulan Inspeksi:",-1)),t("p",xs,[t("div",{innerHTML:a.value.notes||"-"},null,8,hs)])])):v("",!0)]),e[26]||(e[26]=t("h2",{class:"text-2xl font-bold border-b-2 border-gray-800 pb-2 mb-6"},"Hasil Inspeksi",-1)),(n(!0),r(D,null,z(yt.value,S=>(n(),r("div",{key:S.component.id,class:X(["section mb-6",S.component.name==="Foto Kendaraan"?"photo-component":""])},[t("div",ks,c(S.component.name||"Tanpa Komponen"),1),S.component.name==="Foto Kendaraan"?(n(),r("div",_s,[(n(!0),r(D,null,z(S.points,x=>{var Y;return n(),r("div",{key:x.id},[(n(!0),r(D,null,z((Y=x.inspection_point)==null?void 0:Y.images,(O,nt)=>(n(),r("div",{key:O.id,class:"image-container"},[at(O.image_path)?(n(),r("img",{key:0,src:L(O.image_path),alt:"Foto Kendaraan",class:"w-28 h-28 object-cover border border-gray-300 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:B=>U(L(O.image_path))},null,8,ws)):(n(),r("div",Cs,e[22]||(e[22]=[t("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])}),128))])):(n(!0),r(D,{key:1},z(S.points,x=>{var Y,O,nt;return n(),r("div",{key:x.id,class:"point ml-4 py-3 border-b border-gray-100"},[G(x)||J(x)?(n(),r(D,{key:0},[t("span",Is,c(((Y=x.inspection_point)==null?void 0:Y.name)||"-"),1),t("div",$s,[G(x)?(n(),r(D,{key:0},[vt(x)?(n(),r("div",Ds,[(n(!0),r(D,null,z(W(x),B=>(n(),r("span",{key:B,class:X(["status-badge",_t(B)])},c(B.trim()),3))),128)),q.value&&wt(x)&&S.component.name!=="Dokumen"?(n(),r("button",{key:0,onClick:B=>Z(x),class:"ml-2 bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 transition-colors inline-flex items-center",title:"Tambah Estimasi Perbaikan"},e[23]||(e[23]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]),8,Es)):v("",!0)])):v("",!0),xt(x)?(n(),r("div",js,c(Ct(x)),1)):v("",!0)],64)):v("",!0)]),ht(x)?(n(),r("div",Ms,[(n(!0),r(D,null,z((O=x.inspection_point)==null?void 0:O.images,(B,Js)=>(n(),r("div",{key:B.id,class:"image-container"},[at(B.image_path)?(n(),r("img",{key:0,src:L(B.image_path),alt:"image",class:"w-20 h-20 object-cover border border-gray-300 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:Ws=>U(L(B.image_path))},null,8,Ss)):(n(),r("div",Bs,e[24]||(e[24]=[t("span",null,"Gambar tidak ditemukan",-1)])))]))),128))])):v("",!0),kt(x)&&lt(x)?(n(),r("div",Ts,c((nt=x.inspection_point)==null?void 0:nt.results[0].note),1)):v("",!0)],64)):v("",!0)])}),128))],2))),128)),ct(De,{estimations:_.value,"inspection-id":a.value.id,"encrypted-ids":h.encryptedIds,"can-edit":q.value,"onUpdate:estimations":l,"onUpdate:totalCost":f},null,8,["estimations","inspection-id","encrypted-ids","can-edit"]),K.value?(n(),r("div",Fs,[t("button",{onClick:e[1]||(e[1]=S=>k.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"}," Setujui Laporan "),e[25]||(e[25]=t("p",{class:"text-sm text-gray-500 mt-2 italic"}," Catatan: Halaman ini hanya simulasi dan mungkin berbeda dengan tampilan file PDF. Silakan periksa lebih detail untuk memastikan tidak ada kesalahan. Jika sudah yakin, silakan setujui untuk proses selanjutnya. ",-1))])):v("",!0)])):(n(),r("div",Ps,[e[27]||(e[27]=t("p",{class:"text-lg font-semibold text-gray-700"}," Data sudah tidak ada, karena sudah dijadikan PDF. ",-1)),t("a",{href:s.route("inspections.download.approved.pdf",h.encryptedIds),class:"mt-4 inline-block bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Download PDF ",8,Ns)])),k.value?(n(),r("div",Rs,[t("div",As,[e[29]||(e[29]=t("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Laporan",-1)),e[30]||(e[30]=t("p",{class:"text-gray-700 mb-6"}," Apakah Anda yakin semua data sudah sesuai? Setelah disetujui, laporan akan diproses menjadi file PDF. ",-1)),t("div",Us,[t("button",{onClick:e[2]||(e[2]=S=>k.value=!1),class:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400"}," Batal "),a.value.file?(n(),r("button",qs,e[28]||(e[28]=[t("span",null,"Laporan sudah di buat",-1)]))):(n(),r("button",{key:0,onClick:bt,class:"bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 transition-colors duration-200",disabled:b.value},[b.value?(n(),r("span",Os,"Membuat file PDF...")):(n(),r("span",zs,"Setujui Laporan"))],8,Vs))])])])):v("",!0),R.value?(n(),r("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:M},[t("div",Ls,[t("button",{onClick:M,class:"absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-70 transition-all"},e[31]||(e[31]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),A.value?(n(),r("img",{key:0,src:A.value,alt:"Full size image",class:"max-w-[90vw] max-h-[90vh] w-auto h-auto object-contain",onClick:e[3]||(e[3]=gt(()=>{},["stop"]))},null,8,Hs)):(n(),r("div",Ks," Gambar tidak dapat dimuat "))])])):v("",!0),ct(pt,{showModal:i.value,estimationData:N.value,inspectionId:a.value.id,encryptedIds:h.encryptedIds,onClose:tt,onSaved:mt},null,8,["showModal","estimationData","inspectionId","encryptedIds"])])}}},Xs=Tt(Gs,[["__scopeId","data-v-73085f35"]]);export{Xs as default};
