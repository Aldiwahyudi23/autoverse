import{q as I,c as m,o as c,d as t,f as A,b,n as $,t as f,r as y,g as N,G as O,H as q,z as h,A as k,u as v,F,m as P,I as U,e as M,x as B,y as E,k as V}from"./vendor-CUNG9NG6.js";import{d as L}from"./debounce-hB1Swk-4.js";const z={key:0,class:"space-y-2"},K={class:"flex justify-between items-center"},R={class:"flex justify-between items-center"},W={key:0,class:"flex justify-between items-center"},G={key:1,class:"flex justify-between items-center"},H={class:"text-xs text-gray-700 font-mono"},J={key:2,class:"flex justify-between items-center"},Q={class:"text-xs text-gray-700"},X={key:3,class:"flex justify-between items-center"},Y={class:"text-xs text-gray-700"},Z={key:1},Ye={__name:"CardTransaction",props:{transaction:{type:Object,default:null},showEditButton:{type:Boolean,default:!0}},emits:["edit"],setup(p){const w=p,d={pending:"Menunggu Pembayaran",paid:"Sudah Dibayar",failed:"Gagal",refunded:"Dikembalikan",expired:"Kadaluarsa"},i={cash:"Cash",transfer:"Transfer",debit_card:"Kartu Debit",credit_card:"Kartu Kredit",qris:"QRIS"},g=I(()=>{var e;return((e=w.transaction)==null?void 0:e.status)==="paid"}),r=I(()=>{var e;return((e=w.transaction)==null?void 0:e.status)==="pending"}),a=I(()=>{var e;return((e=w.transaction)==null?void 0:e.status)==="failed"}),u=I(()=>!g.value&&!r.value&&!a.value),_=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e);return(e,l)=>(c(),m("div",{class:$(["p-3 rounded border",{"bg-green-50 border-green-200":g.value,"bg-red-50 border-red-200":a.value,"bg-yellow-50 border-yellow-200":r.value}])},[l[7]||(l[7]=t("div",{class:"flex justify-between items-center mb-2"},[t("h4",{class:"text-sm font-medium text-gray-700 flex items-center"},[t("svg",{class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})]),A(" Pembayaran ")])],-1)),p.transaction?(c(),m("div",z,[t("div",K,[l[0]||(l[0]=t("span",{class:"text-xs font-medium text-gray-600"},"Status:",-1)),t("span",{class:$([{"text-green-600 font-semibold":g.value,"text-yellow-600 font-semibold":r.value,"text-red-600 font-semibold":a.value,"text-gray-600 font-semibold":u.value},"text-xs"])},f(d[p.transaction.status]),3)]),t("div",R,[l[1]||(l[1]=t("span",{class:"text-xs font-medium text-gray-600"},"Nominal:",-1)),t("span",{class:$([{"text-green-700 font-semibold":g.value,"text-yellow-700 font-semibold":r.value,"text-red-700 font-semibold":a.value},"text-xs"])},f(_(p.transaction.amount)),3)]),p.transaction.payment_method?(c(),m("div",W,[l[2]||(l[2]=t("span",{class:"text-xs font-medium text-gray-600"},"Metode:",-1)),t("span",{class:$([{"text-green-700":g.value,"text-yellow-700":r.value,"text-red-700":a.value},"text-xs"])},f(i[p.transaction.payment_method]||p.transaction.payment_method),3)])):b("",!0),p.transaction.invoice_number?(c(),m("div",G,[l[3]||(l[3]=t("span",{class:"text-xs font-medium text-gray-600"},"Invoice:",-1)),t("span",H,f(p.transaction.invoice_number),1)])):b("",!0),p.transaction.payment_date?(c(),m("div",J,[l[4]||(l[4]=t("span",{class:"text-xs font-medium text-gray-600"},"Tanggal:",-1)),t("span",Q,f(new Date(p.transaction.payment_date).toLocaleDateString("id-ID")),1)])):b("",!0),p.transaction.payer&&p.transaction.payer.name?(c(),m("div",X,[l[5]||(l[5]=t("span",{class:"text-xs font-medium text-gray-600"},"Dibayar oleh:",-1)),t("span",Y,f(p.transaction.payer.name),1)])):b("",!0)])):(c(),m("div",Z,l[6]||(l[6]=[t("p",{class:"text-xs text-yellow-700"},"Data transaksi belum tersedia",-1)])))],2))}},ee={class:"space-y-4"},te={class:"relative"},se={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto"},ne=["onClick"],ae={class:"font-medium text-sm"},oe={class:"text-xs text-gray-500"},re={key:0},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={key:0,class:"text-xs text-red-600 mt-1"},ue={class:"relative"},de={key:0,class:"text-xs text-red-600 mt-1"},me={class:"md:col-span-2"},ce={key:1,class:"p-3 bg-blue-50 border border-blue-200 rounded-md"},pe={class:"flex justify-between items-start"},_e={class:"text-sm text-gray-700"},ge={class:"text-xs text-gray-600"},xe={class:"text-xs text-gray-600"},ve={__name:"CustomerForm",props:{formData:{type:Object,required:!0},existingCustomer:{type:Object,default:null},existingSeller:{type:Object,default:null}},emits:["update:form","customer-selected","update:errors"],setup(p,{emit:w}){const d=w,i=p,g=y(""),r=y([]),a=y(!1),u=y(null),_=y({customer_name:"",customer_phone:""}),e=y({customer_id:"",customer_name:"",customer_phone:"",customer_email:"",customer_address:""});N(()=>{var s;i.existingCustomer?(e.value={customer_id:i.existingCustomer.id,customer_name:i.existingCustomer.name,customer_phone:((s=i.existingCustomer.phone)==null?void 0:s.replace("62",""))||"",customer_email:i.existingCustomer.email||"",customer_address:i.existingCustomer.address||""},u.value=i.existingCustomer):e.value={...i.formData}}),O(e,s=>{d("update:form",s)},{deep:!0});const l=L(async()=>{if(!g.value.trim()){r.value=[];return}try{const s=await fetch(`/customers/search?search=${encodeURIComponent(g.value)}`);s.ok&&(r.value=await s.json())}catch(s){console.error("Error searching customers:",s),r.value=[]}},300),S=s=>{var n;u.value=s,e.value={customer_id:s.id,customer_name:s.name,customer_phone:((n=s.phone)==null?void 0:n.replace("62",""))||"",customer_email:s.email||"",customer_address:s.address||""},s.sellers&&s.sellers.length>0&&d("customer-selected",{customer:s,sellers:s.sellers}),a.value=!1,g.value=""},D=()=>{u.value=null,e.value={customer_id:"",customer_name:"",customer_phone:"",customer_email:"",customer_address:""}},j=s=>{s.target.closest(".relative")||(a.value=!1)};N(()=>{document.addEventListener("click",j)}),q(()=>{document.removeEventListener("click",j)});const T=()=>{e.value.customer_name.trim()?e.value.customer_name.trim().length<3?_.value.customer_name="Nama customer minimal 3 karakter":_.value.customer_name="":_.value.customer_name="Nama customer wajib diisi"},x=()=>{const s=e.value.customer_phone.trim();s?/^\d{9,14}$/.test(s)?_.value.customer_phone="":_.value.customer_phone="Nomor WhatsApp harus 9-14 digit angka":_.value.customer_phone="Nomor WhatsApp wajib diisi"};return(s,n)=>(c(),m("div",ee,[t("div",null,[n[7]||(n[7]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Pilih Customer yang sudah ada (opsional) ",-1)),t("div",te,[h(t("input",{"onUpdate:modelValue":n[0]||(n[0]=o=>g.value=o),onInput:n[1]||(n[1]=(...o)=>v(l)&&v(l)(...o)),onFocus:n[2]||(n[2]=o=>a.value=!0),type:"text",placeholder:"Cari customer...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,544),[[k,g.value]]),a.value&&r.value.length>0?(c(),m("div",se,[(c(!0),m(F,null,P(r.value,o=>(c(),m("div",{key:o.id,onClick:C=>S(o),class:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0"},[t("div",ae,f(o.name),1),t("div",oe,f(o.phone)+" â€¢ "+f(o.email),1)],8,ne))),128))])):b("",!0)]),n[8]||(n[8]=t("p",{class:"text-xs text-gray-500 mt-1"}," Kosongkan jika ingin membuat customer baru ",-1))]),u.value?b("",!0):(c(),m("div",re,[n[14]||(n[14]=t("h4",{class:"text-sm font-medium text-gray-700 mb-3 border-b pb-2"}," Data Customer Baru ",-1)),t("div",le,[t("div",null,[n[9]||(n[9]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Nama Customer * ",-1)),h(t("input",{"onUpdate:modelValue":n[3]||(n[3]=o=>e.value.customer_name=o),onBlur:T,type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Nama lengkap customer"},null,544),[[k,e.value.customer_name]]),_.value.customer_name?(c(),m("p",ie,f(_.value.customer_name),1)):b("",!0)]),t("div",null,[n[11]||(n[11]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Nomor WhatsApp * ",-1)),t("div",ue,[n[10]||(n[10]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 text-sm"},"+62")],-1)),h(t("input",{"onUpdate:modelValue":n[4]||(n[4]=o=>e.value.customer_phone=o),onBlur:x,type:"tel",required:"",class:"w-full pl-10 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"8123456789"},null,544),[[k,e.value.customer_phone]])]),_.value.customer_phone?(c(),m("p",de,f(_.value.customer_phone),1)):b("",!0)]),t("div",null,[n[12]||(n[12]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Email ",-1)),h(t("input",{"onUpdate:modelValue":n[5]||(n[5]=o=>e.value.customer_email=o),type:"email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"customer@email.com"},null,512),[[k,e.value.customer_email]])]),t("div",me,[n[13]||(n[13]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Alamat ",-1)),h(t("textarea",{"onUpdate:modelValue":n[6]||(n[6]=o=>e.value.customer_address=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Alamat lengkap customer"},null,512),[[k,e.value.customer_address]])])])])),u.value?(c(),m("div",ce,[t("div",pe,[t("div",null,[n[15]||(n[15]=t("h5",{class:"text-sm font-semibold text-blue-800"},"Customer terpilih:",-1)),t("p",_e,f(u.value.name),1),t("p",ge,f(u.value.phone),1),t("p",xe,f(u.value.email),1)]),t("button",{onClick:D,type:"button",class:"text-xs text-red-600 hover:text-red-800"}," Ubah ")])])):b("",!0)]))}},fe={key:0,class:"space-y-4"},be={class:"space-y-4"},ye=["disabled"],he=["value","disabled"],ke={key:0,class:"text-xs text-gray-500"},we={key:0,class:"text-xs text-gray-500 mt-1"},$e={key:0,class:"text-xs text-red-600 mt-1"},Ce={class:"flex"},Se=["disabled"],je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={key:0,class:"text-xs text-red-600 mt-1"},Te={class:"relative"},Ie={key:0,class:"text-xs text-red-600 mt-1"},Ne={__name:"SellerForm",props:{formData:{type:Object,required:!0},showForm:{type:Boolean,default:!1},existingSeller:{type:Object,default:null}},emits:["update:form","update:errors"],setup(p,{emit:w}){const d=w,i=p,g=y([]),r=y(!1),a=y({seller_inspection_area:"",seller_inspection_address:"",seller_link_maps:"",seller_unit_holder_name:"",seller_unit_holder_phone:"",seller_settings:{}}),u=y({seller_inspection_address:"",seller_link_maps:"",seller_unit_holder_name:"",seller_unit_holder_phone:""}),_=async()=>{try{r.value=!0;const x=await fetch("/api/regions/active-with-teams");if(x.ok){const s=await x.json();g.value=s.regions||[]}else console.error("Failed to fetch regions")}catch(x){console.error("Error fetching regions:",x)}finally{r.value=!1}};N(()=>{var x;_(),i.existingSeller?a.value={seller_inspection_area:i.existingSeller.inspection_area||"",seller_inspection_address:i.existingSeller.inspection_address||"",seller_link_maps:i.existingSeller.link_maps||"",seller_unit_holder_name:i.existingSeller.unit_holder_name||"",seller_unit_holder_phone:((x=i.existingSeller.unit_holder_phone)==null?void 0:x.replace("62",""))||"",seller_settings:i.existingSeller.settings||{}}:a.value={...i.formData}}),O(a,x=>{d("update:form",x)},{deep:!0});const e=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(x=>{const{latitude:s,longitude:n}=x.coords,o=`https://www.google.com/maps?q=${s},${n}`;a.value.seller_link_maps=o,l(s,n)},x=>{alert("Gagal mendapatkan lokasi: "+x.message)}):alert("Browser tidak mendukung geolocation")},l=async(x,s)=>{try{const o=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${x}&lon=${s}`)).json();if(o.address&&(a.value.seller_inspection_area||(a.value.seller_inspection_area=o.address.city||o.address.town||o.address.village||""),!a.value.seller_inspection_address)){const C=[];o.address.road&&C.push(o.address.road),o.address.suburb&&C.push(o.address.suburb),o.address.city_district&&C.push(o.address.city_district),o.address.city&&C.push(o.address.city),o.address.state&&C.push(o.address.state),a.value.seller_inspection_address=C.join(", ")}}catch(n){console.error("Error reverse geocoding:",n)}},S=()=>{if(a.value.seller_link_maps&&a.value.seller_link_maps.includes("google.com/maps"))window.open(a.value.seller_link_maps,"_blank","noopener,noreferrer");else if(a.value.seller_inspection_address){const x=encodeURIComponent(a.value.seller_inspection_address);window.open(`https://www.google.com/maps/search/?api=1&query=${x}`,"_blank","noopener,noreferrer")}},D=()=>{a.value.seller_inspection_address.trim()?a.value.seller_inspection_address.trim().length<5?u.value.seller_inspection_address="Alamat inspeksi minimal 5 karakter":u.value.seller_inspection_address="":u.value.seller_inspection_address="Alamat inspeksi wajib diisi"},j=()=>{a.value.seller_unit_holder_name.trim()?a.value.seller_unit_holder_name.trim().length<3?u.value.seller_unit_holder_name="Nama penanggung jawab minimal 3 karakter":u.value.seller_unit_holder_name="":u.value.seller_unit_holder_name="Nama penanggung jawab wajib diisi"},T=()=>{const x=a.value.seller_unit_holder_phone.trim();x?/^\d{9,14}$/.test(x)?u.value.seller_unit_holder_phone="":u.value.seller_unit_holder_phone="Nomor WhatsApp harus 9-14 digit angka":u.value.seller_unit_holder_phone="Nomor WhatsApp wajib diisi"};return(x,s)=>p.showForm?(c(),m("div",fe,[s[14]||(s[14]=t("h4",{class:"text-sm font-medium text-gray-700 mb-3 border-b pb-2"}," Data Lokasi Inspeksi & Penanggung Jawab ",-1)),t("div",be,[t("div",null,[s[6]||(s[6]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Area Inspeksi * ",-1)),h(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.value.seller_inspection_area=n),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",disabled:r.value},[s[5]||(s[5]=t("option",{value:"",disabled:""},"Pilih Area Inspeksi",-1)),(c(!0),m(F,null,P(g.value,n=>(c(),m("option",{key:n.id,value:n.name,disabled:!n.has_active_team,class:$({"text-gray-400":!n.has_active_team})},[A(f(n.name)+" ",1),n.has_active_team?b("",!0):(c(),m("span",ke,"(Tidak tersedia)"))],10,he))),128))],8,ye),[[U,a.value.seller_inspection_area]]),r.value?(c(),m("p",we,"Memuat data area...")):b("",!0)]),t("div",null,[s[7]||(s[7]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Alamat Lengkap Inspeksi * ",-1)),h(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=n=>a.value.seller_inspection_address=n),onBlur:D,rows:"3",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Alamat lengkap lokasi inspeksi"},null,544),[[k,a.value.seller_inspection_address]]),u.value.seller_inspection_address?(c(),m("p",$e,f(u.value.seller_inspection_address),1)):b("",!0)]),t("div",null,[t("div",{class:"flex justify-between items-center mb-1"},[s[9]||(s[9]=t("label",{class:"block text-xs font-medium text-gray-600"}," Link Google Maps ",-1)),t("button",{type:"button",onClick:e,class:"text-xs text-blue-600 hover:text-blue-800 flex items-center",title:"Ambil lokasi saat ini"},s[8]||(s[8]=[t("svg",{class:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})],-1),A(" Lokasi Saat Ini ")]))]),t("div",Ce,[h(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>a.value.seller_link_maps=n),type:"text",placeholder:"https://maps.google.com/?q=...",class:"flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,512),[[k,a.value.seller_link_maps]]),t("button",{type:"button",onClick:S,class:"px-3 py-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 text-sm",disabled:!a.value.seller_link_maps,title:"Cari di Maps"},s[10]||(s[10]=[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)]),8,Se)])]),t("div",je,[t("div",null,[s[11]||(s[11]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Nama Penanggung Jawab * ",-1)),h(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>a.value.seller_unit_holder_name=n),onBlur:j,type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Nama orang yang memegang unit"},null,544),[[k,a.value.seller_unit_holder_name]]),u.value.seller_unit_holder_name?(c(),m("p",De,f(u.value.seller_unit_holder_name),1)):b("",!0)]),t("div",null,[s[13]||(s[13]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Nomor WhatsApp Penanggung Jawab * ",-1)),t("div",Te,[s[12]||(s[12]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 text-sm"},"+62")],-1)),h(t("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>a.value.seller_unit_holder_phone=n),onBlur:T,type:"tel",required:"",class:"w-full pl-10 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"8123456789"},null,544),[[k,a.value.seller_unit_holder_phone]])]),u.value.seller_unit_holder_phone?(c(),m("p",Ie,f(u.value.seller_unit_holder_phone),1)):b("",!0)])])])])):b("",!0)}},Oe={class:"space-y-4"},Ve={class:"space-y-4"},Ae={key:0},Ue={__name:"TransactionForm",props:{formData:{type:Object,required:!0},existingTransaction:{type:Object,default:null}},emits:["update:form"],setup(p,{emit:w}){const d=w,i=p,g=y(""),r=y({transaction_amount:"",transaction_payment_method:"",transaction_status:"pending",transaction_payment_date:new Date().toISOString().split("T")[0],transaction_notes:""});N(()=>{if(i.existingTransaction){const _=parseFloat(i.existingTransaction.amount)||0;r.value={transaction_amount:_,transaction_payment_method:i.existingTransaction.payment_method||"",transaction_status:i.existingTransaction.status||"pending",transaction_payment_date:i.existingTransaction.payment_date?new Date(i.existingTransaction.payment_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],transaction_notes:i.existingTransaction.notes||""},g.value=a(_)}else r.value={...i.formData}});const a=_=>{if(!_)return"";const e=String(_).replace(/\D/g,""),l=parseInt(e,10);return isNaN(l)?"":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(l)},u=_=>{const e=_.target.value.replace(/\D/g,"");r.value.transaction_amount=e,g.value=a(e)};return O(r,_=>{d("update:form",_)},{deep:!0}),(_,e)=>(c(),m("div",Oe,[e[12]||(e[12]=t("h4",{class:"text-sm font-medium text-gray-700 mb-3 border-b pb-2"}," Data Pembayaran ",-1)),t("div",Ve,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Nominal Pembayaran * ",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),onInput:u,type:"text",required:"",placeholder:"Contoh: 250000",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,544),[[k,g.value]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Metode Pembayaran * ",-1)),h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.transaction_payment_method=l),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},e[6]||(e[6]=[M('<option value="">Pilih Metode</option><option value="cash">Cash</option><option value="transfer">Transfer</option><option value="debit_card">Kartu Debit</option><option value="credit_card">Kartu Kredit</option><option value="qris">QRIS</option>',6)]),512),[[U,r.value.transaction_payment_method]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Status * ",-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.transaction_status=l),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},e[8]||(e[8]=[M('<option value="pending">Menunggu Pembayaran</option><option value="paid">Sudah Dibayar</option><option value="failed">Gagal</option><option value="refunded">Dikembalikan</option><option value="expired">Kadaluarsa</option>',5)]),512),[[U,r.value.transaction_status]])]),r.value.transaction_status==="paid"?(c(),m("div",Ae,[e[10]||(e[10]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Tanggal Pembayaran ",-1)),h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.transaction_payment_date=l),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,512),[[k,r.value.transaction_payment_date]])])):b("",!0),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Catatan ",-1)),h(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.transaction_notes=l),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"Catatan tambahan..."},null,512),[[k,r.value.transaction_notes]])])])]))}},Me={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4"},Fe={class:"bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},Pe={class:"flex justify-between items-center mb-6 pb-4 border-b"},qe={class:"text-lg font-bold"},Be={class:"flex items-center mb-4"},Ee={key:0},Le={class:"flex items-center mb-4"},ze={class:"flex items-center mb-4"},Ke={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-md"},Re={key:0,class:"text-sm text-red-600"},We={key:1,class:"text-sm text-red-600"},Ge={class:"flex justify-end space-x-3 pt-6 border-t"},He=["disabled"],Je=["disabled"],Ze={__name:"AllDataModal",props:{show:{type:Boolean,required:!0},inspectionId:{type:String,required:!0},existingCustomer:{type:Object,default:null},existingSeller:{type:Object,default:null},existingTransaction:{type:Object,default:null}},emits:["close","saved"],setup(p,{emit:w}){const d=p,i=w;y(!1);const g=y(""),r=y(1),a=y(!1),u=y({}),_=y({}),e=B({customer_id:"",customer_name:"",customer_phone:"",customer_email:"",customer_address:"",seller_inspection_area:"",seller_inspection_address:"",seller_link_maps:"",seller_unit_holder_name:"",seller_unit_holder_phone:"",seller_settings:{},transaction_amount:"",transaction_payment_method:"",transaction_status:"pending",transaction_payment_date:new Date().toISOString().split("T")[0],transaction_notes:""}),l=I(()=>!(!e.customer_name||!e.customer_phone||Object.values(u.value).some(s=>s)||a.value&&(!e.seller_inspection_area||!e.seller_inspection_address||!e.seller_unit_holder_name||!e.seller_unit_holder_phone||Object.values(_.value).some(s=>s))||!e.transaction_amount||!e.transaction_payment_method||!e.transaction_status));N(()=>{var s,n;d.existingCustomer&&(e.customer_id=d.existingCustomer.id,e.customer_name=d.existingCustomer.name,e.customer_phone=((s=d.existingCustomer.phone)==null?void 0:s.replace("62",""))||"",e.customer_email=d.existingCustomer.email||"",e.customer_address=d.existingCustomer.address||"",a.value=!0,r.value=3),d.existingSeller&&(e.seller_inspection_area=d.existingSeller.inspection_area||"",e.seller_inspection_address=d.existingSeller.inspection_address||"",e.seller_link_maps=d.existingSeller.link_maps||"",e.seller_unit_holder_name=d.existingSeller.unit_holder_name||"",e.seller_unit_holder_phone=((n=d.existingSeller.unit_holder_phone)==null?void 0:n.replace("62",""))||"",e.seller_settings=d.existingSeller.settings||{}),d.existingTransaction&&(e.transaction_amount=d.existingTransaction.amount||"",e.transaction_payment_method=d.existingTransaction.payment_method||"",e.transaction_status=d.existingTransaction.status||"pending",e.transaction_payment_date=d.existingTransaction.payment_date?new Date(d.existingTransaction.payment_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],e.transaction_notes=d.existingTransaction.notes||"")}),O([()=>e.customer_name,()=>e.customer_phone],([s,n])=>{s&&n?(a.value=!0,r.value=2):(a.value=!1,r.value=1)});const S=s=>{var n;if(s.sellers&&s.sellers.length>0){const o=s.sellers[0];e.seller_inspection_area=o.inspection_area||"",e.seller_inspection_address=o.inspection_address||"",e.seller_link_maps=o.link_maps||"",e.seller_unit_holder_name=o.unit_holder_name||"",e.seller_unit_holder_phone=((n=o.unit_holder_phone)==null?void 0:n.replace("62",""))||"",e.seller_settings=o.settings||{}}a.value=!0,r.value=2},D=s=>{Object.assign(e,s)},j=s=>{Object.assign(e,s)},T=s=>{Object.assign(e,s)},x=()=>{if(!l.value){g.value="Harap lengkapi semua field yang wajib diisi";return}const s={...e.data(),customer_phone:e.customer_phone.startsWith("62")?e.customer_phone:"62"+e.customer_phone.replace(/^0/,""),seller_unit_holder_phone:e.seller_unit_holder_phone.startsWith("62")?e.seller_unit_holder_phone:"62"+e.seller_unit_holder_phone.replace(/^0/,""),transaction_amount:parseInt(e.transaction_amount,10)};e.post(`/inspections-data/${d.inspectionId}/store-all-data`,s,{preserveScroll:!0,onSuccess:()=>{i("close"),i("saved")},onError:n=>{g.value=Object.values(n)[0]||"Gagal menyimpan data"}})};return(s,n)=>p.show?(c(),m("div",Me,[t("div",Fe,[t("div",Pe,[t("h3",qe,f(p.existingCustomer?"Edit Data Inspeksi":"Tambah Data Inspeksi"),1),t("button",{onClick:n[0]||(n[0]=o=>s.$emit("close")),class:"text-gray-500 hover:text-gray-700"},n[4]||(n[4]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("form",{onSubmit:E(x,["prevent"]),class:"space-y-8"},[t("div",null,[t("div",Be,[t("div",{class:$(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium",r.value>=1?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"])}," 1 ",2),n[5]||(n[5]=t("h4",{class:"ml-3 text-sm font-medium text-gray-700"},"Data Customer",-1))]),V(ve,{"form-data":{customer_id:v(e).customer_id,customer_name:v(e).customer_name,customer_phone:v(e).customer_phone,customer_email:v(e).customer_email,customer_address:v(e).customer_address},"existing-customer":p.existingCustomer,"existing-seller":p.existingSeller,"onUpdate:form":D,onCustomerSelected:S,"onUpdate:errors":n[1]||(n[1]=o=>u.value=o)},null,8,["form-data","existing-customer","existing-seller"])]),a.value?(c(),m("div",Ee,[t("div",Le,[t("div",{class:$(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium",r.value>=2?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"])}," 2 ",2),n[6]||(n[6]=t("h4",{class:"ml-3 text-sm font-medium text-gray-700"},"Lokasi & Penanggung Jawab",-1))]),V(Ne,{"form-data":{seller_inspection_area:v(e).seller_inspection_area,seller_inspection_address:v(e).seller_inspection_address,seller_link_maps:v(e).seller_link_maps,seller_unit_holder_name:v(e).seller_unit_holder_name,seller_unit_holder_phone:v(e).seller_unit_holder_phone,seller_settings:v(e).seller_settings},"show-form":a.value,"existing-seller":p.existingSeller,"onUpdate:form":j,"onUpdate:errors":n[2]||(n[2]=o=>_.value=o)},null,8,["form-data","show-form","existing-seller"])])):b("",!0),t("div",null,[t("div",ze,[t("div",{class:$(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium",r.value>=3?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"])}," 3 ",2),n[7]||(n[7]=t("h4",{class:"ml-3 text-sm font-medium text-gray-700"},"Pembayaran",-1))]),V(Ue,{"form-data":{transaction_amount:v(e).transaction_amount,transaction_payment_method:v(e).transaction_payment_method,transaction_status:v(e).transaction_status,transaction_payment_date:v(e).transaction_payment_date,transaction_notes:v(e).transaction_notes},"existing-transaction":p.existingTransaction,"onUpdate:form":T},null,8,["form-data","existing-transaction"])]),v(e).hasErrors||g.value?(c(),m("div",Ke,[g.value?(c(),m("p",Re,f(g.value),1)):v(e).errors?(c(),m("p",We,f(Object.values(v(e).errors)[0]),1)):b("",!0)])):b("",!0),t("div",Ge,[t("button",{type:"button",onClick:n[3]||(n[3]=o=>s.$emit("close")),disabled:v(e).processing,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-400 disabled:opacity-50"}," Batal ",8,He),t("button",{type:"submit",disabled:v(e).processing||!l.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50"},f(v(e).processing?"Menyimpan...":"Simpan Semua Data"),9,Je)])],32)])])):b("",!0)}};export{Ye as _,Ze as a};
