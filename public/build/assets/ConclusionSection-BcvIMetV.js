import{x as Le,r as k,g as Ie,q as Y,E as Ve,G as pe,c as o,o as s,d as e,b as p,k as ge,z as we,A as ke,n as J,t as U,u as me,e as Pe,F as fe,m as he,f as de,y as Ce,w as $e,N as xe,a as Ne,j as Se,l as je,T as De,O as Ae,D as Fe,W as Re,R as qe,J as Ue,B as Ee}from"./vendor-g77w9U1W.js";import{l as _e}from"./lodash-CGXsUT3p.js";import{_ as ze}from"./PrimaryButton-CrKKsBb9.js";import{_ as He}from"./ActionMessage-C9w22vKV.js";import{_ as ye}from"./app-DfnQvrPw.js";import{_ as Oe}from"./InputNumber-sdp6_31d.js";const We={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},Ke={key:0,class:"p-4 space-y-2"},Ze={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},Ge={class:"flex items-center space-x-2"},Je={key:0,class:"text-xs text-red-500 font-normal ml-2"},Xe={key:1,class:"text-xs text-red-500 font-normal ml-2"},Ye={key:2,class:"text-xs text-green-500 font-normal ml-2"},Qe={class:"space-y-2 pb-2 border-b border-gray-100 last:border-0 last:pb-0"},et={class:"relative"},tt={key:0,class:"absolute right-3 top-3"},at={key:1,class:"text-xs text-red-500 font-normal ml-2"},st={key:2,class:"mt-1 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},ot={key:3,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},nt={key:0},lt=["onMousedown"],it={class:"font-medium text-gray-900"},rt={class:"text-sm text-gray-500"},ut={key:1,class:"p-4 text-sm text-gray-500 text-center"},dt={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},ct={key:0,class:"mb-4"},mt=["innerHTML"],vt={key:1},gt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},pt=["onClick"],ft=["src","alt"],ht={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},bt={class:"text-white text-xs text-center"},wt={key:2,class:"text-center py-4 text-gray-500 text-sm"},xt={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},yt=["src","alt"],kt={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},$t={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},It={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ct={__name:"VehicleDetails",props:{inspection:{type:Object,default:null},CarDetail:Array,allInspections:{type:Array,default:()=>[]}},emits:["update-vehicle","update:validation","update:hasUnsavedChanges"],setup(t,{emit:E}){var ee,W,X,H,ne,G;const a=t,g=E,r=Le({plate_number:((ee=a.inspection)==null?void 0:ee.plate_number)||"",car_id:((W=a.inspection)==null?void 0:W.car_id)||null,car_name:((X=a.inspection)==null?void 0:X.car_name)||""}),c=k(((H=a.inspection)==null?void 0:H.plate_number)||""),m=k(((ne=a.inspection)==null?void 0:ne.car_id)||null),i=k(((G=a.inspection)==null?void 0:G.car_name)||""),l=k(""),d=k(""),b=k(""),w=k(!1),_=k(""),A=k(""),B=k(r.car_name),R=k(!1),S=k(!1),I=k([]),V=k(null),y=k([]),ae=k(!1),C=k(0);Ie(()=>{var h,u,K,N,te;if(O((h=a.inspection)==null?void 0:h.plate_number),(u=a.inspection)!=null&&u.car_id&&((K=a.CarDetail)==null?void 0:K.length)>0){const ue=a.CarDetail.find(ce=>ce.id===a.inspection.car_id);ue&&Q(ue)}else!((N=a.inspection)!=null&&N.car_id)&&((te=a.inspection)!=null&&te.car_name)&&(B.value=a.inspection.car_name,r.car_id=null);window.addEventListener("keydown",v),g("update:hasUnsavedChanges",re.value),g("update:validation",le.value)}),Ve(()=>{window.removeEventListener("keydown",v)});const O=h=>{if(!h){l.value="",d.value="",b.value="";return}const u=h.toUpperCase().trim(),K=u.match(/^([A-Z]{1,2})?([0-9]{1,4})?([A-Z]{1,3})?$/);if(K)l.value=K[1]||"",d.value=K[2]||"",b.value=K[3]||"";else{let N="area",te="",ue="",ce="";for(const ie of u)N==="area"&&/[A-Z]/.test(ie)?te+=ie:N==="area"&&/[0-9]/.test(ie)?(N="number",ue+=ie):N==="number"&&/[0-9]/.test(ie)?ue+=ie:N==="number"&&/[A-Z]/.test(ie)?(N="suffix",ce+=ie):N==="suffix"&&/[A-Z]/.test(ie)&&(ce+=ie);l.value=te,d.value=ue,b.value=ce}F()},F=()=>{const h=`${l.value}${d.value}${b.value}`;r.plate_number=h,$()},T=h=>{h==="area"?l.value=l.value.toUpperCase().replace(/[^A-Z]/g,""):h==="number"?d.value=d.value.replace(/[^0-9]/g,""):h==="suffix"&&(b.value=b.value.toUpperCase().replace(/[^A-Z]/g,"")),F()},f=Y(()=>{const h=r.plate_number;return/^[A-Z]{1,2}\d{1,4}[A-Z]{0,3}$/.test(h)}),D=Y(()=>!B.value||B.value.trim()===""),q=Y(()=>r.plate_number.length>0&&!f.value?"Format plat nomor tidak valid.":null),le=Y(()=>{const h=!r.plate_number||r.plate_number.trim()==="",u=!B.value||B.value.trim()==="";return h||u||!f.value||w.value}),re=Y(()=>{const h=r.plate_number!==c.value,u=r.car_id!==m.value||B.value!==i.value;return h||u}),be=Y(()=>re.value&&!le.value),M=h=>{var K,N,te;if(!h)return"";const u=[];return(K=h.brand)!=null&&K.name&&u.push(h.brand.name),(N=h.model)!=null&&N.name&&u.push(h.model.name),(te=h.type)!=null&&te.name&&u.push(h.type.name),h.cc&&u.push((h.cc/1e3).toFixed(1)),h.transmission&&u.push(h.transmission),h.year&&u.push(h.year.toString()),h.fuel_type&&u.push(h.fuel_type),h.production_period&&u.push(`(${h.production_period})`),u.join(" ")},j=()=>{r.car_id&&(r.car_id=null,V.value=null,y.value=[]),z()},z=_e.debounce(()=>{if(!B.value.trim()){I.value=[],R.value=!1;return}S.value=!0;try{const h=B.value.toLowerCase().trim();I.value=a.CarDetail.filter(u=>M(u).toLowerCase().includes(h)),R.value=!0}finally{S.value=!1}},300),Z=()=>{setTimeout(()=>{R.value=!1,r.car_name=B.value,$()},200)},Q=async h=>{V.value=h,B.value=M(h),r.car_id=h.id,r.car_name=M(h),R.value=!1,await se(h.id),$(),g("update:hasUnsavedChanges",re.value),g("update:validation",le.value)},oe=h=>!h||!h.file_path?"":`/storage/${h.file_path}`,se=async h=>{try{const u=await fetch(`/api/cars/${h}/images`);if(u.ok){const K=await u.json();y.value=Array.isArray(K)?K:[]}else y.value=[]}catch(u){console.error("Error loading car images:",u),y.value=[]}},ve=h=>{C.value=h,ae.value=!0,document.body.style.overflow="hidden"},P=()=>{ae.value=!1,document.body.style.overflow=""},n=()=>{C.value=(C.value+1)%y.value.length},x=()=>{C.value=(C.value-1+y.value.length)%y.value.length},v=h=>{if(ae.value)switch(h.key){case"Escape":P();break;case"ArrowRight":n();break;case"ArrowLeft":x();break}},$=()=>{const h={plate_number:r.plate_number,car_id:r.car_id,car_name:r.car_name};g("update-vehicle",h)},L=()=>{a.inspection&&r.post(route("inspections.updateVehicleDetails",{inspection:a.inspection.id}),{preserveScroll:!0,onSuccess:()=>{c.value=r.plate_number,m.value=r.car_id,i.value=r.car_name,g("update:hasUnsavedChanges",!1),console.log("Data berhasil disimpan!")},onError:h=>{console.error("Gagal menyimpan data:",h)}})};return pe([()=>r.plate_number,()=>r.car_name],h=>{_.value="",w.value=!1,A.value="";const u=h[0];if(u&&u.length>=6){const K=a.allInspections.filter(N=>{var te;return N.plate_number===u&&N.id!==((te=a.inspection)==null?void 0:te.id)});if(K.length>0){const N=["draft","in_progress","pending","pending_review","revision"],te=K.find(ue=>N.includes(ue.status));if(te)w.value=!0,_.value=`Nomor plat ini sedang dalam proses inspeksi dengan status: ${te.status.replace(/_/g," ").toUpperCase()}.`;else{const ue=K.filter(ce=>["approved","rejected","completed","cancelled"].includes(ce.status));if(ue.length>0){ue.sort((ie,Me)=>new Date(Me.created_at)-new Date(ie.created_at));const ce=ue[0];if(ce.car_id){const ie=a.CarDetail.find(Me=>Me.id===ce.car_id);ie&&Q(ie)}else ce.car_name&&(B.value=ce.car_name,r.car_name=ce.car_name,r.car_id=null);A.value=`Nomor plat ini sudah pernah diperiksa ${ue.length} kali sebelumnya.`}}}}g("update:hasUnsavedChanges",re.value),g("update:validation",le.value)},{deep:!0}),(h,u)=>{var K;return s(),o("div",We,[u[21]||(u[21]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Detail Kendaraan")],-1)),t.inspection?(s(),o("div",Ke,[e("div",Ze,[u[9]||(u[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Nomor Plat Kendaraan ",-1)),e("div",Ge,[we(e("input",{"onUpdate:modelValue":u[0]||(u[0]=N=>l.value=N),type:"text",placeholder:"Contoh: B",class:J(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!f.value||w.value}]),onInput:u[1]||(u[1]=N=>T("area")),maxlength:"2"},null,34),[[ke,l.value]]),we(e("input",{"onUpdate:modelValue":u[2]||(u[2]=N=>d.value=N),type:"tel",pattern:"[0-9]*",placeholder:"1234",class:J(["w-2/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!f.value||w.value}]),onInput:u[3]||(u[3]=N=>T("number")),maxlength:"4"},null,34),[[ke,d.value]]),we(e("input",{"onUpdate:modelValue":u[4]||(u[4]=N=>b.value=N),type:"text",placeholder:"ABC",class:J(["w-1/4 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-center transition duration-150",{"border-red-500 focus:border-red-500":!f.value||w.value}]),onInput:u[5]||(u[5]=N=>T("suffix")),maxlength:"3"},null,34),[[ke,b.value]])]),q.value?(s(),o("span",Je,U(q.value),1)):p("",!0),_.value?(s(),o("span",Xe,U(_.value),1)):p("",!0),A.value?(s(),o("span",Ye,U(A.value),1)):p("",!0)]),e("div",Qe,[u[13]||(u[13]=e("label",{class:"block text-sm font-medium text-gray-700"}," Nama Mobil ",-1)),e("div",et,[we(e("input",{"onUpdate:modelValue":u[6]||(u[6]=N=>B.value=N),type:"text",placeholder:"Cari atau ketik nama mobil...",class:J(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{"border-red-500 focus:border-red-500":D.value}]),onInput:j,onFocus:u[7]||(u[7]=N=>R.value=!0),onBlur:Z},null,34),[[ke,B.value]]),S.value?(s(),o("div",tt,u[10]||(u[10]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):p("",!0),D.value?(s(),o("span",at,"Nama mobil tidak boleh kosong.")):p("",!0),!me(r).car_id&&B.value?(s(),o("div",st,u[11]||(u[11]=[Pe('<div class="flex items-start" data-v-a6c054b9><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-a6c054b9><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-a6c054b9></path></svg><div data-v-a6c054b9><p class="text-yellow-800 font-medium mb-1" data-v-a6c054b9>Informasi Penting</p><p class="text-yellow-700 text-sm mb-2" data-v-a6c054b9> Anda memasukkan nama mobil secara manual. Data detail mobil (spesifikasi, gambar, deskripsi) <span class="font-semibold" data-v-a6c054b9>tidak akan tersedia</span> dalam laporan inspeksi. </p><p class="text-yellow-700 text-sm mb-2" data-v-a6c054b9> Untuk laporan yang lengkap dengan semua detail mobil, silakan pilih mobil dari hasil pencarian. </p><p class="text-yellow-700 text-sm" data-v-a6c054b9> Jika tidak ingin mengubah data mobil dan anda tidak sengaja sudah menghapus atau edit, <span class="font-semibold" data-v-a6c054b9>jangan klik tombol &quot;Perbarui Detail Kendaraan&quot;</span>. Sebagai gantinya, <span class="font-semibold" data-v-a6c054b9>refresh halaman</span> untuk kembali ke data awal. </p></div></div>',1)]))):p("",!0),R.value?(s(),o("div",ot,[I.value.length>0?(s(),o("div",nt,[(s(!0),o(fe,null,he(I.value,N=>(s(),o("div",{key:N.id,class:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onMousedown:te=>Q(N)},[e("div",it,U(M(N)),1),e("div",rt,U(N.year)+" • "+U(N.cc)+"cc • "+U(N.transmission)+" • "+U(N.fuel_type),1)],40,lt))),128))])):(s(),o("div",ut,u[12]||(u[12]=[de(" Tidak ada data mobil yang cocok. "),e("br",null,null,-1),de(" Silakan input manual dengan format: "),e("br",null,null,-1),e("span",{class:"font-medium text-gray-800"},"Toyota Avanza 1.5 G AT Bensin 2019",-1)])))])):p("",!0)])]),me(r).car_id&&V.value?(s(),o("div",dt,[V.value.description?(s(),o("div",ct,[u[14]||(u[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),e("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:V.value.description},null,8,mt)])):p("",!0),y.value.length>0?(s(),o("div",vt,[u[15]||(u[15]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),e("div",gt,[(s(!0),o(fe,null,he(y.value,(N,te)=>(s(),o("div",{key:N.id||te,class:"relative group cursor-pointer",onClick:ue=>ve(te)},[e("img",{src:oe(N),alt:N.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,ft),N.note?(s(),o("div",ht,[e("p",bt,U(N.note),1)])):p("",!0)],8,pt))),128))])])):(s(),o("div",wt," Tidak ada gambar tersedia untuk mobil ini "))])):p("",!0),ae.value?(s(),o("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:P},[e("div",xt,[e("button",{onClick:P,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},u[16]||(u[16]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),y.value.length>1?(s(),o("button",{key:0,onClick:Ce(x,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},u[17]||(u[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):p("",!0),y.value.length>1?(s(),o("button",{key:1,onClick:Ce(n,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},u[18]||(u[18]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):p("",!0),e("img",{src:oe(y.value[C.value]),alt:"Car Image "+(C.value+1),class:"max-w-full max-h-full object-contain",onClick:u[8]||(u[8]=Ce(()=>{},["stop"]))},null,8,yt),y.value.length>1?(s(),o("div",kt,U(C.value+1)+" / "+U(y.value.length),1)):p("",!0),(K=y.value[C.value])!=null&&K.note?(s(),o("div",$t,U(y.value[C.value].note),1)):p("",!0)])])):p("",!0),ge(ze,{type:"button",onClick:L,class:"w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",disabled:!be.value},{default:$e(()=>[me(r).processing?(s(),o("svg",It,u[19]||(u[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),e("span",null,U(me(r).processing?"Mengirim...":"Perbarui Detail Kendaraan"),1),ge(He,{on:me(r).recentlySuccessful,class:"me-3 text-sm text-green-600 font-medium"},{default:$e(()=>u[20]||(u[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),de(" Tersimpan. ")])),_:1,__:[20]},8,["on"])]),_:1},8,["disabled"])])):p("",!0)])}}},Ao=ye(Ct,[["__scopeId","data-v-a6c054b9"]]),Vt={class:"mt-1"},St=["value","required","minlength","maxlength","allowSpace","placeholder"],Mt={key:0,class:"mt-2 text-sm text-red-600"},Ut={__name:"InputText",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],pattern:String,placeholder:String,error:String,pointId:[String,Number],textTransform:{type:String,default:"none"},allowSpace:{type:Boolean,default:!0}},emits:["update:modelValue","save"],setup(t,{emit:E}){const a=t,g=E,r=Y(()=>{if(!a.modelValue)return"";let m=a.modelValue;switch(a.allowSpace||(m=m.replace(/\s+/g,"")),a.textTransform){case"uppercase":return m.toUpperCase();case"lowercase":return m.toLowerCase();case"capitalize":return m.replace(/\b\w/g,i=>i.toUpperCase());default:return m}}),c=m=>{let i=m.target.value;switch(a.allowSpace||(i=i.replace(/\s+/g,"")),a.textTransform){case"uppercase":i=i.toUpperCase();break;case"lowercase":i=i.toLowerCase();break;case"capitalize":i=i.replace(/\b\w/g,l=>l.toUpperCase());break}g("update:modelValue",i),g("save",a.pointId)};return(m,i)=>(s(),o("div",Vt,[e("input",{value:r.value,onInput:c,type:"text",required:t.required,minlength:t.minLength,maxlength:t.maxLength,allowSpace:t.allowSpace,placeholder:t.placeholder,class:J(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",{uppercase:t.textTransform==="uppercase",lowercase:t.textTransform==="lowercase",capitalize:t.textTransform==="capitalize"}])},null,42,St),t.error?(s(),o("p",Mt,U(t.error),1)):p("",!0)]))}},_t={class:"mt-1"},Nt=["value","required","min","max"],jt={key:0,class:"mt-2 text-sm text-red-600"},Tt={__name:"InputDate",props:{modelValue:String,required:Boolean,minDate:String,maxDate:String,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:E}){const a=t,g=E,r=c=>{g("update:modelValue",c.target.value),g("save",a.pointId)};return(c,m)=>(s(),o("div",_t,[e("input",{value:t.modelValue,onChange:r,type:"date",required:t.required,min:t.minDate,max:t.maxDate,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},null,40,Nt),t.error?(s(),o("p",jt,U(t.error),1)):p("",!0)]))}},Bt={class:"mt-1"},Lt=["value","required","placeholder"],Pt={key:0,class:"mt-2 text-sm text-red-600"},Dt={__name:"InputAccount",props:{modelValue:[String,Number],required:Boolean,placeholder:String,error:String,pointId:[String,Number],settings:{type:Object,default:()=>({currency_symbol:"Rp",thousands_separator:",",min_value:0,max_value:1e9})}},emits:["update:modelValue","save"],setup(t,{emit:E}){const a=t,g=E,r=k(""),c=Y(()=>{var b,w,_,A;return{currency_symbol:((b=a.settings)==null?void 0:b.currency_symbol)||"Rp",thousands_separator:((w=a.settings)==null?void 0:w.thousands_separator)||",",min_value:((_=a.settings)==null?void 0:_.min_value)!==void 0?Number(a.settings.min_value):0,max_value:((A=a.settings)==null?void 0:A.max_value)!==void 0?Number(a.settings.max_value):1e9}}),m=b=>{if(b==null||b==="")return"";const w=Number(b);if(isNaN(w))return"";let _=w.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return c.value.thousands_separator!==","&&(_=_.replace(/,/g,c.value.thousands_separator)),_},i=b=>b?b.replace(/[^\d]/g,""):"",l=Y(()=>r.value?`${c.value.currency_symbol} ${m(r.value)}`:""),d=b=>{let w=i(b.target.value),_=Number(w);c.value.min_value!==void 0&&_<c.value.min_value&&(w=c.value.min_value.toString()),c.value.max_value!==void 0&&_>c.value.max_value&&(w=c.value.max_value.toString()),r.value=w,g("update:modelValue",w),g("save",a.pointId)};return pe(()=>a.modelValue,b=>{b!=null&&(r.value=b.toString())},{immediate:!0}),(b,w)=>(s(),o("div",Bt,[e("input",{value:l.value,onInput:d,type:"text",required:t.required,placeholder:t.placeholder,class:J(["block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",t.error?"border-red-300":"border-gray-300"])},null,42,Lt),t.error?(s(),o("p",Pt,U(t.error),1)):p("",!0)]))}},At={class:"mt-1 space-y-3"},Ft={key:0,class:"space-y-2"},Rt={class:"flex flex-wrap gap-2"},qt=["onClick"],Et=["value","required","minlength","maxlength","placeholder"],zt={class:"flex justify-between items-center mt-1"},Ht={class:"text-xs text-gray-500"},Ot={key:0,class:"text-xs text-red-600"},Wt={__name:"InputTextarea",props:{modelValue:String,required:Boolean,minLength:[String,Number],maxLength:[String,Number],placeholder:String,error:String,pointId:[String,Number],inspectionId:[String,Number],settings:Object},emits:["update:modelValue","save"],setup(t,{emit:E}){const a=t,g=E,r=k([]),c=k(""),m=b=>r.value.some(w=>w.value===b),i=b=>{m(b.value)?r.value=r.value.filter(B=>B.value!==b.value):r.value.push(b);const _=[...r.value.map(B=>B.value)];c.value.trim()&&_.push(c.value.trim());const A=_.join(", ");g("update:modelValue",A),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:A})},l=b=>{const w=b.target.value;g("update:modelValue",w),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,notes:w}),d(w)},d=b=>{var B,R,S,I;if(!b){r.value=[],c.value="";return}const w=b.split(",").map(V=>V.trim()).filter(V=>V),_=((R=(B=a.settings)==null?void 0:B.damage_options)==null?void 0:R.map(V=>V.value))||[];r.value=((I=(S=a.settings)==null?void 0:S.damage_options)==null?void 0:I.filter(V=>w.includes(V.value)))||[];const A=w.filter(V=>!_.includes(V));c.value=A.join(", ")};return pe(()=>a.modelValue,b=>{b!=null&&d(b)},{immediate:!0}),(b,w)=>{var _,A,B;return s(),o("div",At,[(_=t.settings)!=null&&_.enable_damage&&((A=t.settings)!=null&&A.damage_options)?(s(),o("div",Ft,[w[0]||(w[0]=e("h4",{class:"text-sm font-medium text-gray-700"},"Pilih Kerusakan:",-1)),e("div",Rt,[(s(!0),o(fe,null,he(t.settings.damage_options,(R,S)=>(s(),o("button",{key:S,type:"button",onClick:I=>i(R),class:J(["px-3 py-1.5 rounded-md text-sm font-medium transition-colors border",{"border-indigo-500 bg-indigo-100 text-indigo-700":m(R.value),"border-gray-300 bg-white text-gray-700 hover:bg-gray-50":!m(R.value)}])},U(R.label),11,qt))),128))])])):p("",!0),e("div",null,[e("textarea",{value:t.modelValue,onInput:l,required:t.required,minlength:t.minLength,maxlength:t.maxLength,placeholder:t.placeholder,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150",rows:"4"},null,40,Et),e("div",zt,[e("span",Ht,U(((B=t.modelValue)==null?void 0:B.length)||0)+"/"+U(t.maxLength||400),1),t.error?(s(),o("p",Ot,U(t.error),1)):p("",!0)])])])}}},Kt={class:"mt-1"},Zt=["value","required"],Gt={key:0,class:"mt-2 text-sm text-red-600"},Jt={__name:"InputSelect",props:{modelValue:String,required:Boolean,error:String,pointId:[String,Number]},emits:["update:modelValue","save"],setup(t,{emit:E}){const a=t,g=E,r=c=>{g("update:modelValue",c.target.value),g("save",a.pointId)};return(c,m)=>(s(),o("div",Kt,[e("select",{value:t.modelValue,onChange:r,required:t.required,class:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm transition duration-150"},m[0]||(m[0]=[e("option",{value:"",disabled:""},"Select status",-1),e("option",{value:"good"},"Good",-1),e("option",{value:"bad"},"Bad",-1),e("option",{value:"na"},"N/A",-1)]),40,Zt),t.error?(s(),o("p",Gt,U(t.error),1)):p("",!0)]))}},Fo=ye(Jt,[["__scopeId","data-v-c34a74db"]]),Xt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm"},Yt={class:"bg-white rounded-xl p-8 w-full max-w-sm mx-auto shadow-2xl transform transition-all duration-300 scale-100 opacity-100"},Qt={class:"text-xs text-gray-500 mt-2 text-center"},ea={class:"flex flex-row space-x-4 mb-6"},ta={class:"mt-4 text-right"},aa={__name:"ImageSourceOptionsModal",props:{show:{type:Boolean,default:!1},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})}},emits:["close","open-webcam","trigger-gallery"],setup(t){return(E,a)=>t.show?(s(),o("div",Xt,[e("div",Yt,[a[7]||(a[7]=e("h3",{class:"text-xl font-bold text-gray-800 mb-2 text-center"},"Pilih Sumber Gambar",-1)),e("p",Qt,[a[3]||(a[3]=de("Ambil Foto Maksimal: ")),e("b",null,U(t.settings.max_files),1),a[4]||(a[4]=de(" Dengan Rasio & Ukuran: ")),e("b",null,U(t.settings.camera_aspect_ratio),1)]),e("div",ea,[e("button",{onClick:a[0]||(a[0]=g=>E.$emit("open-webcam")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),e("span",{class:"text-sm font-medium"},"Kamera",-1)])),e("button",{onClick:a[1]||(a[1]=g=>E.$emit("trigger-gallery")),class:"flex-1 flex flex-col items-center justify-center p-4 border border-gray-200 rounded-lg text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 ease-in-out transform hover:scale-105"},a[6]||(a[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2 text-gray-500 hover:text-indigo-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("span",{class:"text-sm font-medium"},"Galeri",-1)]))]),e("div",ta,[e("button",{onClick:a[2]||(a[2]=g=>E.$emit("close")),class:"px-5 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 transition-colors duration-200 ease-in-out"}," Batal ")])])])):p("",!0)}},sa={key:0,class:"fixed inset-0 z-40 p-0 webcam-modal-container"},oa={class:"webcam-content-box"},na={class:"webcam-header"},la={class:"rounded-full text-white hover:bg-gray-700 transition-colors"},ia={class:"inspection-point-name"},ra={key:0,class:"screen-flash-overlay"},ua={key:2,class:"zoom-controls"},da=["max"],ca={class:"webcam-footer"},ma={class:"camera-controls"},va=["disabled"],ga={class:"camera-icon-container"},pa={key:0,class:"camera-spinner"},fa={key:1,class:"camera-body"},ha={__name:"WebcamModal",props:{show:Boolean,aspectRatio:Number,settings:Object,point:Object},emits:["close","photoCaptured"],setup(t,{emit:E}){const a=t,g=E,r=k(null),c=k(null);let m=null,i=null;const l=k("environment"),d=k(!1),b=k(!1),w=k(!1),_=k(!1),A=k(!1),B=k({}),R=k(!1),S=k(1),I=k(1),V=k(!1),y=Y(()=>{var M;return((M=a.settings)==null?void 0:M.max_size)||2048}),ae=Y(()=>a.aspectRatio?{aspectRatio:`${a.aspectRatio} / 1`,maxWidth:"100%",maxHeight:"70vh",margin:"0 auto"}:{}),C=Y(()=>{if(!a.aspectRatio)return{};const M=a.aspectRatio,j=M>1?80:60,z=M>1?80/M:60*M;return{width:`${j}%`,height:`${z}%`}}),O=async()=>{m&&m.getTracks().forEach(M=>M.stop());try{const M={facingMode:l.value,width:{ideal:4096},height:{ideal:2160},aspectRatio:{ideal:a.aspectRatio||1.3333333333333333},frameRate:{ideal:30},advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]};m=await navigator.mediaDevices.getUserMedia({video:M,audio:!1}),i=m.getVideoTracks()[0],r.value.srcObject=m,r.value.onloadedmetadata=async()=>{await T(),await r.value.play()}}catch(M){console.error("Error accessing camera: ",M),alert("Failed to access camera. Please allow camera permission."),g("close")}},F=()=>{m&&m.getTracks().forEach(M=>M.stop()),g("close")},T=async()=>{if(i)try{const M=await navigator.mediaDevices.enumerateDevices();d.value=M.filter(z=>z.kind==="videoinput").length>1;const j=i.getCapabilities();j.zoom?(V.value=!0,I.value=j.zoom.max,console.log(`Zoom supported. Max zoom: ${I.value}`)):(V.value=!1,console.warn("Zoom is not supported by this camera.")),b.value=j.torch||j.fillLightMode&&j.fillLightMode.includes("torch")}catch(M){console.error("Error checking camera capabilities:",M)}},f=async M=>{if(!i)return;const j=r.value.getBoundingClientRect(),z=M.clientX-j.left,Z=M.clientY-j.top;A.value=!0,B.value={left:`${z}px`,top:`${Z}px`,transform:"translate(-50%, -50%)"};try{if(i.getCapabilities().pointsOfInterest){const oe=z/j.width,se=Z/j.height;await i.applyConstraints({advanced:[{focusMode:"manual",pointsOfInterest:[{x:oe,y:se}]}]})}else console.warn("Manual focus with point of interest is not supported.")}catch(Q){console.warn("Manual focus failed:",Q)}setTimeout(()=>{A.value=!1,i.getCapabilities().focusMode.includes("continuous")&&i.applyConstraints({advanced:[{focusMode:"continuous"}]})},1e3)},D=async M=>{if(!i||!V.value)return;const j=Math.min(Math.max(M,1),I.value);S.value=j;try{await i.applyConstraints({advanced:[{zoom:j}]})}catch(z){console.error("Failed to set zoom:",z)}},q=async()=>{if(!(!i||!b.value))try{l.value==="user"?(w.value=!w.value,_.value=w.value):(await i.applyConstraints({advanced:[{torch:!w.value}]}),w.value=!w.value)}catch(M){console.error("Flash toggle failed:",M)}},le=async()=>{d.value&&(l.value=l.value==="environment"?"user":"environment",m&&m.getTracks().forEach(M=>M.stop()),await O())},re=async M=>new Promise(j=>{const z=y.value*1024;if(M.size<=z){j(M);return}const Z=new Image,Q=new FileReader;Q.onload=oe=>{Z.onload=()=>{const se=document.createElement("canvas"),ve=se.getContext("2d"),P=Math.sqrt(z/M.size);se.width=Z.width*P,se.height=Z.height*P,ve.drawImage(Z,0,0,se.width,se.height);let n=.9;const x=()=>{se.toBlob(v=>{v.size>z&&n>.1?(n-=.1,x()):j(v)},"image/jpeg",n)};x()},Z.src=oe.target.result},Q.readAsDataURL(M)}),be=async()=>{if(!(R.value||!r.value||!c.value)){R.value=!0;try{const M=r.value,j=c.value,z=M.videoWidth,Z=M.videoHeight;let Q,oe,se,ve;z/Z>a.aspectRatio?(oe=Z,Q=Z*a.aspectRatio,se=(z-Q)/2,ve=0):(Q=z,oe=z/a.aspectRatio,se=0,ve=(Z-oe)/2),j.width=Q,j.height=oe,j.getContext("2d").drawImage(M,se,ve,Q,oe,0,0,Q,oe);const n=await new Promise(v=>{j.toBlob(v,"image/jpeg",1)}),x=await re(n);if(x){const v=new File([x],`capture_${Date.now()}.jpeg`,{type:"image/jpeg",lastModified:Date.now()});g("photoCaptured",v),_.value=!0,setTimeout(()=>{_.value=!1},100)}}catch(M){console.error("Error capturing photo:",M),alert("Failed to capture photo. Please try again.")}finally{R.value=!1}}};return pe(()=>a.show,M=>{M?O():F()}),Ve(()=>{m&&m.getTracks().forEach(M=>M.stop())}),(M,j)=>{var z;return t.show?(s(),o("div",sa,[e("div",oa,[e("div",na,[e("p",la,U(t.settings.camera_aspect_ratio),1),e("div",ia,U(((z=t.point)==null?void 0:z.name)||"Camera"),1),e("button",{onClick:F,class:"p-2 rounded-full text-white hover:bg-gray-700 transition-colors"},j[2]||(j[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",{class:"webcam-video-container",style:xe(ae.value),onClick:f,onTouchstart:f},[e("video",{ref_key:"webcamVideo",ref:r,autoplay:"",playsinline:"",class:"webcam-video"},null,512),e("canvas",{ref_key:"webcamCanvas",ref:c,class:"hidden"},null,512),_.value?(s(),o("div",ra)):p("",!0),e("div",{class:"aspect-ratio-guide",style:xe(C.value)},null,4),A.value?(s(),o("div",{key:1,class:"focus-indicator",style:xe(B.value)},j[3]||(j[3]=[e("div",{class:"focus-ring"},null,-1)]),4)):p("",!0),j[4]||(j[4]=e("div",{class:"hd-badge"},[e("span",{class:"hd-text"},"HD")],-1)),V.value?(s(),o("div",ua,[we(e("input",{type:"range",min:"1",max:I.value,step:"0.1","onUpdate:modelValue":j[0]||(j[0]=Z=>S.value=Z),onInput:j[1]||(j[1]=Z=>D(parseFloat(Z.target.value))),class:"zoom-slider"},null,40,da),[[ke,S.value]])])):p("",!0)],36),e("div",ca,[e("div",ma,[t.settings.enable_flash&&b.value?(s(),o("button",{key:0,onClick:q,class:J(["control-button",{active:w.value,disabled:!b.value}])},j[5]||(j[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)]),2)):p("",!0),e("button",{onClick:be,class:"capture-button",disabled:R.value},[e("div",ga,[R.value?(s(),o("div",pa)):(s(),o("div",fa,j[6]||(j[6]=[e("div",{class:"camera-lens"},null,-1),e("div",{class:"camera-flash"},null,-1)])))])],8,va),t.settings.enable_camera_switch&&d.value?(s(),o("button",{key:1,onClick:le,class:"control-button"},j[7]||(j[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})],-1)]))):p("",!0)])])])])):p("",!0)}}},ba=ye(ha,[["__scopeId","data-v-b94530cf"]]),wa={key:0,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center"},xa={class:"w-full h-full flex flex-col"},ya={class:"flex justify-between items-center p-4 bg-black bg-opacity-70 text-white shadow-md"},ka=["disabled"],$a={class:"text-lg font-semibold"},Ia={class:"flex items-center gap-2"},Ca=["disabled"],Va=["disabled"],Sa={key:0,class:"bg-blue-900 bg-opacity-50 text-white p-3"},Ma={class:"flex items-center justify-between mb-2"},Ua={class:"text-xs"},_a={class:"w-full bg-blue-700 bg-opacity-50 rounded-full h-2"},Na={class:"text-xs mt-1 text-blue-300"},ja={class:"flex-1 flex items-center justify-center overflow-hidden relative"},Ta=["src"],Ba={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},La=["disabled"],Pa=["disabled"],Da={class:"flex flex-col gap-3 p-4 bg-black bg-opacity-70 shadow-inner"},Aa={class:"flex justify-between items-center w-full"},Fa=["disabled"],Ra={key:1,class:"flex-1"},qa=["disabled"],Ea={class:"flex gap-3 w-full"},za={key:1,class:"flex-1 px-4 py-3 bg-gradient-to-r from-indigo-700 to-sky-600 rounded-lg cursor-not-allowed flex items-center justify-center font-medium opacity-75",disabled:""},Ha={class:"flex items-center gap-2"},Oa={key:0,class:"text-center"},Wa={__name:"PreviewModal",props:{show:Boolean,images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},allowMultiple:Boolean,maxFiles:Number,isUploading:Boolean,aspectRatio:Number,point:Object,uploadProgress:{type:Number,default:0},currentUpload:{type:Number,default:0},totalUpload:{type:Number,default:0}},emits:["close","saveImages","removePreviewImage","triggerAddMorePhotos","update:images"],setup(t,{emit:E}){const a=t,g=E,r=k(0),c=k([]),m=Y(()=>c.value.length>0?c.value[r.value]:null);pe(()=>a.images,S=>{c.value=S.map(I=>({...I,rotation:I.rotation||0})),S.length===0&&a.show&&_()},{deep:!0,immediate:!0}),pe(()=>a.show,S=>{S&&a.images.length>0&&(r.value=a.initialIndex)}),pe(()=>a.uploadProgress,S=>{S===100&&console.log("Upload completed")});const i=S=>S.preview||(S.image_path?`/${S.image_path}`:""),l=()=>{if(m.value&&!a.isUploading){const S=(m.value.rotation+90)%360;c.value[r.value].rotation=S,g("update:images",c.value)}},d=()=>{a.isUploading||(r.value=r.value<c.value.length-1?r.value+1:0)},b=()=>{a.isUploading||(r.value=r.value>0?r.value-1:c.value.length-1)},w=()=>{a.isUploading||g("saveImages",c.value)},_=()=>{a.isUploading||g("close")},A=()=>{if(m.value&&!a.isUploading){const S=m.value,I=c.value.findIndex(V=>V.isNew&&S.isNew&&V.preview===S.preview||!V.isNew&&!S.isNew&&V.id===S.id);I!==-1&&(g("removePreviewImage",S),c.value.splice(I,1),g("update:images",c.value)),r.value>=c.value.length&&(r.value=Math.max(0,c.value.length-1)),c.value.length===0&&g("close")}},B=()=>{a.isUploading||g("triggerAddMorePhotos")},R=S=>{S.key==="Escape"&&!a.isUploading&&_()};return Ie(()=>{document.addEventListener("keydown",R)}),Ve(()=>{document.removeEventListener("keydown",R)}),(S,I)=>{var V;return t.show?(s(),o("div",wa,[e("div",xa,[e("div",ya,[e("button",{onClick:_,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},I[0]||(I[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ka),e("div",$a,U(((V=t.point)==null?void 0:V.name)||"Preview")+" ("+U(r.value+1)+"/"+U(c.value.length)+") ",1),e("div",Ia,[m.value&&m.value.isNew?(s(),o("button",{key:0,onClick:A,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors","aria-label":"Remove new image",disabled:t.isUploading},I[1]||(I[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]),8,Ca)):p("",!0),m.value&&m.value.isNew?(s(),o("button",{key:1,onClick:l,class:"p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",disabled:t.isUploading},I[2]||(I[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,Va)):p("",!0)])]),t.isUploading?(s(),o("div",Sa,[e("div",Ma,[I[3]||(I[3]=e("span",{class:"text-sm font-medium"},"Mengupload gambar...",-1)),e("span",Ua,U(t.uploadProgress)+"%",1)]),e("div",_a,[e("div",{class:"bg-blue-400 h-2 rounded-full transition-all duration-300",style:xe({width:t.uploadProgress+"%"})},null,4)]),e("p",Na,U(t.currentUpload)+"/"+U(t.totalUpload)+" gambar terupload",1)])):p("",!0),e("div",ja,[e("div",{class:"relative w-full max-w-full",style:xe({paddingTop:t.aspectRatio?100/t.aspectRatio+"%":"75%"})},[m.value?(s(),o("img",{key:0,src:i(m.value),class:"absolute inset-0 w-full h-full object-contain transition-transform duration-300 ease-in-out bg-black",style:xe({transform:`rotate(${m.value.rotation}deg)`})},null,12,Ta)):p("",!0),m.value&&m.value.isUploading?(s(),o("div",Ba,I[4]||(I[4]=[e("div",{class:"text-center text-white"},[e("div",{class:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e("p",{class:"text-sm"},"Mengupload...")],-1)]))):p("",!0)],4),c.value.length>1&&!t.isUploading?(s(),o("button",{key:0,onClick:b,class:"absolute left-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},I[5]||(I[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,La)):p("",!0),c.value.length>1&&!t.isUploading?(s(),o("button",{key:1,onClick:d,class:"absolute right-4 p-3 bg-black bg-opacity-50 text-white rounded-full hover:bg-opacity-70 transition-colors",disabled:t.isUploading},I[6]||(I[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,Pa)):p("",!0)]),e("div",Da,[e("div",Aa,[m.value&&!m.value.isNew?(s(),o("button",{key:0,onClick:A,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-red-400",disabled:t.isUploading},I[7]||(I[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),de(" Hapus Foto ")]),8,Fa)):(s(),o("div",Ra)),t.allowMultiple&&c.value.length<t.maxFiles&&!t.isUploading?(s(),o("button",{key:2,onClick:B,class:"px-3 py-2 rounded-lg text-white font-medium flex items-center gap-1 transition-colors hover:text-indigo-400",disabled:t.isUploading},I[8]||(I[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),de(" Tambah Foto ")]),8,qa)):p("",!0)]),e("div",Ea,[t.isUploading?(s(),o("button",za,[e("div",Ha,[I[9]||(I[9]=e("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),e("span",null,"Mengupload... "+U(t.uploadProgress)+"%",1)])])):(s(),o("button",{key:0,onClick:w,class:"flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-indigo-700 to-sky-600 shadow-lg text-white transition-colors font-medium hover:from-indigo-600 hover:to-sky-500"}," Simpan & Upload "))]),t.isUploading?(s(),o("div",Oa,I[10]||(I[10]=[e("p",{class:"text-xs text-blue-300"}," Modal akan tertutup otomatis. Upload terus berjalan di background. ",-1)]))):p("",!0)])])])):p("",!0)}}},Ka=ye(Wa,[["__scopeId","data-v-a18bbf7c"]]),Za=["accept","multiple","disabled"],Ga={class:"text-xs text-gray-500 mb-2"},Ja=["disabled"],Xa={class:"h-full flex flex-col items-center justify-center p-4 text-center"},Ya={class:"text-xs text-gray-400 mt-1"},Qa={key:0,class:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg"},es={class:"flex items-center justify-between mb-2"},ts={class:"text-xs text-blue-600"},as={class:"w-full bg-blue-200 rounded-full h-2"},ss={class:"text-xs text-blue-600 mt-1"},os={key:1,class:"flex items-center gap-4"},ns=["src"],ls={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},is=["disabled"],rs={key:2,class:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide"},us=["disabled"],ds=["onClick"],cs=["src"],ms={key:0,class:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center text-white text-xs font-bold"},vs={key:0},gs={key:1,class:"ml-1"},ps={key:1,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},fs={key:2,class:"mt-1 text-xs text-red-600"},hs={__name:"InputImage",props:{modelValue:{type:Array,default:()=>[]},error:String,inspectionId:{type:[String,Number],required:!0},pointId:{type:[String,Number],required:!0},settings:{type:Object,default:()=>({max_files:1,allowed_types:["jpg","png","jpeg"],camera_aspect_ratio:"3:4",enable_flash:!0,enable_camera_switch:!0,max_size:2048})},point:Object},emits:["update:modelValue","save","removeImage","uploaded","uploadProgress"],setup(t,{emit:E}){const a=t,g=E,r=k(null),c=k(null),m=k(!1),i=k(!1),l=k(!1),d=k([]),b=k(0),w=k(!1),_=k(0),A=k(0),B=k(0),R=`inspection-${a.inspectionId}-point-${a.pointId}-backup`,S=Y(()=>Number(a.settings.max_files)>1),I=Y(()=>a.settings.allowed_types.map(n=>`.${n}`).join(", ")),V=Y(()=>{const n=a.settings.camera_aspect_ratio.split(":");if(n.length===2){const x=parseFloat(n[0]),v=parseFloat(n[1]);if(!isNaN(x)&&!isNaN(v)&&v!==0)return x/v}return 3/4}),y=Y(()=>{const n=[],x=new Set;for(const v of a.modelValue)v.id&&x.add(v.id),n.push({...v,rotation:v.rotation||0,isNew:!1,isUploaded:!0,preview:v.preview||(v.image_path?`/${v.image_path}`:null)});for(const v of d.value)v.id&&x.add(v.id),n.push({...v,isUploading:v.isUploading||!1});return n}),ae=n=>n.preview||(n.image_path?`/${n.image_path}`:""),C=()=>{l.value&&(l.value=!1),m.value=!0},O=()=>{m.value=!1,r.value.click()},F=()=>{m.value=!1,i.value=!0},T=()=>{m.value=!1,y.value.length>0&&(l.value=!0)},f=()=>{i.value=!1,y.value.length>0&&(l.value=!0)},D=()=>{l.value=!1,w.value||(d.value.forEach(n=>{n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview)}),d.value=[])},q=n=>new Promise(x=>{const v=new FileReader;v.onload=$=>{const L=new Image;L.onload=()=>{x({file:n,preview:URL.createObjectURL(n),rotation:0,width:L.naturalWidth,height:L.naturalHeight,isNew:!0})},L.onerror=()=>{console.error("Failed to load image for dimensions:",n.name),x({file:n,preview:URL.createObjectURL(n),rotation:0,width:0,height:0,isNew:!0})},L.src=$.target.result},v.readAsDataURL(n)}),le=n=>{const x=n.name.split(".").pop().toLowerCase();return a.settings.allowed_types.includes(x)},re=async n=>{const v=(a.settings.max_size||2048)*1024;return new Promise($=>{const L=new Image,ee=new FileReader;ee.onload=W=>{L.onload=()=>{const X=document.createElement("canvas"),H=X.getContext("2d"),ne=Math.max(L.width,L.height);X.width=ne,X.height=ne,H.fillStyle="white",H.fillRect(0,0,ne,ne);const G=(ne-L.width)/2,h=(ne-L.height)/2;H.drawImage(L,G,h,L.width,L.height);let u=.9;const K=()=>{X.toBlob(N=>{if(N.size>v&&u>.1)u-=.1,K();else{const te=new File([N],n.name,{type:"image/jpeg",lastModified:Date.now()});$(te)}},"image/jpeg",u)};K()},L.src=W.target.result},ee.readAsDataURL(n)})},be=async n=>{const x=Array.from(n.target.files);if(!x.length){m.value=!1,y.value.length>0&&(l.value=!0);return}try{const v=x.filter(H=>!le(H));if(v.length>0){const H=v.map(ne=>ne.name.split(".").pop()).join(", ");alert(`File type not allowed: ${H}. Allowed types: ${a.settings.allowed_types.join(", ")}`),n.target.value="";return}const $=y.value.length,L=a.settings.max_files-$,ee=await Promise.all(x.slice(0,L).map(async H=>await re(H))),W=await Promise.all(ee.map(q)),X=S.value?W:W.slice(0,1);S.value?d.value.push(...X):(d.value.forEach(H=>{H.preview&&H.preview.startsWith("blob:")&&URL.revokeObjectURL(H.preview)}),d.value=X),m.value=!1,X.length>0?(b.value=Math.max(0,y.value.length-X.length),l.value=!0):y.value.length>0&&(l.value=!0),n.target.value=""}catch(v){console.error("Error processing selected images:",v),alert("Failed to process selected images. Please try again."),m.value=!1,y.value.length>0&&(l.value=!0)}},M=async n=>{const x=y.value.length;if(!S.value||x<a.settings.max_files)try{const v=await re(n),$=new Image;$.onload=()=>{const L={file:v,preview:URL.createObjectURL(v),rotation:0,width:$.naturalWidth,height:$.naturalHeight,isNew:!0};S.value?d.value.push(L):(d.value.forEach(ee=>{ee.preview&&ee.preview.startsWith("blob:")&&URL.revokeObjectURL(ee.preview)}),d.value=[L]),i.value=!1,m.value=!1,b.value=y.value.length-1,l.value=!0},$.src=URL.createObjectURL(v)}catch(v){console.error("Error processing captured image:",v),alert("Failed to process captured image. Please try again.")}else alert(`Maximum ${a.settings.max_files} files allowed.`),i.value=!1,m.value=!1,y.value.length>0&&(l.value=!0)},j=(n=0)=>{b.value=n,l.value=!0},z=n=>new Promise(x=>{if(n.rotation===0||!c.value){if(!n.isNew&&!n.file){x({file:null,width:n.width,height:n.height,isOriginal:!0});return}x({file:n.file,width:n.width,height:n.height});return}const v=new Image;v.onload=async()=>{try{const $=c.value,L=$.getContext("2d"),ee=v.width,W=v.height;let X,H;n.rotation===90||n.rotation===270?(X=W,H=ee):(X=ee,H=W),$.width=X,$.height=H,L.clearRect(0,0,$.width,$.height),L.translate($.width/2,$.height/2),L.rotate(n.rotation*Math.PI/180),L.drawImage(v,-ee/2,-W/2,ee,W),L.setTransform(1,0,0,1,0,0);const ne=await new Promise(u=>{$.toBlob(u,"image/jpeg",.9)}),G=new File([ne],n.file?n.file.name:`rotated_image_${Date.now()}.jpg`,{type:"image/jpeg"}),h=await re(G);x({file:h,width:X,height:H})}catch($){console.error("Error processing rotated image:",$),x({file:n.file,width:n.width,height:n.height})}},v.onerror=()=>{console.error("Failed to load image for rotation processing:",n.preview),x({file:n.file,width:n.width,height:n.height})},v.src=n.preview}),Z=n=>{try{const x={images:n.map(v=>{var $;return{fileName:(($=v.file)==null?void 0:$.name)||`image-${Date.now()}.jpg`,rotation:v.rotation||0,width:v.width||0,height:v.height||0,timestamp:Date.now()}}),inspectionId:a.inspectionId,pointId:a.pointId};localStorage.setItem(R,JSON.stringify(x))}catch(x){console.error("Error saving backup:",x)}},Q=()=>{localStorage.removeItem(R)},oe=async n=>{w.value=!0;const x=[],v=[];if(!a.pointId){alert("Error: Point ID is missing. Cannot upload image."),w.value=!1;return}try{Z(n);for(const $ of n){if(!$.isNew&&$.rotation===0&&$.id&&$.image_path){x.push({id:$.id,image_path:$.image_path,width:$.width,height:$.height,rotation:0,preview:$.preview,isUploaded:!0});continue}const{file:L,width:ee,height:W,isOriginal:X}=await z($);if(X&&!$.isNew){x.push({id:$.id,image_path:$.image_path,width:$.width,height:$.height,rotation:$.rotation||0,preview:$.preview,isUploaded:!0});continue}L&&v.push({file:L,width:ee,height:W,rotation:$.rotation||0,originalImage:$})}D(),v.length>0?await se(v,x):(g("update:modelValue",x),g("save",a.pointId))}catch($){console.error("Error during image processing:",$),alert("Terjadi error saat memproses gambar. Data tersimpan secara lokal.")}finally{w.value=!1}},se=async(n,x)=>{var v,$,L,ee;B.value=n.length,A.value=0,_.value=0;try{const W=new FormData;W.append("inspection_id",a.inspectionId),W.append("point_id",a.pointId),n.forEach((G,h)=>{W.append("images[]",G.file);const u=d.value.findIndex(K=>{var N;return K.preview===((N=G.originalImage)==null?void 0:N.preview)});u!==-1&&(d.value[u].isUploading=!0)});const H=(await Ne.post(route("inspections.upload-image"),W,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:G=>{G.total&&(_.value=Math.round(G.loaded*100/G.total),A.value=Math.floor(G.loaded/G.total*n.length))}})).data.images,ne=[...x];for(let G=0;G<H.length;G++){const h=H[G],u=(v=n[G])==null?void 0:v.originalImage;ne.push({id:h.image_id,image_path:h.path,width:h.width||(u==null?void 0:u.width)||0,height:h.height||(u==null?void 0:u.height)||0,rotation:(($=n[G])==null?void 0:$.rotation)||0,preview:h.public_url,isUploaded:!0}),u!=null&&u.preview&&u.preview.startsWith("blob:")&&URL.revokeObjectURL(u.preview)}d.value=d.value.filter(G=>!n.some(h=>{var u;return((u=h.originalImage)==null?void 0:u.preview)===G.preview})),g("update:modelValue",ne),g("save",a.pointId),g("uploaded",{pointId:a.pointId,images:ne,newImagesCount:H.length}),Q(),console.log(`✅ Successfully uploaded ${H.length} images`)}catch(W){throw console.error("Error uploading images:",W),d.value.forEach(X=>{X.isUploading=!1}),(ee=(L=W.response)==null?void 0:L.data)!=null&&ee.message?alert(`Upload gagal: ${W.response.data.message}. Data tersimpan secara lokal.`):alert(`Upload gagal: ${W.message}. Data tersimpan secara lokal.`),W}finally{_.value=0,A.value=0,B.value=0}},ve=n=>{if(n){if(n.id&&!n.isNew)P(n);else{const x=d.value.findIndex(v=>v.preview&&v.preview===n.preview&&v.isNew||v.id&&v.id===n.id);if(x!==-1){const v=d.value.splice(x,1)[0];v.preview&&v.preview.startsWith("blob:")&&URL.revokeObjectURL(v.preview)}g("update:modelValue",a.modelValue.filter(v=>!(v.id&&v.id===n.id)&&!(v.preview&&v.preview===n.preview)))}b.value>=y.value.length&&(b.value=Math.max(0,y.value.length-1)),y.value.length===0&&D()}},P=async n=>{var v,$;if(n.id||n.image_path)try{await Ne.delete(route("inspections.delete-image"),{data:{image_id:n.id,image_path:n.image_path}})}catch(L){console.error("Error deleting image from server:",L),($=(v=L.response)==null?void 0:v.data)!=null&&$.message?alert(`Failed to delete image from server: ${L.response.data.message}`):alert(`Failed to delete image from server: ${L.message}`);return}n.preview&&n.preview.startsWith("blob:")&&URL.revokeObjectURL(n.preview);const x=a.modelValue.filter(L=>L.id!==n.id);g("update:modelValue",x),d.value=d.value.filter(L=>L.isNew&&n.isNew?L.preview!==n.preview:L.id!==n.id),g("removeImage",{image:n}),l.value&&y.value.length===0?D():l.value&&b.value>=y.value.length&&(b.value=Math.max(0,y.value.length-1))};return Ie(()=>{try{localStorage.getItem(R)&&console.log("Found backup images, ready for recovery if needed")}catch(n){console.error("Error loading backup:",n)}}),(n,x)=>(s(),o("div",null,[e("input",{ref_key:"galleryInput",ref:r,type:"file",accept:I.value,class:"hidden",onChange:be,multiple:S.value,disabled:w.value},null,40,Za),e("canvas",{ref_key:"processingCanvas",ref:c,class:"hidden"},null,512),e("p",Ga,"Foto Maksimal: "+U(t.settings.max_files)+" | Rasio: "+U(t.settings.camera_aspect_ratio),1),y.value.length===0?(s(),o("label",{key:0,onClick:C,class:J(["block w-full border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 h-28",{"border-gray-300 hover:border-indigo-400 bg-gray-50":!0}]),disabled:w.value},[e("div",Xa,[x[2]||(x[2]=e("svg",{class:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),x[3]||(x[3]=e("p",{class:"text-sm text-gray-600 font-medium"},"Upload Image",-1)),e("p",Ya,"Tipe: "+U(I.value),1)])],8,Ja)):(s(),o("div",{key:1,class:J(["block w-full rounded-lg transition-colors duration-200 p-2",{"border-2 border-dashed border-indigo-200 bg-indigo-50 h-auto p-2":t.settings.max_files==1,"bg-transparent":t.settings.max_files>1}]),"aria-label":"Image gallery"},[w.value?(s(),o("div",Qa,[e("div",es,[x[4]||(x[4]=e("span",{class:"text-sm font-medium text-blue-700"},"Mengupload gambar...",-1)),e("span",ts,U(_.value)+"%",1)]),e("div",as,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:xe({width:_.value+"%"})},null,4)]),e("p",ss,U(A.value)+"/"+U(B.value)+" gambar terupload",1)])):p("",!0),t.settings.max_files===1?(s(),o("div",os,[e("div",{class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:x[0]||(x[0]=v=>j(0))},[e("img",{src:ae(y.value[0]),class:"w-full h-full object-cover"},null,8,ns),y.value[0].isUploading?(s(),o("div",ls,x[5]||(x[5]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0)]),e("button",{onClick:x[1]||(x[1]=Ce(v=>P(y.value[0]),["stop"])),type:"button",class:"flex items-center gap-1 text-red-600 font-medium hover:text-red-800 transition-colors",disabled:w.value},x[6]||(x[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.095 21H7.905a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),de(" Hapus Foto ")]),8,is)])):(s(),o("div",rs,[S.value&&y.value.length<t.settings.max_files?(s(),o("div",{key:0,class:"flex-shrink-0 flex flex-col items-center justify-center p-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-indigo-500 transition-colors w-24 h-24",onClick:C,disabled:w.value},x[7]||(x[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("p",{class:"mt-1 text-xs text-gray-600"},"Tambah",-1)]),8,us)):p("",!0),(s(!0),o(fe,null,he(y.value,(v,$)=>(s(),o("div",{key:v.id||v.preview,class:"relative flex-shrink-0 w-24 h-24 overflow-hidden rounded-md border border-gray-200 cursor-pointer",onClick:L=>j($)},[e("img",{src:ae(v),class:"w-full h-full object-cover"},null,8,cs),v.isNew||v.rotation!==0?(s(),o("div",ms,[v.isNew?(s(),o("span",vs,"BARU")):p("",!0),v.rotation!==0?(s(),o("span",gs,"ROTASI")):p("",!0)])):p("",!0),v.isUploading?(s(),o("div",ps,x[8]||(x[8]=[e("div",{class:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):p("",!0)],8,ds))),128))]))],2)),t.error?(s(),o("p",fs,U(t.error),1)):p("",!0),ge(aa,{show:m.value,settings:t.settings,onClose:T,onOpenWebcam:F,onTriggerGallery:O},null,8,["show","settings"]),ge(ba,{show:i.value,"aspect-ratio":V.value,settings:t.settings,point:t.point,onClose:f,onPhotoCaptured:M},null,8,["show","aspect-ratio","settings","point"]),ge(Ka,{show:l.value,images:y.value,point:t.point,"initial-index":b.value,"allow-multiple":S.value,"max-files":t.settings.max_files,"is-uploading":w.value,"aspect-ratio":V.value,"upload-progress":_.value,"current-upload":A.value,"total-upload":B.value,onClose:D,onSaveImages:oe,onRemovePreviewImage:ve,onTriggerAddMorePhotos:C},null,8,["show","images","point","initial-index","allow-multiple","max-files","is-uploading","aspect-ratio","upload-progress","current-upload","total-upload"])]))}},Te=ye(hs,[["__scopeId","data-v-e67efd07"]]),bs={key:0,class:"fixed inset-0 z-50 overflow-hidden"},ws={class:"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[85vh] overflow-hidden flex flex-col"},xs={class:"px-4 pb-2 border-b border-gray-200"},ys={class:"text-lg font-semibold text-gray-900"},ks={key:0,class:"text-sm text-gray-500 mt-1"},$s={class:"flex-1 overflow-y-auto p-4"},Is={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},Cs={__name:"BottomSheetModal",props:{show:Boolean,title:String,subtitle:String},emits:["close"],setup(t,{emit:E}){const a=E,g=()=>{a("close")},r=c=>{c.key==="Escape"&&g()};return Ie(()=>{document.addEventListener("keydown",r)}),Ve(()=>{document.removeEventListener("keydown",r)}),(c,m)=>(s(),Se(De,{name:"bottom-sheet"},{default:$e(()=>[t.show?(s(),o("div",bs,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:g}),e("div",ws,[m[0]||(m[0]=e("div",{class:"flex justify-center py-3"},[e("div",{class:"w-12 h-1.5 bg-gray-300 rounded-full"})],-1)),e("div",xs,[e("h3",ys,U(t.title),1),t.subtitle?(s(),o("p",ks,U(t.subtitle),1)):p("",!0)]),e("div",$s,[je(c.$slots,"default",{},void 0,!0)]),c.$slots.footer?(s(),o("div",Is,[je(c.$slots,"footer",{},void 0,!0)])):p("",!0)])])):p("",!0)]),_:3}))}},Vs=ye(Cs,[["__scopeId","data-v-7893c2dc"]]),Ss={class:"space-y-4"},Ms={key:0,class:"mt-2"},Us={key:1,class:"mt-2"},_s={key:2,class:"mt-2"},Ns={key:3,class:"mt-2"},js={key:4,class:"mt-2"},Ts={class:"text-sm font-medium text-gray-700 mb-2"},Bs={key:0,class:"text-red-500"},Ls={key:0,class:"text-xs text-red-500"},Ps=["name","value","checked"],Ds={key:6,class:"space-y-2"},As={key:0,class:"text-red-500"},Fs={key:1,class:"text-xs text-red-500"},Rs={key:7,class:"mt-4"},qs={class:"text-sm font-medium text-gray-700 mb-2"},Es={key:0,class:"text-red-500"},zs={key:0,class:"text-xs text-red-500"},Hs={class:"flex gap-2"},Os=["disabled"],Be={__name:"RadioOptionModal",props:{show:Boolean,title:String,subtitle:String,name:String,options:{type:Array,default:()=>[]},selectedValue:String,notesValue:String,imagesValue:{type:Array,default:()=>[]},pointId:[String,Number],inspectionId:[String,Number],showTextarea:{type:Boolean,default:!0},showImageUpload:{type:Boolean,default:!0},selectedPoint:Object,point:Object},emits:["update:selectedValue","update:notesValue","update:imagesValue","close","save","hapus","saveTextarea","saveImage","saveText","saveNumber","saveAccount","saveDate"],setup(t,{emit:E}){const a=t,g=E,r=i=>g("hapus",i),c=Y(()=>a.options.find(i=>i.value===a.selectedValue)),m=Y(()=>{var l,d,b,w,_,A,B;if(a.point.input_type==="text"&&(!((l=a.notesValue)!=null&&l.trim())||a.point.settings.min_length&&a.notesValue.length<a.point.settings.min_length||a.point.settings.max_length&&a.notesValue.length>a.point.settings.max_length)||a.point.input_type==="number"&&(!((d=a.notesValue)!=null&&d.trim())||a.point.settings.min&&a.notesValue.length<a.point.settings.min||a.point.settings.max&&a.notesValue.length>a.point.settings.max)||a.point.input_type==="account"&&(!((b=a.notesValue)!=null&&b.trim())||a.point.settings.min_value&&a.notesValue.length<a.point.settings.min_value||a.point.settings.max_value&&a.notesValue.length>a.point.settings.max_value)||a.point.input_type==="date"&&(!((w=a.notesValue)!=null&&w.trim())||a.point.settings.min_date&&a.notesValue.length<a.point.settings.min_date||a.point.settings.max_date&&a.notesValue.length>a.point.settings.max_date)||a.point.input_type==="imageTOradio"&&a.imagesValue.length===0||a.options.length&&!a.selectedValue)return!1;const i=c.value;return!(a.showTextarea&&((_=i==null?void 0:i.settings)!=null&&_.show_textarea)&&(!((A=a.notesValue)!=null&&A.trim())||i.settings.min_length&&a.notesValue.length<i.settings.min_length||i.settings.max_length&&a.notesValue.length>i.settings.max_length)||a.showImageUpload&&((B=i==null?void 0:i.settings)!=null&&B.show_image_upload)&&(a.imagesValue.length===0||i.settings.max_files&&a.imagesValue.length>i.settings.max_files))});return(i,l)=>(s(),Se(Vs,{show:t.show,title:t.title,subtitle:t.subtitle,onClose:l[18]||(l[18]=d=>i.$emit("close"))},{footer:$e(()=>[t.selectedPoint?(s(),o("button",{key:0,onClick:l[15]||(l[15]=d=>r(t.pointId)),class:"flex items-center justify-center text-red-600 hover:text-red-800 mb-3"},l[20]||(l[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2-3H7m5 0v3"})],-1),de(" Hapus Data ")]))):p("",!0),e("div",Hs,[e("button",{type:"button",onClick:l[16]||(l[16]=d=>i.$emit("close")),class:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),e("button",{type:"button",onClick:l[17]||(l[17]=d=>i.$emit("save")),disabled:!m.value,class:"flex-1 px-4 py-2 bg-indigo-600 border border-transparent rounded-md shadow-sm text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Simpan ",8,Os)])]),default:$e(()=>{var d,b,w,_,A,B,R,S,I,V,y,ae,C,O,F,T,f,D,q,le,re,be,M,j,z,Z,Q,oe,se,ve;return[e("div",Ss,[t.point.input_type==="text"?(s(),o("div",Ms,[ge(Ut,{"model-value":t.notesValue,required:(d=t.point.settings)==null?void 0:d.is_required,"min-length":(b=t.point.settings)==null?void 0:b.min_length,"max-length":(w=t.point.settings)==null?void 0:w.max_length,allowSpace:(_=t.point.settings)==null?void 0:_.allow_space,textTransform:(A=t.point.settings)==null?void 0:A.text_transform,placeholder:((B=t.point.settings)==null?void 0:B.placeholder)||"Masukan text",error:i.error,"onUpdate:modelValue":l[0]||(l[0]=P=>i.$emit("update:notesValue",P)),onSave:l[1]||(l[1]=P=>i.$emit("saveText",P))},null,8,["model-value","required","min-length","max-length","allowSpace","textTransform","placeholder","error"])])):p("",!0),t.point.input_type==="number"?(s(),o("div",Us,[ge(Oe,{"model-value":t.notesValue,required:(R=t.point.settings)==null?void 0:R.is_required,min:(S=t.point.settings)==null?void 0:S.min,max:(I=t.point.settings)==null?void 0:I.max,step:((V=t.point.settings)==null?void 0:V.step)||1,placeholder:((y=t.point.settings)==null?void 0:y.placeholder)||"Masukan number",error:i.error,"onUpdate:modelValue":l[2]||(l[2]=P=>i.$emit("update:notesValue",P)),onSave:l[3]||(l[3]=P=>i.$emit("saveNumber",P))},null,8,["model-value","required","min","max","step","placeholder","error"])])):p("",!0),t.point.input_type==="account"?(s(),o("div",_s,[ge(Dt,{"model-value":t.notesValue,required:(ae=t.point.settings)==null?void 0:ae.is_required,placeholder:((C=t.point.settings)==null?void 0:C.placeholder)||"Masukkan nilai",error:i.error,"point-id":t.pointId,settings:t.point.settings,"onUpdate:modelValue":l[4]||(l[4]=P=>i.$emit("update:notesValue",P)),onSave:l[5]||(l[5]=P=>i.$emit("saveAccount",P))},null,8,["model-value","required","placeholder","error","point-id","settings"])])):p("",!0),t.point.input_type==="date"?(s(),o("div",Ns,[ge(Tt,{"model-value":t.notesValue,required:(O=t.point.settings)==null?void 0:O.is_required,"min-date":(F=t.point.settings)==null?void 0:F.min_date,"max-date":(T=t.point.settings)==null?void 0:T.max_date,error:i.error,"onUpdate:modelValue":l[6]||(l[6]=P=>i.$emit("update:notesValue",P)),onSave:l[7]||(l[7]=P=>i.$emit("saveDate",P))},null,8,["model-value","required","min-date","max-date","error"])])):p("",!0),t.point.input_type==="imageTOradio"?(s(),o("div",js,[e("h4",Ts,[(f=t.point.settings)!=null&&f.required?(s(),o("span",Bs,"*")):p("",!0)]),ge(Te,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point.inspection_point,"inspection-id":t.inspectionId,settings:t.point.settings,"onUpdate:modelValue":l[8]||(l[8]=P=>i.$emit("update:imagesValue",P)),onSave:l[9]||(l[9]=P=>i.$emit("saveImage",P))},null,8,["model-value","point-id","point","inspection-id","settings"]),(D=t.point.settings)!=null&&D.required&&t.imagesValue.length===0?(s(),o("p",Ls," Foto wajib diupload ")):p("",!0)])):p("",!0),t.options.length?(s(),o("div",{key:5,class:J(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(fe,null,he(t.options,(P,n)=>(s(),o("label",{key:n,class:"cursor-pointer"},[e("input",{type:"radio",name:t.name,value:P.value,checked:t.selectedValue===P.value,onChange:l[10]||(l[10]=x=>i.$emit("update:selectedValue",x.target.value)),class:"hidden peer"},null,40,Ps),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.selectedValue===P.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.selectedValue!==P.value}])},U(P.label),3)]))),128))],2)):p("",!0),t.showTextarea&&((le=(q=c.value)==null?void 0:q.settings)!=null&&le.show_textarea)?(s(),o("div",Ds,[(re=c.value.settings)!=null&&re.required?(s(),o("span",As,"*")):p("",!0),ge(Wt,{"model-value":t.notesValue,"point-id":t.pointId,"inspection-id":t.inspectionId,settings:c.value.settings,required:(be=c.value.settings)==null?void 0:be.required,"min-length":(M=c.value.settings)==null?void 0:M.min_length,"max-length":(j=c.value.settings)==null?void 0:j.max_length,placeholder:((z=c.value.settings)==null?void 0:z.placeholder)||"Tambahkan keterangan...","onUpdate:modelValue":l[11]||(l[11]=P=>i.$emit("update:notesValue",P)),onSave:l[12]||(l[12]=P=>i.$emit("saveTextarea",P))},null,8,["model-value","point-id","inspection-id","settings","required","min-length","max-length","placeholder"]),(Z=c.value.settings)!=null&&Z.required&&!t.notesValue?(s(),o("p",Fs," Keterangan wajib diisi ")):p("",!0)])):p("",!0),t.showImageUpload&&((oe=(Q=c.value)==null?void 0:Q.settings)!=null&&oe.show_image_upload)?(s(),o("div",Rs,[e("h4",qs,[l[19]||(l[19]=de(" Upload Foto ")),(se=c.value.settings)!=null&&se.required?(s(),o("span",Es,"*")):p("",!0)]),ge(Te,{"model-value":t.imagesValue,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,settings:c.value.settings,"onUpdate:modelValue":l[13]||(l[13]=P=>i.$emit("update:imagesValue",P)),onSave:l[14]||(l[14]=P=>i.$emit("saveImage",P))},null,8,["model-value","point-id","point","inspection-id","settings"]),(ve=c.value.settings)!=null&&ve.required&&t.imagesValue.length===0?(s(),o("p",zs," Foto wajib diupload ")):p("",!0)])):p("",!0)])]}),_:1},8,["show","title","subtitle"]))}},Ws={class:"mt-2 space-y-2"},Ks=["name","value","checked","onChange","required"],Zs={key:0,class:"p-2 rounded-lg bg-gray-50"},Gs={key:0,class:"mt-2"},Js={class:"flex gap-2 overflow-x-auto",style:{"scrollbar-width":"none"}},Xs=["src"],Ys={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},Qs={key:1,class:"mt-2"},eo={class:"text-sm text-gray-600"},to={key:2,class:"mt-2 text-sm text-red-600"},Ro={__name:"InputRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:E}){const a=t,g=E,r=k(a.notes),c=k([...a.images]),m=k(!1),i=k(""),l=k([]),d=k(""),b=k([]),w=Y(()=>a.options.find(C=>C.value===a.modelValue)),_=C=>C.settings&&(C.settings.show_textarea||C.settings.show_image_upload);pe(()=>a.notes,C=>{r.value=C}),pe(()=>a.images,C=>{c.value=[...C]}),pe(()=>a.modelValue,C=>{C&&(d.value=C)});const A=C=>{g("update:modelValue",C.value),_(C)?R():g("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:C.value,notes:"",images:[]})},B=C=>C.preview||(C.image_path?`/${C.image_path}`:C),R=()=>{d.value=a.modelValue,i.value=r.value,l.value=[...c.value],b.value=[...c.value],m.value=!0},S=()=>{i.value="",l.value=[],d.value="",m.value=!1},I=C=>{l.value=C,c.value=[...C],g("update:images",[...C]),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...C]})},V=C=>{},y=()=>{d.value!==a.modelValue&&g("update:modelValue",d.value),r.value=i.value,g("update:notes",i.value),c.value=[...l.value],g("update:images",[...l.value]),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:d.value,notes:i.value,images:l.value}),m.value=!1},ae=C=>{d.value="",i.value="",l.value=[],r.value="",c.value=[],g("update:modelValue",""),g("update:notes",""),g("update:images",[]),g("hapus",C),m.value=!1};return(C,O)=>{var F,T,f,D;return s(),o("div",Ws,[e("div",{class:J(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(fe,null,he(t.options,(q,le)=>(s(),o("label",{key:le,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:q.value,checked:t.modelValue===q.value,onChange:re=>A(q),class:"hidden peer",required:t.required},null,40,Ks),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===q.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==q.value}])},U(q.label),3)]))),128))],2),t.modelValue&&w.value&&_(w.value)?(s(),o("div",Zs,[e("div",{class:"flex justify-between items-start"},[O[4]||(O[4]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail : ",-1)),e("button",{onClick:R,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),t.images.length>0&&((F=w.value.settings)!=null&&F.show_image_upload)?(s(),o("div",Gs,[e("div",Js,[(s(!0),o(fe,null,he(t.images,(q,le)=>(s(),o("div",{key:le,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:B(q),class:"w-full h-full object-cover rounded"},null,8,Xs),le===3&&t.images.length>4?(s(),o("span",Ys," +"+U(t.images.length-4),1)):p("",!0)]))),128))])])):p("",!0),t.notes&&((T=w.value.settings)!=null&&T.show_textarea)?(s(),o("div",Qs,[e("p",eo,U(t.notes),1)])):p("",!0)])):p("",!0),m.value?(s(),Se(Be,{key:(f=t.selectedPoint)==null?void 0:f.id,show:m.value,title:t.pointName||"Detail",subtitle:(D=w.value)==null?void 0:D.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":d.value,"notes-value":i.value,"images-value":l.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":O[0]||(O[0]=q=>d.value=q),"onUpdate:notesValue":O[1]||(O[1]=q=>i.value=q),"onUpdate:imagesValue":O[2]||(O[2]=q=>I(q)),onClose:S,onSave:y,onSaveTextarea:C.handleTextareaSave,onSaveImage:V,onHapus:O[3]||(O[3]=q=>ae(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point","onSaveTextarea"])):p("",!0),t.error?(s(),o("p",to,U(t.error),1)):p("",!0)])}}},ao={class:"mt-2 space-y-2"},so={key:0,class:"flex flex-wrap gap-3"},oo={key:1,class:"p-2"},no={key:0,class:"mt-2"},lo={class:"flex gap-2 overflow-x-auto scrollbar-hide"},io=["src"],ro={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-xs"},uo=["name","value","checked"],co={key:1,class:"mt-2"},mo={class:"text-sm text-gray-600"},vo={key:3,class:"mt-2 text-sm text-red-600"},qo={__name:"InputImageToRadio",props:{modelValue:String,required:Boolean,error:String,point:Object,pointId:[String,Number],pointName:String,inspectionId:[String,Number],options:{type:Array,default:()=>[]},selectedPoint:Object,notes:{type:String,default:""},images:{type:Array,default:()=>[]}},emits:["update:modelValue","update:notes","update:images","save","hapus"],setup(t,{emit:E}){const a=t,g=E,r=k(a.notes),c=k([...a.images]),m=k(!1),i=k(""),l=k([]),d=k(""),b=k([]),w=Y(()=>a.options.find(V=>V.value===a.modelValue)),_=V=>V.preview||(V.image_path?`/${V.image_path}`:V);pe(()=>a.notes,V=>{r.value=V});const A=()=>{d.value=a.modelValue||"",i.value=r.value,l.value=[...c.value],b.value=[...c.value],m.value=!0},B=()=>{i.value="",l.value=[],d.value="",m.value=!1},R=V=>{l.value=V,c.value=[...V],g("update:images",[...V]),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:a.modelValue,notes:r.value,images:[...V]})},S=()=>{d.value!==a.modelValue&&g("update:modelValue",d.value),r.value=i.value,g("update:notes",i.value),c.value=[...l.value],g("update:images",[...l.value]),g("save",{pointId:a.pointId,inspectionId:a.inspectionId,value:d.value,notes:i.value,images:l.value}),m.value=!1},I=V=>{d.value="",i.value="",l.value=[],r.value="",c.value=[],g("update:modelValue",""),g("update:notes",""),g("update:images",[]),g("hapus",V),m.value=!1};return(V,y)=>{var ae,C,O;return s(),o("div",ao,[!t.modelValue&&c.value.length===0&&!r.value?(s(),o("div",so,[e("div",{class:"relative w-28 h-28 border-2 border-dashed rounded-lg flex items-center justify-center cursor-pointer overflow-hidden",onClick:A},y[4]||(y[4]=[e("div",{class:"flex flex-col items-center text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),e("span",{class:"text-xs font-medium"},"Tambah")],-1)]))])):(s(),o("div",oo,[e("div",{class:"flex justify-between items-start"},[y[5]||(y[5]=e("h4",{class:"text-sm font-medium text-gray-700"},"Detail :",-1)),e("button",{onClick:A,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Edit ")]),c.value.length>0?(s(),o("div",no,[e("div",lo,[(s(!0),o(fe,null,he(c.value,(F,T)=>(s(),o("div",{key:T,class:"relative flex-shrink-0",style:{width:"130px",height:"130px"}},[e("img",{src:_(F),class:"w-full h-full object-cover rounded"},null,8,io),T===3&&c.value.length>4?(s(),o("span",ro," +"+U(c.value.length-4),1)):p("",!0)]))),128))])])):p("",!0),e("div",{class:J(["grid gap-2 w-full mt-2",`grid-cols-${Math.min(t.options.length,3)}`])},[(s(!0),o(fe,null,he(t.options,(F,T)=>(s(),o("label",{key:T,class:"cursor-pointer"},[e("input",{type:"radio",name:"radio-"+t.pointId,value:F.value,checked:t.modelValue===F.value,disabled:!0,class:"hidden peer"},null,8,uo),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":t.modelValue===F.value,"border-gray-300 text-gray-700 hover:bg-gray-50":t.modelValue!==F.value}])},U(F.label),3)]))),128))],2),r.value&&((ae=w.value.settings)!=null&&ae.show_textarea)?(s(),o("div",co,[e("p",mo,U(r.value),1)])):p("",!0)])),m.value?(s(),Se(Be,{key:(C=t.selectedPoint)==null?void 0:C.id,show:m.value,title:t.pointName||"Detail",subtitle:(O=w.value)==null?void 0:O.description,name:"modal-radio-"+t.pointId,options:t.options,"selected-value":d.value,"notes-value":i.value,"images-value":l.value,"point-id":t.pointId,point:t.point,"inspection-id":t.inspectionId,"selected-point":t.selectedPoint,"onUpdate:selectedValue":y[0]||(y[0]=F=>d.value=F),"onUpdate:notesValue":y[1]||(y[1]=F=>i.value=F),"onUpdate:imagesValue":y[2]||(y[2]=F=>R(F)),onClose:B,onSave:S,onHapus:y[3]||(y[3]=F=>I(t.pointId))},null,8,["show","title","subtitle","name","options","selected-value","notes-value","images-value","point-id","point","inspection-id","selected-point"])):p("",!0),t.error?(s(),o("p",vo,U(t.error),1)):p("",!0)])}}},go={class:"bg-gray-50 shadow-lg rounded-xl overflow-hidden border border-gray-100"},po={class:"p-4 space-y-4-6"},fo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},ho=["value"],bo={class:"p-4 space-y-4-6"},wo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},xo=["value"],yo={key:0,class:"p-4 space-y-4"},ko={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full"},$o=["value"],Io={class:"p-4 space-y-2"},Co={class:"flex gap-1 mb-2 p-2 bg-gray-100 rounded-md"},Vo={key:0,class:"text-xs text-gray-500 mb-2"},So={key:0,class:"font-bold mx-1"},Mo={key:1,class:"italic mx-1"},Uo={key:2,class:"underline mx-1"},_o={class:"text-xs mt-1 text-gray-500"},No={__name:"ConclusionSection",props:{inspectionId:{type:Number,required:!0},inspection:{type:Object,required:!0}},setup(t){const E=t,a=k(null),g=k(!1),r=k(""),c=`inspection-${E.inspectionId}-conclusion`,m=Ae({bold:!1,italic:!1,underline:!1}),i=T=>{if(!T)return{};if(typeof T=="string")try{return JSON.parse(T)||{}}catch(f){return console.error("Error parsing settings JSON:",f),{}}return typeof T=="object"&&T!==null?T:{}},l=Y(()=>i(E.inspection.settings).conclusion||{}),d=k({flooded:l.value.flooded||"",collision:l.value.collision||"",collision_severity:l.value.collision_severity||"",conclusion_note:""}),b=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],w=[{value:"yes",label:"Ya"},{value:"no",label:"Tidak"}],_=[{value:"light",label:"Ringan"},{value:"heavy",label:"Berat"}];Ie(()=>{R(),A(),Fe(()=>{B(),S()})});const A=()=>{const T=localStorage.getItem(c);if(T)try{const f=JSON.parse(T);d.value={...d.value,...f},r.value="📱 Memuat draft tersimpan..."}catch(f){console.error("Error loading from localStorage:",f)}else E.inspection.notes&&(d.value.conclusion_note=E.inspection.notes)},B=()=>{a.value&&d.value.conclusion_note&&(a.value.innerHTML=d.value.conclusion_note)},R=()=>{const f=i(E.inspection.settings).conclusion||{};d.value.flooded=f.flooded||"",d.value.collision=f.collision||"",d.value.collision_severity=f.collision_severity||""},S=()=>{if(!a.value)return;const T=window.getSelection();T.rangeCount===0||T.isCollapsed||(m.bold=document.queryCommandState("bold"),m.italic=document.queryCommandState("italic"),m.underline=document.queryCommandState("underline"))},I=T=>{if(!a.value)return;a.value.focus();const f=m[T];switch(T){case"bold":document.execCommand("bold",!1,!f);break;case"italic":document.execCommand("italic",!1,!f);break;case"underline":document.execCommand("underline",!1,!f);break}setTimeout(()=>{S(),y()},10)},V=()=>{a.value&&(a.value.focus(),document.execCommand("removeFormat",!1,null),Object.keys(m).forEach(T=>{m[T]=!1}),y())},y=_e.debounce(()=>{a.value&&(d.value.conclusion_note=a.value.innerHTML,F())},500),ae=T=>{T.preventDefault(),document.execCommand("insertParagraph",!1,null)},C=T=>{T.preventDefault();const f=(T.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,f)},O=()=>{g.value=!1,a.value&&(d.value.conclusion_note=a.value.innerHTML,F())},F=_e.debounce(()=>{const T={flooded:d.value.flooded,collision:d.value.collision,collision_severity:d.value.collision==="yes"?d.value.collision_severity:null,conclusion_note:d.value.conclusion_note};localStorage.setItem(c,JSON.stringify(T)),r.value="💾 Menyimpan...",Re.post(route("inspections.updateConclusion",E.inspectionId),T,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{localStorage.removeItem(c),r.value="✅ Tersimpan"},onError:()=>{r.value="❌ Gagal menyimpan - data tersimpan secara lokal",setTimeout(()=>F(),3e3)}})},1e3);return pe([()=>d.value.flooded,()=>d.value.collision,()=>d.value.collision_severity],()=>{F()}),qe(()=>{r.value==="✅ Tersimpan"&&localStorage.removeItem(c)}),(T,f)=>(s(),o("div",go,[f[20]||(f[20]=e("div",{class:"bg-indigo-200 px-6 py-2 border-b"},[e("h3",{class:"text-xl font-semibold text-indigo-700"},"Kesimpulan Inspeksi")],-1)),e("div",po,[f[12]||(f[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de(" Apakah kendaraan pernah terkena banjir? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",fo,[(s(),o(fe,null,he(b,D=>e("label",{key:D.value,class:"cursor-pointer"},[we(e("input",{type:"radio","onUpdate:modelValue":f[0]||(f[0]=q=>d.value.flooded=q),value:D.value,class:"hidden peer",onChange:f[1]||(f[1]=(...q)=>me(F)&&me(F)(...q))},null,40,ho),[[Ue,d.value.flooded]]),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":d.value.flooded===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":d.value.flooded!==D.value}])},U(D.label),3)])),64))])]),e("div",bo,[f[14]||(f[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de(" Apakah kendaraan pernah mengalami tabrakan? "),e("span",{class:"text-red-500"},"*")],-1)),e("div",wo,[(s(),o(fe,null,he(w,D=>e("label",{key:D.value,class:"cursor-pointer"},[we(e("input",{type:"radio","onUpdate:modelValue":f[2]||(f[2]=q=>d.value.collision=q),value:D.value,class:"hidden peer",onChange:f[3]||(f[3]=(...q)=>me(F)&&me(F)(...q))},null,40,xo),[[Ue,d.value.collision]]),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":d.value.collision===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":d.value.collision!==D.value}])},U(D.label),3)])),64))]),d.value.collision==="yes"?(s(),o("div",yo,[f[13]||(f[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[de("Tingkat kerusakan: "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ko,[(s(),o(fe,null,he(_,D=>e("label",{key:D.value,class:"cursor-pointer"},[we(e("input",{type:"radio","onUpdate:modelValue":f[4]||(f[4]=q=>d.value.collision_severity=q),value:D.value,class:"hidden peer",onChange:f[5]||(f[5]=(...q)=>me(F)&&me(F)(...q))},null,40,$o),[[Ue,d.value.collision_severity]]),e("div",{class:J(["w-full px-4 py-3 border rounded-lg text-center transition-colors whitespace-nowrap text-sm font-medium",{"border-indigo-500 bg-indigo-50 text-indigo-700":d.value.collision_severity===D.value,"border-gray-300 text-gray-700 hover:bg-gray-50":d.value.collision_severity!==D.value}])},U(D.label),3)])),64))])])):p("",!0)]),e("div",Io,[f[19]||(f[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Kesimpulan",-1)),e("div",Co,[e("button",{type:"button",onClick:f[6]||(f[6]=D=>I("bold")),class:J(["p-2 rounded transition-colors font-medium",m.bold?"bg-indigo-500 text-white":"hover:bg-gray-200"]),title:"Bold"},f[15]||(f[15]=[e("strong",null,"B",-1)]),2),e("button",{type:"button",onClick:f[7]||(f[7]=D=>I("italic")),class:J(["p-2 rounded transition-colors font-medium",m.italic?"bg-indigo-500 text-white":"hover:bg-gray-200"]),title:"Italic"},f[16]||(f[16]=[e("em",null,"I",-1)]),2),e("button",{type:"button",onClick:f[8]||(f[8]=D=>I("underline")),class:J(["p-2 rounded transition-colors font-medium",m.underline?"bg-indigo-500 text-white":"hover:bg-gray-200"]),title:"Underline"},f[17]||(f[17]=[e("u",null,"U",-1)]),2),e("button",{type:"button",onClick:f[9]||(f[9]=D=>V()),class:"p-2 rounded hover:bg-gray-200 transition-colors ml-2",title:"Clear Formatting"}," 🗑️ Clear ")]),Object.values(m).some(D=>D)?(s(),o("div",Vo,[f[18]||(f[18]=de(" Format aktif: ")),m.bold?(s(),o("span",So,"Bold")):p("",!0),m.italic?(s(),o("span",Mo,"Italic")):p("",!0),m.underline?(s(),o("span",Uo,"Underline")):p("",!0)])):p("",!0),e("div",{ref_key:"editorRef",ref:a,contenteditable:"true",class:J(["w-full min-h-[120px] p-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 prose max-w-none",{"bg-white":!g.value,"bg-blue-50":g.value}]),onInput:f[10]||(f[10]=(...D)=>me(y)&&me(y)(...D)),onBlur:O,onFocus:f[11]||(f[11]=D=>g.value=!0),onKeydown:Ee(ae,["enter"]),onPaste:C,onMouseup:S,onKeyup:S,placeholder:"Tambahkan catatan kesimpulan inspeksi di sini..."},null,34),e("p",_o,U(r.value),1)])]))}},Eo=ye(No,[["__scopeId","data-v-1f51fbd1"]]);export{Vs as B,Eo as C,Te as I,Ao as V,Ut as _,Dt as a,Tt as b,Wt as c,Ro as d,qo as e,Fo as f,Be as g};
