import{x as se,p as re,r as b,q as h,E as A,G as ae,g as ie,H as ne,j as M,o as i,w as le,k as F,d as s,u as a,v as de,c as l,b as c,t as f,z as x,F as T,m as $,I as G,C as ue,A as H,n as ce,y as L}from"./vendor-BAtEjGXf.js";import{A as me}from"./AppLayout-CZWK4OuS.js";import{_ as pe,a as ge,b as fe}from"./CarSelectionWizard-0YtAHLGD.js";import{_ as be}from"./app-BkcWaOmJ.js";import"./lodash-ClksMqjB.js";import"./fuse-Ch1WBRTM.js";const ve={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},_e={class:"space-y-6 bg-white rounded-xl shadow-md p-6"},ye={key:0,class:"mb-4 text-sm text-red-600 bg-red-100 p-3 rounded-md"},he={class:"mb-2 flex justify-end"},xe={class:"mb-4"},ke=["value"],we={class:"mb-4 flex items-center justify-between"},Ce={class:"relative inline-flex items-center cursor-pointer"},Ie=["disabled"],Ae={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Me=["min"],Te={key:0,class:"mb-6"},$e=["value"],Le={class:"mt-6 flex justify-end"},je=["disabled"],Be={key:4,class:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ue={key:0,class:"mb-4"},Ve=["innerHTML"],Se={key:1},De={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},Pe=["onClick"],Ee=["src","alt"],ze={key:0,class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center p-2"},qe={class:"text-white text-xs text-center"},Ne={key:2,class:"text-center py-4 text-gray-500 text-sm"},Fe={class:"relative max-w-4xl max-h-full w-full h-full flex items-center justify-center"},Ge=["src","alt"],He={key:2,class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded-full text-sm"},Ke={key:3,class:"absolute bottom-4 left-4 text-white bg-black bg-opacity-50 px-3 py-1 rounded text-sm max-w-md"},Je={__name:"Index copy",props:{CarDetail:Array,Category:Array,team:Array,inspection:Array,activeInspections:Boolean},setup(j){const g=j,t=se({plate_number:"",car_id:null,car_name:"",category_id:"",is_scheduled:!1,scheduled_at_date:null,scheduled_at_time:null,inspector_id:null}),C=re(),v=C.props.global.user,B=C.props.global.region,d=C.props.global.has_roles,U=b(!1),K=b(new Date().toISOString().split("T")[0]),u=b(null),n=b([]),k=b(!1),m=b(0),w=b("search"),J=()=>{w.value=w.value==="search"?"wizard":"search",t.car_id=null,t.car_name="",u.value=null,n.value=[]},V=h(()=>d.includes("admin_plann"));A(()=>{V.value&&(t.is_scheduled=!0)});const S=o=>{var e,p,r;o.car_id&&o.car_name?(t.car_id=o.car_id,t.car_name=o.car_name,u.value=g.CarDetail.find(_=>_.id===o.car_id)||null):o.id&&(t.car_id=o.id,t.car_name=`${(e=o.brand)==null?void 0:e.name} ${(p=o.model)==null?void 0:p.name} ${(r=o.type)==null?void 0:r.name} ${Q(o.cc)} ${X(o.transmission)} ${o.fuel_type} ${o.year} (${o.production_period})`,u.value=o)},D=h(()=>g.activeInspections),O=h(()=>!(!t.plate_number.trim()||!t.category_id||!t.car_id&&!t.car_name.trim()||t.is_scheduled&&(!t.scheduled_at_date||!t.scheduled_at_time)||(d.includes("Admin")||d.includes("coordinator"))&&!t.inspector_id)),R=h(()=>t.is_scheduled?"Buat Jadwal":"Mulai Inspeksi"),W=h(()=>{const o=g.team.filter(y=>y.status==="active"),e=d.includes("Admin"),p=d.includes("admin_plann"),r=d.includes("coordinator"),_=d.includes("admin_region");return e||p?o:r?o.filter(y=>y.region_id===B.id):_?o.filter(y=>y.region_id===B.id):[]}),Q=o=>(o/1e3).toFixed(1)+"L",X=o=>({AT:"Automatic",MT:"Manual",CVT:"CVT",AMT:"AMT"})[o]||o,Y=o=>{U.value=!o},Z=o=>{console.log("Car data received from plate validation:",o),o?(t.car_id=o.id,t.car_name=o.name,o.id&&(u.value=g.CarDetail.find(e=>e.id===o.id)||null,u.value&&ee(u.value.id)),o.inspectionData&&console.log("Inspection data available:",o.inspectionData)):(t.car_id=null,t.car_name="",u.value=null,n.value=[])},ee=async o=>{try{const e=await fetch(`/api/cars/${o}/images`);if(e.ok){const p=await e.json();n.value=Array.isArray(p)?p:[]}else n.value=[]}catch(e){console.error("Error loading car images:",e),n.value=[]}},P=o=>{n.value=o},E=o=>o!=null&&o.file_path?`/storage/${o.file_path}`:"",te=o=>{m.value=o,k.value=!0,document.body.style.overflow="hidden"},I=()=>{k.value=!1,document.body.style.overflow=""},z=()=>{m.value=(m.value+1)%n.value.length},q=()=>{m.value=(m.value-1+n.value.length)%n.value.length},N=o=>{if(k.value)switch(o.key){case"Escape":I();break;case"ArrowRight":z();break;case"ArrowLeft":q();break}};A(()=>{const o=d.includes("Admin")||d.includes("coordinator");t.inspector_id=(v==null?void 0:v.id)||null}),A(()=>{D.value&&(t.is_scheduled=!0)}),ae(()=>t.car_id,o=>{o?u.value=g.CarDetail.find(e=>e.id===o)||null:(u.value=null,n.value=[])}),ie(()=>{window.addEventListener("keydown",N)}),ne(()=>{window.removeEventListener("keydown",N)});const oe=()=>{t.plate_number,t.car_id,t.car_name,t.category_id,t.is_scheduled,t.inspector_id,t.is_scheduled&&`${t.scheduled_at_date}${t.scheduled_at_time}`,t.post(route("inspections.store"),{preserveScroll:!0,onSuccess:()=>{},onError:()=>{}})};return(o,e)=>(i(),M(me,{title:"Buat Inspeksi Baru"},{default:le(()=>{var p;return[F(a(de),{title:"Inspek Baru"}),s("div",ve,[s("div",_e,[e[22]||(e[22]=s("div",{class:"mb-4"},[s("h3",{class:"text-xl md:text-3xl font-bold text-gray-900 mb-6 text-center"},"Buat Inspeksi Baru"),s("p",{class:"text-gray-600"},"Isi detail kendaraan dan jadwal untuk memulai inspeksi.")],-1)),a(t).errors.form_error?(i(),l("div",ye,f(a(t).errors.form_error),1)):c("",!0),F(pe,{"plate-number":a(t).plate_number,"onUpdate:plateNumber":e[0]||(e[0]=r=>a(t).plate_number=r),inspections:g.inspection,"car-detail":g.CarDetail,onPlateValidityUpdate:Y,onCarDataUpdate:Z},null,8,["plate-number","inspections","car-detail"]),s("div",he,[s("button",{onClick:J,class:"text-sm text-indigo-600 hover:text-indigo-800 underline"},f(w.value==="search"?"Ganti ke Pilihan Dropdown":"Ganti ke Pencarian Teks"),1)]),w.value==="search"?(i(),M(ge,{key:1,"car-id":a(t).car_id,"onUpdate:carId":e[1]||(e[1]=r=>a(t).car_id=r),"car-name":a(t).car_name,"onUpdate:carName":e[2]||(e[2]=r=>a(t).car_name=r),"car-detail":g.CarDetail,onCarSelected:S,onCarImagesLoaded:P},null,8,["car-id","car-name","car-detail"])):(i(),M(fe,{key:2,"car-detail":g.CarDetail,onCarSelected:S,onCarImagesLoaded:P},null,8,["car-detail"])),s("div",xe,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"category"}," Kategori Inspeksi ",-1)),x(s("select",{id:"category","onUpdate:modelValue":e[3]||(e[3]=r=>a(t).category_id=r),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[9]||(e[9]=s("option",{value:"",disabled:""},"Pilih Kategori",-1)),(i(!0),l(T,null,$(j.Category,r=>(i(),l("option",{key:r.id,value:r.id},f(r.name),9,ke))),128))],512),[[G,a(t).category_id]])]),s("div",we,[e[12]||(e[12]=s("label",{for:"schedule-toggle",class:"text-sm font-medium text-gray-700"},"Jadwalkan Inspeksi?",-1)),s("label",Ce,[x(s("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=r=>a(t).is_scheduled=r),id:"schedule-toggle",class:"sr-only peer",disabled:D.value||V.value},null,8,Ie),[[ue,a(t).is_scheduled]]),e[11]||(e[11]=s("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-700"},null,-1))])]),a(t).is_scheduled?(i(),l("div",Ae,[s("div",null,[e[13]||(e[13]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-date"}," Tanggal ",-1)),x(s("input",{type:"date",id:"schedule-date","onUpdate:modelValue":e[5]||(e[5]=r=>a(t).scheduled_at_date=r),min:K.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,8,Me),[[H,a(t).scheduled_at_date]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"schedule-time"}," Waktu ",-1)),x(s("input",{type:"time",id:"schedule-time","onUpdate:modelValue":e[6]||(e[6]=r=>a(t).scheduled_at_time=r),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},null,512),[[H,a(t).scheduled_at_time]])]),a(d).includes("Admin")||a(d).includes("coordinator")||a(d).includes("admin_plann")?(i(),l("div",Te,[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2",for:"inspector"}," Pilih Inspektor ",-1)),x(s("select",{id:"inspector","onUpdate:modelValue":e[7]||(e[7]=r=>a(t).inspector_id=r),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:""},[e[15]||(e[15]=s("option",{value:"",disabled:""},"Pilih Inspektor",-1)),(i(!0),l(T,null,$(W.value,r=>(i(),l("option",{key:r.id,value:r.user.id},f(r.user.name),9,$e))),128))],512),[[G,a(t).inspector_id]])])):c("",!0)])):c("",!0),s("div",Le,[s("button",{onClick:oe,disabled:!O.value||a(t).processing||U.value,class:ce({"px-6 py-2 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed":!0,"bg-gradient-to-r from-indigo-700 to-sky-600 border border-transparent text-white hover:bg-blue-700":!a(t).is_scheduled,"bg-gradient-to-r from-green-700 to-indigo-600 border-transparent text-white hover:bg-green-700":a(t).is_scheduled})},f(R.value),11,je)]),a(t).car_id&&u.value?(i(),l("div",Be,[u.value.description?(i(),l("div",Ue,[e[17]||(e[17]=s("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deskripsi:",-1)),s("div",{class:"prose prose-sm max-w-none text-gray-600",innerHTML:u.value.description},null,8,Ve)])):c("",!0),n.value.length>0?(i(),l("div",Se,[e[18]||(e[18]=s("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"Gambar Mobil:",-1)),s("div",De,[(i(!0),l(T,null,$(n.value,(r,_)=>(i(),l("div",{key:r.id||_,class:"relative group cursor-pointer",onClick:y=>te(_)},[s("img",{src:E(r),alt:r.name||"Car Image",class:"w-full h-24 object-cover rounded-lg border border-gray-200 transition-transform duration-200 group-hover:scale-105"},null,8,Ee),r.note?(i(),l("div",ze,[s("p",qe,f(r.note),1)])):c("",!0)],8,Pe))),128))])])):(i(),l("div",Ne," Tidak ada gambar tersedia untuk mobil ini "))])):c("",!0),k.value?(i(),l("div",{key:5,class:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4",onClick:I},[s("div",Fe,[s("button",{onClick:I,class:"absolute top-4 right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-colors"},e[19]||(e[19]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),n.value.length>1?(i(),l("button",{key:0,onClick:L(q,["stop"]),class:"absolute left-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[20]||(e[20]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]))):c("",!0),n.value.length>1?(i(),l("button",{key:1,onClick:L(z,["stop"]),class:"absolute right-4 z-10 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-70 transition-colors"},e[21]||(e[21]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))):c("",!0),s("img",{src:E(n.value[m.value]),alt:"Car Image "+(m.value+1),class:"max-w-full max-h-full object-contain",onClick:e[8]||(e[8]=L(()=>{},["stop"]))},null,8,Ge),n.value.length>1?(i(),l("div",He,f(m.value+1)+" / "+f(n.value.length),1)):c("",!0),(p=n.value[m.value])!=null&&p.note?(i(),l("div",Ke,f(n.value[m.value].note),1)):c("",!0)])])):c("",!0)])])]}),_:1}))}},Ze=be(Je,[["__scopeId","data-v-412bf4a7"]]);export{Ze as default};
