import{r as D,q as V,P as T,G as U,c as u,o as d,b as k,d as t,t as b,y as q,z as x,f,A as C,J as w,F,a as N,j as z,m as A,n as S}from"./vendor-C3sNAm3r.js";const H={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},O={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},J={class:"flex items-center justify-between p-4 border-b"},G={class:"text-lg font-bold"},K={class:"p-4"},L={class:"space-y-4"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q={class:"space-y-2"},W={class:"flex items-center"},X={class:"flex items-center"},Z={class:"space-y-2"},tt={class:"flex items-center"},et={class:"flex items-center"},st={class:"flex items-center"},at={class:"relative"},ot={class:"flex justify-end space-x-3 mt-6 pt-4 border-t"},nt=["disabled"],rt=["disabled"],lt={key:0},it={key:1},dt={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},ut={class:"bg-white rounded-lg shadow-xl w-96 mx-4"},ct={class:"p-6"},pt={class:"text-gray-700 mb-6"},mt={class:"flex justify-end space-x-3"},gt=["disabled"],bt={key:0},yt={key:1},xt={__name:"RepairEstimationModal",props:{showModal:Boolean,estimationData:Object,inspectionId:[String,Number],encryptedIds:String},emits:["close","saved","deleted"],setup(p,{emit:I}){const l=p,m=I,c=D(!1),g=D(!1),y=V(()=>{var n;return!!((n=l.estimationData)!=null&&n.id)}),s=T({part_name:"",repair_description:"",urgency:"segera",status:"perlu",estimated_cost:0,notes:""}),h=V({get:()=>s.estimated_cost?new Intl.NumberFormat("id-ID").format(s.estimated_cost):"",set:n=>{const e=n.replace(/[^\d]/g,"");s.estimated_cost=e?parseInt(e,10):0}}),_=()=>{s.part_name="",s.repair_description="",s.urgency="segera",s.status="perlu",s.estimated_cost=0,s.notes=""},$=n=>{const r=n.target.value.replace(/[^\d]/g,"");r?(s.estimated_cost=parseInt(r,10),n.target.value=new Intl.NumberFormat("id-ID").format(s.estimated_cost)):(s.estimated_cost=0,n.target.value="")},M=n=>{s.estimated_cost>0&&(n.target.value=new Intl.NumberFormat("id-ID").format(s.estimated_cost))};U(()=>l.estimationData,n=>{n&&Object.assign(s,n)},{immediate:!0});const E=async()=>{let n=null;y.value?m("saved",{...s,id:l.estimationData.id}):(n="temp-"+Date.now(),m("saved",{...s,id:n}));try{c.value=!0;const e=y.value?route("repair-estimations.update",{inspection:l.inspectionId,repair_estimation:l.estimationData.id}):route("repair-estimations.store",l.inspectionId),r=y.value?"put":"post",o=await N[r](e,s);m("saved",o.data),v()}catch(e){n&&m("error",n),console.error("Error saving estimation:",e),alert("Gagal menyimpan estimasi. Silakan coba lagi.")}finally{c.value=!1}},j=()=>{g.value=!0},B=async()=>{try{c.value=!0,await N.delete(route("repair-estimations.destroy",{inspection:l.inspectionId,repair_estimation:l.estimationData.id})),m("deleted",l.estimationData.id),g.value=!1,v()}catch(n){console.error("Error deleting estimation:",n),alert("Gagal menghapus estimasi. Silakan coba lagi.")}finally{c.value=!1}},v=()=>{_(),m("close")};return U(()=>l.showModal,n=>{n&&l.estimationData?Object.assign(s,l.estimationData):n&&!l.estimationData&&_()}),(n,e)=>(d(),u(F,null,[p.showModal?(d(),u("div",H,[t("div",O,[t("div",J,[t("h3",G,b(y.value?"Edit Estimasi Perbaikan":"Tambah Estimasi Perbaikan"),1),t("button",{onClick:v,class:"text-gray-400 hover:text-gray-600"},e[10]||(e[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",K,[t("form",{onSubmit:q(E,["prevent"])},[t("div",L,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[f(" Nama Part/Komponen "),t("span",{class:"text-red-500"},"*")],-1)),x(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>s.part_name=r),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contoh: Radiator, Rem Depan, dll"},null,512),[[C,s.part_name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[f(" Deskripsi Perbaikan "),t("span",{class:"text-red-500"},"*")],-1)),x(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.repair_description=r),required:"",rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Jelaskan jenis perbaikan yang diperlukan"},null,512),[[C,s.repair_description]])]),t("div",Y,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Urgensi "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Q,[t("label",W,[x(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=r=>s.urgency=r),value:"segera",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[w,s.urgency]]),e[13]||(e[13]=t("span",{class:"ml-2 text-sm text-gray-700"},"Segera",-1))]),t("label",X,[x(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=r=>s.urgency=r),value:"jangka_panjang",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[w,s.urgency]]),e[14]||(e[14]=t("span",{class:"ml-2 text-sm text-gray-700"},"Jangka Panjang",-1))])])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[f(" Status "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Z,[t("label",tt,[x(t("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=r=>s.status=r),value:"perlu",required:"",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[w,s.status]]),e[16]||(e[16]=t("span",{class:"ml-2 text-sm text-gray-700"},"Perlu",-1))]),t("label",et,[x(t("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=r=>s.status=r),value:"disarankan",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[w,s.status]]),e[17]||(e[17]=t("span",{class:"ml-2 text-sm text-gray-700"},"Disarankan",-1))]),t("label",st,[x(t("input",{type:"radio","onUpdate:modelValue":e[6]||(e[6]=r=>s.status=r),value:"opsional",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"},null,512),[[w,s.status]]),e[18]||(e[18]=t("span",{class:"ml-2 text-sm text-gray-700"},"Opsional",-1))])])])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[f(" Estimasi Biaya (Rp) "),t("span",{class:"text-red-500"},"*")],-1)),t("div",at,[e[20]||(e[20]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"Rp")],-1)),x(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>h.value=r),onInput:$,onBlur:M,required:"",class:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"},null,544),[[C,h.value]])]),e[22]||(e[22]=t("p",{class:"text-xs text-gray-500 mt-1"}," Masukkan angka tanpa titik atau koma ",-1))]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Catatan Tambahan ",-1)),x(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=r=>s.notes=r),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Catatan khusus atau informasi tambahan"},null,512),[[C,s.notes]])])]),t("div",ot,[t("button",{type:"button",onClick:v,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Batal "),y.value?(d(),u("button",{key:0,type:"button",onClick:j,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:c.value}," Hapus ",8,nt)):k("",!0),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:c.value},[c.value?(d(),u("span",lt,e[24]||(e[24]=[t("svg",{class:"animate-spin h-5 w-5 inline-block",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),f(" Menyimpan... ")]))):(d(),u("span",it,b(y.value?"Update":"Simpan"),1))],8,rt)])],32)])])])):k("",!0),g.value?(d(),u("div",dt,[t("div",ut,[t("div",ct,[e[27]||(e[27]=t("h3",{class:"text-lg font-bold mb-4"},"Konfirmasi Hapus",-1)),t("p",pt,[e[25]||(e[25]=f(' Apakah Anda yakin ingin menghapus estimasi perbaikan untuk "')),t("strong",null,b(s.part_name),1),e[26]||(e[26]=f('"? '))]),t("div",mt,[t("button",{onClick:e[9]||(e[9]=r=>g.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"}," Batal "),t("button",{onClick:B,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",disabled:c.value},[c.value?(d(),u("span",bt,"Menghapus...")):(d(),u("span",yt,"Ya, Hapus"))],8,gt)])])])])):k("",!0)],64))}},ft={class:"mt-8 pt-6 border-t border-gray-300"},vt={class:"flex justify-between items-center mb-4"},kt={key:0,class:"overflow-x-auto"},wt={class:"w-full border-collapse border border-gray-300 rounded-lg overflow-hidden"},ht={class:"bg-gray-100"},_t={key:0,class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},Et={class:"p-3 border border-gray-300"},Ct={class:"p-3 border border-gray-300 font-medium"},Dt={class:"p-3 border border-gray-300"},It={class:"p-3 border border-gray-300"},$t={class:"flex flex-col gap-1"},Mt={class:"p-3 border border-gray-300 font-bold text-right"},jt={key:0,class:"p-3 border border-gray-300"},Bt={class:"flex gap-2"},St=["onClick"],Vt=["onClick"],Ut={class:"bg-gray-100"},Pt=["colspan"],Nt={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded-lg"},Rt={__name:"RepairEstimationSection",props:{estimations:{type:Array,default:()=>[]},inspectionId:{type:[String,Number],required:!0},encryptedIds:{type:String,required:!0},canEdit:{type:Boolean,default:!1}},emits:["update:estimations","update:totalCost"],setup(p,{emit:I}){const l=p,m=I,c=D(!1),g=D(null),y=V(()=>l.estimations.reduce((o,a)=>o+parseFloat(a.estimated_cost||0),0));U(y,o=>{m("update:totalCost",o)});const s=o=>o?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o):"Rp 0",h=o=>o==="segera"?"Segera":"Jangka Panjang",_=o=>({perlu:"Perlu",disarankan:"Disarankan",opsional:"Opsional"})[o]||o,$=o=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{segera:"bg-red-100 text-red-800",jangka_panjang:"bg-yellow-100 text-yellow-800"}[o]||"bg-gray-100 text-gray-800"}`,M=o=>`inline-block px-2 py-1 rounded-full text-xs font-medium ${{perlu:"bg-red-100 text-red-800",disarankan:"bg-yellow-100 text-yellow-800",opsional:"bg-blue-100 text-blue-800"}[o]||"bg-gray-100 text-gray-800"}`,E=()=>{g.value=null,c.value=!0},j=o=>{g.value=o,c.value=!0},B=o=>{g.value=o,c.value=!0},v=()=>{c.value=!1,g.value=null},n=o=>{const a=l.estimations.findIndex(i=>i.id===o.id);if(a!==-1){const i=[...l.estimations];i[a]=o,m("update:estimations",i)}else m("update:estimations",[...l.estimations,o]);v()},e=o=>{const a=l.estimations.filter(i=>i.id!==o);m("update:estimations",a),v()},r=o=>{const a=l.estimations.filter(i=>i.id!==o);m("update:estimations",a)};return(o,a)=>(d(),u("div",ft,[t("div",vt,[a[1]||(a[1]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Estimasi Perbaikan",-1)),p.canEdit?(d(),u("button",{key:0,onClick:E,class:"bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200 flex items-center gap-2"},a[0]||(a[0]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),f(" Tambah Estimasi ")]))):k("",!0)]),p.estimations.length>0?(d(),u("div",kt,[t("table",wt,[t("thead",ht,[t("tr",null,[a[2]||(a[2]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"No",-1)),a[3]||(a[3]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Part/Komponen",-1)),a[4]||(a[4]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Deskripsi Perbaikan",-1)),a[5]||(a[5]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Urgensi & Status",-1)),a[6]||(a[6]=t("th",{class:"p-3 border border-gray-300 text-left font-bold text-gray-700"},"Estimasi Biaya",-1)),p.canEdit?(d(),u("th",_t,"Aksi")):k("",!0)])]),t("tbody",null,[(d(!0),u(F,null,A(p.estimations,(i,P)=>(d(),u("tr",{key:i.id,class:S(P%2===0?"bg-white":"bg-gray-50")},[t("td",Et,b(P+1),1),t("td",Ct,b(i.part_name),1),t("td",Dt,b(i.repair_description),1),t("td",It,[t("div",$t,[t("span",{class:S($(i.urgency))},b(h(i.urgency)),3),t("span",{class:S(M(i.status))},b(_(i.status)),3)])]),t("td",Mt,b(s(i.estimated_cost)),1),p.canEdit?(d(),u("td",jt,[t("div",Bt,[t("button",{onClick:R=>j(i),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"}," Edit ",8,St),t("button",{onClick:R=>B(i),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"}," Hapus ",8,Vt)])])):k("",!0)],2))),128))]),t("tfoot",Ut,[t("tr",null,[a[7]||(a[7]=t("td",{colspan:"4",class:"p-3 border border-gray-300 text-right font-bold"}," Total Estimasi: ",-1)),t("td",{colspan:p.canEdit?2:1,class:"p-3 border border-gray-300 font-bold text-right text-green-700"},b(s(y.value)),9,Pt)])])])])):(d(),u("div",Nt,[a[8]||(a[8]=t("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),a[9]||(a[9]=t("p",{class:"text-gray-500"},"Belum ada estimasi perbaikan.",-1)),p.canEdit?(d(),u("button",{key:0,onClick:E,class:"mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"}," Tambah Estimasi Pertama ")):k("",!0)])),c.value?(d(),z(xt,{key:2,"show-modal":c.value,"estimation-data":g.value,"inspection-id":p.inspectionId,"encrypted-ids":p.encryptedIds,onClose:v,onSaved:n,onDeleted:e,onError:r},null,8,["show-modal","estimation-data","inspection-id","encrypted-ids"])):k("",!0)]))}};export{Rt as _,xt as a};
